import{U as D,k as C}from"./index-C7RI_ets.js";const g=(t,e)=>{let{name:s,label:l,group:n}=Object.assign({},e),{readOnly:r,required:f}=Object.assign({},e),h,b;return t&&(l=l||t.label,s=s||t.name,f=t.required||(e==null?void 0:e.required),r=t.readOnly||(e==null?void 0:e.readOnly),h=t.properties,b=t.userInterface),{name:s,label:l,group:n,readOnly:r,required:f,props:h,userInterface:b||D.SHORTTEXT}},q=/child\[([^\]]+)\]/,E=/\$\{.+\}/;class T{constructor(){this._sheets=new Map,this._requiredFields=[],this._cleanOnCopyFields=[],this._defaultValues={}}static getDetailName(e){const s=q.exec(e);return s?s[1]:void 0}getSheet(e){return this._sheets.get(e)}getAllSheets(){return this._sheets}addSheet(e){this._sheets.set(e.name,e)}addRequiredFields(e){this._requiredFields=this._requiredFields.concat(e)}getRequiredFields(){return this._requiredFields}addCleanOnCopyFields(e){this._cleanOnCopyFields=this._cleanOnCopyFields.concat(e)}getCleanOnCopyFields(){return this._cleanOnCopyFields}addDefaultValues(e){return this._defaultValues=Object.assign(Object.assign({},this._defaultValues),e)}getDefaultValues(){const e={};return Object.entries(this._defaultValues).forEach(([s,l])=>{if(typeof l=="string"){const n=E.exec(l);n&&(l=this.getDefaultVar(n[0]))}e[s]=l}),e}getDefaultVar(e){return e==="${data}"?C.getToday():e==="${datahora}"?C.getToday(!0):this._defaultVars?this._defaultVars.get(e):void 0}setDefaultVars(e){this._defaultVars=e}}const M=t=>{const e=t.metadata;let s;return e&&(s=e.fields.filter(n=>n.visible!==!1).map(n=>({name:n.name,defaultValue:n.defaultValue}))),{emptyConfig:!1,fields:s}},w=(t,e,s=!1)=>{var l,n;(t==null||(t==null?void 0:t.emptyConfig)===!0)&&(t=M(e));const r=new Map,f=new Map,h=[],b=[],y={};(l=t==null?void 0:t.tabs)===null||l===void 0||l.forEach(a=>{!f.has(a.label)&&a.visible===!1&&f.set(a.label,a)}),(n=t==null?void 0:t.fields)===null||n===void 0||n.forEach(a=>{var d,p,_;if(a.visible!==!1){const u=A(a.tab||"__main",r);if(f.has(u.label))return;const i=e.getField(a.name),O=(i==null?void 0:i.visible)==null||(i==null?void 0:i.visible)===!0;if(i&&O&&u.visible){r.has(u)||r.set(u,[]);const F=g(i,a);r.get(u).push(F),F.required&&h.push(a.name),((a.cleanOnCopy==null?(d=i.properties)===null||d===void 0?void 0:d.cleanOnCopy:a.cleanOnCopy)||!((p=i.properties)===null||p===void 0)&&p.cleanOnCopy)&&b.push(a.name);let o=a.defaultValue==null?(_=i.properties)===null||_===void 0?void 0:_.defaultValue:a.defaultValue;if(o&&o.value!=null){const{type:V,value:m}=o;if(V)if(V==="V")o=m;else try{const v=JSON.parse(m);v&&"value"in v?o=v:o=m}catch{}y[a.name]=o}}}});const c=new T;if(c.setDefaultVars(t.defaultVars),s){const a=e.metadata;a!=null&&a.children!=null&&a.children.forEach(d=>{const{label:p,name:_,fields:u}=S(d);r.set({name:_,label:p},u)})}return Array.from(r.entries()).sort(R).forEach(([a,d])=>{c.addSheet({label:a.label==="__main"?"Principal":a.label,name:a.name||a.label,fields:d})}),c.addRequiredFields(h),c.addCleanOnCopyFields(b),c.addDefaultValues(y),c},A=(t,e)=>(typeof t=="string"?Array.from(e.keys()).find(l=>l.label===t):t)||{label:t,visible:!0},R=(t,e)=>t[0].label=="__main"?-1:(t[0].order||1e4)-(e[0].order||1e4),S=t=>({name:`child[${t.name}]`,label:t.label,fields:[]});export{T as F,M as a,w as b};
//# sourceMappingURL=FormMetadata-GNw8SuGx.js.map

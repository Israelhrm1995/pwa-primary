import{U as m,D as c,N,k as b}from"./index-C7RI_ets.js";import{F as p}from"./filter-item-type.enum-d45e026f-B41QHsvD.js";import{F as f}from"./index-8acbae97-DxLtPl40.js";class L{static buildFilterExpression(e){var i;if(e==null)return;let a=(i=this.buildVariableParameterValue(e))!==null&&i!==void 0?i:void 0,t=e.expression||"",r="'";switch(e.paramVariable&&(r=""),e.operand){case"IN":t+=` ${f[e.operand]} (${a})`;break;case"NULL":case"NOT_NULL":t+=` IS ${f[e.operand]}`;break;case"LIKE":t+=` LIKE '%${a}%'`;break;case"START_WITH":t+=` LIKE '${a}%'`;break;case"FINISHED_WITH":t+=` LIKE '%${a}'`;break;default:e.operand&&(t+=` ${f[e.operand]}`),["string","number"].includes(typeof a)&&(a=isNaN(a)?`${r}${a}${r}`:a,t+=` ${a}`)}return t}static buildVariableParameterValue(e){var i;if(e!=null){if(e.paramVariable)return this.proccessVarialbeParameter(e);if(e.operand!==f.NULL&&e.operand!=="NOT_NULL"){let a=e.value;const t=e.type;return(m.SEARCH===e.userInterface||e.userInterface===m.OPTIONSELECTOR||c.OBJECT==t)&&(a=(i=a==null?void 0:a.value)!==null&&i!==void 0?i:a),c.NUMBER==t&&a!=null?(a=N.stringToNumber(a),this.checkIsValidNumber(a)):c.DATE==t?a=this.convertDataValue(a):c.BOOLEAN==t&&(a=a?"S":"N"),a}return e.operand}}static checkIsValidNumber(e){if(isNaN(e))throw new Error("O valor informado não é um número válido.")}static proccessVarialbeParameter(e){if(e.systemConfig!=null){const i=e.systemConfig;return`?:{entidade=${i.entity||""};campo=${i.fieldName||""}}`}if(e.userConfig!=null){const i=e.userConfig;return`?:{desc=${i.description||""};tipo=${i.type||""}}`}return`?:{entidade=${e.entityName||""};campo=${e.fieldName||""}}`}static convertDataValue(e){return typeof e=="string"&&(e=new Date(e)),b.formatDate(e)}static buildGroupExpression(e){var i,a;if(!(!((i=e==null?void 0:e.items)===null||i===void 0)&&i.length))return"";const t=e.items.map(r=>this.buildFilterExpression(r)).join(` ${e.operand} `);if(((a=e==null?void 0:e.childrenGroups)===null||a===void 0?void 0:a.length)>0){const r=e.childrenGroups.map(l=>this.buildGroupExpression(l)).join(` ${e.operand} `);return`(${t} ${e.operand} (${r}))`}return`(${t})`}static validateFields(e){const i=this.buildPlainExpressionItems(e);for(const a of i)if(!this.validateExpressionItem(a))return!1;return!0}static buildPlainExpressionItems(e){const{items:i=[],childrenGroups:a=[]}=e||{},t=r=>r.reduce((l,d)=>{var s;return d.items&&(l=l.concat(d.items)),!((s=d.childrenGroups)===null||s===void 0)&&s.length&&(l=l.concat(t(d.childrenGroups))),l},[]);return i.concat(t(a))}static validateExpressionItem(e){return Object.entries({fieldName:t=>!!t,value:(t,r)=>r?!0:t!=null,operand:t=>!!t}).every(t=>{const[r,l]=t,d=e.paramVariable||e.userInterface==="SWITCH"||["NULL","NOT_NULL"].includes(e.operand);return l(e[r],d)})}static getNormalizedValue(e,i){return e.reduce((a,t,r)=>(t.dataType===c.BOOLEAN&&(a==null||a[r]==null)&&(a=a&&!Array.isArray(a)?[a]:a||[],a[r]=!1),a),i)}static validateVariableValues(e,i){if(!e)return!0;let a=i||e.value,t=!0;if(e.type===p.PERSONALIZED){const l=(e.groupedItems||[]).filter(n=>n.visible).filter(n=>{var u,o,v;return!!(!((v=(o=(u=n.props)===null||u===void 0?void 0:u.personalizedFilter)===null||o===void 0?void 0:o.parameters)===null||v===void 0)&&v.length)}),d=l.flatMap(n=>{var u;return(u=n.props.personalizedFilter)===null||u===void 0?void 0:u.parameters}),s=l.flatMap(n=>n.props.personalizedFilter.parameters.flatMap((u,o)=>n.value?n.value[o]===void 0&&u.dataType===c.BOOLEAN?!1:n.value[o]:null));a=this.getNormalizedValue(d,a),t=d.length===s.length&&s.every(n=>n!=null)}return t}static buildVariableParameters(e){const i=this.buildPlainExpressionItems(e),a=[];for(const t of i)t.paramVariable&&a.push({entityName:t.entityName,fieldName:t.fieldName});return a}}export{L as P};
//# sourceMappingURL=PersonalizedFilterUtils-2db38ff2-LzsptIzZ.js.map

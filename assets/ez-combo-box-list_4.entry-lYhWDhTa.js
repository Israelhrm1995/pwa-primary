import{b as u,e as o,k as p,d as m,i as v}from"./index-BV2D5AMk.js";import{E as b,O as x,S as w}from"./dataUnitInMemoryLoader-BjgoPaoq.js";import{H as g,p as _}from"./purify-da6317bb-DN2mK1xw.js";import{K as y}from"./index-dokJR7Uh.js";import{C as z}from"./FormLayout-071d324c-B21b_KW2.js";import{R as c,a as d}from"./RichToolbarHelper-fd6427df-BbctMkQE.js";import{A as k}from"./ApplicationUtils-eaf91331-DedxIlrs.js";import"./DialogType-54a62731-BI65OFfy.js";import"./CheckMode-bdb2ec19-B2adzS2d.js";import"./_commonjsHelpers-9943807e-B7wMhLWa.js";const S=":host{--ez-combo-box--border-radius:var(--border--radius-medium, 12px);--ez-combo-box--font-size:var(--text--medium, 14px);--ez-combo-box--font-family:var(--font-pattern, Arial);--ez-combo-box--font-weight--large:var(--text-weight--large, 500);--ez-combo-box--font-weight--medium:var(--text-weight--medium, 400);--ez-combo-box--background-color--xlight:var(--background--xlight, #fff);--ez-combo-box--background-medium:var(--background--medium, #f0f3f7);--ez-combo-box--line-height:calc(var(--text--medium, 14px) + 4px);--ez-combo-box__list-title--primary:var(--title--primary, #2B3A54);--ez-combo-box__list-text--primary:var(--text--primary, #626e82);--ez-combo-box__list-height:calc(var(--ez-combo-box--font-size) + var(--ez-combo-box--space--medium) + 4px);--ez-combo-box--space--medium:var(--space--medium, 12px);--ez-combo-box--space--small:var(--space--small, 6px);--ez-combo-box__scrollbar--color-default:var(--scrollbar--default, #626e82);--ez-combo-box__scrollbar--color-background:var(--scrollbar--background, #E5EAF0);--ez-combo-box__scrollbar--color-hover:var(--scrollbar--hover, #2B3A54);--ez-combo-box__scrollbar--color-clicked:var(--scrollbar--clicked, #a2abb9);--ez-combo-box__scrollbar--border-radius:var(--border--radius-small, 6px);--ez-combo-box__scrollbar--width:var(--space--medium, 12px);--ez-combo-box__list-container--padding:var(--space--extra-small, 3px)}.list-container{padding-top:var(--ez-combo-box__list-container--padding)}.list-wrapper{display:flex;flex-direction:column;box-sizing:border-box;width:0;z-index:var(--more-visible, 2);max-height:calc(4*var(--ez-combo-box__list-height) + 2*var(--ez-combo-box--space--small) + 9px);background-color:var(--ez-combo-box--background-color--xlight);border-radius:var(--ez-combo-box--border-radius);box-shadow:var(--shadow--medium, 0 8px 24px 0 rgba(43, 58, 84, 0.10));padding:var(--ez-combo-box--space--small)}.list-options{box-sizing:border-box;width:100%;height:100%;padding:0;margin:0;display:flex;flex-direction:column;scroll-behavior:smooth;overflow:auto;scrollbar-width:thin;gap:3px;scrollbar-color:var(--ez-combo-box__scrollbar--color-clicked) var(--ez-combo-box__scrollbar--color-background)}.list-options::-webkit-scrollbar{background-color:var(--ez-combo-box__scrollbar--color-background);width:var(--ez-combo-box__scrollbar--width);max-width:var(--ez-combo-box__scrollbar--width);min-width:var(--ez-combo-box__scrollbar--width)}.list-options::-webkit-scrollbar-track{background-color:var(--ez-combo-box__scrollbar--color-background);border-radius:var(--ez-combo-box__scrollbar--border-radius)}.list-options::-webkit-scrollbar-thumb{background-color:var(--ez-combo-box__scrollbar--color-default);border-radius:var(--ez-combo-box__scrollbar--border-radius)}.list-options::-webkit-scrollbar-thumb:vertical:hover,.list-options::-webkit-scrollbar-thumb:horizontal:hover{background-color:var(--ez-combo-box__scrollbar--color-hover)}.list-options::-webkit-scrollbar-thumb:vertical:active,.list-options::-webkit-scrollbar-thumb:horizontal:active{background-color:var(--ez-combo-box__scrollbar--color-clicked)}.item{display:flex;align-items:center;width:100%;box-sizing:border-box;list-style-type:none;cursor:pointer;border-radius:var(--ez-combo-box--border-radius-small);padding:var(--ez-combo-box--space--small);min-height:var(--ez-combo-box__list-height);gap:var(--space--small, 6px)}.item__value,.item__label{flex-basis:auto;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--ez-combo-box__list-title--primary);font-family:var(--ez-combo-box--font-family);font-size:var(--ez-combo-box--font-size);line-height:var(--ez-combo-box--line-height)}.item__label{font-weight:var(--ez-combo-box--font-weight--medium)}.item__label--bold{font-weight:var(--ez-combo-box--font-weight--large)}.item__value{text-align:center;color:var(--ez-combo-box__list-text--primary);font-weight:var(--ez-combo-box--font-weight--large)}.item__value--hidden{visibility:hidden;position:absolute;white-space:nowrap;z-index:-1;top:0;left:0}.item__label{text-align:left}.message{text-align:center;display:flex;justify-content:center;align-items:center;list-style-type:none;min-height:var(--ez-combo-box__list-height)}.message__no-result{color:var(--ez-combo-box__list-title--primary);font-family:var(--ez-combo-box--font-family);font-size:var(--ez-combo-box--font-size)}.message__loading{border-radius:50%;width:14px;height:14px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;border:3px solid var(--ez-combo-box__list-title--primary);border-top:3px solid transparent}li:hover{background-color:var(--ez-combo-box--background-medium)}.preselected{background-color:var(--background--medium)}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",E=class{constructor(e){u(this,e),this.showLoading=void 0,this.visibleOptions=void 0,this.textEmptyList="Nenhum resultado encontrado",this.showOptionValue=void 0,this.preSelection=void 0,this.maxWidth=void 0,this.width=void 0,this.onOptionSelect=void 0,this.onOptionHover=void 0}async nextOption(){var e,t;if(!(!((e=this.visibleOptions)===null||e===void 0)&&e.length))return;this.preSelection!==void 0&&this.preSelection>=this.visibleOptions.length-1||(this.preSelection=this.preSelection===void 0?0:this.preSelection+1,this.scrollToOption(this.visibleOptions[this.preSelection]),(t=this.onOptionHover)===null||t===void 0||t.call(this,this.preSelection))}async previousOption(){var e,t;if(!(!((e=this.visibleOptions)===null||e===void 0)&&e.length))return;this.preSelection!==void 0&&this.preSelection<=0||(this.preSelection=this.preSelection===void 0?this.visibleOptions.length-1:this.preSelection-1,this.scrollToOption(this.visibleOptions[this.preSelection]),(t=this.onOptionHover)===null||t===void 0||t.call(this,this.preSelection))}async selectCurrentOption(){this.preSelection!==void 0&&(this.onOptionSelect(this.visibleOptions[this.preSelection]),this.preSelection=void 0)}observeWidth(e,t){e!==t&&this._listWrapper&&(this._listWrapper.style.width=`${this.width}px`)}observeMaxWidth(e,t){e!==t&&this._listWrapper&&(this._listWrapper.style.maxWidth=this.maxWidth?`${this.maxWidth}px`:"")}handleKeyDown(e){switch(e.key){case"ArrowDown":e.preventDefault(),e.stopPropagation(),this.nextOption();break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),this.previousOption();break;case"Enter":this.selectCurrentOption();break;case"Escape":this.preSelection=void 0;break}}buildItem(e,t){const i=this.showOptionValue&&this.maxWidth>0?`${this.maxWidth}px`:"";return e.label=e.label||e.value,o("li",{tabIndex:1,class:t===this.preSelection?"item preselected":"item",id:`item_${e.value}_${t}`,key:`item_${e.value}_${t}`,onMouseDown:()=>this.onOptionSelect(e),onMouseOver:()=>this.preSelection=t},this.showOptionValue?o("span",{class:"item__value",title:e.value,style:{width:i,minWidth:i,maxWidth:i}},e.value):void 0,o("span",{class:"item__label "+(this.showOptionValue?"item__label--bold":""),title:e.label},e.label))}scrollToOption(e){if(!(e!=null&&e.value)||!this._optionsList)return;const t=this.visibleOptions.indexOf(e);if(t===-1)return;const i=this._optionsList.querySelector(`li#item_${CSS.escape(e.value)}_${CSS.escape(String(t))}`);i&&i.scrollIntoView({behavior:"smooth",block:"nearest"})}componentDidLoad(){this._listWrapper.style.width=`${this.width}px`,this._listWrapper.style.maxWidth=this.maxWidth?`${this.maxWidth}px`:""}componentDidRender(){var e;(e=this._optionsList)===null||e===void 0||e.querySelectorAll(".item").forEach(t=>{b.addIDInfoIfNotExists(t,"itemComboBox")})}render(){return o("section",{class:"list-container"},o("div",{class:"list-wrapper",ref:e=>this._listWrapper=e},o("ul",{class:"list-options",ref:e=>this._optionsList=e},!this.showLoading&&this.visibleOptions.length===0&&o("div",{class:"message"},o("span",{class:"message__no-result"},this.textEmptyList)),this.showLoading&&o("div",{class:"message"},o("div",{class:"message__loading"})),this.showOptionValue&&o("span",{class:"item__value item__value--hidden"}),!this.showLoading&&this.visibleOptions.length>0&&this.visibleOptions.map((e,t)=>this.buildItem(e,t)))))}static get watchers(){return{width:["observeWidth"],maxWidth:["observeMaxWidth"]}}};E.style=S;const H=class{constructor(e){u(this,e),this.gui=void 0,this.customEditor=void 0,this.formViewField=void 0,this.value=void 0,this.detailContext=void 0,this.builderFallback=void 0,this.selectedRecord=void 0}async setFocus(){var e,t;(t=(e=this.gui)===null||e===void 0?void 0:e.setFocus)===null||t===void 0||t.call(e)}async setBlur(){var e,t;(t=(e=this.gui)===null||e===void 0?void 0:e.setBlur)===null||t===void 0||t.call(e)}async isInvalid(){var e,t;return((t=(e=this.gui)===null||e===void 0?void 0:e.isInvalid)===null||t===void 0?void 0:t.call(e))||!1}watchValue(){this.handleValue(this.gui)}watchCustomEditor(){this.getContent()}watchFormViewField(e,t){x.equals(e,t)||this.getContent()}watchDetailContext(){this.getContent()}watchBuilderFallback(){this.getContent()}watchSelectedRecord(e,t){const i=e==null?void 0:e.__record__id__,s=t==null?void 0:t.__record__id__;i!==s&&this.getContent()}getContent(){var e,t,i,s,r;const n=new Map;for(const l in this.formViewField.props)n.set(l,this.formViewField.props[l]);const h={value:this.value,name:this.formViewField.name,currentEditor:this.builderFallback(this.formViewField),setValue:l=>this.setValue(l),getValue:this.getValue,record:this.selectedRecord,editorMetadata:{label:this.formViewField.label,hidden:((e=this.formViewField.props)===null||e===void 0?void 0:e.visible)===!1,userInterface:this.formViewField.userInterface,options:(t=this.formViewField.props)===null||t===void 0?void 0:t.options,props:this.formViewField.props?n:void 0,optionLoader:this.formViewField.optionLoader},source:z.FORM,detailContext:this.detailContext};let a=this.customEditor.getEditorElement(h);if(!a){a=this.builderFallback(this.formViewField),this.handleValue(a),this.gui=a;return}if(!(a instanceof HTMLElement)&&typeof a!="string"){this.handleValue(a),this.gui=a;return}typeof a=="string"&&(a=g.parseElement(a));const f=(r=(s=(i=this.value)===null||i===void 0?void 0:i.value)!==null&&s!==void 0?s:this.value)!==null&&r!==void 0?r:"";a.setAttribute("value",f),this.gui=o("div",{key:w.generateUUID(),ref:l=>l&&l.appendChild(a)})}setValue(e){this.value=e}getValue(){return this.value}handleValue(e){var t;(t=e.$children$)===null||t===void 0||t.forEach(i=>{i.$attrs$.value=this.value})}componentWillLoad(){this.getContent()}render(){return o(p,null,this.gui)}static get watchers(){return{value:["watchValue"],customEditor:["watchCustomEditor"],formViewField:["watchFormViewField"],detailContext:["watchDetailContext"],builderFallback:["watchBuilderFallback"],selectedRecord:["watchSelectedRecord"]}}},F=".sc-ez-rich-text-h{display:block;width:100%;font-family:Roboto;--ez-rich-text--box-shadow:0 0 3px 0 #DCE0E8;--ez-rich-text--shadow--outline:var(--shadow--outline) var(--color--strokes)}.editor-container.sc-ez-rich-text{width:100%;overflow:hidden;border-radius:12px;border:1px solid #DCE0E8}ez-text-area.sc-ez-rich-text{--text-area__input--border:1px solid}.preview.sc-ez-rich-text{min-height:20px;padding:12px;resize:both;overflow:auto;max-width:100%;border-top:1px solid #DCE0E8}",C=class{constructor(e){u(this,e),this.ezChange=m(this,"ezChange"),this.historyStack=[],this.historyIndex=-1,this.previewMode=!1,this.showPreview=!0,this.value="",this.label=void 0,this.mode="regular",this.enabled=!0,this.rows=6,this.errorMessage=void 0,this.canShowError=!0,this.showConfigs=!0,this.showTextFormat=!0,this.showUndoRedo=!0}observeValue(e,t){x.equals(e,t)||this.ezChange.emit(e)}observeErrorMessage(e){e&&this.previewMode&&(this.previewMode=!1)}async handleExecuteToolbarCommand(e){const{command:t,value:i}=e.detail;await this.executeCommand(t,i)}async setFocus(){this.handleFocus()}async setBlur(){var e;await((e=this.textAreaRef)===null||e===void 0?void 0:e.setBlur())}async isInvalid(){return typeof this.errorMessage=="string"&&this.errorMessage.trim()!==""}bindPreview(){!this._keyboardManager||!this.showPreview||this._keyboardManager.bind("ctrl + p",async()=>{await this.togglePreview()},{description:"Entra em modo de pré visualização.",element:this.element})}bindConfigs(){!this._keyboardManager||!this.showConfigs||this._keyboardManager.bind("ctrl + l",async()=>{await this.handleFormatSelection(c.LIST)},{description:"Aplica estilo de lista ao texto selecionado.",element:this.element}).bind("ctrl + k",async()=>{await this.handleLink()},{description:"Abre popup de link.",element:this.element}).bind("ctrl + o",async()=>{await this.handleImage()},{description:"Abre popup de imagem.",element:this.element})}bindTextFormat(){!this._keyboardManager||!this.showTextFormat||this._keyboardManager.bind("ctrl + b",async()=>{await this.handleFormatSelection(c.BOLD)},{description:"Aplica estilo negrito ao texto selecionado.",element:this.element}).bind("ctrl + i",async()=>{await this.handleFormatSelection(c.ITALIC)},{description:"Aplica estilo itálico ao texto selecionado.",element:this.element}).bind("ctrl + u",async()=>{await this.handleFormatSelection(c.UNDERLINE)},{description:"Aplica estilo underline ao texto selecionado.",element:this.element})}initKeyboardManager(){this._keyboardManager=new y({propagate:!1,element:this.element}),this._keyboardManager.bind("ctrl + Enter",async()=>{await this.handleFormatSelection(c.BREAK_LINE)},{description:"Aplica quebra de linha.",element:this.element}).bind("ctrl + z",async()=>{await this.handleUndo()},{description:"Desfaz a ultima alteração de texto.",element:this.element}).bind("ctrl + x",async()=>{await this.handleRedo()},{description:"Refaz a ultima alteração de texto.",element:this.element}),this.bindPreview(),this.bindConfigs(),this.bindTextFormat()}async executeCommand(e,t){switch(e){case d.FOCUS:this.handleFocus();break;case d.PREVIEW:await this.togglePreview();break;case d.FORMAT:await this.handleFormatSelection(t);break;case d.UNDO:await this.handleUndo();break;case d.REDO:await this.handleRedo();break;case d.LINK:await this.handleLink();break;case d.IMAGE:await this.handleImage();break}}handleFocus(){this.previewMode=!1,requestAnimationFrame(async()=>{await this.textAreaRef.setFocus()})}async handleLink(){this.previewMode=!1,requestAnimationFrame(async()=>{await this.linkBuilderRef.show(this.getSelectedText())})}async handleImage(){this.previewMode=!1,await this.imageUploaderRef.show()}async handleRedo(){this.previewMode=!1,requestAnimationFrame(async()=>{this.redo(),await this.textAreaRef.setFocus()})}async handleUndo(){this.previewMode=!1,requestAnimationFrame(async()=>{this.undo(),await this.textAreaRef.setFocus()})}async handleFormatSelection(e){e&&(this.previewMode=!1,requestAnimationFrame(async()=>{await this.formatSelection(e),await this.textAreaRef.setFocus()}))}async togglePreview(){this.previewMode=!this.previewMode,this.previewMode&&await this.textAreaRef.setFocus()}getSelectedText(){const e=this.getTextAreaElement();if(!e)return;const t=e.selectionStart,i=e.selectionEnd;return(this.textAreaRef.value||"").substring(t,i)}getTextAreaElement(){return this.element.querySelector("ez-text-area").shadowRoot.querySelector("textarea")}async formatSelection(e){if(!this.textAreaRef)return;const t=e.replace("$selection",this.getSelectedText()||"");await this.textAreaRef.appendTextToSelection(t),this.value=this.textAreaRef.value,this.addToHistory(this.value)}addToHistory(e){this.historyIndex>=0&&e===this.historyStack[this.historyIndex]||(this.historyStack.length>=50&&this.historyStack.splice(0,this.historyStack.length-49),this.historyStack.push(e),this.historyIndex=this.historyStack.length-1)}undo(){if(!this.canExecuteUndo())return;this.historyIndex--;const e=this.historyStack[this.historyIndex];this.value=e,this.textAreaRef.value=e}canExecuteUndo(){return this.historyIndex>0}redo(){this.canExecuteRedo()&&(this.historyIndex++,this.getValueFromHistory())}canExecuteRedo(){return this.historyIndex<this.historyStack.length-1}getValueFromHistory(){const e=this.historyStack[this.historyIndex];this.value=e,this.textAreaRef.value=e}handleTextAreaChanged(e){this.value=e.detail,this.addToHistory(this.value)}async removeShortcuts(){var e;(e=this._keyboardManager)===null||e===void 0||e.unbindAllShortcutKeys()}componentDidLoad(){this.initKeyboardManager(),this.addToHistory(this.value)}async disconnectedCallback(){await this.removeShortcuts()}getSanitizedValue(){return _.sanitize(this.value,{ADD_ATTR:["target","rel"]})}renderContent(){return this.previewMode?o("div",{id:"rich-text-preview-container",class:"preview",innerHTML:this.getSanitizedValue()}):o("ez-text-area",{ref:e=>this.textAreaRef=e,label:this.label,value:this.value,enabled:this.enabled,rows:this.rows,mode:this.mode,canShowError:this.canShowError,errorMessage:this.errorMessage,onEzChange:this.handleTextAreaChanged.bind(this)})}render(){return o(p,null,o("div",{class:"editor-container bordered"},o("ez-rich-toolbar",{isPreviewMode:this.previewMode,showPreview:this.showPreview,showConfigs:this.showConfigs&&this.enabled,showTextFormat:this.showTextFormat&&this.enabled,showUndoRedo:this.showUndoRedo&&this.enabled}),this.renderContent()),o("ez-link-builder",{ref:e=>this.linkBuilderRef=e}),o("ez-simple-image-uploader",{ref:e=>this.imageUploaderRef=e}))}get element(){return v(this)}static get watchers(){return{value:["observeValue"],errorMessage:["observeErrorMessage"]}}};C.style=F;const A=":host{display:flex;align-items:center;gap:5px}.text-edit__form-input{width:auto;--ez-text-input__input--padding:0px}.text-edit__hidden-value{visibility:hidden;position:absolute;white-space:nowrap;z-index:-1;top:0;left:0}",I=class{constructor(e){u(this,e),this.saveEdition=m(this,"saveEdition"),this.cancelEdition=m(this,"cancelEdition"),this._newValue=void 0,this.value=void 0,this.styled=void 0}async applyFocusSelect(){this.calcSizeInput(this.value,!0)}calcSizeInput(e,t=!1){var i,s;const r=(s=(i=this._inputElement)===null||i===void 0?void 0:i.shadowRoot)===null||s===void 0?void 0:s.querySelector("input");if(r!=null){const n=this.getWidthValue(e);r.style.width=n+"px",t&&setTimeout(()=>r.select(),100)}}getWidthValue(e){if(this._valueBasis!=null){const t=this._valueBasis;if(e!=null)return t.innerHTML=e,t.clientWidth>0?t.clientWidth+2:2;t.innerHTML=""}return 0}setStyledInput(){var e,t;let i="",s="",r="";this.styled!=null&&(i=this.styled.fontSize,s=this.styled.fontWeight,r=this.styled.fontFamily);const n=(t=(e=this._inputElement)===null||e===void 0?void 0:e.shadowRoot)===null||t===void 0?void 0:t.querySelector("input");n!=null&&(n.style.fontSize=i,n.style.fontWeight=s,n.style.fontFamily=r);const h=this._valueBasis;h!=null&&(h.style.fontSize=i,h.style.fontWeight=s,h.style.fontFamily=r)}handleSaveEdition(){if(!this._newValue){k.alert("Aviso","Não é possível salvar um campo em branco.").then(()=>{this.setNewValue(this.value,!0)});return}this.saveEdition.emit({value:this.value,newValue:this._newValue})}handleCancelEdition(){this.cancelEdition.emit()}setNewValue(e,t=!1){this._newValue=e,this.calcSizeInput(this._newValue,t)}componentDidLoad(){this.applyFocusSelect(),this.setNewValue(this.value)}componentDidRender(){this.setStyledInput()}render(){return b.addIDInfoIfNotExists(this._element,"input"),o(p,null,o("span",{class:"text-edit__hidden-value",ref:e=>this._valueBasis=e}),o("ez-text-input",{"data-element-id":b.getInternalIDInfo("textInput"),onInput:()=>{this.calcSizeInput(this._newValue)},class:"text-edit__form-input",value:this._newValue,ref:e=>this._inputElement=e,mode:"slim",onEzChange:e=>this.setNewValue(e==null?void 0:e.detail),noBorder:!0}),o("ez-button",{class:"text-edit__icon-check",mode:"icon",iconName:"check",size:"small",onClick:()=>{this.handleSaveEdition()}}),o("ez-button",{class:"text-edit__icon-close",mode:"icon",iconName:"close",size:"small",onClick:()=>{this.handleCancelEdition()}}))}get _element(){return v(this)}};I.style=A;export{E as ez_combo_box_list,H as ez_custom_form_input,C as ez_rich_text,I as ez_text_edit};

import{b as d,d as c,e as r,k as p,i as b}from"./index-BCuik2gT.js";import{O as h,E as u}from"./dataUnitInMemoryLoader-CwDmnNwL.js";import"./ApplicationUtils-eaf91331-DedxIlrs.js";import{C as _}from"./CSSVarsUtils-acba92d7-BCgqr3Ak.js";import"./DialogType-54a62731-BI65OFfy.js";import"./CheckMode-bdb2ec19-B2adzS2d.js";import"./FormLayout-071d324c-B21b_KW2.js";const v=":host{--ez-combo-box--height:42px;--ez-combo-box--width:100%;--ez-combo-box--border-radius:var(--border--radius-medium, 12px);--ez-combo-box--font-size:var(--text--medium, 14px);--ez-combo-box--font-family:var(--font-pattern, Arial);--ez-combo-box--background-color--xlight:var(--background--xlight, #fff);--ez-combo-box__input--background-color:var(--background--medium, #e0e0e0);--ez-combo-box__input--border:var(--border--medium, 2px solid);--ez-combo-box__input--border-color:var(--ez-combo-box__input--background-color);--ez-combo-box__input--focus--border-color:var(--color--primary, #008561);--ez-combo-box__input--disabled--background-color:var(--color--disable-secondary, #F2F5F8);--ez-combo-box__input--disabled--color:var(--text--disable, #AFB6C0);--ez-combo-box__btn--color:var(--title--primary, #2B3A54);--ez-combo-box__btn-disabled--color:var(--text--disable, #AFB6C0);--ez-combo-box__btn-hover--color:var(--color--primary, #4e4e4e);width:var(--ez-combo-box--width)}ez-icon{--ez-icon--color:inherit;font-weight:var(--text-weight--large, 600)}.suppressed-search-input{--ez-text-input__input--border-color:var(--color--strokes, #dce0e8);--ez-text-input__input--disabled--background-color:var(--background--xlight, #fff);--ez-text-input__input--disabled--color:var(--title--primary, #2B3A54)}.btn{outline:none;border:none;background:none;cursor:pointer;padding:0px;color:var(--ez-combo-box__btn--color)}.btn:disabled{cursor:unset;color:var(--ez-combo-box__btn-disabled--color)}.btn:disabled:hover{cursor:not-allowed;color:var(--ez-combo-box__btn-disabled--color)}.btn:hover{color:var(--ez-combo-box__btn-hover--color)}.btn__close{visibility:hidden}ez-text-input:hover .btn__close,ez-text-input:focus .btn__close{visibility:visible}.text-input-slot-container{--ez-text-input__icon--width:32px;--ez-text-input__min-width:var(--ez-combo-box__min-width);--ez-text-input__max-width:var(--ez-combo-box__max-width)}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",f=class{constructor(e){d(this,e),this.ezChange=c(this,"ezChange"),this._changeDeboucingTimeout=null,this._deboucingTime=300,this._maxWidthValue=0,this._tabPressed=!1,this._textEmptyList="Nenhum resultado encontrado",this._lookupMode=!1,this.isOpen=!1,this._preSelection=void 0,this._visibleOptions=void 0,this._startLoading=!1,this._showLoading=!0,this._criteria=void 0,this.limitCharsToSearch=3,this.value=void 0,this.label=void 0,this.enabled=!0,this.options=void 0,this.errorMessage=void 0,this.showSelectedValue=!1,this.showOptionValue=!1,this.suppressSearch=!1,this.optionLoader=void 0,this.suppressEmptyOption=!1,this.stopPropagateEnterKeyEvent=!0,this.canShowError=!0,this.mode="regular",this.hideErrorOnFocusOut=!0,this.listOptionsPosition=void 0,this.isTextSearch=!1,this.autoFocus=!1,this.preventAutoFocus=!1,this.alternativePlaceholder=void 0,this.textEmptyOption="Selecione um item"}observeErrorMessage(){var e;this._textInput&&(this._textInput.errorMessage=this.errorMessage,!((e=this.errorMessage)===null||e===void 0)&&e.trim()||this.setInputValue())}observeValue(e,t){if(this._textInput&&e!=t)try{if(typeof e=="string"){this.setInputValue();return}const i=this.getSelectedOption(e),s=this.getSelectedOption(t),o=this.getSelectedOption(this.value);if(this.isDifferentValues(o,i)&&(this.value=i),this.isDifferentValues(i,s)){this.setInputValue();const n=i===null?void 0:i;this._lookupMode||this.ezChange.emit(n)}this.resetOptions()}finally{this._lookupMode=!1}}observeOptions(e,t){h.equals(e,t)||this.loadOptions(l.PRELOAD)}async getValueAsync(){return this._showLoading?new Promise(e=>{let t=setInterval(()=>{this._showLoading||(clearInterval(t),e(this.sanitizeValue(this.value)))},100)}):new Promise(e=>e(this.sanitizeValue(this.value)))}async setFocus(e){this._textInput&&this._textInput.setFocus(e)}async setBlur(){this._textInput&&this._textInput.setBlur()}async isInvalid(){return typeof this.errorMessage=="string"&&this.errorMessage.trim()!==""}async clearValue(){this.clearSearch()}isDifferentValues(e,t){return h.objectToString(e||{})!==h.objectToString(t||{})}getFormattedText(e){if(e!=null)return!this.showSelectedValue||e.value==null?e.label:e.label?`${e.value} - ${e.label}`:e.value}getText(){const e=this.getSelectedOption(this.sanitizeValue(this.value)),t=this.getFormattedText(e);if(t!=null)return String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}getSelectedOption(e){return typeof e=="string"||e instanceof String?this._visibleOptions.find(t=>t.value===e):e}updateVisibleOptions(){let e=this._source||[];if(this._criteria){const t=this._criteria.toUpperCase();e=e.filter(i=>i.label.toLocaleUpperCase().indexOf(t)>-1)}this.hasToAddEmptyoption(e)&&(e=[{value:void 0,label:this.textEmptyOption}].concat(e)),this._visibleOptions=e,this._maxWidthValue=this.getMaxWidthValue()}hasToAddEmptyoption(e){return!this.suppressEmptyOption&&!e.filter(t=>!t.value).length}getMaxWidthValue(){var e;if(this.showOptionValue){const t=[];return(e=this._visibleOptions)===null||e===void 0||e.forEach(i=>{const s=this.getWidthValue(i.value);t.includes(s)||t.push(s)}),t.length>1?Math.max(...t):0}return 0}getWidthValue(e){if(this._itemValueBasis!=null){const t=this._itemValueBasis;if(e!=null)return t.innerHTML=e,t.clientWidth>0?t.clientWidth+2:0;t.innerHTML=""}return 0}async showOptions(){var e,t;if(!this.enabled)return;await this.openPopover();const i=(t=(e=this.value)===null||e===void 0?void 0:e.value)!==null&&t!==void 0?t:this.value,s=this._visibleOptions.findIndex(o=>o.value===i);this._preSelection=s===-1?0:s,this._resizeObserver&&this._resizeObserver.observe(this._textInput),this.preventAutoFocus||await this.setFocus()}hideOptions(){var e;(e=this._popover)===null||e===void 0||e.hide(),this._resizeObserver&&this._resizeObserver.unobserve(this._textInput)}updateSource(e){this._startLoading=!1,e instanceof Promise?(this._showLoading=!0,e.then(t=>{this._showLoading=!1,this.updateSource(t)}).catch(()=>this._showLoading=!1),this.updateVisibleOptions()):(this._showLoading=!1,Array.isArray(e)?(this._source=e,this.updateVisibleOptions(),this._tabPressed&&(this._tabPressed=!1)):this.selectOption(e))}selectOption(e,t=!0){var i,s,o;const n=this.getSelectedOption(this.value);if(((i=n==null?void 0:n.value)===null||i===void 0?void 0:i.toString())!==((s=e==null?void 0:e.value)===null||s===void 0?void 0:s.toString())||n==null&&e!=null&&"value"in e){const a=e!=null&&e.value?e:void 0;this.value=a,(o=this._popover)===null||o===void 0||o.hide()}else this.resetOptions();t&&setTimeout(()=>{this.setFocus()},0)}loadOptions(e,t=""){if(this._criteria=t,this._startLoading=!0,this.optionLoader){const i={mode:e,argument:t};this.updateSource(this.optionLoader(i))}else this.updateSource(this.options)}cancelPreselection(){!this._textInput.value&&this.sanitizeValue(this.value)?this.selectOption(void 0):window.setTimeout(()=>{this.setInputValue(!1)},this._deboucingTime)}setInputValue(e=!0){const t=this.getText();(this._textInput.value||"")!==t&&(this._textInput.value=t,e&&(this.errorMessage=null))}clearSearch(){this.value=null}resetOptions(){this.hideOptions(),this._criteria=void 0,this._preSelection=void 0,this.updateVisibleOptions()}sanitizeValue(e){if(!(e==="undefined"||e==="null"))return e}componentWillLoad(){if(this.options===void 0){this.options=[];const e=this.el.querySelectorAll("option");e&&e.forEach(t=>{let i=t.innerText,s=t.getAttribute("value");s||(s=i),this.options.push({label:i,value:s}),t.hidden=!0})}this.loadOptions(l.PRELOAD)}setResizeObserver(){this._resizeObserver=new ResizeObserver(e=>{window.requestAnimationFrame(()=>{if(!Array.isArray(e)||!e.length||!this._textInput||!this._comboBoxList)return;const t=this._textInput.clientWidth;this._comboBoxList.width=t})})}connectedCallback(){this._resizeObserver||this.setResizeObserver()}componentDidLoad(){_.applyVarsTextInput(this.el,this._textInput),this.setInputValue(!1),this.setResizeObserver(),this.autoFocus&&requestAnimationFrame(()=>{this.setFocus({selectText:!0})})}disconnectedCallback(){var e;(e=this._popover)===null||e===void 0||e.remove(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}handlerIconClick(){this.showOptions()}onTextInputChangeHandler(e){var t;if(this.clearDeboucingTimeout(),this._startLoading){this._changeDeboucingTimeout=window.setTimeout(()=>{this.onTextInputChangeHandler(e)},this._deboucingTime);return}const i=(t=e.target.value)===null||t===void 0?void 0:t.trim();this._criteria||(this._textInput.value=e.data||i),this._criteria=i,i?(this.updateVisibleOptions(),this.showOptions()):(this._preSelection=void 0,this.updateVisibleOptions())}clearDeboucingTimeout(){this._changeDeboucingTimeout&&(window.clearTimeout(this._changeDeboucingTimeout),this._changeDeboucingTimeout=null)}onTextInputClickHandler(){this.showOptions()}keyDownHandler(e){var t,i,s,o,n,a;if(e.ctrlKey&&(e.key==="f"||e.key==="F")){this.loadOptions(l.ADVANCED),e.preventDefault(),e.stopPropagation();return}switch(e.key){case"ArrowDown":e.preventDefault(),this.canShowListOptions()&&(this.showOptions(),(t=this._comboBoxList)===null||t===void 0||t.nextOption());break;case"ArrowUp":e.preventDefault(),this.canShowListOptions()&&(this.showOptions(),(i=this._comboBoxList)===null||i===void 0||i.previousOption());break;case"Enter":this.isOpen&&(e.preventDefault(),(s=this._comboBoxList)===null||s===void 0||s.selectCurrentOption());break;case"Escape":this.isOpen&&(e.preventDefault(),(o=this._popover)===null||o===void 0||o.hide());break;case"Tab":this._tabPressed=!0,this.isOpen&&((n=this._comboBoxList)===null||n===void 0||n.selectCurrentOption(),(a=this._popover)===null||a===void 0||a.hide());break}}onTextInputFocusOutHandler(){this.hideErrorOnFocusOut&&this.cancelPreselection()}canShowListOptions(){return!this._showLoading&&this._visibleOptions.length>0}async openPopover(){var e;this.isOpen=!0,await((e=this._popover)===null||e===void 0?void 0:e.showUnder(this._textInput))}render(){var e;return u.addIDInfoIfNotExists(this.el,"input"),r(p,null,r("ez-text-input",{"data-element-id":u.getInternalIDInfo("textInput"),class:`text-input-slot-container ${this.suppressSearch?"suppressed-search-input":""}`,ref:t=>this._textInput=t,"data-slave-mode":"true",enabled:this.enabled&&!this.suppressSearch,onInput:t=>this.onTextInputChangeHandler(t),onClick:()=>this.onTextInputClickHandler(),onFocusout:()=>this.onTextInputFocusOutHandler(),onKeyDown:t=>this.keyDownHandler(t),label:this.label,canShowError:this.canShowError,errorMessage:this.errorMessage,mode:this.mode,alternativePlaceholder:this.alternativePlaceholder},r("button",{class:"btn",slot:"rightIcon",disabled:!this.enabled,tabindex:-1,onClick:()=>this.handlerIconClick()},r("ez-icon",{iconName:"chevron-down"}))),r("ez-popover-plus",{ref:t=>this._popover=t,anchorElement:this._textInput,autoClose:!0,boxWidth:"fit-content",overlayType:"none",onEzVisibilityChange:t=>this.isOpen=t.detail},r("ez-combo-box-list",{ref:t=>this._comboBoxList=t,showLoading:this._showLoading,visibleOptions:this._visibleOptions,textEmptyList:this._textEmptyList,showOptionValue:this.showOptionValue,preSelection:this._preSelection,maxWidth:this._maxWidthValue,width:(e=this._textInput)===null||e===void 0?void 0:e.clientWidth,onOptionSelect:t=>this.selectOption(t),onOptionHover:t=>this._preSelection=t})))}get el(){return b(this)}static get watchers(){return{errorMessage:["observeErrorMessage"],value:["observeValue"],options:["observeOptions"]}}};var l;(function(e){e.ADVANCED="ADVANCED",e.PRELOAD="PRELOAD",e.PREDICTIVE="PREDICTIVE"})(l||(l={}));f.style=v;export{f as ez_combo_box};
//# sourceMappingURL=ez-combo-box.entry-iIds8e7n.js.map

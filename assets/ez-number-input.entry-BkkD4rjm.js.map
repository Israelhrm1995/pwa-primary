{"version":3,"file":"ez-number-input.entry-BkkD4rjm.js","sources":["../../node_modules/@sankhyalabs/ezui/dist/esm/ez-number-input.entry.js"],"sourcesContent":["import { r as registerInstance, c as createEvent, h, g as getElement } from './index-baa5e267.js';\nimport { NumberUtils, StringUtils, ElementIDUtils } from '@sankhyalabs/core';\nimport { C as CSSVarsUtils } from './CSSVarsUtils-acba92d7.js';\n\nconst ezNumberInputCss = \":host{--ez-number-input__min-width:0px;--ez-number-input__max-width:100%;display:block;width:100%}.number__input{height:100%;min-width:var(--ez-number-input__min-width);max-width:var(--ez-number-input__max-width)}\";\n\nconst EzNumberInput = class {\n  constructor(hostRef) {\n    registerInstance(this, hostRef);\n    this.ezChange = createEvent(this, \"ezChange\", 7);\n    this.ezStartChange = createEvent(this, \"ezStartChange\", 7);\n    this.ezCancelWaitingChange = createEvent(this, \"ezCancelWaitingChange\", 7);\n    this._focused = false;\n    this._changePending = false;\n    this._valuePromiseCallbacks = [];\n    this._value = undefined;\n    this.label = undefined;\n    this.value = undefined;\n    this.enabled = true;\n    this.canShowError = true;\n    this.errorMessage = undefined;\n    this.allowNegative = true;\n    this.precision = undefined;\n    this.prettyPrecision = undefined;\n    this.mode = \"regular\";\n    this.autoFocus = false;\n    this.alternativePlaceholder = undefined;\n  }\n  /**\n   * Aplica o foco no campo.\n   */\n  async setFocus(options) {\n    this._textInput.setFocus(options);\n  }\n  /**\n   * Remove o foco do campo.\n   */\n  async setBlur() {\n    this._textInput.setBlur();\n  }\n  /**\n   * Retorna se o conteúdo é inválido.\n   */\n  async isInvalid() {\n    return typeof this.errorMessage === \"string\" && this.errorMessage.trim() !== \"\";\n  }\n  /*\n    * Retorna uma promise com o valor da opção selecionada,\n    * que será resolvida quando o backend devolver este dado.\n    */\n  async getValueAsync() {\n    if (this._changePending) {\n      return new Promise(accept => {\n        this._valuePromiseCallbacks.push(accept);\n      });\n    }\n    return Promise.resolve(this.value);\n  }\n  observeLabel() {\n    if (this._textInput) {\n      this._textInput.label = this.label;\n    }\n  }\n  observeErrorMessage() {\n    var _a;\n    if (this._textInput) {\n      this._textInput.errorMessage = this.errorMessage;\n      if (!((_a = this.errorMessage) === null || _a === void 0 ? void 0 : _a.trim())) {\n        this.setInputValue();\n      }\n    }\n  }\n  observeValue(newValue, oldValue) {\n    if (this._textInput && newValue != oldValue) {\n      this.handleNewValue(newValue, oldValue);\n    }\n    this._changePending = false;\n  }\n  observePrecision() {\n    if (this._textInput) {\n      this.setInputValue();\n    }\n  }\n  handleNewValue(newValue, oldValue) {\n    const newValueValidated = this.validateValue(newValue);\n    const oldValueValidated = this.validateValue(oldValue);\n    if (newValueValidated === null) {\n      this._value = '';\n    }\n    if (newValueValidated === oldValueValidated) {\n      return;\n    }\n    const textValue = this.getTextValue(newValueValidated) || '';\n    const parsedNumber = this.getParsedNumber(textValue);\n    if ((this._value || '') !== textValue && (parsedNumber !== undefined || !this._focused)) {\n      this._value = textValue;\n      this._focused = false;\n      this.errorMessage = \"\";\n    }\n    const valueEmitted = newValueValidated === null ? undefined : newValueValidated;\n    this.ezChange.emit(valueEmitted);\n  }\n  validateValue(value) {\n    return isNaN(value) || value === undefined ? null : value;\n  }\n  getTextValue(value) {\n    if (value == undefined)\n      return undefined;\n    let textValue = this.precision >= 0 ? NumberUtils.format(value.toString(), Number(this.precision), Number(this.prettyPrecision)) : value.toString();\n    return (this.precision === 0) ? StringUtils.replaceAll(textValue, \".\", \"\") : textValue;\n  }\n  changeValue(newValue) {\n    this.errorMessage = \"\";\n    if (this.value != newValue) {\n      this.value = newValue === undefined ? null : newValue;\n    }\n    else {\n      this.setInputValue();\n      this.ezCancelWaitingChange.emit();\n    }\n  }\n  setError(msg) {\n    this.value = null;\n    this.errorMessage = msg;\n    this.ezCancelWaitingChange.emit();\n  }\n  handleBlur() {\n    if (!this._changePending) {\n      return;\n    }\n    try {\n      const parsedNumber = this.getParsedNumber();\n      if (parsedNumber !== undefined && isNaN(parsedNumber)) {\n        this.setError(\"O valor digitado não é um número válido\");\n      }\n      else {\n        try {\n          this.changeValue(parsedNumber);\n        }\n        catch (e) {\n          this.setError(e.message);\n          return;\n        }\n      }\n    }\n    finally {\n      for (const callback of this._valuePromiseCallbacks) {\n        callback(this.value);\n      }\n      this._valuePromiseCallbacks = [];\n    }\n  }\n  handleInput() {\n    const parsedNumber = this.getParsedNumber();\n    if (parsedNumber !== this.value) {\n      this._focused = true;\n      this._changePending = true;\n      this.ezStartChange.emit({ waitmessage: \"\", blocking: false });\n    }\n  }\n  getParsedNumber(value = this._textInput.value) {\n    return (value === null || value === void 0 ? void 0 : value.trim()) ? NumberUtils.stringToNumber(value) : undefined;\n  }\n  setInputValue() {\n    const textValue = this.getTextValue(this.value) || '';\n    if ((this._value || '') !== textValue) {\n      this._value = textValue;\n      this._textInput.value = this._value;\n    }\n  }\n  componentDidLoad() {\n    CSSVarsUtils.applyVarsTextInput(this._elem, this._textInput);\n    this.setInputValue();\n    if (this.autoFocus) {\n      requestAnimationFrame(() => {\n        this.setFocus({ selectText: true });\n      });\n    }\n  }\n  render() {\n    ElementIDUtils.addIDInfoIfNotExists(this._elem, 'input');\n    let restrict = this.precision > 0 ? \"0123456789,.\" : \"0123456789\";\n    if (this.allowNegative) {\n      restrict += '-';\n    }\n    return (h(\"ez-text-input\", { class: \"number__input\", \"data-element-id\": ElementIDUtils.getInternalIDInfo(\"textInput\"), ref: elem => this._textInput = elem, \"data-slave-mode\": \"true\", label: this.label, onBlur: () => this.handleBlur(), onInput: () => this.handleInput(), restrict: restrict, enabled: this.enabled, errorMessage: this.errorMessage, mode: this.mode, canShowError: this.canShowError, value: this._value, alternativePlaceholder: this.alternativePlaceholder }));\n  }\n  get _elem() { return getElement(this); }\n  static get watchers() { return {\n    \"label\": [\"observeLabel\"],\n    \"errorMessage\": [\"observeErrorMessage\"],\n    \"value\": [\"observeValue\"],\n    \"precision\": [\"observePrecision\"],\n    \"prettyPrecision\": [\"observePrecision\"]\n  }; }\n};\nEzNumberInput.style = ezNumberInputCss;\n\nexport { EzNumberInput as ez_number_input };\n"],"names":["ezNumberInputCss","EzNumberInput","hostRef","registerInstance","createEvent","options","accept","_a","newValue","oldValue","newValueValidated","oldValueValidated","textValue","parsedNumber","valueEmitted","value","NumberUtils","StringUtils","msg","e","callback","CSSVarsUtils","ElementIDUtils","restrict","h","elem","getElement"],"mappings":"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","x_google_ignoreList":[0]}
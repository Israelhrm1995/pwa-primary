import{b as v,d as _,e as o,k as f,i as b}from"./index-BV2D5AMk.js";import{C as m}from"./CSSVarsUtils-acba92d7-BCgqr3Ak.js";import{O as p,S as O,E as d}from"./dataUnitInMemoryLoader-BjgoPaoq.js";import{A as g}from"./ApplicationUtils-eaf91331-DedxIlrs.js";import"./DialogType-54a62731-BI65OFfy.js";import"./CheckMode-bdb2ec19-B2adzS2d.js";import"./FormLayout-071d324c-B21b_KW2.js";import{R as x}from"./constants-b036528f-ZVp9Yw9B.js";import{r as u,a as h}from"./searchFormatters-8229207e-CYLc1YSr.js";const V=":host{--ez-search--height:42px;--ez-search--width:100%;--ez-search__icon--width:48px;--ez-search--border-radius:var(--border--radius-medium, 12px);--ez-search--border-radius-small:var(--border--radius-small, 6px);--ez-search--font-size:var(--text--medium, 14px);--ez-search--font-family:var(--font-pattern, Arial);--ez-search--font-weight--large:var(--text-weight--large, 500);--ez-search--font-weight--medium:var(--text-weight--medium, 400);--ez-search--background-color--xlight:var(--background--xlight, #fff);--ez-search--background-medium:var(--background--medium, #f0f3f7);--ez-search--line-height:calc(var(--text--medium, 14px) + 4px);--ez-search__input--background-color:var(--background--medium, #e0e0e0);--ez-search__input--border:var(--border--medium, 2px solid);--ez-search__input--border-color:var(--ez-search__input--background-color);--ez-search__input--focus--border-color:var(--color--primary, #008561);--ez-search__input--disabled--background-color:var(--color--disable-secondary, #F2F5F8);--ez-search__input--disabled--color:var(--text--disable, #AFB6C0);--ez-search__input--error--border-color:#CC2936;--ez-search__btn--color:var(--title--primary, #2B3A54);--ez-search__btn-disabled--color:var(--text--disable, #AFB6C0);--ez-search__btn-hover--color:var(--color--primary, #4e4e4e);--ez-search__label--color:var(--title--primary, #2B3A54);--ez-search--space--medium:var(--space--medium, 12px);--ez-search--space--small:var(--space--small, 6px);display:flex;flex-wrap:wrap;position:relative;width:var(--ez-search--width)}ez-icon{--ez-icon--color:inherit;font-weight:var(--text-weight--large, 600)}.suppressed-search-input{--ez-text-input__input--border-color:var(--color--strokes, #dce0e8);--ez-text-input__input--disabled--background-color:var(--background--xlight, #fff);--ez-text-input__input--disabled--color:var(--title--primary, #2B3A54)}.btn{outline:none;border:none;background:none;cursor:pointer;color:var(--ez-search__btn--color)}.btn:disabled{cursor:not-allowed;color:var(--ez-search__btn-disabled--color)}.btn:disabled:hover{cursor:not-allowed;color:var(--ez-search__btn-disabled--color)}.btn:hover{color:var(--ez-search__btn-hover--color)}.btn__close{visibility:hidden}ez-text-input:hover .btn__close,ez-text-input:focus .btn__close{visibility:visible}",w=class{constructor(e){v(this,e),this.ezChange=_(this,"ezChange"),this._changeDeboucingTimeout=null,this._limitCharsToSearch=3,this._deboucingTime=300,this._maxWidthValue=0,this._tabPressed=!1,this._textEmptyList="Nenhum resultado encontrado",this._textEmptySearch="Nenhum resultado de {0} encontrado",this._startHighlightTag="<span class='card-item__highlight'>",this._endHighlightTag="</span>",this._preSelection=void 0,this._visibleOptions=void 0,this._startLoading=!1,this._showLoading=!0,this._showLoadingDescription=!1,this._criteria=void 0,this.value=void 0,this.label=void 0,this.enabled=!0,this.errorMessage=void 0,this.optionLoader=void 0,this.contextProperties=void 0,this.showSelectedValue=!0,this.showOptionValue=!0,this.suppressEmptyOption=!1,this.stopPropagateEnterKeyEvent=!1,this.mode="regular",this.canShowError=!0,this.hideErrorOnFocusOut=!0,this.listOptionsPosition=void 0,this.isTextSearch=!1,this.ignoreLimitCharsToSearch=!1,this.options=void 0,this.suppressSearch=!1,this.ensureClearButtonVisible=!1,this.suppressPreLoad=!0,this.autoFocus=!1,this.alternativePlaceholder=void 0}observeErrorMessage(){var e;this._textInput&&(this._textInput.errorMessage=this.errorMessage,!(!((e=this.errorMessage)===null||e===void 0)&&e.trim())&&this.errorMessage&&this.setInputValue())}getValue(e){return typeof e=="object"?e==null?void 0:e.value:e}validateNewValue(e,t){const i=this.getValue(e),s=this.getValue(t);return i!=="[object Object]"&&i!==s}async observeValue(e,t){if(this._textInput&&this.validateNewValue(e,t)){if(typeof e=="string"){await this.handleValueAsString(e);return}const i=this.getSelectedOption(e),s=this.getSelectedOption(this._currentValue);if(this.isDifferentValues(s,i)){this._currentValue=i,this.setInputValue();const n=i??void 0;this.ezChange.emit(n)}this.resetOptions()}}observeOptions(e,t){!e.length&&this.suppressPreLoad||(e==null?void 0:e.join(""))!==(t==null?void 0:t.join(""))&&this.loadOptions(l.PRELOAD)}async getValueAsync(){return this._showLoading?new Promise(e=>{let t=setInterval(()=>{this._showLoading||(clearInterval(t),e(this.value))},100)}):new Promise(e=>e(this.value))}async setFocus(e){this._textInput&&this._textInput.setFocus(e)}async setBlur(){this._textInput&&this._textInput.setBlur()}async isInvalid(){return typeof this.errorMessage=="string"&&this.errorMessage.trim()!==""}async clearValue(){this.clearSearch()}async handleValueAsString(e){if(this.getSelectedOption(e)){this.setInputValue();return}await this.loadDescriptionValue(e),this._currentValue&&(this.setInputValue(),this.ezChange.emit(this.value),this._currentValue=this.value)}isDifferentValues(e,t){return p.objectToString(e||{})!==p.objectToString(t||{})}getFormattedText(e){if(e==null)return;let t=!this.showSelectedValue||e.value==null?e.label:e.label?`${e.value} - ${e.label}`:e.value;return t=t==null?void 0:t.replace(new RegExp(this._startHighlightTag,"g"),"").replace(new RegExp(this._endHighlightTag,"g"),""),t}getText(){const e=this.getSelectedOption(this._currentValue),t=this.getFormattedText(e);return u(t)}getSelectedOption(e){return typeof e=="string"||e instanceof String?this._visibleOptions.find(t=>t.value===e):e&&Object.assign(Object.assign({},e),{value:h(e==null?void 0:e.value),label:h(e==null?void 0:e.label)})}updateVisibleOptions(){let e=this._source||[];this.suppressEmptyOption?this._visibleOptions=e:this._visibleOptions=[{value:void 0,label:""}].concat(e),this._maxWidthValue=this.getMaxWidthValue()}getMaxWidthValue(){var e;const t=[];return(e=this._visibleOptions)===null||e===void 0||e.forEach(i=>{const s=this.getWidthValue(i.value);t.includes(s)||t.push(s)}),t.length>1?Math.max(...t):0}getWidthValue(e){if(this._itemValueBasis!=null){const t=this._itemValueBasis;if(e!=null)return t.innerHTML=e,t.clientWidth>0?t.clientWidth+2:0;t.innerHTML=""}return 0}showOptions(){this.enabled&&(this.isOptionsVisible()||this._ezPopOverPlusElement.showUnder(this._textInput))}hideOptions(){this._ezPopOverPlusElement.hide()}isOptionsVisible(){return this._ezPopOverPlusElement.opened}selectCurrentOption(){this._preSelection!==void 0?(this.selectOption(this._visibleOptions[this._preSelection]),this._preSelection=void 0):this.controlListWithOnlyOne()}updateSource(e){this._startLoading=!1,e instanceof Promise?(this._showLoading=!0,this._showLoadingDescription=!0,e.then(t=>{this.updateSource(t)}).finally(()=>{this._showLoading=!1,this._showLoadingDescription=!1}),this.updateVisibleOptions()):(this._showLoading=!1,Array.isArray(e)?(this._source=e,this.updateVisibleOptions(),this._tabPressed&&(this._tabPressed=!1,this.controlEmptySearch(!1))):this.selectOption(e))}clearSource(){this._source=[],this.updateVisibleOptions()}selectOption(e,t=!0){var i,s;const n=this.getSelectedOption(this.value),r=Object.assign(Object.assign({},e),{value:h(e==null?void 0:e.value),label:h(e==null?void 0:e.label)}),a=Object.assign(Object.assign({},r),{value:u(r==null?void 0:r.value),label:u(r==null?void 0:r.label)});if(((i=n==null?void 0:n.value)===null||i===void 0?void 0:i.toString())!==((s=a==null?void 0:a.value)===null||s===void 0?void 0:s.toString())||n==null&&a!=null&&"value"in a){const c=a!=null&&a.value?a:void 0;this.value=c,this._currentValue=c}else this.setInputValue(),this.resetOptions();this._visibleOptions=[],this.clearSource(),t&&setTimeout(()=>{this.setFocus()},0)}loadOptions(e,t=""){if(this._criteria=t,this._startLoading=!0,this.optionLoader){const i={mode:e,argument:t};this.updateSource(this.optionLoader(i,this.contextProperties))}else this.updateSource(this.options)}cancelPreselection(){!this._textInput.value&&this._currentValue&&this._source.length>0?this.selectOption(void 0):window.setTimeout(()=>{this.setInputValue()},this._deboucingTime),this.resetOptions()}setInputValue(e=!0){const t=this.getText();(this._textInput.value||"")!==t&&(this._textInput.value=t,e&&(this.errorMessage=null))}clearSearch(){this.value=null,this._currentValue=null}controlListWithOnlyOne(e=!0){var t,i;const s=(t=this._visibleOptions)===null||t===void 0?void 0:t.filter(n=>n.label!==""&&n.value!=null);if((s==null?void 0:s.length)>0){const n=new RegExp(this._startHighlightTag,"g"),r=new RegExp(this._endHighlightTag,"g");let a=O.decodeHtmlEntities(s[0].label);const c={value:(i=s[0].value)===null||i===void 0?void 0:i.replace(n,"").replace(r,""),label:a==null?void 0:a.replace(n,"").replace(r,"")};this.selectOption(c,e)}}controlEmptySearch(e=!0){var t;!((t=this._visibleOptions)===null||t===void 0)&&t.length?this.controlListWithOnlyOne(e):(this.clearSearch(),g.info(this._textEmptyList))}async loadDescriptionValue(e){var t,i;if(e==null)return;if(((t=this.options)===null||t===void 0?void 0:t.length)>0){this.loadOptionValue(e);return}const s={mode:l.PREDICTIVE,argument:e},n=await((i=this.optionLoader)===null||i===void 0?void 0:i.call(this,s,this.contextProperties));n!=null&&(n instanceof Promise?n.then(r=>{this.setDescriptionValue(r)}):this.setDescriptionValue(n))}setDescriptionValue(e){const t=(e==null?void 0:e[0])||e;if(t==null||!Object.keys(t).length){this.showNoResultMessage();return}this._currentValue=t&&Object.assign(Object.assign({},t),{value:h(t.value),label:h(t.label)}),this.value=this._currentValue,this.setTextInputValue()}setTextInputValue(){if(this._textInput&&(this._textInput.value===null||this._textInput.value===void 0)){if(this.value===void 0||this.value===null)return;const e=typeof this.value=="string"?this.value:this.getFormattedText(this.value);this._textInput.value=u(e)}}loadOptionValue(e){var t;const i=(t=this.options)===null||t===void 0?void 0:t.find(s=>s.value===e);i!=null?this.selectOption(i):this.showNoResultMessage()}async showNoResultMessage(){this.clearSearch(),g.info(this._textEmptySearch.replace("{0}",this.getFieldLabel()))}getFieldLabel(){var e;return(e=this.label)===null||e===void 0?void 0:e.replace(x,"").toUpperCase()}resetOptions(){this.hideOptions(),this._criteria=void 0,this._preSelection=void 0,this.updateVisibleOptions()}async handleInitialValue(){if(!!!this.getValue(this.value))return;if(typeof this.value=="string"){await this.handleValueAsString(this.value);return}let t=this.getFormattedText(this.value);t=u(t),this._textInput.value=t}componentWillLoad(){if(this.options===void 0){this.options=[];const e=this.el.querySelectorAll("option");e&&e.forEach(t=>{let i=t.innerText,s=t.getAttribute("value"),n=t.getAttribute("details");s||(s=i),this.options.push({label:i,value:s,details:n}),t.hidden=!0})}this.updateSource([])}componentDidRender(){var e;(e=this._optionsList)===null||e===void 0||e.querySelectorAll(".item").forEach(t=>{d.addIDInfoIfNotExists(t,"itemSearch")})}async componentDidLoad(){this._currentValue=this.value,m.applyVarsTextInput(this.el,this._textInput),this._resizeObserver=new ResizeObserver(e=>{window.requestAnimationFrame(()=>{!Array.isArray(e)||e.length})}),this._intersectionObserver=new IntersectionObserver(e=>{e.forEach(t=>{!t.isIntersecting&&this._ezPopOverPlusElement&&this._ezPopOverPlusElement.hide()})},{threshold:.1}),this._textInput&&this._intersectionObserver.observe(this._textInput),await this.handleInitialValue(),this.autoFocus&&requestAnimationFrame(()=>{this.setFocus({selectText:!0})})}disconnectedCallback(){var e,t;(e=this._resizeObserver)===null||e===void 0||e.disconnect(),(t=this._intersectionObserver)===null||t===void 0||t.disconnect()}handlerIconClick(){this.loadOptions(l.ADVANCED)}buildNumberArgument(e){return this.isTextSearch?NaN:Number(e||void 0)}onTextInputChangeHandler(e){var t;if(this.clearDeboucingTimeout(),this._startLoading){this._changeDeboucingTimeout=window.setTimeout(()=>{this.onTextInputChangeHandler(e)},this._deboucingTime);return}const i=(t=e.target.value)===null||t===void 0?void 0:t.trim(),s=this.buildNumberArgument(i);this._criteria||(this._textInput.value=e.data||i),this._criteria=i,i?(this._showLoading=!1,this.clearSource(),this.ignoreLimitCharsToSearch||!isNaN(s)||i.length>=this._limitCharsToSearch?(this._showLoading=!0,this._changeDeboucingTimeout=window.setTimeout(()=>{this.loadOptions(l.PREDICTIVE,isNaN(s)?i:s.toString())},this._deboucingTime),this.showOptions()):this.hideOptions()):(this.hideOptions(),this._showLoading=!1,this.clearSource())}clearDeboucingTimeout(){this._changeDeboucingTimeout&&(window.clearTimeout(this._changeDeboucingTimeout),this._changeDeboucingTimeout=null)}async keyDownHandler(e){switch(this._tabPressed=!1,e.ctrlKey&&(e.key==="f"||e.key==="F")&&(this.loadOptions(l.ADVANCED),e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()),e.key){case"ArrowDown":e.stopPropagation(),this.canShowListOptions()&&e.preventDefault(),this.isOptionsVisible()||this.showOptions(),await this._searchList.nextOption();break;case"ArrowUp":e.stopPropagation(),this.canShowListOptions()&&e.preventDefault(),await this._searchList.previousOption();break;case"Enter":this.handleEventPropagation(e),this.selectCurrentOption();break;case"Escape":this.cancelPreselection();break;case"Tab":this._tabPressed=!0,this.controlListWithOnlyOne(!1);break}}handleEventPropagation(e){this._ezPopOverPlusElement.opened&&this.stopPropagateEnterKeyEvent&&e.stopPropagation()}onTextInputFocusOutHandler(){this.hideErrorOnFocusOut&&this.cancelPreselection()}canShowListOptions(){return!this._showLoading&&this._visibleOptions.length>0}canShowLoadSpinDescription(){return this._showLoadingDescription&&!this._ezPopOverPlusElement.opened}onChangePreSelection(e){this._preSelection=e}render(){var e;return d.addIDInfoIfNotExists(this.el,"input"),o(f,null,o("ez-text-input",{"data-element-id":d.getInternalIDInfo("textInput"),class:this.suppressSearch?"suppressed-search-input":"",ref:t=>this._textInput=t,"data-slave-mode":"true",enabled:this.enabled&&!this.suppressSearch,onInput:t=>this.onTextInputChangeHandler(t),onFocusout:()=>this.onTextInputFocusOutHandler(),onKeyDown:t=>this.keyDownHandler(t),label:this.label,canShowError:this.canShowError,errorMessage:this.errorMessage,mode:this.mode,alternativePlaceholder:this.alternativePlaceholder},o("button",{class:"btn",slot:"leftIcon",disabled:!this.enabled,tabindex:-1,onClick:()=>this.handlerIconClick()},this.canShowLoadSpinDescription()?o("div",{class:"message__loading"}):o("ez-icon",{iconName:"search"})),!((e=this._textInput)===null||e===void 0)&&e.value&&(this._criteria||this.value)||this.ensureClearButtonVisible?o("button",{class:"btn btn__close",slot:"rightIcon",disabled:!this.enabled,tabindex:-1,onClick:()=>this.clearSearch()},o("ez-icon",{iconName:"close"})):void 0),o("ez-popover-plus",{ref:t=>this._ezPopOverPlusElement=t,autoClose:!1,overlayType:"none",useAnchorSize:!0,anchorElement:[this._textInput,this.el]},o("search-list",{ref:t=>this._searchList=t,showLoading:this._showLoading,visibleOptions:this._visibleOptions,textEmptyList:this._textEmptyList,canShowListOptions:this.canShowListOptions(),value:this.value,showOptionValue:this.showOptionValue,preSelection:this._preSelection,onChangeValue:({detail:t})=>this.selectOption(t),onChangePreSelection:({detail:t})=>this.onChangePreSelection(t)})))}get el(){return b(this)}static get watchers(){return{errorMessage:["observeErrorMessage"],value:["observeValue"],options:["observeOptions"]}}};var l;(function(e){e.ADVANCED="ADVANCED",e.PRELOAD="PRELOAD",e.PREDICTIVE="PREDICTIVE"})(l||(l={}));w.style=V;export{w as ez_search};

import{b as I,d as v,j as C,e as l,k as w,i as k}from"./index-DA6RLjux.js";import{O as _,E as f,S as p}from"./dataUnitInMemoryLoader-BjgoPaoq.js";const A="chevron-down",L="chevron-right",N=(i,e,t)=>e?i.iconExpanded||A:i.iconContracted||L,P=(i,e,t)=>i.tooltip||i.label,z=i=>{const{node:e,selectedId:t,itemClick:r,iconClick:s,iconResolver:a,tooltipResolver:o,itemsList:d,itemDoubleClick:g}=i;if(!e.visible)return;const n=e.item,c=i.level||1,h=e.isDisabled(),b=!h&&n.expanded,x=e.isExpandable(),u=!h&&!e.isPlaceHolder;return u&&d.push(n),l("ul",{class:c===1?"first-level":void 0},l("li",Object.assign({title:o(n,!h,c),class:`tree-item ${n.id!==t?"tree-item-error":""}`,onClick:()=>u&&r(n),onDblClick:()=>u&&g(n)},{disabled:h,selected:n.id===t,[f.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:f.getInternalIDInfo(`ezTreeItem_${n.id}`)}),l("div",{class:"item-label-container"},l("div",{class:"item-icon-box"},x&&l("ez-icon",{id:n.id,class:"item-icon",size:"small",iconName:a(n,b,c),onClick:()=>u&&s(n)})),l("label",{class:`item-label ${n.bold?"item-label--bold":""}`},n.label)),E(n.id,n.badge,n.id===t)),b&&e.getChildren().map(y=>l(z,{selectedId:t,node:y,itemClick:r,iconClick:s,level:c+1,iconResolver:a,tooltipResolver:o,itemsList:d,itemDoubleClick:g})))};function E(i,e,t){if(e!=null)return typeof e=="string"?l("div",{class:`tree-item-badge ${t?null:e}`},e==="error"&&l("ez-icon",{id:`${i}-badge-error`,class:"tree-item-badge-error-icon",size:"x-small",style:{color:"white"},iconName:"alert-circle"})):e.type==="text"?l("div",{id:`${i}-badge-text`,class:"tree-item-badge-text"},e.text):l("div",null,l("ez-icon",{id:`${i}-badge-icon`,class:"tree-item-badge-icon",style:{"--ez-icon--color":`var(--ez-tree__badge--icon-color--${e.iconColor||"default"})`},iconName:e.iconName}))}class m{constructor(e,t,r,s=!1){this.children=new Map,this.visible=!0,this.item=t,this.parent=r,this._tree=e,this.isPlaceHolder=s,t&&!s?(this._isLazyLoad=typeof t.children=="function"||t.childrenCount>0,Array.isArray(t.children)&&(Array.from(t.children).forEach(a=>this.addChild(this._tree,a)),this._childrenLoaded=!0)):(this._isLazyLoad=!1,this._childrenLoaded=!0)}refresh(e){if(this.isPlaceHolder)return;this.item=Object.assign({},e),this._isLazyLoad=typeof this.item.children=="function"||this.item.childrenCount>0;const t=this.children;this.children=new Map,Array.isArray(this.item.children)?(this.item.expanded===void 0&&(this.item.expanded=!0),Array.from(this.item.children).forEach(r=>{const s=t.get(r.id);s?(r.expanded===void 0&&(r.expanded=s.item.expanded),s.refresh(r),this.children.set(r.id,s)):(r.expanded===void 0&&(r.expanded=!0),this.addChild(this._tree,Object.assign({},r)))}),this._childrenLoaded=!0):this._childrenLoaded=!1}isDisabled(){return this.isPlaceHolder?!1:this._tree.isNodeDisabled(this.item.id,this.item.disabled)}updateChildren(e){this.isPlaceHolder||this.refresh(Object.assign(Object.assign({},this.item),{children:e}))}addChild(e,t){this.children.has(t.id)||this.children.set(t.id,new m(e,t,this))}addPlaceHolder(){this.children.clear();const e=this.item.id;this.children.set(e,new m(void 0,{id:`placeholder_${e}`,label:"Carregando..."},this,!0))}getNode(e){if(this.children.has(e))return this.children.get(e);const t=Array.from(this.children.values());for(const r of t){const s=r.getNode(e);if(s)return s}}needLoad(){return this._isLazyLoad&&!this._childrenLoaded}isExpandable(){return!!(this._isLazyLoad||this.children.size>0)}getChildren(){return this.isPlaceHolder?[]:(this.needLoad()&&this._tree.loadChildren(this),Array.from(this.children.values()))}}class D extends m{constructor(e){super(void 0),this._disabledValues=new Map,this._changeCallback=e}async addChildAt(e,t){const r=this.getNode(e);r!=null&&(r.addChild(this,t),this._changeCallback())}setDisabled(e,t){this._disabledValues.set(e,t),this._changeCallback()}isNodeDisabled(e,t){return this._disabledValues.has(e)?this._disabledValues.get(e):t}load(e){if(e===this._currentItems)return;this._currentItems=e;const t=this.children;this.children=new Map,this._disabledValues.clear(),e.forEach(r=>{const s=t.get(r.id);s?(s.refresh(r),this.children.set(r.id,s)):this.addChild(this,Object.assign({},r))})}setFilterPattern(e){this._filterPattern=p.replaceAccentuatedCharsKeepSymbols(e),this.applyFilter(this),this._changeCallback()}updateItem(e){if(e==null)return;const t=this.getNode(e.id);t!=null&&(Object.keys(e).forEach(r=>t.item[r]=e[r]),e.children==null?t.children.clear():Array.isArray(e.children)&&t.updateChildren(e.children),this._changeCallback())}async open(e){return new Promise(async t=>{await this.walkPath(this,e,r=>r.item.expanded=!0),t()})}applyFilter(e){if(e.children.forEach(s=>{this.applyFilter(s)}),e.item==null)return;const t=p.replaceAccentuatedCharsKeepSymbols(e.item.label);let r=!1;if(t.includes(this._filterPattern))r=!0;else{const s=Array.from(e.children.values());for(let a=0;a<s.length;a++)if(s[a].visible){r=!0,e.item.expanded=!0;break}}e.visible=r}async walkPath(e,t,r,s=0){return new Promise(async a=>{const o=t.split(">>").map(d=>d.trim());if(o.length>s){const d=e.getNode(o[s]);d&&(d.needLoad()&&await this.loadLevel(d),r(d),await this.walkPath(d,t,r,s+1))}a()})}async loadChildren(e){return new Promise(t=>{this.loadLevel(e).then(()=>{t(),this._changeCallback()})})}async loadLevel(e){return new Promise(t=>{e.addPlaceHolder();const r=e.item.children;r(e.item).then(s=>{e.updateChildren(s),t()})})}}const F=":host{--ez-tree--border-radius:var(--border--radius-small, 8px);--ez-tree--padding-inline-start:20px;--ez-tree--margin:var(--space--extra-small, 3px);--ez-tree--margin-right:calc(var(--space--small, 6px) + 2px);--ez-tree--font-family:var(--font-pattern, Arial);--ez-tree--font-size:var(--text--medium, 14px);--ez-tree--selected--font-weight:var(--text-weight--large, 600);--ez-tree--font-weight:var(--text-weight--small, 400);--ez-tree--color:var(--title--primary, #2B3A54);--ez-tree--selected--color:var(--color--primary, #008561);--ez-tree--disabled--color:var(--text--disable, #AFB6C0);--ez-tree--font-weight--bold:var(--text-weight--large, 600);--ez-tree__tree-item--height:var(--size-medium, 18px);--ez-tree__tree-item--padding:var(--space--small, 6px);--ez-tree__tree-item--background-color:var(--background--xlight, #FFFFFF);--ez-tree__tree-item--selected--background-color:var(--color--primary-300, #E2F4EF);--ez-tree__tree-item--hover--background-color:var(--background--medium, #F0F3F7);--ez-tree__tree-item--disabled--background-color:var(--ez-tree__tree-Item--background-color);--ez-tree__item-icon-box--height:var(--ez-tree__tree-item--height);--ez-tree__item-icon-box--width:var(--size-medium, 18px);--ez-tree__item-icon-box--padding:var(--ez-tree__tree-item--padding);--ez-tree__badge--icon-color--default:var(--title--primary, #2B3A54);--ez-tree__badge--icon-color--error:var(--color--error, #da4453);--ez-tree__badge--icon-color--success:var(--color-alert--success-800, #157a00);--ez-tree__badge--icon-color--warning:var(--color--warning, #f2d410);--ez-tree__badge--icon-color--disabled:var(--text--disable, #AFB6C0);display:flex;flex-direction:column;margin:0 var(--ez-tree--margin) var(--ez-tree--margin) var(--ez-tree--margin);outline:none}ul{list-style-type:none;margin:0;padding-inline-start:var(--ez-tree--padding-inline-start)}ul.first-level{padding-inline-start:0}.tree-item-badge{width:16px;height:16px;background:transparent;border-radius:50%;transition:all 300ms ease-in-out;display:flex;align-items:center;justify-content:center}.tree-item-badge-error-icon{--ez-icon--color:white}.tree-item-badge-text{font-family:var(--ez-tree--font-family);font-size:var(--ez-tree--font-size);font-weight:var(--ez-tree--font-weight);color:var(--ez-tree--color)}.tree-item-badge.error{background:var(--color--error)}.tree-item-badge.warning{background:var(--color--warning)}.tree-item-badge.success{background:var(--color--success)}.item-label-container{display:flex;align-items:center}.tree-item{display:flex;align-items:center;margin-top:var(--ez-tree--margin);margin-right:var(--ez-tree--margin-right);border-radius:var(--ez-tree--border-radius);height:var(--ez-tree__tree-item--height);padding:var(--ez-tree__tree-item--padding);justify-content:space-between}.tree-item[selected]{background-color:var(--ez-tree__tree-item--selected--background-color)}.tree-item:hover{background-color:var(--ez-tree__tree-item--hover--background-color)}.tree-item[disabled],.tree-item[disabled]:hover{background-color:var(--ez-tree__tree-item--disabled--background-color)}.item-icon-box{display:flex;align-items:center;justify-content:center;width:var(--ez-tree__item-icon-box--width);height:var(--ez-tree__item-icon-box--height);padding:var(--ez-tree__item-icon-box--padding) var(--ez-tree__item-icon-box--padding) var(--ez-tree__item-icon-box--padding) 0}.item-icon{--ez-icon--color:var(--ez-tree--color)}.item-icon:hover{cursor:pointer}.tree-item[selected] .item-icon{--ez-icon--color:var(--ez-tree--selected--color)}.tree-item[disabled] .item-icon{cursor:unset;--ez-icon--color:var(--ez-tree--disabled--color)}.item-label{cursor:inherit;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-family:var(--ez-tree--font-family);font-size:var(--ez-tree--font-size);font-weight:var(--ez-tree--font-weight);color:var(--ez-tree--color)}.item-label--bold{font-weight:var(--ez-tree--font-weight--bold)}.tree-item[selected] .item-label{color:var(--ez-tree--selected--color);font-weight:var(--ez-tree--selected--font-weight)}.tree-item[disabled] .item-label{color:var(--ez-tree--disabled--color)}",O=class{constructor(i){I(this,i),this.ezChange=v(this,"ezChange"),this.ezOpenItem=v(this,"ezOpenItem"),this.ezDbClickItem=v(this,"ezDbClickItem"),this._onItemClick=e=>{this.value=e},this._onIconClick=e=>{this.openClose(e),this.value=e},this._tree=new D(()=>C(this)),this._waintingForLoad=void 0,this.items=[],this.value=void 0,this.selectedId=void 0,this.iconResolver=N,this.tooltipResolver=void 0}async selectItem(i){const e=this._tree.getNode(i);e?this.value=e.item:this.value=void 0}async openItem(i){this._waintingForLoad=!0,await this._tree.open(i),this._waintingForLoad=!1}async disableItem(i){[].concat(i).forEach(e=>this._tree.setDisabled(e,!0))}async enableItem(i){[].concat(i).forEach(e=>this._tree.setDisabled(e,!1))}async addChild(i,e){var t;e==null&&(e=(t=this.value)===null||t===void 0?void 0:t.id),this._tree.addChildAt(e,i);const r=this._tree.getNode(e);r&&(r.item.expanded=!0)}async applyFilter(i){this._tree.setFilterPattern(i)}async updateItem(i){var e;this._tree.updateItem(i),((e=this._tree)===null||e===void 0?void 0:e.getNode(this.selectedId))==null&&(this.value=this._visibleItems?this._visibleItems[0]:void 0)}async getItem(i){return new Promise(e=>{const t=this._tree.getNode(i);e(t==null?void 0:t.item)})}async getCurrentPath(){var i,e,t;const r=(i=this._tree)===null||i===void 0?void 0:i.getNode(this.selectedId);if(r==null)return;const s=[];let a,o=(e=r.parent)===null||e===void 0?void 0:e.item;for(s.push(this.getItemPathAttrs(r.item));o!=null;)s.unshift(this.getItemPathAttrs(o)),a=this._tree.getNode(o.id),o=(t=a==null?void 0:a.parent)===null||t===void 0?void 0:t.item;return s}async getParent(i){return new Promise(e=>{var t;const r=this._tree.getNode(i);r&&e((t=r.parent)===null||t===void 0?void 0:t.item),e(void 0)})}observeItems(i,e){_.objectToString(i)!==_.objectToString(e)&&this._tree.load(this.items||[])}observeValue(){var i;this.ezChange.emit(this.value),this.selectedId=(i=this.value)===null||i===void 0?void 0:i.id}onKeyDownListener(i){if(!this.value)return;let e=!1;switch(i.key){case"ArrowUp":this.previousItem(),e=!0;break;case"ArrowDown":this.nextItem(),e=!0;break;case"ArrowLeft":this.previousLevel(),e=!0;break;case"ArrowRight":this.nextLevel(),e=!0;break;case" ":this.openClose(this.value),e=!0;break}e&&(i.stopPropagation(),i.preventDefault())}getItemPathAttrs({id:i,label:e}){return{id:i,label:e}}openClose(i){if(i==null)return;const e=!i.expanded;i.expanded=e,e&&this.ezOpenItem.emit(i),this._tree.updateItem(i)}previousLevel(){var i;if(this.value)if(this.value.expanded)this.value.expanded=!1,this._tree.updateItem(this.value);else{const t=(i=this._tree.getNode(this.value.id).parent)===null||i===void 0?void 0:i.item;t&&(this.value=t)}}nextLevel(){!this.value||!this._tree.getNode(this.value.id).isExpandable()||(this.value.expanded?this.nextItem():(this.value.expanded=!0,this._tree.updateItem(this.value)))}indexOf(i){if(i==null)return-1;for(let e=0;e<this._visibleItems.length;e++)if(this._visibleItems[e].id===i)return e;return-1}selectNextItem(i){var e;const t=this.indexOf((e=this.value)===null||e===void 0?void 0:e.id)+i;t>-1&&t<this._visibleItems.length&&(this.value=this._visibleItems[t])}nextItem(){this.selectNextItem(1)}previousItem(){this.selectNextItem(-1)}connectedCallback(){this.items&&this._tree.load(this.items)}componentWillRender(){var i;if(!this.selectedId||((i=this.value)===null||i===void 0?void 0:i.id)===this.selectedId)return;const e=this._tree.getNode(this.selectedId);e&&(this.value=e.item)}render(){if(f.addIDInfoIfNotExists(this._element,"ezTree"),this.items!=null)return this._visibleItems=[],l(w,{tabindex:"-1"},this._waintingForLoad?l("label",null,"Carregando..."):this._tree.getChildren().map(i=>{var e;return l(z,{selectedId:(e=this.value)===null||e===void 0?void 0:e.id,node:i,itemClick:this._onItemClick,iconClick:this._onIconClick,iconResolver:this.iconResolver,tooltipResolver:this.tooltipResolver||P,itemsList:this._visibleItems,itemDoubleClick:t=>this.ezDbClickItem.emit(t)})}))}get _element(){return k(this)}static get watchers(){return{items:["observeItems"],value:["observeValue"]}}};O.style=F;export{O as ez_tree};

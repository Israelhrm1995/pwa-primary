import{b as m,d as u,j as g,e as o,i as w}from"./index-CHxCopeG.js";import{A as c}from"./ApplicationUtils-eaf91331-DedxIlrs.js";import{E as x}from"./dataUnitInMemoryLoader-CwDmnNwL.js";import"./DialogType-54a62731-BI65OFfy.js";class f{constructor(t){this.file=t,this.size=t.size,this.name=t.name}abortUpload(){this._uploadingXhr&&(this._aborted=!0,this._uploadingXhr.abort(),this._uploadingXhr=void 0)}isUploading(){return this._uploadingXhr!==void 0}async upload(t,i,s){return new Promise((d,r)=>{const a=new XMLHttpRequest;this._uploadingXhr=a,this._aborted=!1,this.progress=0,a.upload.onprogress=l=>{const n=l.loaded,p=l.total;this.progress=~~(n/p*100),s(this,n,p)},a.onreadystatechange=()=>{if(a.readyState==4){this._uploadingXhr=void 0;const l=a.status;this._aborted||(l===0?r("Servidor indisponível"):l>=500?r("Erro inesperado no servidor"):l>=400&&r("Operação não permitida"));const n=a.response;if(n)try{d(JSON.parse(n))}catch(p){r(`Servidor não retornou um objeto válido: ${n}.
${p}`)}}},a.ontimeout=()=>{r("Tempo limite de transferência atingido.")};const h=new FormData;h.append("ARQUIVO",this.file,this.file.name),a.open("POST",t,!0),i&&i.forEach((l,n)=>a.setRequestHeader(n,l)),a.send(h)})}async delete(t,i,s){return new Promise((d,r)=>{const a=new XMLHttpRequest;a.onreadystatechange=()=>{a.readyState==4&&(a.status===0?r("Servidor indisponível"):a.status>=500?r("Erro inesperado no servidor"):a.status>=400&&r("Operação não permitida"),d(!0))},a.ontimeout=()=>{r("Tempo limite de remoção atingido.")},a.open("DELETE",i,!0),s&&s.forEach((h,l)=>a.setRequestHeader(l,h)),a.send(JSON.stringify(t))})}}const b=`:host{--ez-upload--height:42px;--ez-upload--width:100%;--ez-upload__icon--width:48px;--ez-upload__container--background-color:var(--background--medium, #d2dce9);--ez-upload__color--primary:var(--color--primary, #008561);--ez-upload--padding--extra-small:var(--space--extra-small, 3px);--ez-upload--padding--small:var(--space--small, 6px);--ez-upload--padding--medium:var(--space--medium, 12px);--ez-upload--padding--large:var(--space--large, 24px);--ez-upload__border--color:var(--color-strokes, #DCE0E8);--ez-upload--text-shadow:var(--text-shadow, 0 0 0 #353535, 0 0 1px transparent);--ez-upload--text--primary:var(--text-primary, #626e82);--ez-upload--text--secondary:var(--text-secondary, #a2abb9);--ez-upload--font-size:var(--text--medium, 14px);--ez-upload--font-family:var(--font-pattern, Arial);--ez-upload--font-weight:var(--text-weight--large, 500);--ez-upload__btn__cancel-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="8x" width="8px"><path d="M 8,0.8 7.2,0 4,3.2 0.8,0 0,0.8 3.2,4 0,7.2 0.8,8 4,4.8 7.2,8 8,7.2 4.8,4 Z"/></svg>');--ez-upload__file-icon-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="11x" width="9px"><path d="M 1.2272719,8.4999999 V 2.75 c 0,-1.1045695 1.4652499,-2 3.2727273,-2 1.8074777,0 3.2727281,0.8954305 3.2727281,2 V 8.9999999 C 7.7727273,9.690356 6.8569456,10.25 5.7272719,10.25 4.5975985,10.25 3.6818174,9.690356 3.6818174,8.9999999 V 3.75 c 0,-0.2761425 0.3663125,-0.5 0.8181818,-0.5 0.4518694,0 0.8181818,0.2238575 0.8181818,0.5 V 8.4999999 H 6.5454537 V 3.75 C 6.5454537,3.059644 5.6296725,2.5 4.4999992,2.5 3.3703258,2.5 2.4545446,3.059644 2.4545446,3.75 V 8.9999999 C 2.4545446,10.10457 3.9197945,11 5.7272719,11 7.5347496,11 9,10.10457 9,8.9999999 V 2.75 C 9,1.231217 6.9852809,0 4.4999992,0 2.0147181,5e-7 0,1.231217 0,2.75 v 5.7499999 z"/></svg>');display:flex;flex-wrap:wrap;position:relative;padding-bottom:16px;font-family:var(--ez-upload--font-family);font-size:var(--ez-upload--font-size);width:var(--ez-upload--width);font-weight:var(--ez-upload--font-weight)}.iu{display:flex;flex-wrap:wrap;background-color:var(--ez-upload__container--background-color);padding:var(--ez-upload--padding--small);width:100%;border-radius:12px;box-sizing:border-box}.iu__container{width:100%;display:flex;flex-wrap:wrap;justify-content:center;align-items:center;border:2px dashed var(--ez-upload__border--color);border-radius:6px;box-sizing:border-box}.iu__footer{display:flex;flex-wrap:wrap;justify-content:flex-start;width:100%;padding:0 var(--ez-upload--padding--medium) var(--ez-upload--padding--medium) var(--ez-upload--padding--medium);box-sizing:border-box}.iu__item{display:flex;width:100%;justify-content:flex-start;align-items:center;align-self:center;padding-bottom:var(--ez-upload--padding--extra-small);box-sizing:border-box;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.iu__item-label{display:flex;max-width:80%;align-self:stretch;align-items:center}.file__name{font-weight:200}.box__content{width:100%;justify-content:center;align-items:center;height:100%;border:1px dashed var(--ez-upload__border--color);border-radius:6px;box-sizing:border-box}.box__container{display:flex;flex-wrap:wrap;background-color:var(--ez-upload__container--background-color);padding:6px;width:100%;border-radius:12px}a:-webkit-any-link{color:#008561;fill:#008561;cursor:pointer;text-decoration:none}progress[value]{display:flex;width:100%;appearance:none;border:1px solid var(--ez-upload__border--color);height:12px;justify-content:flex-start;align-items:center;border-radius:3px;position:relative}progress[value]::-webkit-progress-bar{display:flex;-webkit-appearance:none;width:100%;background-color:rgb(255, 255, 255);border-radius:2px;padding:2px}progress[value]::-webkit-progress-value{display:flex;width:100%;background-color:var(--ez-upload__color--primary)}.text--center{text-align:center}.align--middle{align-self:center;align-items:center}.padding-large{padding:var(--ez-upload--padding--large) 0px}.padding-extra-small{padding:var(--ez-upload--padding--extra-small) 0px}.text{font-family:var(--font-pattern, "Roboto");text-shadow:0 0 0 #353535, 0 0 1px transparent}.text--primary{color:var(--ez-upload--text--primary);text-shadow:var(--ez-upload--text-shadow)}.text--secondary{color:var(--ez-upload--text--secondary);text-shadow:var(--ez-upload--text-shadow)}.text--ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.text--medium{font-size:14px}.text--small{font-size:12px}.btn-cancel{outline:none;border:none;background-color:unset;cursor:pointer}.btn-cancel::after{content:'';display:flex;background-color:var(--text--primary, #008561);width:8px;height:8px;-webkit-mask-image:var(--ez-upload__btn__cancel-image);mask-image:var(--ez-upload__btn__cancel-image)}.iu_header{display:flex;flex-direction:column;width:100%}.iu__label{padding:var(--space--small);box-sizing:border-box;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-family:var(--ez-upload--font-family);font-size:var(--text--extra-small);font-weight:var(--ez-upload--font-weight);color:var(--ez-upload--text--primary);text-shadow:var(--ez-upload--text-shadow)}.iu__file-icon{outline:none;border:none;background-color:unset;cursor:pointer}.iu__file-icon:disabled{cursor:unset}.iu__file-icon::after{content:'';display:flex;background-color:var(--text--primary, #626e82);width:9px;height:11px;-webkit-mask-image:var(--ez-upload__file-icon-image);mask-image:var(--ez-upload__file-icon-image)}.iu__file-icon:disabled::after{background-color:var(--text--disable, #AFB6C0)}.iu__icon-label{justify-content:center;display:flex;cursor:pointer;box-sizing:border-box}.background--disabled{background-color:var(--color--disable-secondary, #F2F5F8)}.text--disabled{color:var(--text--disable, #AFB6C0)}.mouse-pointer--disabled{cursor:unset}.appearanceNone{width:0px;height:0px}.row{width:100%;display:flex;flex-wrap:wrap}.col{display:flex;flex-wrap:wrap;align-self:flex-start;box-sizing:border-box}.col--stretch{align-self:stretch}.col--undefined{width:unset}.col--nowrap{flex-wrap:nowrap}@media screen and (min-width: 320px){.col--sd-1{width:8.33333%}.col--sd-2{width:16.66667%}.col--sd-3{width:25%}.col--sd-4{width:33.33333%}.col--sd-5{width:41.66667%}.col--sd-6{width:50%}.col--sd-7{width:58.33333%}.col--sd-8{width:66.66667%}.col--sd-9{width:75%}.col--sd-10{width:83.33333%}.col--sd-11{width:91.66667%}.col--sd-12{width:100%}}@media screen and (min-width: 480px){.col--pn-1{width:8.33333%}.col--pn-2{width:16.66667%}.col--pn-3{width:25%}.col--pn-4{width:33.33333%}.col--pn-5{width:41.66667%}.col--pn-6{width:50%}.col--pn-7{width:58.33333%}.col--pn-8{width:66.66667%}.col--pn-9{width:75%}.col--pn-10{width:83.33333%}.col--pn-11{width:91.66667%}.col--pn-12{width:100%}}@media screen and (min-width: 768px){.col--tb-1{width:8.33333%}.col--tb-2{width:16.66667%}.col--tb-3{width:25%}.col--tb-4{width:33.33333%}.col--tb-5{width:41.66667%}.col--tb-6{width:50%}.col--tb-7{width:58.33333%}.col--tb-8{width:66.66667%}.col--tb-9{width:75%}.col--tb-10{width:83.33333%}.col--tb-11{width:91.66667%}.col--tb-12{width:100%}}@media screen and (min-width: 992px){.col--md-1{width:8.33333%}.col--md-2{width:16.66667%}.col--md-3{width:25%}.col--md-4{width:33.33333%}.col--md-5{width:41.66667%}.col--md-6{width:50%}.col--md-7{width:58.33333%}.col--md-8{width:66.66667%}.col--md-9{width:75%}.col--md-10{width:83.33333%}.col--md-11{width:91.66667%}.col--md-12{width:100%}}@media screen and (min-width: 1200px){.col--ld-1{width:8.33333%}.col--ld-2{width:16.66667%}.col--ld-3{width:25%}.col--ld-4{width:33.33333%}.col--ld-5{width:41.66667%}.col--ld-6{width:50%}.col--ld-7{width:58.33333%}.col--ld-8{width:66.66667%}.col--ld-9{width:75%}.col--ld-10{width:83.33333%}.col--ld-11{width:91.66667%}.col--ld-12{width:100%}}`,_=class{constructor(e){m(this,e),this.ezChange=u(this,"ezChange"),this.ezStartChange=u(this,"ezStartChange"),this.ezCancelWaitingChange=u(this,"ezCancelWaitingChange"),this._filePointers=new Map,this.label=void 0,this.subtitle=void 0,this.enabled=!0,this.maxFileSize=void 0,this.maxFiles=void 0,this.requestHeaders=void 0,this.urlUpload=void 0,this.urlDelete=void 0,this.value=void 0}observeValue(e,t){(e!==this._updatingValue||e==null&&t!=null)&&(this._filePointers.forEach(i=>{this.isRemoteFile(i)&&i.abortUpload()}),this._filePointers=new Map,this.updateFilePointers(),this._updatingValue=void 0)}updateFilePointers(){Array.isArray(this.value)&&this.value.forEach(e=>this._filePointers.set(e.name,e))}observeRequestHeaders(){if(this._requestHeaders=new Map,typeof this.requestHeaders=="string")try{this.requestHeaders=JSON.parse(this.requestHeaders)}catch{this.requestHeaders=void 0}for(var e in this.requestHeaders)this._requestHeaders.set(e,this.requestHeaders[e])}async addFiles(e){if(this.maxFiles>0){let t=this._filePointers.size;if(e.forEach(i=>{this._filePointers.has(i.name)||t++}),t>this.maxFiles){this.showError(`A quantidade máxima de arquivos é ${this.maxFiles}.`);return}}Array.prototype.forEach.call(e,this.addFile.bind(this))}async setFocus(){this._fileInput.focus()}async setBlur(){this._fileInput.blur()}async addFile(e){const t=this._filePointers.get(e.name);t?c.confirm("Substituir arquivo",`Já existe um arquivo chamado "${e.name}". Deseja substituí-lo?`).then(i=>{i&&(this.isRemoteFile(t)&&t.abortUpload(),this.doAddFile(e))}):this.doAddFile(e)}async doAddFile(e){try{if(this.validateFile(e)){this.ezStartChange.emit({waitmessage:"Há arquivos sendo enviados. Por favor aguarde a conclusão ou cancele o envio.",blocking:!0});const t=new f(e),i=this._filePointers.get(e.name);i&&this.isRemoteFile(i)&&i.abortUpload(),this._filePointers.set(e.name,t),t.upload(this.urlUpload,this._requestHeaders,s=>this.updateFeedback(s)).then(s=>s.forEach(d=>this.finishUpload(t.name,d))).catch(s=>{this.ezCancelWaitingChange.emit(),this.showError(s)}),g(this)}}catch(t){throw this.ezCancelWaitingChange.emit(),t}}finishUpload(e,t){this._filePointers.set(e,t),this.updateValue()}updateValue(){this._updatingValue=[],this._filePointers.forEach(e=>{this.isRemoteFile(e)||this._updatingValue.push(e)}),this._filePointers.size===this._updatingValue.length&&(this.value=this._updatingValue,this.ezChange.emit(this.value))}buildProgressId(e){return`PROGRESS_${e.name.replace(/[^a-z0-9_]/gi,"_")}_${e.file.lastModified}`}updateFeedback(e){window.requestAnimationFrame(()=>{if(this._host){const t=this._host.shadowRoot.querySelector("#"+this.buildProgressId(e));t&&(t.value=e.progress)}})}validateFile(e){return!this._filePointers.has(e.name)&&this.maxFiles>0&&this._filePointers.size>=this.maxFiles?(this.showError(`A quantidade máxima de arquivos é ${this.maxFiles}.`),!1):e.size===0?(this.showError(`Erro de permissão: O arquivo "${e.name}" não pode ser enviado.`),!1):this.urlUpload?this.maxFileSize>=0&&e.size>this.maxFileSize?(this.showError("O tamanho máximo dos arquivos é de "+this.formatBytes(this.maxFileSize)),!1):!0:(this.showError("Endereço de upload não informado"),!1)}showError(e){c.alert("Enviando arquivo",e)}formatBytes(e,t=1){if(e===0)return"0 Bytes";const i=1024,s=t<0?0:t,d=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(i));return parseFloat((e/Math.pow(i,r)).toFixed(s))+" "+d[r]}onFileInputChange(e){const t=e.target;this.addFiles(Array.from(t.files)),this._fileInput.value=""}isRemoteFile(e){return"file"in e}removeFromList(e){this._filePointers.delete(e),this.updateValue()}removeFile(e){const t=this._filePointers.get(e);if(this.isRemoteFile(t))t.abortUpload(),this.removeFromList(e);else if(this.urlDelete){const i=new f(null);this._filePointers.set(t.name,i),i.delete(t,this.urlDelete,null).then(s=>this.removeFromList(e)).catch(s=>this.showError(s))}else this.removeFromList(e)}openFilesDialog(){this.enabled&&this._fileInput.click()}componentDidLoad(){this.enabled&&this._dropZone&&window.FileList&&window.File&&(this._dropZone.addEventListener("dragover",e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy",this._dropZone.style.background="#c2dbff"}),this._dropZone.addEventListener("drop",e=>{e.stopPropagation(),e.preventDefault(),this.addFiles(Array.from(e.dataTransfer.files)),this._dropZone.style.background=""}),this._dropZone.addEventListener("dragleave",e=>{this._dropZone.style.background=""})),this._host&&x.addIDInfo(this._host,"input"),this.observeRequestHeaders()}componentWillRender(){this.value&&this._filePointers.size<this.value.length&&this.updateFilePointers()}render(){return o("div",{ref:e=>this._dropZone=e,class:this.evalDisabledClass("iu","background--disabled")},o("div",{class:"iu__container",onClick:()=>this.openFilesDialog()},o("div",{class:"iu_header"},this.label?o("label",{class:this.evalDisabledClass("iu__label","text--disabled"),title:this.label},this.label):null,o("div",{class:"padding-large"},o("div",{class:this.evalDisabledClass("iu__icon-label","mouse-pointer--disabled")},o("button",{class:"iu__file-icon",disabled:!this.enabled}),o("div",{class:this.evalDisabledClass("text text--center text--medium text--primary","text--disabled")},this.enabled?"Arraste e solte ou clique para adicionar arquivos":"Somente leitura")),this.subtitle&&o("div",{class:this.evalDisabledClass("padding-extra-small text text--center text--small text--secondary","text--disabled")},this.subtitle))),this.buildFooter()),o("input",{ref:e=>this._fileInput=e,onChange:e=>this.onFileInputChange(e),type:"file",multiple:!0,class:"appearanceNone"}))}buildFooter(){if(this._filePointers.size===0)return null;const e=[];return this._filePointers.forEach(t=>e.push(this.buildFileItem(t))),o("div",{class:"iu__footer"},e)}buildFileItem(e){const t=e.name,i=Number(e.progress),s=e.downloadURL,d=e.size>0?`(${this.formatBytes(e.size)})`:"",r=`${t} ${d}`;return o("div",{class:"iu__item",key:t,onClick:a=>a.stopPropagation()},o("div",{class:"iu__item-label modificador"},o("div",{title:r,class:"col--stretch align--middle file__name text text--primary text--small text--ellipsis align--middle"},s?o("a",{href:s,download:!0},r):r)),isNaN(i)?null:o("div",{class:"col col--sd-4 col--stretch align--middle"},o("progress",{id:this.buildProgressId(e),value:i,max:"100"})),this.enabled?o("div",{class:"col col--stretch align--middle"},o("button",{class:"btn-cancel ",onClick:()=>this.removeFile(t)})):null)}evalDisabledClass(e,t){return this.enabled?e:`${e} ${t}`}get _host(){return w(this)}static get watchers(){return{value:["observeValue"],requestHeaders:["observeRequestHeaders"]}}};_.style=b;export{_ as ez_upload};
//# sourceMappingURL=ez-upload.entry-D7XoNI6i.js.map

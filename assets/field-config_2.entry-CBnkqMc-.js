import{r as O,c as g,f as x,h as t,H as _}from"./index-CzwKln6B.js";import{U as l,S as V,l as R,O as L}from"./dataUnitInMemoryLoader-CwDmnNwL.js";import{A as z}from"./ApplicationContext-B_qAnYBt.js";import{a as v,D as u,b as p}from"./constants-7b422de0-BRz2gykn.js";import{C as y}from"./FormLayout-CTCTPPNq.js";import{e as T,f as D,h as E,i as w}from"./FormConfigHelper-49fe72ca-CenmSOwG.js";const A=".field-config-container.sc-field-config{font-family:'Roboto';color:#2b3a54;display:flex;flex-direction:column;gap:10px;width:330px;justify-content:space-between}.header.sc-field-config{display:flex;font-weight:500;font-size:16px}.actions.sc-field-config{display:flex;align-items:flex-end;gap:12px}",M=class{constructor(e){O(this,e),this.fieldConfigChanged=g(this,"fieldConfigChanged",7),this.fieldLabel=void 0,this.fieldLabelErrorMessage=void 0,this.fieldDefaultValue=void 0,this.fieldCleanOnCopy=void 0,this.fieldRequired=void 0,this.fieldReadOnly=void 0,this._defaultType=void 0,this.dataUnit=void 0,this.fieldConfig=void 0,this.fieldDescriptor=void 0,this.messagesBuilder=void 0}observeFieldLabel(){this.validateFieldLabel&&(this.fieldLabelErrorMessage=void 0)}async show(e){this._popoupElement.opened=!0,this.initializeValues(),x(this)}validateFieldLabel(){var e;return!((e=this.fieldLabel)===null||e===void 0)&&e.trim()?!0:(this.applyErrorMessage(),!1)}getMessage(e,i){return this.messagesBuilder.getMessage(e,i)}isAllowDefault(){var e;const i=(e=this.fieldDescriptor.properties)===null||e===void 0?void 0:e.allowDefault;return i==null?!0:i==="true"}enabledValueDefault(){var e,i,a;const o=(e=this.fieldDescriptor.properties)===null||e===void 0?void 0:e.allowDefault;return(v.UserInterface.hasOwnProperty((i=this.fieldDescriptor)===null||i===void 0?void 0:i.userInterface)||((a=this.fieldDescriptor)===null||a===void 0?void 0:a.userInterface)===l.SEARCH)&&(o==null||o==="true")}getDefaultType(){var e,i;return(i=(e=this.fieldDefaultValue)===null||e===void 0?void 0:e.type)!==null&&i!==void 0?i:u.fixed}emitFieldChanged(){this.fieldConfigChanged.emit(this.fieldConfig)}handleLabelChanged({detail:e}){this.fieldLabel=e}handleDefaultTypeChanged({detail:e}){const i=e.value;i!=null&&(this._defaultType=i,this.fieldDefaultValue={type:this._defaultType})}handleDefaultValueChanged({detail:e}){this.fieldDefaultValue.value=e==null?void 0:e.value}onChangeDefaultValue(e){this.fieldDefaultValue.value=T(e,this.dataUnit,this.fieldConfig.name)}handleClearDuplicateChanged({detail:e}){this.fieldCleanOnCopy=e}handleRequiredChanged({detail:e}){this.fieldRequired=e}handleReadOnlyChanged({detail:e}){this.fieldReadOnly=e}loadDefaultValue(){var e;if(!((e=this.fieldConfig.defaultValue)===null||e===void 0)&&e.type){this._defaultType=this.fieldConfig.defaultValue.type;return}this._defaultType=u.fixed,this.fieldConfig.defaultValue={type:this._defaultType}}buildOptions(){let e=this.fieldDescriptor.userInterface;return e===l.SEARCH&&(e=l.INTEGERNUMBER),v.UserInterface[e]}renderDefaultValueEditor(){return this._defaultType===u.variable?t("ez-combo-box",{label:this.getMessage("snkConfigOptions.label.valueDefault"),enabled:this.isAllowDefault(),onEzChange:e=>this.handleDefaultValueChanged(e),value:this.fieldDefaultValue.value,options:this.buildOptions()}):this.fieldDescriptor.userInterface&&this.buildFieldDefaultValueElement()}buildFieldDefaultValueElement(){var e;const{userInterface:i,properties:a,dataType:o}=this.fieldDescriptor,f=a==null?void 0:a.allowDefault;let d,n=V.getBooleanValue(f,!this.fieldReadOnly);i===l.FILE&&(n=!1),n&&(d=(e=this.fieldDefaultValue)===null||e===void 0?void 0:e.value,d!=null&&(d=R(o,d)));const s={value:d,enabled:n,label:this.fieldConfig.label,name:this.fieldConfig.name,required:this.fieldRequired,userInterface:i};switch(i){case l.SWITCH:return this.buildInputDefault(s,void 0,y.SWITCH);case l.CHECKBOX:return this.buildInputDefault(s,void 0,y.REGULAR);case l.OPTIONSELECTOR:case l.DECIMALNUMBER:return this.buildInputDefault(s,a);default:return this.buildInputDefault(s)}}buildInputDefault({value:e,enabled:i,label:a,name:o,required:f,userInterface:d},n=void 0,s=void 0){let h,c=0,C=0;const F=d==null||p[d]==null?p.DEFAULT:p[d];if(d===l.OPTIONSELECTOR){const r=n==null?void 0:n.options;if(typeof r=="string"){const b=L.stringToObject(r);h=Object.keys(b).map(m=>({value:m,label:b[m]}))}else h=r}else d===l.DECIMALNUMBER&&(c=Number((n==null?void 0:n.precision)||2),C=Number((n==null?void 0:n.prettyPrecision)||c));return t(F,Object.assign({value:e,enabled:i,label:a,"data-field-name":o,key:o,onEzChange:r=>this.onChangeDefaultValue(r==null?void 0:r.detail)},this.getConditionalAttributes(d,f,h,c,C,s)))}getConditionalAttributes(e,i,a,o,f,d){const n=e==l.SEARCHPLUS;switch(e){case l.SEARCH:case l.SEARCHPLUS:return{suppressEmptyOption:i,optionLoader:s=>this.onSearchDefaultValue(s,{useSearchPlus:n})};case l.OPTIONSELECTOR:return{suppressEmptyOption:i,options:a};case l.CHECKBOX:case l.SWITCH:return{mode:d};case l.INTEGERNUMBER:case l.DECIMALNUMBER:return{precision:o,prettyPrecision:f,onEzStartChange:s=>this.onChangeDefaultValue(s==null?void 0:s.detail)};case l.DATE:case l.DATETIME:case l.TIME:return{onEzStartChange:s=>this.onChangeDefaultValue(s==null?void 0:s.detail)};default:return{}}}onSearchDefaultValue(e,i){if(this._application&&this.fieldConfig)return this._application.executeSearch(e,this.fieldConfig.name,this.dataUnit,i)}initializeValues(){this.fieldLabel=this.fieldConfig.label,this.fieldDefaultValue=this.fieldConfig.defaultValue,this.fieldRequired=this.fieldConfig.required,this.fieldReadOnly=this.fieldConfig.readOnly,this.fieldCleanOnCopy=this.fieldConfig.cleanOnCopy}handleApplyChanges(){this.validateFieldLabel()&&(this.fieldConfig.label=this.fieldLabel,this.fieldConfig.defaultValue=this.fieldDefaultValue,this.fieldConfig.required=this.fieldRequired,this.fieldConfig.readOnly=this.fieldReadOnly,this.fieldConfig.cleanOnCopy=this.fieldCleanOnCopy,this.emitFieldChanged(),this._popoupElement.opened=!1)}applyErrorMessage(){this.fieldLabelErrorMessage=`Informe um valor para ${this.getMessage("snkConfigOptions.label.nameField")}`}handleDiscardChanges(){this.initializeValues(),this._popoupElement.opened=!1}componentWillLoad(){this.loadDefaultValue(),this._application=z.getContextValue("__SNK__APPLICATION__")}render(){return t("ez-popup",{heightMode:"auto",size:"auto","ez-title":"Configuração do campo",onEzClosePopup:()=>this.handleDiscardChanges(),ref:e=>this._popoupElement=e},t("div",{class:"field-config-container"},t("ez-text-input",{label:this.getMessage("snkConfigOptions.label.nameField"),value:this.fieldLabel,errorMessage:this.fieldLabelErrorMessage,hasInvalid:!!this.fieldLabelErrorMessage,onEzChange:e=>this.handleLabelChanged(e)}),t("ez-combo-box",{label:this.getMessage("snkConfigOptions.label.typeValueDefault"),suppressEmptyOption:!0,enabled:this.enabledValueDefault(),onEzChange:e=>this.handleDefaultTypeChanged(e),value:this.getDefaultType()},t("option",{value:u.fixed},this.getMessage("snkConfigOptions.options.valueFixed")),t("option",{value:u.variable},this.getMessage("snkConfigOptions.options.variable"))),this.renderDefaultValueEditor(),t("ez-check",{label:this.getMessage("snkConfigOptions.label.clearDuplicate"),value:this.fieldCleanOnCopy,onEzChange:e=>this.handleClearDuplicateChanged(e)}),t("ez-check",{label:this.getMessage("snkConfigOptions.label.requiredField"),enabled:E("required","systemRequired",this.fieldDescriptor),value:D("required",this.fieldDescriptor,this.fieldRequired),onEzChange:e=>this.handleRequiredChanged(e)}),t("ez-check",{label:this.getMessage("snkConfigOptions.label.protectedField"),enabled:E("readOnly","systemReadOnly",this.fieldDescriptor),value:D("readOnly",this.fieldDescriptor,this.fieldReadOnly),onEzChange:e=>this.handleReadOnlyChanged(e)}),t("div",{class:"actions"},t("ez-button",{label:"Cancelar",onClick:()=>this.handleDiscardChanges()}),t("ez-button",{label:"Confirmar",class:"ez-button--primary",onClick:()=>this.handleApplyChanges()}))))}static get watchers(){return{fieldLabel:["observeFieldLabel"]}}};M.style=A;const I=".sc-field-item-h{width:100%;display:flex;padding:12px 8px;border-radius:var(--border--radius-small, 4px);border:1px solid #dce0e8;cursor:grab;align-items:center;height:42px;max-height:42px;background:#FAFCFF}.full-width.sc-field-item-h{width:100%}ez-icon.sc-field-item{--ez-icon--color:#A2ABB9}.icons.sc-field-item{display:flex}.label.sc-field-item{display:flex;flex-grow:1;padding-left:8px;font-size:14px;align-items:center;gap:4px;height:22px}.label-text.sc-field-item{overflow:hidden;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;height:auto;-webkit-box-orient:vertical;-webkit-line-clamp:2;line-clamp:2;display:-webkit-box;-o-text-overflow:ellipsis;text-overflow:ellipsis;word-break:break-word}.required-mark.sc-field-item{color:#cf3105;background:#F7E0E5;width:12px;height:12px;border-radius:50%;display:flex;align-items:center;justify-content:center;padding-top:5px;font-size:16px;align-self:self-start}.actions.sc-field-item{display:flex;flex-direction:row;align-content:center;gap:4px}ez-button.sc-field-item{width:24px;align-items:center;justify-content:center;display:flex}.sc-field-item-h .hiddeble.sc-field-item{transition:0.2s ease-in-out;visibility:hidden;opacity:0}.sc-field-item-h:hover .hiddeble.sc-field-item{visibility:visible;opacity:1}",k=class{constructor(e){O(this,e),this.setFieldAsAvailable=g(this,"setFieldAsAvailable",7),this.addFieldToGuide=g(this,"addFieldToGuide",7),this.fieldDescriptor=void 0,this.fieldConfig=void 0,this.onLayoutConfig=!1,this.dataUnit=void 0,this.messagesBuilder=void 0}observeDataUnit(){this.loadFieldDescriptor()}isRequired(){var e,i;const a=this.dataUnit&&this.dataUnit.getField((e=this.fieldConfig)===null||e===void 0?void 0:e.name);return(a==null?void 0:a.required)===!0||((i=this.fieldConfig)===null||i===void 0?void 0:i.required)===!0}async showFieldConfig(){var e;await((e=this._refFieldConfig)===null||e===void 0?void 0:e.show(this._editIconRef))}renderFieldConfig(){if(this.onLayoutConfig&&this.dataUnit&&this.messagesBuilder)return t("field-config",{ref:e=>this._refFieldConfig=e,fieldConfig:this.fieldConfig,dataUnit:this.dataUnit,fieldDescriptor:this.fieldDescriptor,messagesBuilder:this.messagesBuilder,onFieldConfigChanged:()=>x(this)})}renderActions(){return this.onLayoutConfig?t("div",{class:"actions hiddeble"},t("ez-button",{mode:"icon",class:"ez-button--tertiary",onClick:()=>this.setFieldAsAvailable.emit(this.fieldConfig),size:"medium",iconName:"minus",title:"Remover"}),t("ez-button",{ref:e=>this._editIconRef=e,mode:"icon",class:"ez-button--tertiary",onClick:this.showFieldConfig.bind(this),iconName:"edit",size:"medium",title:"Editar"})):t("div",{class:"actions hiddeble"},t("ez-button",{mode:"icon",class:"ez-button--tertiary",onClick:()=>this.addFieldToGuide.emit(this.fieldConfig),iconName:"plus",size:"medium",title:"Adicionar ao Layout"}))}loadFieldDescriptor(){this.dataUnit&&(this.fieldDescriptor=this.dataUnit.getField(this.fieldConfig.name))}renderRequiredMark(){if(this.isRequired())return t("span",{class:"required-mark"},"*")}componentWillLoad(){this.loadFieldDescriptor()}getFieldLabel(){var e,i;return!((e=this.fieldConfig)===null||e===void 0)&&e.label?this.fieldConfig.label:(i=this.fieldDescriptor)===null||i===void 0?void 0:i.label}render(){var e;return t(_,{class:this.onLayoutConfig?"":"full-width"},t("div",{class:"icons"},t("ez-icon",{iconName:"drag-indicator"}),t("ez-icon",{iconName:w((e=this.fieldDescriptor)===null||e===void 0?void 0:e.userInterface)})),t("span",{class:"label"},t("span",{class:"label-text",title:this.getFieldLabel()},this.getFieldLabel()),this.renderRequiredMark()),this.renderActions(),this.renderFieldConfig())}static get watchers(){return{dataUnit:["observeDataUnit"]}}};k.style=I;export{M as field_config,k as field_item};
//# sourceMappingURL=field-config_2.entry-CBnkqMc-.js.map

import{r as G,c as u,f as b,h as r,H as c,g as v}from"./index-BV2D5AMk.js";import{S as y,O as x}from"./dataUnitInMemoryLoader-BjgoPaoq.js";import{S as h}from"./sortable.esm-842f85a3-C83syoBY.js";import{S as m,I as F,d as L}from"./FormConfigHelper-49fe72ca-BjOYQIZX.js";import{T as p,G as d}from"./constants-7b422de0-BRz2gykn.js";import{A as g}from"./FormLayout-pPi2ZB-q.js";const C='.sc-fields-layout-h{display:flex;padding:12px;box-shadow:var(--shadow--small, 0 0 16px rgba(0, 38, 111, 0.07));border-radius:var(--border--radius-medium, 6px);height:var(--snk-form-config-container-height);flex-direction:column}.layout-container.sc-fields-layout{container-type:inline-size;display:flex;flex-direction:column;overflow:auto;height:calc(100vh - 225px)}.guide-header.sc-fields-layout{display:flex;width:100%;font-size:20px;border-bottom:1px solid #dce0e8;margin-bottom:6px;align-items:center;height:45px}.guide-header.sc-fields-layout ez-button.sc-fields-layout{transition:all 0.2s ease-in-out;visibility:hidden;opacity:0}.guide-header.sc-fields-layout:hover ez-button.sc-fields-layout{visibility:visible;opacity:1}.guide-header-label.sc-fields-layout{display:block;padding:10px 0}.group-config.sc-fields-layout{padding:12px 0;display:flex;flex-direction:column;width:100%}.group-content.sc-fields-layout{display:grid;gap:12px;min-height:65px;width:100%;padding:6px 0;grid-template-columns:repeat(auto-fill, minmax(250px, 1fr))}.group-content.empty-content.sc-fields-layout{position:relative}.group-content.empty-content.sc-fields-layout::before{content:"Arraste e solte um campo aqui";color:#cbcfd7;font-size:16px;font-weight:500;text-align:center;position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;transition:opacity 0.3s;height:100%;box-sizing:border-box;padding:10px;background:#f9f9f9;border:1px dashed #dce0e8;border-radius:6px}.no-group-container.sc-fields-layout{padding:12px 0;width:100%;border-bottom:1px solid #dce0e8}.no-group-container.sc-fields-layout::before{content:"Inclua estes campos nos grupos ou deixe-os separados no topo do formulário";width:100%;display:block;font-size:16px;font-weight:400;color:#AFB6C0;padding-bottom:12px}.add-group-container.sc-fields-layout{display:flex;align-items:center;border-top:1px solid #dce0e8;padding-top:22px;padding-bottom:12px;gap:6px;cursor:pointer;justify-content:center;width:100%;height:55px}.no-guide-selected.sc-fields-layout{display:block;margin:auto;font-size:24px;color:#AFB6C0;font-weight:500}.ghost.sc-fields-layout{opacity:.5;background:#c8fbe2}',N=class{constructor(e){G(this,e),this.isEditingGuideName=u(this,"isEditingGuideName",7),this.isEditingGroupName=u(this,"isEditingGroupName",7),this.layoutChanged=u(this,"layoutChanged",7),this.setFieldListAsAvailable=u(this,"setFieldListAsAvailable",7),this.guideRenamed=u(this,"guideRenamed",7),this.ID_GROUPS="container-groups",this.ID_FIELDS="container-fields",this.reservedGuideNames=[p.main.toLowerCase(),p.general.toLocaleLowerCase()],this.groupsListMemory=[],this.groupsRefList=[],this.isEditGuideNameActive=!1,this.selectedGuide=void 0,this.groupsList=[],this.guideNames=[],this.dataUnit=void 0,this.messagesBuilder=void 0}handleFieldConfigChanged({detail:e}){const t=e,i=this.groupsListMemory.find(a=>a.name===t.group);if(!i)return;const o=i.fields.map(a=>a.name===t.name?t:a),s=this.groupsListMemory.map(a=>a.name===i.name?{name:a.name,fields:o}:a);this.applyGroupUpdate(s)}observeSelectedGuide(){this.isEditGuideNameActive=!1,b(this),this.isEditingGroupName.emit(!1)}observeGroupList(e){this.groupsListMemory=[...e]}observeIsEditGuideNameActive(e){this.isEditingGuideName.emit(e)}async addFieldToLayout(e){e.group=d.noGroup,e.tab=this.selectedGuide.name;const t=this.getFixedFieldsGroup(),i={name:d.noGroup,fields:t?[...t.fields,e]:[e]},o=t?[i,...this.groupsListMemory.slice(1)]:[i,...this.groupsListMemory];this.applyGroupUpdate(o)}getFixedFieldsGroup(){return this.groupsListMemory.find(e=>e.name===d.noGroup)}getMessage(e,t){return this.messagesBuilder.getMessage(e,t)}handleAddGroup(){const e={name:this.buildNewGroupName(),fields:[]},t=[...this.groupsListMemory,e];this.applyGroupUpdate(t)}buildNewGroupName(){var e,t;const i=(t=(e=this.groupsListMemory.filter(o=>o.name.includes(d.newGroup)))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0;return i===0?d.newGroup:`${d.newGroup} (${i})`}makeDynamicFieldsContainersDraggable(){this.groupsList.filter(t=>t.name!==d.noGroup).forEach(t=>{this.makeFieldContainerDraggable(this.getFieldsContainerId(t.name))})}getFieldsContainerId(e){return`${this.ID_FIELDS}-${y.replaceBlankCharacters(e)}`}handleSortGroups(e){var t;const i=(t=e.to)===null||t===void 0?void 0:t.children;if(!i)return;const o=Array.from(i).map(n=>n.getAttribute("data-group-name")),s=[],a=this.getFixedFieldsGroup();a&&s.push(a),o.forEach(n=>{const l=this.groupsListMemory.find(f=>f.name===n);l&&s.push(l)}),this.applyGroupUpdate(s)}handleFieldsChanged(e){let t=[...this.groupsListMemory];t=[...this.handleFieldsOnGroupUpdate(t,e,m.FROM)],t=[...this.handleFieldsOnGroupUpdate(t,e,m.TO)],this.applyGroupUpdate(t)}applyGroupUpdate(e){var t;return(t=this.groupsRefList)===null||t===void 0||t.forEach(i=>i==null?void 0:i.cancelEdition()),x.equals(e,this.groupsListMemory)?!1:(this.groupsListMemory=[...e],this.layoutChanged.emit(this.groupsListMemory),!0)}handleFieldsOnGroupUpdate(e,t,i){const o=t[i];return o.id===F?e:this.updateGroupList(e,o,i,t)}updateGroupList(e,t,i,o){const s=t.getAttribute("data-group-name"),a={name:s,fields:L(o,i,s,this.selectedGuide.name)};return this.replaceGroup(e,a)}replaceGroup(e,t){return e.map(i=>i.name===t.name?t:i)}makeGroupsDraggable(){try{const e=this.getContainerElement(this.ID_GROUPS);if(!e)return;new h(e,{group:"groups",ghostClass:"ghost",direction:"horizontal",animation:15,onSort:t=>this.handleSortGroups(t)})}catch{console.error("Falha ao tornar container de grupos arrastável: ",this.ID_GROUPS)}}makeFieldContainerDraggable(e){try{const t=this.getContainerElement(e);if(!t)return;new h(t,{group:"fields",ghostClass:"ghost",direction:"vertical",animation:15,onAdd:i=>this.handleFieldsChanged(i),onRemove:i=>this.handleFieldsChanged(i),onSort:i=>this.handleFieldsChanged(i)})}catch{console.error("Falha ao tornar grupo arrastável: ",e)}}getContainerElement(e){return this.el.querySelector(`[id="${e}"]`)}handleSetFieldAsAvailable(e){var t;const i=(t=e.group)!==null&&t!==void 0?t:d.noGroup,s=this.groupsListMemory.find(l=>l.name===i).fields.filter(l=>l.name!==e.name),a={name:i,fields:s},n=[...this.replaceGroup(this.groupsListMemory,a)];this.applyGroupUpdate(n)}removeGroup(e){var t,i;const o=(i=(t=this.groupsListMemory.find(a=>a.name===e.name))===null||t===void 0?void 0:t.fields)!==null&&i!==void 0?i:[],s=[...this.groupsListMemory.filter(a=>a.name!==e.name)];this.applyGroupUpdate(s)&&this.setFieldListAsAvailable.emit(o)}handleRenameGroup(e){const{value:t,newValue:i}=e.detail,o=this.groupsListMemory.map(s=>{if(s.name!==t)return Object.assign({},s);const a=s.fields.map(n=>Object.assign(Object.assign({},n),{group:i}));return{name:i,fields:a}});this.applyGroupUpdate(o)}canSaveGroup(e,t){if(!this.groupsList.some(a=>{var n;return((n=a.name)!==null&&n!==void 0?n:"").toLocaleLowerCase()===(e??"").toLocaleLowerCase()}))return!0;const o=this.getMessage("snkFormConfig.confirm.title"),s=this.buildDuplicatedGroupNameContent(e);return g.alert(o,s).then(()=>{var a;return(a=this.groupsRefList[t])===null||a===void 0?void 0:a.applyFocusTextEdit()}),!1}buildDuplicatedGroupNameContent(e){const t=this.selectedGuide.name;return`
        ${this.getMessage("snkFormConfig.alert.titleGroupExists")}
        <b>${e}</b>
        ${this.getMessage("snkFormConfig.alert.inTab")}
        <b>${t===p.main?this.getMessage("snkFormConfig.form.mainArea"):t}</b>.
        <br/><br/>
        ${this.getMessage("snkFormConfig.alert.infoValidTitle")}
      `}buildDuplicatedTabNameContent(e){return`
        ${this.getMessage("snkFormConfig.alert.titleGuideExists")}
        <b>${e}</b>.
        <br/><br/>
        ${this.getMessage("snkFormConfig.alert.infoValidTitle")}
      `}buildReservedTabNameContent(e){return`
        ${this.getMessage("snkFormConfig.alert.titleGuideReservedName")}
        <br/><br/>
        <b>${e}</b>.
        <br/><br/>
        ${this.getMessage("snkFormConfig.alert.infoValidTitle")}
      `}renderFields(e){if(e.length!==0)return e.map(t=>r("field-item",{key:t.name,fieldConfig:t,onLayoutConfig:!0,dataUnit:this.dataUnit,messagesBuilder:this.messagesBuilder,onSetFieldAsAvailable:i=>this.handleSetFieldAsAvailable(i.detail)}))}renderDraggableGroups(){return this.groupsList.filter(t=>t.name!==d.noGroup).map((t,i)=>{var o;return r("div",{key:t.name,class:"group-config","data-group-name":t.name},r("ez-collapsible-box",{ref:s=>this.groupsRefList[i]=s,label:t.name,headerSize:"large",editable:!0,removable:!0,"icon-placement":"left",onEzRemove:()=>this.removeGroup(t),onEzSaveEditLabel:s=>this.handleRenameGroup(s),onEzEditLabelMode:({detail:s})=>this.isEditingGroupName.emit(s),conditionalSave:s=>this.canSaveGroup(s,i)},r("div",{id:this.getFieldsContainerId(t.name),class:`group-content ${!((o=t.fields)===null||o===void 0)&&o.length?"":"empty-content"}`,"data-group-name":t.name},this.renderFields(t.fields))))})}renderFixedFields(){var e,t;const i=(t=(e=this.groupsList.find(o=>o.name===d.noGroup))===null||e===void 0?void 0:e.fields)!==null&&t!==void 0?t:[];return this.renderFields(i)}handleRenameGuide(e){const{value:t,newValue:i}=e.detail;if(this.isEditGuideNameActive=!1,i===t)return;const o=this.guideNames.includes(i.toLowerCase()),s=this.reservedGuideNames.includes(i.toLowerCase());if(s||o){const a=this.getMessage("snkFormConfig.confirm.title"),n=s?this.buildReservedTabNameContent(i):this.buildDuplicatedTabNameContent(i);g.alert(a,n).then(()=>this._refTextEdit.applyFocusSelect());return}this.guideRenamed.emit(i)}cancelEditGuideName(){this.isEditGuideNameActive=!1}async startGuideNameEdition(){this.isEditGuideNameActive=!0,setTimeout(async()=>{await this._refTextEdit.applyFocusSelect()},200)}getTextEditStyle(){return{fontSize:"20px",fontWeight:"500",fontFamily:"Roboto"}}renderGuideName(){var e,t;return this.isEditGuideNameActive?r("div",{class:"guide-header"},r("ez-text-edit",{class:"collapsible-box__text-edit",ref:i=>this._refTextEdit=i,value:(e=this.selectedGuide)===null||e===void 0?void 0:e.label,styled:this.getTextEditStyle(),onSaveEdition:i=>this.handleRenameGuide(i),onCancelEdition:()=>this.cancelEditGuideName()})):r("div",{class:"guide-header"},r("span",{class:"guide-header-label"},(t=this.selectedGuide)===null||t===void 0?void 0:t.label),this.renderEditGuideNameButton())}renderEditGuideNameButton(){var e;if(((e=this.selectedGuide)===null||e===void 0?void 0:e.name)!==p.main)return r("ez-button",{mode:"icon",class:"ez-button--tertiary",onClick:()=>this.startGuideNameEdition(),size:"medium",iconName:"edit",title:"Renomear"})}componentDidRender(){this.makeGroupsDraggable(),this.makeDynamicFieldsContainersDraggable(),this.makeFieldContainerDraggable(d.noGroup)}render(){return this.selectedGuide?r(c,{class:"ez-flex-item--auto ez-size-height--full ez-box ez-padding--medium content-container"},this.renderGuideName(),r("div",{class:"layout-container"},r("ez-scroller",{direction:"vertical",activeShadow:!0},r("div",{class:"no-group-container"},r("div",{id:d.noGroup,class:"group-content","data-group-name":d.noGroup},this.renderFixedFields())),r("hr",null),r("div",{id:this.ID_GROUPS,class:"groups-container"},this.renderDraggableGroups()))),r("div",{class:"add-group-container",onClick:this.handleAddGroup.bind(this)},r("ez-icon",{slot:"leftIcon",iconName:"plus"}),r("span",null,"Criar novo grupo"))):r(c,{class:"ez-flex-item--auto ez-size-height--full ez-box ez-padding--medium content-container"},r("span",{class:"no-guide-selected"},"Selecione uma guia e comece a configurar"))}get el(){return v(this)}static get watchers(){return{selectedGuide:["observeSelectedGuide"],groupsList:["observeGroupList"],isEditGuideNameActive:["observeIsEditGuideNameActive"]}}};N.style=C;export{N as fields_layout};

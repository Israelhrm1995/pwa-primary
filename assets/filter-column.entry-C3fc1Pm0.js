import{v as f,w as v,U as l,y as b,x as n}from"./index-CxFxc26b.js";import{P as m}from"./constants-3fabe81e-wRQIC6Ss.js";const O=".filter-column{padding:var(--space--2xs, 8px);position:relative}.filter-column__header{margin-bottom:var(--space--2xs, 8px);display:flex;flex-direction:row;align-items:center;justify-content:space-between;height:var(--space--xl, 32px)}.filter-column__footer{position:relative;display:flex;flex-direction:row;justify-content:flex-end;align-items:center;width:100%;bottom:0;left:0;padding-top:var(--space--2xs, 8px);border-top:var(--border--medium) var(--color--disable-secondary)}.filter-column__popover{position:absolute}.filter-column__header-title{margin-left:8px}#filter-column-selection-list{--ez-multi-selection-default-height:unset}",_=window,y=new CustomEvent("onSubmitFilter",{detail:{showToast:!0}}),C=class{constructor(e){f(this,e),this.applyFilterColumnOptions=v(this,"applyFilterColumnOptions"),this.opened=!0,this.columnName=void 0,this.columnLabel=void 0,this.gridHeaderHidden=!1,this.noHeaderTaskBar=!1,this.dataSource=void 0,this.dataUnit=void 0,this.options=void 0,this.selectedItems=void 0,this.fieldDescriptor=void 0,this.useOptions=!1,this.isTextSearch=!1}async hide(){await this.ezPopoverElement.hide(),await this.clearConfigs()}async show(e){var t;this.canShow(e)&&(this.fieldDescriptor=(t=e.fieldDescriptor)!==null&&t!==void 0?t:this.dataUnit.getField(e.columnName),this.buildIsTextSearch(),this.columnName=e.columnName,this.columnLabel=e.columnLabel,await this.setOptions(e),await this.ezPopoverElement.showUnder(`filter-column-${e.columnName}-${this.dataUnit.dataUnitId}`))}buildIsTextSearch(){var e,t;const i=(t=(e=this.fieldDescriptor)===null||e===void 0?void 0:e.userInterface)!==null&&t!==void 0?t:l.SHORTTEXT;this.isTextSearch=!(i===l.DECIMALNUMBER||i===l.INTEGERNUMBER)}async clearConfigs(){var e;await((e=this.ezMultiSelectionList)===null||e===void 0?void 0:e.clearFilteredOptions()),this.options=null,this.columnName=null}canShow(e){return!this.ezPopoverElement.opened||e.columnName!==this.columnName}submit(){this.applyFilterColumnOptions.emit({field:this.columnName,values:this.selectedItems}),_.dispatchEvent(y),this.hide()}changeSelectedItems(e){this.selectedItems=e}hasToUseOptions(){return this.fieldDescriptor.userInterface===l.OPTIONSELECTOR||this.fieldDescriptor.userInterface===l.SWITCH||this.fieldDescriptor.userInterface===l.CHECKBOX}isCheckBoxOrSwitch(){return this.fieldDescriptor.userInterface===l.SWITCH||this.fieldDescriptor.userInterface===l.CHECKBOX}async setOptions(e){var t,i,o,a;const r=e.filteredOptions,s=this.hasToUseOptions();if(s){this.useOptions=s,this.options=s?this.buildOptions(r):r??null;return}let d=this.columnName;const h={onlyLabel:!1};!((i=(t=e.fieldDescriptor)===null||t===void 0?void 0:t.properties)===null||i===void 0)&&i[m]&&(d=(a=(o=e.fieldDescriptor)===null||o===void 0?void 0:o.properties)===null||a===void 0?void 0:a[m],h.onlyLabel=!0);const u=await this.dataSource.getStaticOptions(d,h);if(u!=null){const p=new Set((r||[]).filter(c=>c.check).map(c=>c.label));this.useOptions=!0,this.options=p.size===0?u:u.map(c=>Object.assign(Object.assign({},c),{check:p.has(c.label)}));return}this.useOptions=!1,this.options=null}buildOptions(e){var t,i;if(e&&e.length>0)return e;if(this.isCheckBoxOrSwitch())return[{label:this.i18n("app.yes"),value:"true",check:!0},{label:this.i18n("app.no"),value:"false",check:!0}];const o=(i=(t=this.fieldDescriptor)===null||t===void 0?void 0:t.properties)===null||i===void 0?void 0:i.options;if(Array.isArray(o))return o.map(s=>({label:s.value,value:s.value,check:!0}));const a=JSON.parse(o);return Object.keys(a).map(s=>({label:a[s],value:s,check:!0}))}handleEzVisibilityChange(e){e.detail===!1&&this.clearConfigs()}async componentWillLoad(){this.i18n=await b()}render(){return n("ez-popover-plus",{ref:e=>this.ezPopoverElement=e,class:"filter-column__popover","overlay-type":"none",autoClose:!0,onEzVisibilityChange:this.handleEzVisibilityChange.bind(this)},n("section",{class:"filter-column"},n("header",{class:"filter-column__header"},n("span",{class:"ez-text ez-text--medium filter-column__header-title"},this.i18n("ez-grid.filterColumnHeader",{columnLabel:this.columnLabel})),n("ez-button",{mode:"icon","icon-name":"close",class:"ez-button--tertiary",onClick:()=>this.hide()})),n("ez-multi-selection-list",{id:"filter-column-selection-list",columnName:this.columnName,dataSource:this.dataSource,options:this.options,useOptions:this.useOptions,ref:e=>this.ezMultiSelectionList=e,onChangeFilteredOptions:e=>this.changeSelectedItems(e.detail),isTextSearch:this.isTextSearch,"data-element-id":this.columnName}),n("footer",{class:"filter-column__footer"},n("ez-button",{label:this.i18n("app.apply"),class:"ez-button--primary",onClick:this.submit.bind(this)}))))}};C.style=O;export{C as filter_column};
//# sourceMappingURL=filter-column.entry-C3fc1Pm0.js.map

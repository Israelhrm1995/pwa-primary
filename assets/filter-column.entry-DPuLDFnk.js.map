{"version":3,"file":"filter-column.entry-DPuLDFnk.js","sources":["../../node_modules/@sankhyalabs/ezui/dist/esm/filter-column.entry.js"],"sourcesContent":["import { r as registerInstance, c as createEvent, h } from './index-5a720e56.js';\nimport { UserInterface } from '@sankhyalabs/core';\nimport { a as PRESENTATION_FROM_COL_PROP_NAME } from './constants-3fabe81e.js';\nimport { i as initI18n } from './index-b623906e.js';\n\nconst filterColumnCss = \".filter-column{padding:var(--space--2xs, 8px);position:relative}.filter-column__header{margin-bottom:var(--space--2xs, 8px);display:flex;flex-direction:row;align-items:center;justify-content:space-between;height:var(--space--xl, 32px)}.filter-column__footer{position:relative;display:flex;flex-direction:row;justify-content:flex-end;align-items:center;width:100%;bottom:0;left:0;padding-top:var(--space--2xs, 8px);border-top:var(--border--medium) var(--color--disable-secondary)}.filter-column__popover{position:absolute}.filter-column__header-title{margin-left:8px}#filter-column-selection-list{--ez-multi-selection-default-height:unset}\";\n\nconst windowInstace = window;\nconst onSubmitFilter = new CustomEvent('onSubmitFilter', {\n  detail: {\n    showToast: true,\n  },\n});\nconst FilterColumn = class {\n  constructor(hostRef) {\n    registerInstance(this, hostRef);\n    this.applyFilterColumnOptions = createEvent(this, \"applyFilterColumnOptions\", 7);\n    this.opened = true;\n    this.columnName = undefined;\n    this.columnLabel = undefined;\n    this.gridHeaderHidden = false;\n    this.noHeaderTaskBar = false;\n    this.dataSource = undefined;\n    this.dataUnit = undefined;\n    this.options = undefined;\n    this.selectedItems = undefined;\n    this.fieldDescriptor = undefined;\n    this.useOptions = false;\n    this.isTextSearch = false;\n  }\n  async hide() {\n    await this.ezPopoverElement.hide();\n    await this.clearConfigs();\n  }\n  /**\n   * Abre o filtro de coluna.\n   * @Params IFilterColumnConfigs informações para configurar o filtro\n   */\n  async show(configs) {\n    var _a;\n    if (this.canShow(configs)) {\n      this.fieldDescriptor = (_a = configs.fieldDescriptor) !== null && _a !== void 0 ? _a : this.dataUnit.getField(configs.columnName);\n      this.buildIsTextSearch();\n      this.columnName = configs.columnName;\n      this.columnLabel = configs.columnLabel;\n      await this.setOptions(configs);\n      await this.ezPopoverElement.showUnder(`filter-column-${configs.columnName}-${this.dataUnit.dataUnitId}`);\n    }\n  }\n  buildIsTextSearch() {\n    var _a, _b;\n    const userInterface = (_b = (_a = this.fieldDescriptor) === null || _a === void 0 ? void 0 : _a.userInterface) !== null && _b !== void 0 ? _b : UserInterface.SHORTTEXT;\n    this.isTextSearch = !(userInterface === UserInterface.DECIMALNUMBER || userInterface === UserInterface.INTEGERNUMBER);\n  }\n  async clearConfigs() {\n    var _a;\n    await ((_a = this.ezMultiSelectionList) === null || _a === void 0 ? void 0 : _a.clearFilteredOptions());\n    this.options = null;\n    this.columnName = null;\n  }\n  canShow(configs) {\n    return !this.ezPopoverElement.opened || configs.columnName !== this.columnName;\n  }\n  submit() {\n    this.applyFilterColumnOptions.emit({\n      field: this.columnName,\n      values: this.selectedItems,\n    });\n    windowInstace.dispatchEvent(onSubmitFilter);\n    this.hide();\n  }\n  changeSelectedItems(items) {\n    this.selectedItems = items;\n  }\n  hasToUseOptions() {\n    return this.fieldDescriptor.userInterface === UserInterface.OPTIONSELECTOR\n      || this.fieldDescriptor.userInterface === UserInterface.SWITCH\n      || this.fieldDescriptor.userInterface === UserInterface.CHECKBOX;\n  }\n  isCheckBoxOrSwitch() {\n    return this.fieldDescriptor.userInterface === UserInterface.SWITCH\n      || this.fieldDescriptor.userInterface === UserInterface.CHECKBOX;\n  }\n  async setOptions(config) {\n    var _a, _b, _c, _d;\n    const selectedItems = config.filteredOptions;\n    const validateFieldUserInterfaceOptionSelector = this.hasToUseOptions();\n    if (validateFieldUserInterfaceOptionSelector) {\n      this.useOptions = validateFieldUserInterfaceOptionSelector;\n      this.options = validateFieldUserInterfaceOptionSelector ? this.buildOptions(selectedItems) : (selectedItems !== null && selectedItems !== void 0 ? selectedItems : null);\n      return;\n    }\n    let colName = this.columnName;\n    const staticOptionsConfig = { onlyLabel: false };\n    if ((_b = (_a = config.fieldDescriptor) === null || _a === void 0 ? void 0 : _a.properties) === null || _b === void 0 ? void 0 : _b[PRESENTATION_FROM_COL_PROP_NAME]) {\n      colName = (_d = (_c = config.fieldDescriptor) === null || _c === void 0 ? void 0 : _c.properties) === null || _d === void 0 ? void 0 : _d[PRESENTATION_FROM_COL_PROP_NAME];\n      staticOptionsConfig.onlyLabel = true;\n    }\n    const options = await this.dataSource.getStaticOptions(colName, staticOptionsConfig);\n    if (options != undefined) {\n      const selected = new Set((selectedItems || []).filter(item => item.check).map(item => item.label));\n      this.useOptions = true;\n      this.options = selected.size === 0 ? options : options.map(option => (Object.assign(Object.assign({}, option), { check: selected.has(option.label) })));\n      return;\n    }\n    this.useOptions = false;\n    this.options = null;\n  }\n  buildOptions(selectedItems) {\n    var _a, _b;\n    if (selectedItems && selectedItems.length > 0) {\n      return selectedItems;\n    }\n    if (this.isCheckBoxOrSwitch()) {\n      return [\n        { label: this.i18n(\"app.yes\"), value: 'true', check: true },\n        { label: this.i18n(\"app.no\"), value: 'false', check: true },\n      ];\n    }\n    const options = (_b = (_a = this.fieldDescriptor) === null || _a === void 0 ? void 0 : _a.properties) === null || _b === void 0 ? void 0 : _b.options;\n    if (Array.isArray(options)) {\n      return options.map((option) => {\n        return { label: option.value, value: option.value, check: true };\n      });\n    }\n    const optionsObject = JSON.parse(options);\n    const objectKeys = Object.keys(optionsObject);\n    return objectKeys.map(key => {\n      return { label: optionsObject[key], value: key, check: true };\n    });\n  }\n  handleEzVisibilityChange(event) {\n    if (event.detail === false) {\n      this.clearConfigs();\n    }\n  }\n  async componentWillLoad() {\n    this.i18n = await initI18n();\n  }\n  render() {\n    return (h(\"ez-popover-plus\", { ref: (element) => (this.ezPopoverElement = element), class: 'filter-column__popover', \"overlay-type\": 'none', autoClose: true, onEzVisibilityChange: this.handleEzVisibilityChange.bind(this) }, h(\"section\", { class: 'filter-column' }, h(\"header\", { class: 'filter-column__header' }, h(\"span\", { class: 'ez-text ez-text--medium filter-column__header-title' }, this.i18n(\"ez-grid.filterColumnHeader\", { columnLabel: this.columnLabel })), h(\"ez-button\", { mode: 'icon', \"icon-name\": 'close', class: 'ez-button--tertiary', onClick: () => this.hide() })), h(\"ez-multi-selection-list\", { id: 'filter-column-selection-list', columnName: this.columnName, dataSource: this.dataSource, options: this.options, useOptions: this.useOptions, ref: (element) => (this.ezMultiSelectionList = element), onChangeFilteredOptions: (event) => this.changeSelectedItems(event.detail), isTextSearch: this.isTextSearch, \"data-element-id\": this.columnName }), h(\"footer\", { class: 'filter-column__footer' }, h(\"ez-button\", { label: this.i18n(\"app.apply\"), class: 'ez-button--primary', onClick: this.submit.bind(this) })))));\n  }\n};\nFilterColumn.style = filterColumnCss;\n\nexport { FilterColumn as filter_column };\n"],"names":["filterColumnCss","windowInstace","onSubmitFilter","FilterColumn","hostRef","registerInstance","createEvent","configs","_a","_b","userInterface","UserInterface","items","config","_c","_d","selectedItems","validateFieldUserInterfaceOptionSelector","colName","staticOptionsConfig","PRESENTATION_FROM_COL_PROP_NAME","options","selected","item","option","optionsObject","key","event","initI18n","h","element"],"mappings":"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","x_google_ignoreList":[0]}
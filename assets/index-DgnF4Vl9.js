import{d as l,J as c}from"./dataUnitInMemoryLoader-CwDmnNwL.js";function h(a,e){const t=getComputedStyle(a);return l.HORIZONTAL===e?parseInt(t.marginLeft||"0")+parseInt(t.marginRight||"0"):parseInt(t.marginTop||"0")+parseInt(t.marginBottom||"0")}const d="overflowed";class v{constructor({element:e,callback:t,overFlowDirection:i=l.HORIZONTAL,debounce:s=200,deltaSize:r=0,notOverFlow:n=[]}){this._lastContainerSize=void 0,this._lastContainerInstance=void 0,this._scrollDirection=l.HORIZONTAL,this._hiddenItemsProps=new Map,this._notOverFlowPros=new Map,this._notOverFlow=[],this.DATA_ELEMENT_ID="data-element-id",this._onResize=t,this._scrollDirection=i,this._propSize=l.HORIZONTAL===i?"width":"height",this._resizeObserver=new ResizeObserver(c.debounce(o=>this.handleResize(o),s)),this._resizeObserver.observe(e),this._deltaSize=r,this._notOverFlow=n}addNotOverFlowElement(e){this._notOverFlow.includes(e)||this._notOverFlow.push(e)}destroy(){this._resizeObserver.disconnect()}forceUpdate(){this._lastContainerSize&&this._lastContainerInstance&&this.updateOverFlowedItems(this._lastContainerInstance,this._lastContainerSize)}handleResize(e){if(!e||e.length===0)return;const t=e[0],i=t.contentRect[this._propSize];i&&this.hasChangedSize(i)&&this.updateOverFlowedItems(t.target,i)}updateOverFlowedItems(e,t){const i=Array.from(e.children);this.registerNotOverflowProps(i),this.proccessElements(t,i),this._lastContainerSize=t,this._lastContainerInstance=e}registerNotOverflowProps(e){e.forEach(t=>{const i=t.id||this.getDataElementId(t);this.canNotRegisterNotOverFlow(i)||this._notOverFlowPros.set(i,this.getElementSizeProps(t))})}canNotRegisterNotOverFlow(e){return!e||!this._notOverFlow.includes(e)}hasChangedSize(e){if(!this._lastContainerSize)return!0;const t=e-this._lastContainerSize;return t<0?Math.abs(t)>this._deltaSize:t>0}proccessElements(e,t){if(t.length===0)return;const i=this.calcChildrenSize(t);if(Number((e-i).toFixed(4))>0){this.clearOverFlow();return}this.proccessElementsOverFlow(t,e)}clearOverFlow(){this._hiddenItemsProps=new Map,this._onResize([])}proccessElementsOverFlow(e,t){const i=[],s=t-this._deltaSize;let r=0;for(const o of e){if(r+=this.calcElementSize(o),this.exceedsAvaliableSize(r,i,s))break;i.push(o)}const n=e.filter(o=>this.isElementOverFlowing(i,o));n.forEach(o=>{this._hiddenItemsProps.has(o)||this.registerElementSize(o)}),this._onResize(n)}isElementOverFlowing(e,t){return!e.includes(t)&&this.canOverFlowElement(t)}canOverFlowElement(e){return!this._notOverFlow.includes(e.id)&&!this._notOverFlow.includes(this.getDataElementId(e))}getDataElementId(e){var t;return(t=e.getAttribute("data-element-id"))!==null&&t!==void 0?t:""}exceedsAvaliableSize(e,t,i){if(!this._notOverFlow.length)return e>i;const s=this.canNotOverFlowNotIncludedIds(t);if(!s.length)return e>i;const r=this.calculateVariation(s);return e+r>i}calculateVariation(e){let t=0;return e.forEach(i=>{var s,r;const n=this._notOverFlowPros.get(i);t+=(s=n==null?void 0:n.size)!==null&&s!==void 0?s:0,t+=(r=n==null?void 0:n.margin)!==null&&r!==void 0?r:0}),t}canNotOverFlowNotIncludedIds(e){const t=e.map(i=>i.id||this.getDataElementId(i)).filter(i=>!!i);return this._notOverFlow.filter(i=>!t.includes(i))}registerElementSize(e){const t=this.getElementSizeProps(e);this._hiddenItemsProps.set(e,t)}getElementSizeProps(e){return{size:e.getBoundingClientRect()[this._propSize],margin:h(e,this._scrollDirection)}}calcChildrenSize(e){let t=0;return t+=this._deltaSize,Array.from(e).forEach(i=>t+=this.calcElementSize(i)),t}calcElementSize(e){var t,i;let s=0;if(this.isOverFlowed(e)){const r=this._hiddenItemsProps.get(e);return s+=(t=r==null?void 0:r.size)!==null&&t!==void 0?t:0,s+=(i=r==null?void 0:r.margin)!==null&&i!==void 0?i:0,s}return s+=e.getBoundingClientRect()[this._propSize],s+=h(e,this._scrollDirection),s}isOverFlowed(e){return e.classList.contains(d)}}export{d as O,v as a};
//# sourceMappingURL=index-DgnF4Vl9.js.map

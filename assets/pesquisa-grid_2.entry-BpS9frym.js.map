{"version":3,"file":"pesquisa-grid_2.entry-BpS9frym.js","sources":["../../node_modules/@sankhyalabs/sankhyablocks/dist/esm/pesquisa-grid_2.entry.js"],"sourcesContent":["import { r as registerInstance, c as createEvent, h, H as Host, F as Fragment } from './index-479e1293.js';\nimport { I as InMemoryLoader } from './dataunit-fetcher-1b78797a.js';\nimport './DataFetcher-db08cad0.js';\nimport { P as PesquisaFetcher } from './ISave-da565824.js';\nimport '@sankhyalabs/core';\nimport './index-b40568ff.js';\nimport '@sankhyalabs/ezui/dist/collection/utils/constants';\nimport '@sankhyalabs/core/dist/dataunit/metadata/UnitMetadata';\nimport './filter-item-type.enum-d45e026f.js';\nimport './form-config-fetcher-e623539b.js';\nimport './constants-7b422de0.js';\nimport { ApplicationUtils } from '@sankhyalabs/ezui/dist/collection/utils';\nimport '@sankhyalabs/ezui/dist/collection/components/ez-grid/utils';\nimport '@sankhyalabs/core/dist/utils/SortingUtils';\nimport './ResourceIDUtils-a114189a.js';\nimport './PrintUtils-3e4ff0f5.js';\n\nconst pesquisaGridCss = \".sc-pesquisa-grid-h{background:var(--background--xlight, #FFF);overflow-x:auto}ez-grid.sc-pesquisa-grid{--ez-grid__container--shadow:none;--ez-grid__header--shadow:none}\";\n\nconst PesquisaGrid = class {\n  constructor(hostRef) {\n    registerInstance(this, hostRef);\n    this.pesquisaGridSelectItem = createEvent(this, \"pesquisaGridSelectItem\", 7);\n    this._pesquisaFetcher = new PesquisaFetcher();\n    this.metadata = undefined;\n    this.dataSource = [];\n    this.pkField = undefined;\n    this.descriptionField = undefined;\n    this.entityName = undefined;\n    this.shouldLoadConfig = false;\n    this._gridConfig = undefined;\n    this._inMemoryLoader = undefined;\n    this._dataunit = undefined;\n  }\n  observeDataSource(newValue) {\n    if (!this._inMemoryLoader || !this._dataunit || !newValue)\n      return;\n    this._inMemoryLoader.records = [...newValue];\n  }\n  observeMetadata() {\n    this.initializeDataUnit();\n  }\n  async observeShouldLoadConfig(newValue) {\n    if (!newValue || this._gridConfig)\n      return;\n    await this.loadGridConfig();\n  }\n  async loadGridConfig() {\n    this._gridConfig = await this._pesquisaFetcher.loadPesquisaGridConfig(this.entityName);\n  }\n  initializeDataUnit() {\n    var _a;\n    if (!this.metadata || this._dataunit)\n      return;\n    this._inMemoryLoader = new InMemoryLoader(this.metadata, (_a = this.dataSource) !== null && _a !== void 0 ? _a : []);\n    this._dataunit = this._inMemoryLoader.dataUnit;\n    this._dataunit.pageSize = 0;\n  }\n  handleDbClick(record) {\n    const option = {\n      value: record[this.pkField],\n      label: record[this.descriptionField],\n    };\n    this.pesquisaGridSelectItem.emit(option);\n  }\n  async handleConfigChanged({ detail }) {\n    var _a;\n    const columns = (_a = detail === null || detail === void 0 ? void 0 : detail.columns) !== null && _a !== void 0 ? _a : [];\n    await this._pesquisaFetcher.savePesquisaGridConfig(this.entityName, columns);\n  }\n  render() {\n    if (!this.metadata || !this._dataunit)\n      return;\n    return (h(Host, null, h(\"ez-grid\", { dataUnit: this._dataunit, config: this._gridConfig, mode: \"simple\", autoFocus: false, onEzDoubleClick: ({ detail }) => this.handleDbClick(detail), onConfigChange: async (event) => this.handleConfigChanged(event) })));\n  }\n  static get watchers() { return {\n    \"dataSource\": [\"observeDataSource\"],\n    \"metadata\": [\"observeMetadata\"],\n    \"shouldLoadConfig\": [\"observeShouldLoadConfig\"]\n  }; }\n};\nPesquisaGrid.style = pesquisaGridCss;\n\nconst pesquisaTreeCss = \".sc-pesquisa-tree-h{--snk-pesquisa--tree__action-container--top:var(--space--sm);--snk-pesquisa--tree__action-container--right:var(--space--small);--snk-pesquisa--tree__min-height:var(--space--extra-large);background:var(--background--xlight, #FFF);position:relative;min-height:var(--snk-pesquisa--tree__min-height);height:100%;display:block;overflow-y:auto}.sc-pesquisa-tree-h:hover .actions-container.sc-pesquisa-tree{display:flex}.actions-container.sc-pesquisa-tree{flex-direction:row;position:absolute;top:var(--snk-pesquisa--tree__action-container--top);right:var(--snk-pesquisa--tree__action-container--right);display:none}\";\n\nconst PesquisaTree = class {\n  constructor(hostRef) {\n    registerInstance(this, hostRef);\n    this.pesquisaTreeSelectItem = createEvent(this, \"pesquisaTreeSelectItem\", 7);\n    this.treeLoader = undefined;\n    this.argument = undefined;\n    this.allowsNonAnalytic = false;\n    this.shouldLoadTree = false;\n    this.items = [];\n  }\n  async applyFilter() {\n    await this._tree.applyFilter(this.argument);\n  }\n  async observeShouldLoadTree(newValue) {\n    if (!newValue || this.items.length > 0)\n      return;\n    await this.loadTree();\n  }\n  async loadTree() {\n    if (!this.shouldLoadTree)\n      return;\n    if (!this.treeLoader || typeof this.treeLoader !== 'function')\n      return;\n    const response = await this.treeLoader((this.argument || '').trim());\n    this.items = [...response];\n  }\n  expandOrCloseAllItems(items, expanded) {\n    return items.map(item => (Object.assign(Object.assign({}, item), { expanded, children: item.children ? this.expandOrCloseAllItems(item.children, expanded) : undefined })));\n  }\n  handleExpandAll() {\n    this.items = [...this.expandOrCloseAllItems(this.items, true)];\n  }\n  handleCloseAll() {\n    this.items = [...this.expandOrCloseAllItems(this.items, false)];\n  }\n  handleDbClick(item) {\n    var _a;\n    if (!this.allowsNonAnalytic && !((_a = item['props']) === null || _a === void 0 ? void 0 : _a['analitico'])) {\n      const title = 'Erro';\n      const message = `Há pelo menos um registro inválido selecionado. Você deve selecionar itens do tipo 'analítico'.`;\n      ApplicationUtils.error(title, message);\n      return;\n    }\n    const option = {\n      value: item.id,\n      label: item.label,\n    };\n    this.pesquisaTreeSelectItem.emit(option);\n  }\n  renderEmptyMessage() {\n    return (h(\"div\", { class: \"ez-flex ez-flex--justify-center ez-flex--align-items-center ez-margin--large ez-text ez-text--xlarge ez-text--secondary\" }, h(\"span\", null, \"Nenhum registro encontrado...\")));\n  }\n  render() {\n    var _a;\n    return (h(Host, null, !((_a = this.items) === null || _a === void 0 ? void 0 : _a.length) ?\n      this.renderEmptyMessage() :\n      h(Fragment, null, h(\"div\", { class: 'actions-container' }, h(\"ez-button\", { size: 'small', mode: 'icon', class: 'ez-margin-right--small', iconName: 'show-list', title: \"Expandir\", onClick: () => this.handleExpandAll() }), h(\"ez-button\", { size: 'small', mode: 'icon', iconName: 'hide-list', title: \"Recolher\", onClick: () => this.handleCloseAll() })), h(\"ez-tree\", { ref: (element) => this._tree = element, onEzDbClickItem: ({ detail }) => this.handleDbClick(detail), items: this.items }))));\n  }\n  static get watchers() { return {\n    \"shouldLoadTree\": [\"observeShouldLoadTree\"]\n  }; }\n};\nPesquisaTree.style = pesquisaTreeCss;\n\nexport { PesquisaGrid as pesquisa_grid, PesquisaTree as pesquisa_tree };\n"],"names":["pesquisaGridCss","PesquisaGrid","hostRef","registerInstance","createEvent","PesquisaFetcher","newValue","_a","InMemoryLoader","record","option","detail","columns","h","Host","event","pesquisaTreeCss","PesquisaTree","response","items","expanded","item","ApplicationUtils","Fragment","element"],"mappings":"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","x_google_ignoreList":[0]}
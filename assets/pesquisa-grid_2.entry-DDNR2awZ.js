import{r as a,c as n,h as t,H as r,F as o}from"./index-BCuik2gT.js";import{I as l}from"./dataunit-fetcher-1b78797a-B5AebLgP.js";import"./DataFetcher-db08cad0-YRT7v6X1.js";import{P as d}from"./ISave-da565824-BpwjVTmC.js";import"./dataUnitInMemoryLoader-CwDmnNwL.js";import"./index-b40568ff-7Mtm7E1e.js";import"./filter-item-type.enum-d45e026f-B41QHsvD.js";import"./form-config-fetcher-e623539b-ClsRvgut.js";import"./constants-7b422de0-BRz2gykn.js";import{A as h}from"./FormLayout-CTCTPPNq.js";import"./PrintUtils-3e4ff0f5-Dyc0ptsy.js";import"./ApplicationContext-B_qAnYBt.js";import"./constants-CKEKe-xZ.js";import"./ResourceIDUtils-a114189a-DSWFS9XU.js";const c=".sc-pesquisa-grid-h{background:var(--background--xlight, #FFF);overflow-x:auto}ez-grid.sc-pesquisa-grid{--ez-grid__container--shadow:none;--ez-grid__header--shadow:none}",u=class{constructor(e){a(this,e),this.pesquisaGridSelectItem=n(this,"pesquisaGridSelectItem",7),this._pesquisaFetcher=new d,this.metadata=void 0,this.dataSource=[],this.pkField=void 0,this.descriptionField=void 0,this.entityName=void 0,this.shouldLoadConfig=!1,this._gridConfig=void 0,this._inMemoryLoader=void 0,this._dataunit=void 0}observeDataSource(e){!this._inMemoryLoader||!this._dataunit||!e||(this._inMemoryLoader.records=[...e])}observeMetadata(){this.initializeDataUnit()}async observeShouldLoadConfig(e){!e||this._gridConfig||await this.loadGridConfig()}async loadGridConfig(){this._gridConfig=await this._pesquisaFetcher.loadPesquisaGridConfig(this.entityName)}initializeDataUnit(){var e;!this.metadata||this._dataunit||(this._inMemoryLoader=new l(this.metadata,(e=this.dataSource)!==null&&e!==void 0?e:[]),this._dataunit=this._inMemoryLoader.dataUnit,this._dataunit.pageSize=0)}handleDbClick(e){const i={value:e[this.pkField],label:e[this.descriptionField]};this.pesquisaGridSelectItem.emit(i)}async handleConfigChanged({detail:e}){var i;const s=(i=e==null?void 0:e.columns)!==null&&i!==void 0?i:[];await this._pesquisaFetcher.savePesquisaGridConfig(this.entityName,s)}render(){if(!(!this.metadata||!this._dataunit))return t(r,null,t("ez-grid",{dataUnit:this._dataunit,config:this._gridConfig,mode:"simple",autoFocus:!1,onEzDoubleClick:({detail:e})=>this.handleDbClick(e),onConfigChange:async e=>this.handleConfigChanged(e)}))}static get watchers(){return{dataSource:["observeDataSource"],metadata:["observeMetadata"],shouldLoadConfig:["observeShouldLoadConfig"]}}};u.style=c;const m=".sc-pesquisa-tree-h{--snk-pesquisa--tree__action-container--top:var(--space--sm);--snk-pesquisa--tree__action-container--right:var(--space--small);--snk-pesquisa--tree__min-height:var(--space--extra-large);background:var(--background--xlight, #FFF);position:relative;min-height:var(--snk-pesquisa--tree__min-height);height:100%;display:block;overflow-y:auto}.sc-pesquisa-tree-h:hover .actions-container.sc-pesquisa-tree{display:flex}.actions-container.sc-pesquisa-tree{flex-direction:row;position:absolute;top:var(--snk-pesquisa--tree__action-container--top);right:var(--snk-pesquisa--tree__action-container--right);display:none}",p=class{constructor(e){a(this,e),this.pesquisaTreeSelectItem=n(this,"pesquisaTreeSelectItem",7),this.treeLoader=void 0,this.argument=void 0,this.allowsNonAnalytic=!1,this.shouldLoadTree=!1,this.items=[]}async applyFilter(){await this._tree.applyFilter(this.argument)}async observeShouldLoadTree(e){!e||this.items.length>0||await this.loadTree()}async loadTree(){if(!this.shouldLoadTree||!this.treeLoader||typeof this.treeLoader!="function")return;const e=await this.treeLoader((this.argument||"").trim());this.items=[...e]}expandOrCloseAllItems(e,i){return e.map(s=>Object.assign(Object.assign({},s),{expanded:i,children:s.children?this.expandOrCloseAllItems(s.children,i):void 0}))}handleExpandAll(){this.items=[...this.expandOrCloseAllItems(this.items,!0)]}handleCloseAll(){this.items=[...this.expandOrCloseAllItems(this.items,!1)]}handleDbClick(e){var i;if(!this.allowsNonAnalytic&&!(!((i=e.props)===null||i===void 0)&&i.analitico)){h.error("Erro","Há pelo menos um registro inválido selecionado. Você deve selecionar itens do tipo 'analítico'.");return}const s={value:e.id,label:e.label};this.pesquisaTreeSelectItem.emit(s)}renderEmptyMessage(){return t("div",{class:"ez-flex ez-flex--justify-center ez-flex--align-items-center ez-margin--large ez-text ez-text--xlarge ez-text--secondary"},t("span",null,"Nenhum registro encontrado..."))}render(){var e;return t(r,null,!((e=this.items)===null||e===void 0)&&e.length?t(o,null,t("div",{class:"actions-container"},t("ez-button",{size:"small",mode:"icon",class:"ez-margin-right--small",iconName:"show-list",title:"Expandir",onClick:()=>this.handleExpandAll()}),t("ez-button",{size:"small",mode:"icon",iconName:"hide-list",title:"Recolher",onClick:()=>this.handleCloseAll()})),t("ez-tree",{ref:i=>this._tree=i,onEzDbClickItem:({detail:i})=>this.handleDbClick(i),items:this.items})):this.renderEmptyMessage())}static get watchers(){return{shouldLoadTree:["observeShouldLoadTree"]}}};p.style=m;export{u as pesquisa_grid,p as pesquisa_tree};
//# sourceMappingURL=pesquisa-grid_2.entry-DDNR2awZ.js.map

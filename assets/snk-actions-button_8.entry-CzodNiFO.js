import{r as p,h as r,H as E,g as A,c as m}from"./index-BV2D5AMk.js";import{j as O,k as z,g as R,E as C,S as w,e as S,O as B,f as L}from"./dataUnitInMemoryLoader-BjgoPaoq.js";import{A as _}from"./ApplicationContext-B_qAnYBt.js";import{D as k,W as F}from"./DataFetcher-db08cad0-B7lG84WQ.js";import{P as v}from"./ParamType-d5152b06-Clw0uipm.js";import"./ISave-da565824-Ad8ZGazV.js";import"./index-b40568ff-7Mtm7E1e.js";import"./dataunit-fetcher-1b78797a-Cmcgnk35.js";import"./filter-item-type.enum-d45e026f-B41QHsvD.js";import{F as P}from"./form-config-fetcher-e623539b-By6wLJV7.js";import{O as h}from"./constants-7b422de0-BRz2gykn.js";import{g as M}from"./GetSelectedRecordsIDsInfo-9fa41508-C_4piWLm.js";import{R as V}from"./ResourceIDUtils-a114189a-BM9f4Nxo.js";import{A as N,D as G,F as f}from"./FormLayout-pPi2ZB-q.js";import{C as U}from"./ConfigStorage-89154c4e-iTHVKliQ.js";import"./PrintUtils-3e4ff0f5-DDjQRNo9.js";import"./constants-CKEKe-xZ.js";const j="ActionButtonsSP.executeJava";class q{execute(t){var i;const s={actionID:t.actionID,refreshType:(i=t.actionConfig.javaCall)===null||i===void 0?void 0:i.refreshType};return new Promise(n=>{n({execSource:s,callback:this.callExecJava})})}async callExecJava(t){const i={requestBody:{javaCall:t}};await k.get().callServiceBroker(j,JSON.stringify(i))}}const K="ActionButtonsSP.executeScript";class ${execute(t){var i;const s={actionID:t.actionID,refreshType:(i=t.actionConfig.runScript)===null||i===void 0?void 0:i.refreshType};return new Promise(n=>{n({execSource:s,callback:this.callExecScript})})}async callExecScript(t){const i={runScript:t};await k.get().callServiceBroker(K,i)}}class J{constructor(){this._application=_.getContextValue("__SNK__APPLICATION__")}async execute(t,i){const s=t.resourceID;if(!s)return;let n=await this.buildLaunchObject(t,i);return this._application.openApp(s,n),null}buildLaunchObject(t,i){return new Promise(s=>{let n=t.actionConfig.params.param;if(n&&n.length>0){let a={},o=[];n.forEach(l=>{const c=l.localField;let d=i.getFieldValue(c);if(!d){let u=i.getField(c).label;throw u=w.isEmpty(i.getField(c).label)?c:u,new S(this._application.messagesBuilder.getMessage("snkActionsButton.title.error",void 0),this._application.messagesBuilder.getMessage("snkActionsButton.launchScreen.emptyField",{description:t.description,localFieldLabel:u}))}d=w.isEmpty(d.toString())?void 0:d.toString(),a[l.targetField]=d,o.push({fieldName:l.targetField,value:d})}),a.ACTION_PARAMETERS=o,a.call_time=Date.now(),s(a)}s(null)})}}const H="ActionButtonsSP.executeSTP";class Y{execute(t){var i,s,n;const a=(i=t.actionConfig.dbCall)===null||i===void 0?void 0:i.name,o=(s=t.actionConfig.dbCall)===null||s===void 0?void 0:s.rootEntity,l={actionID:t.actionID,refreshType:(n=t.actionConfig.dbCall)===null||n===void 0?void 0:n.refreshType,procName:a,rootEntity:o};return new Promise(c=>{c({execSource:l,callback:this.callExecProcedure})})}async callExecProcedure(t){const i={requestBody:{stpCall:t}};await k.get().callServiceBroker(H,JSON.stringify(i))}}var g;(function(e){e.LAUNCH_SCREEN="LC",e.JAVASCRIPT="SC",e.JAVA="RJ",e.PROCEDURE="SP",e.EMBEDDED="EB"})(g||(g={}));class W{constructor(t){this.actionType=t,this._application=_.getContextValue("__SNK__APPLICATION__")}get executor(){switch(this.actionType){case g.LAUNCH_SCREEN:return new J;case g.JAVASCRIPT:return new $;case g.JAVA:return new q;case g.PROCEDURE:return new Y;default:throw new S(this._application.messagesBuilder.getMessage("snkActionsButton.title.error",void 0),this._application.messagesBuilder.getMessage("snkActionsButton.action.nonExistentType",{actionType:this.actionType}))}}}var b;(function(e){e.NONE="NONE",e.PARENT="PARENT",e.MASTER="MASTER",e.ALL="ALL"})(b||(b={}));const T="__MASTER_ROW__",X="__ENTITY_NAME__",Q="SystemUtilsSP.getConf";class Z{constructor(t,i,s){var n;this._lastValuesCache={},this._actionsExecuteInterface=t,this._dataUnit=i,this._selectedRows=!((n=i==null?void 0:i.getSelectionInfo())===null||n===void 0)&&n.isAllRecords()?[]:i==null?void 0:i.getSelectionInfo().records,this._application=_.getContextValue("__SNK__APPLICATION__"),this._appResourceId=s}getPrimaryKeys(){return M(this._dataUnit).map(({name:i})=>i)}apply(t,i){this._application.closePopUp(),this._actionsExecuteInterface.execute(t,this._dataUnit).then(({execSource:s,callback:n})=>{this.resolvePromptParams(t,s,i).then(()=>{this.actionExecute(s,n)})})}async execute(t){var i;if(!t.actionConfig)throw new F(this._application.messagesBuilder.getMessage("snkActionsButton.title.warning",void 0),this._application.messagesBuilder.getMessage("snkActionsButton.action.incorrectAction",{description:t.description}));if(!((i=t.actionConfig.params)===null||i===void 0)&&i.promptParam){const s=t.actionConfig.params.promptParam;let n=!1;for(let o=0;o<s.length;o++){let l=s[o];if(!n&&l.saveLast==="true"){n=!0;break}}n&&(t.actionConfig.params.promptParam=await this.loadSavedValuesIntoParams(t));const a=document.createElement("snk-actions-form");window.document.body.appendChild(a),a.action=B.copy(t),a.applyParameters=o=>{this.apply(o,n)},a.openPopup()}else t.type!=g.LAUNCH_SCREEN?this._actionsExecuteInterface.execute(t,this._dataUnit).then(({execSource:s,callback:n})=>{this.actionExecute(s,n)}):this._actionsExecuteInterface.execute(t,this._dataUnit)}loadSavedValuesIntoParams(t){return this.loadLastValues(t).then(i=>{let s=t.actionConfig.params.promptParam;return i&&i.param.forEach(n=>{s=s.map(a=>a.name!==n.paramName?a:a.paramType==="B"?Object.assign(Object.assign({},a),{value:n.$==="S"}):Object.assign(Object.assign({},a),{value:n.$}))}),s})}async actionExecute(t,i){t.virtualPage=this.buildVirtualPage(),await this.prepareAndExecute(t,i),this.recordsReloader(t.refreshType)}resolvePromptParams(t,i,s){return new Promise(n=>{const a=t.actionConfig.params.promptParam;let o=[];a.forEach(l=>{o.push(this.buildPromptParam(l))}),this.putParamsOnExecSource(o,i),s&&this.saveLastValues(t,o),n()})}buildPromptParam(t){let i=t.paramType,s=!1,n,a,o=t.value;switch(i){case v.DATE:i="D";break;case v.DATETIME:i="H";break;case v.DECIMAL:i="F",n={"sk-precision":Number(t.precision)};break;case v.BOOLEAN:i="S",s=!0,o=t.value?"S":"N";break;case v.ENTITY:n={"sk-entity-name":t.entityName,"sk-allow-show-hierarchical-mode":t.hierarchyEntity,"sk-data-type":"S"},t.hierarchyEntity&&t.entityPK&&(a=t.entityPK),o=t.value?Number(t.value):null;break;case v.OPTIONS:i="O",n={"sk-options":t.options.split(";").map(function(c,d){let u,I;if(c.indexOf("=")>-1){let D=c.split("=");u=D[0],I=D[1]}else u=d+1,I=c;return{data:u,value:I}})};break}return{description:t.label,required:t.required=="true",fieldName:t.name,fieldNameOri:t.name,entityPK:a,paramType:t.paramType,type:i,isCheckbox:s,saveLast:t.saveLast,fieldProp:n,value:o,isGeneratedName:t.isGeneratedName}}putParamsOnExecSource(t,i){i.params={param:[]},t.forEach(s=>{if(s.isGeneratedName&&s.value)throw new S(this._application.messagesBuilder.getMessage("snkActionsButton.title.error",void 0),this._application.messagesBuilder.getMessage("snkActionsButton.action.emptyParamName",void 0));w.isEmpty(s.value)||i.params.param.push({type:this.getParamDataType(s.paramType),paramName:s.fieldName,$:this.getParamValue(s)})})}getParamDataType(t){let i;switch(t){case"D":i="F";break;case"DT":case"DH":i="D";break;case"B":case"ENTITY":case"SO":i="S";break;default:i=t}return i}getParamValue(t){let i=t.value;return i&&(t.paramType=="DT"?i=L.formatDate(i):t.paramType=="DH"&&(i=L.formatDateTime(i)),i)}async loadLastValues(t){const i=await this.buildResourceId(t.actionID);return new Promise((s,n)=>{if(this._lastValuesCache[i])s(this._lastValuesCache[i]);else{const a={config:{chave:i,tipo:"T"}};k.get().callServiceBroker(Q,a).then(o=>{var l,c;let d;!((c=(l=o.config)===null||l===void 0?void 0:l.data)===null||c===void 0)&&c.params&&(d=o.config.data.params,Array.isArray(d.param)||(d.param=[d.param])),this._lastValuesCache[i]=d,s(d)}).catch(o=>{n(o)})}})}async saveLastValues(t,i){if(this._application){let s={params:{param:[]}};i.forEach(a=>{a.saveLast=="true"&&s.params.param.push({paramName:a.fieldName,$:a.value})});const n=await this.buildResourceId(t.actionID);this._lastValuesCache[n]=s.params,this._application.saveConfig(n,s)}}async buildResourceId(t){return this._appResourceId+".actionconfig."+t}async prepareAndExecute(t,i){this.addRows(t),await i(t)}addRows(t){const i=this.getPrimaryKeys(),s={row:[]},n=this._selectedRows;for(const a in n){const o=n[a],l={};o.hasOwnProperty(T)&&(l.master="S",l.entityName=o.__ENTITY_NAME__,delete o[T],delete o[X]),l.field||(l.field=[]);for(const c of i)l.field.push({fieldName:c,$:o[c]});s.row.push(l)}s.row.length>0&&(t.rows=s)}recordsReloader(t){switch(t){case b.NONE:break;case b.PARENT:case b.MASTER:case b.ALL:this._dataUnit.loadData();break;default:this._dataUnit.reloadCurrentRecord()}}buildVirtualPage(){var t,i,s,n;if(!((i=(t=this._dataUnit)===null||t===void 0?void 0:t.getSelectionInfo())===null||i===void 0)&&i.isAllRecords())return{filters:{filters:(s=this._dataUnit)===null||s===void 0?void 0:s.getAppliedFilters()},orders:{orders:(n=this._dataUnit)===null||n===void 0?void 0:n.getSort()}}}}const ee="__CONFIRMACAO__",te="__ESCOLHA_SIMNAO__";class ie{async clientConfirm(t,i){return new Promise(s=>{const n=_.getContextValue("__SNK__APPLICATION__");let a="";t.content.event.hasOwnProperty("stpCall")?(i.requestBody=t.content.event.stpCall,a=g.PROCEDURE):t.content.event.hasOwnProperty("runScript")?(i.requestBody=t.content.event.runScript,a=g.JAVASCRIPT):t.content.event.hasOwnProperty("javaCall")&&(i.requestBody=t.content.event.javaCall,a=g.JAVA);let o={type:"S",sequence:t.content.event.sequence};i.requestBody.params?Array.isArray(i.requestBody.params.param)||(i.requestBody.params.param=[i.requestBody.params.param]):i.requestBody.params={param:[]},i.requestBody.params.param.push(o);const l=t.content.event.title.$,c=t.content.event.message.$;let d;switch(a){case g.JAVASCRIPT:d={runScript:i.requestBody};break;case g.PROCEDURE:d={requestBody:{stpCall:i.requestBody}};break;case g.JAVA:d={requestBody:{javaCall:i.requestBody}};break}if(t.content.event.showNoOption=="S"){o.paramName=te;const u=document.createElement("snk-client-confirm");window.document.body.appendChild(u),u.titleMessage=l,u.message=c,u.accept=async()=>{o.$="S",await i.reCall(d),s()},u.cancel=async()=>{o.$="N",await i.reCall(d),s()},u.openPopup()}else n.confirm(l,c,null,"warn",{labelCancel:"Cancelar",labelConfirm:"Sim"}).then(async u=>{u&&(o.paramName=ee,o.$="S",await i.reCall(d),s())})})}}const se=".sc-snk-actions-button-h{display:flex;width:fit-content;height:fit-content}.snk-actions-button.sc-snk-actions-button{display:flex;width:fit-content;height:fit-content}.snk-actions-button__dropdown--show.sc-snk-actions-button{display:flex;flex-direction:column;position:fixed}.snk-actions-button__dropdown.sc-snk-actions-button>ez-dropdown.sc-snk-actions-button{position:relative}.snk-actions-button__dropdown.sc-snk-actions-button{display:none}",y=class{constructor(e){p(this,e),this.CLIENT_EVENT_CONFIRM_NAME="br.com.sankhya.actionbutton.clientconfirm",this._actions=[],this.handleClick=t=>{const i=this._actions.find(a=>a.actionID==t.detail.id),s=new W(i.type).executor;new Z(s,this._dataUnit,this._resourceID).execute(Object.assign({},i)),this._showDropdown=!1},this._items=[],this._showDropdown=!1}async getActions(){const e=await O.useCacheWithService(`SnkActionsButton_${this._entityName}-${this._resourceID}`,async()=>{var t;const i={param:{entityName:this._entityName,resourceID:this._resourceID}};return((t=(await k.get().callServiceBroker("ActionButtonsSP.getActions",i)).actions)===null||t===void 0?void 0:t.action)||[]},z.IN_MEMORY_CACHE);this._actions=y.parameters.isOrderActions?R.sortAlphabetically(e,"description"):e}controlDropdown(){this._showDropdown=!this._showDropdown}canShowDropdown(){var e;return this._showDropdown&&((e=this._items)===null||e===void 0?void 0:e.length)>0}positionDropdown(){var e;const t=(e=this._ezButton)===null||e===void 0?void 0:e.getBoundingClientRect();!t||!this._dropdownParent||(this._dropdownParent.style.top=t.y+t.height+5+"px",this._dropdownParent.style.left=t.x+"px")}closeDropdown(e){const t=e==null?void 0:e.target;t&&(t.closest(".snk-actions-button")||(this._showDropdown=!1))}setEvents(){document.removeEventListener("click",this.closeDropdown.bind(this)),document.addEventListener("click",this.closeDropdown.bind(this)),document.removeEventListener("scroll",this.positionDropdown.bind(this)),document.addEventListener("scroll",this.positionDropdown.bind(this))}async componentWillLoad(){this._application=_.getContextValue("__SNK__APPLICATION__"),await this.loadParameters();const e=this._element.parentElement;this._dataUnit=e==null?void 0:e.dataUnit,this._resourceID=e==null?void 0:e.resourceID,this._entityName=this._dataUnit.name.split("/")[2],this._resourceID==null&&(this._resourceID=await V.getResourceID()),this.setEvents(),await this.getActions(),this.loadItems()}async componentDidLoad(){if(this._element&&(C.addIDInfo(this._element),this.positionDropdown(),!await this._application.hasClientEvent(this.CLIENT_EVENT_CONFIRM_NAME))){const e=new ie;this._application.addClientEvent(this.CLIENT_EVENT_CONFIRM_NAME,e.clientConfirm)}}componentDidUpdate(){this.positionDropdown()}loadItems(){!this._actions||this._actions.length==0||this._actions.forEach(e=>{this._items.push({id:e.actionID,label:e.description})})}getElementID(e){return{[C.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:C.getInternalIDInfo(e)}}async loadParameters(){y.parameters.isOrderActions==null&&(y.parameters.isOrderActions=await this._application.getBooleanParam("global.ordenar.acoes.personalizadas"))}render(){return r(E,null,this._actions&&this._actions.length>0&&r("div",{class:`ez-padding-left--medium snk-actions-button
                            ${this.canShowDropdown()?" ez-elevation--16":""}
                        `},r("ez-button",Object.assign({ref:e=>this._ezButton=e,iconName:"acao",size:"small",mode:"icon",title:this._application.messagesBuilder.getMessage("snkActionsButton.title.actions",void 0),onClick:()=>this.controlDropdown()},this.getElementID("button"))),r("div",Object.assign({ref:e=>this._dropdownParent=e,class:`${this.canShowDropdown()?"snk-actions-button__dropdown--show":"snk-actions-button__dropdown"}
                            `},this.getElementID("dropdown")),this.canShowDropdown()&&r("ez-dropdown",Object.assign({items:this._items,onEzClick:e=>this.handleClick(e)},this.getElementID("dropdown"))))),this.canShowDropdown()&&r("div",Object.assign({class:"ez-scrim ez-scrim--light"},this.getElementID("ezScrim"))))}get _element(){return A(this)}};y.parameters={isOrderActions:null};y.style=se;const ne='.sc-snk-grid-config-h{--snk-grid-config__footer--padding-top:var(--space--medium, 12px);--snk-grid-config__main--padding-right:var(--space--medium, 12px);--snk-grid-config__tabselector-container--padding:var(--space--medium, 12px);--snk-grid-config__button-close--padding-left:var(--space--medium, 12px);--snk-grid-config__title--color:var(--title--primary, #2B3A54);--snk-grid-config__title--font-family:var(--font-pattern, "Roboto");--snk-grid-config__title--font-size:var(--title--large, 20px);--snk-grid-config__title--font-weight:var(--text-weight--extra-large, 700);--snk-grid-config__subtitle--font-family:var(--font-pattern, "Roboto");--snk-grid-config__subtitle--font-size:var(--text--medium, 14px);--snk-grid-config__group--font-family:var(--font-pattern, "Roboto");--snk-grid-config__group--font-size:var(--text--medium, 14px);--snk-grid-config__group--font-weight:var(--text-weight--large, 600);--snk-grid-config__group--padding-bottom:var(--space-small, 6px);--snk-grid-config__scrollbar--color-default:var(--scrollbar--default, #626e82);--snk-grid-config__scrollbar--color-background:var(--scrollbar--background, #E5EAF0);--snk-grid-config__scrollbar--color-hover:var(--scrollbar--hover, #2B3A54);--snk-grid-config__scrollbar--color-clicked:var(--scrollbar--clicked, #a2abb9);--snk-grid-config__scrollbar--border-radius:var(--border--radius-small, 6px);--snk-grid-config__scrollbar--width:var(--space--small, 6px);display:flex;flex-direction:column;max-height:100%;width:100%}.grid-config__body.sc-snk-grid-config{overflow:auto}.padding-right--medium.sc-snk-grid-config{padding-right:var(--space--medium)}ez-list.sc-snk-grid-config{height:100%}.height-calc.sc-snk-grid-config{max-height:calc(100% - 24px)}.grid-config__footer.sc-snk-grid-config{display:flex;justify-content:flex-end;width:100%;padding-top:var(--snk-grid-config__footer--padding-top)}.hidden.sc-snk-grid-config{display:none}.tabselector-container.sc-snk-grid-config{padding:var(--snk-grid-config__tabselector-container--padding) 0}.button-close.sc-snk-grid-config{padding-left:var(--snk-grid-config__button-close--padding-left)}.title-container.sc-snk-grid-config{display:flex;justify-content:space-between;align-items:center;width:100%}.title.sc-snk-grid-config{display:flex;margin:0;line-height:normal;letter-spacing:0em;text-align:left;color:var(--snk-grid-config__title--color);font-size:var(--snk-grid-config__title--font-size);font-family:var(--snk-grid-config__title--font-family);font-weight:var(--snk-grid-config__title--font-weight)}.subtitle.sc-snk-grid-config{color:var(--text--primary);font-size:var(--snk-grid-config__subtitle--font-size);font-family:var(--snk-grid-config__subtitle--font-family)}.grid-config__main.sc-snk-grid-config{overflow-y:auto;scrollbar-width:thin;width:100%;padding-bottom:20px;scrollbar-color:var(--snk-grid-config__scrollbar--color-clicked) var(--snk-grid-config__scrollbar--color-background)}.group-name.sc-snk-grid-config{font-family:var(--snk-grid-config__group--font-family);font-size:var(--snk-grid-config__group--font-size);font-weight:var(--snk-grid-config__group--font-weight);padding-bottom:var(--snk-grid-config__group--padding-bottom)}',x=class{constructor(e){p(this,e),this.configChange=m(this,"configChange",7),this.configCancel=m(this,"configCancel",7),this._orderListItems=[],this._orderPriorityList=[],this._visibleList=[],this._hiddenList=[],this._columListItems=[],this._dataChanged=!1,this._componenteInternalKey=Date.now(),this.selectedIndex=0,this.columns=void 0,this.config=void 0,this.configName=void 0,this.resourceID=void 0,this._collapsibleBoxListOrder=!0,this._collapsibleBoxListSelect=!1}getMessage(e,t){return _.getContextValue("__SNK__APPLICATION__").messagesBuilder.getMessage(e,t)}getSortableColumns(){let e=[];return this.columns.filter(t=>{var i;return w.getBooleanValue((i=t==null?void 0:t.props)===null||i===void 0?void 0:i.get("sortable"),!0)}).forEach(t=>{var i,s;let n=(i=this.config)===null||i===void 0?void 0:i.columns.find(o=>o.name===t.name),a={label:t.label,sort:(s=t==null?void 0:t.sort)!==null&&s!==void 0?s:h.asc.value,id:t.name};n&&(a.orderIndex=n.orderIndex,a.ascending=n.ascending),t.hidden||e.push(a)}),e}createOrderList(){let e=this.getSortableColumns();e.sort((t,i)=>t.orderIndex==0&&i.orderIndex==0&&(t.ascending!=null||i.ascending!=null)?t.ascending!=null?-1:i.ascending!=null?1:0:t.ascending!=null&&i.ascending!=null?t.orderIndex-i.orderIndex:t.ascending!=null||i.ascending!=null?t.ascending!=null?-1:i.ascending!=null?1:0:t.orderIndex-i.orderIndex),this._orderListItems=e}createColumnList(){let e={group:this.getMessage("snkGridConfig.group.visible"),items:[]},t={group:this.getMessage("snkGridConfig.group.hidden"),items:[],sort:h.asc.value};this.columns.forEach(i=>{var s;let n={label:i.label,selected:!1,sort:(s=i==null?void 0:i.sort)!==null&&s!==void 0?s:h.asc.value,id:i.name};i.hidden?t.items.push(n):e.items.push(n)}),this._columListItems=[e,t],this._visibleList=e.items,this._hiddenList=t.items,this.createOrderList()}createOrderListSlotDataElementId(e){return`${this._element.getAttribute(C.DATA_ELEMENT_ID_ATTRIBUTE_NAME)}_configItem_${w.toCamelCase(e.label)}`}buildOrderListSlot(e){const t=this.createOrderListSlotDataElementId(e);let i=h.none.value;return(e==null?void 0:e.ascending)!=null&&(i=e.ascending==!0?h.asc.value:h.desc.value),r("snk-select-box",{selectedOption:i,key:"snk-select-box-"+this._componenteInternalKey+"-"+e,"data-element-id":t,onEzChange:s=>{s.stopPropagation(),this.updateOrder(s.detail,e.label)},preventAutoFocus:!0})}updateOrder(e,t){var i;this._dataChanged=!0;let s=[...this.columns],n=s.find(o=>o.label===t);n&&(n.sort=e.value===h.none.value?void 0:e.value);let a;((i=this._orderPriorityList)===null||i===void 0?void 0:i.length)>0?(this._orderPriorityList.find(o=>o.label===n.label).sort=e,this._orderPriorityList.filter(o=>o.sort).forEach((o,l)=>{o.label===n.label&&(n.sortIndex=l)})):(a=s.filter(o=>o.sort&&o.hidden!==!0).map((o,l)=>({label:o.label,orderIndex:l})),a.forEach(o=>{s.find(l=>l.label===o.label).sortIndex=o.orderIndex})),this.columns=s}finish(){if(!this._dataChanged){this.closeConfig();return}let e=[];this._columListItems.forEach(t=>{t.items.forEach(i=>{const s=this.columns.find(a=>a.label===i.label);let n=Object.assign({},s);t.group===this.getMessage("snkGridConfig.group.hidden")?n.hidden=!0:n.hidden=!1,e.push(n)})}),this.columns=e,this._dataChanged=!1,this.closeConfig(),this.save()}saveGridConfigOnStorage(e){U.saveGridConfig(e,this.configName,this.resourceID).then(t=>{this.configChange.emit(t),N.info(this.getMessage("snkGridConfig.info.successfullyConfigSaved"),{iconName:"check"})})}reOrderPriorityColumns(e,t){let i=[];i=e.filter(a=>a.sort&&a.hidden!==!0).map(a=>({label:a.label,orderIndex:0}));let s=0,n=[];return t.forEach(a=>{let o=i.find(l=>l.label===a.label);o&&(o.orderIndex=s,n.push(o),s++)}),n.length>0&&(i=n),i}save(){var e;let t;this.config?t=this.config:t=this.createConfigFromState(this.columns);let i=[],s;((e=this._orderPriorityList)===null||e===void 0?void 0:e.length)>0&&(s=this.reOrderPriorityColumns(this.columns,this._orderPriorityList)),this.columns.forEach(a=>{let o=t.columns.find(l=>a.name===l.name);a.hidden===!0&&o||(o?o.width=a.width:a.hidden===!1&&(o={name:a.name,width:a.width,orderIndex:0}),o&&(a.sort?(o.ascending=a.sort.toUpperCase()===h.asc.value,s?n(a,o):o.orderIndex=a.sortIndex):(delete o.ascending,o.orderIndex=0),o.configVersion=x.CURRENT_CONFIG_VERSION,i.push(o)))}),t.columns=i,this.saveGridConfigOnStorage(t);function n(a,o){if(s){let l=s.find(c=>c.label===a.label);l&&(o.orderIndex=l.orderIndex)}}}createConfigFromState(e){let t={columns:[]};return e.forEach(i=>{if(!i.hidden){let s={name:i.name};i.width&&(s.width=i.width),i.sort?(s.ascending=i.sort.toUpperCase()===h.asc.value,s.orderIndex=i.sortIndex):s.orderIndex=0,s&&t.columns.push(s)}}),t}closeConfig(){if(this._dataChanged){let e={canClose:!1,labelCancel:this.getMessage("snkGridConfig.confirm.cancel"),labelConfirm:this.getMessage("snkGridConfig.confirm.save"),btnConfirmDanger:!1};N.confirm(this.getMessage("snkGridConfig.confirm.alert"),this.getMessage("snkGridConfig.confirm.msgCancel"),null,G.WARN,e).then(t=>{t?this.finish():(this._dataChanged=!1,this.configCancel.emit(),this._componenteInternalKey=Date.now())})}else this.configCancel.emit()}handleColumnListChange(e){var t;if(e.detail){let i=(t=e.detail.find(s=>s.group===this.getMessage("snkGridConfig.group.visible")))===null||t===void 0?void 0:t.items;i&&(this._dataChanged=!0,this._orderListItems=i)}}handleOrderListChange(e){if(e.detail){let t=e.detail;t&&(this._dataChanged=!0,this._orderPriorityList=t)}}componentWillRender(){var e;((e=this.columns)===null||e===void 0?void 0:e.length)>0&&this.createColumnList()}componentDidLoad(){C.addIDInfo(this._element)}handleRightListChange(e){const t=this._columListItems.find(i=>i.group===this.getMessage("snkGridConfig.group.visible"));t&&t.items!=e&&(t.items=e,this._dataChanged=!0)}getListSlots(){return{RIGHT_LIST:{itemRightSlotBuilder:e=>this.buildOrderListSlot(e)}}}render(){return r(E,null,r("div",{class:"grid-config__header"},r("div",{class:"title-container"},r("div",{class:"ez-margin-bottom--medium"},r("label",{class:"title"},this.getMessage("snkGridConfig.gridConfiguration")),r("label",{class:"subtitle"},this.getMessage("snkGridConfig.columnVisibilityOrder"))),r("div",{class:"button-close"},r("ez-button",{mode:"icon",iconName:"close",size:"medium",class:"ez-button--tertiary",onClick:()=>this.closeConfig()})))),r("div",{class:"grid-config__body"},r("ez-collapsible-box",{id:"group-select-columns",label:this.getMessage("snkGridConfig.columnsSelection"),"header-size":"medium",key:"key_group-select-columns",value:this._collapsibleBoxListSelect,onEzChange:({detail:e})=>this._collapsibleBoxListOrder=!e},r("div",{class:"grid-config__main"},r("ez-double-list",{leftList:this._hiddenList,leftTitle:this.getMessage("snkGridConfig.availableColumns"),rightList:this._visibleList,rightTitle:this.getMessage("snkGridConfig.selectedColumns"),onEzRightListChanged:({detail:e})=>this.handleRightListChange(e),emptyMessage:{LEFT_LIST:this.getMessage("snkGridConfig.emptyMensage.left"),RIGHT_LIST:this.getMessage("snkGridConfig.emptyMensage.right")},entityLabel:"coluna",entityLabelPlural:"colunas"}))),r("ez-collapsible-box",{id:"ID_group-order-columns",label:this.getMessage("snkGridConfig.dataOrdering"),"header-size":"medium",key:"KEY_group-order-columns",value:this._collapsibleBoxListOrder,onEzChange:({detail:e})=>this._collapsibleBoxListSelect=!e},r("div",{class:"grid-config__main"},r("ez-double-list",{rightList:this._orderListItems,rightTitle:this.getMessage("snkGridConfig.selectedColumns"),useOnlyRightList:!0,slotsListBuilder:this.getListSlots(),emptyMessage:{RIGHT_LIST:this.getMessage("snkGridConfig.emptyMensage.right")},entityLabel:"coluna",entityLabelPlural:"colunas"})))),r("div",{class:"grid-config__footer"},r("ez-button",{class:"padding-right--medium",label:this.getMessage("snkGridConfig.cancel"),onClick:()=>this.closeConfig()}),r("ez-button",{label:this.getMessage("snkGridConfig.complete"),class:"ez-button--primary",onClick:()=>this.finish()})))}static get assetsDirs(){return["../assets"]}get _element(){return A(this)}};x.CURRENT_CONFIG_VERSION=1;x.style=ne;const oe=".sc-snk-layout-form-config-h{display:block}",ae="formColCfg.",re=class{constructor(e){p(this,e),this._formConfigFetcher=new P,this.layoutType=f.CASCADE}async save(){this._LayoutFormConfigSingleton.setConfig(this.layoutType),this._formConfigFetcher.saveLayoutFormConfig(ae+this._resourceID,{config:this.layoutType,newConfig:!0})}async componentWillLoad(){const e=_.getContextValue("__SNK__APPLICATION__");this._LayoutFormConfigSingleton=await(e==null?void 0:e.getLayoutFormConfig()),this._resourceID=await(e==null?void 0:e.getResourceID()),this.setLayoutInit()}setLayoutInit(){if(!this._LayoutFormConfigSingleton)return;const{config:e}=this._LayoutFormConfigSingleton;this.layoutType=Number(e)in f?Number(e):f.CASCADE}toggleLayout(e){this.layoutType=e}render(){return r("div",{class:"ez-flex ez-flex--column"},r("div",{class:"ez-margin-bottom--small"},r("ez-check",{label:"Layout em cascata",class:"ez-margin-bottom--small",onEzChange:()=>this.toggleLayout(f.CASCADE),value:this.layoutType===f.CASCADE}),r("snk-view-representation",{mode:f.CASCADE}),r("label",{class:"ez-label ez-margin--small ez-flex ez-text--medium"},"Todos os campos serão organizados em uma coluna única.")),r("div",null,r("ez-check",{label:"Layout lado a lado",class:"ez-margin-bottom--small",onEzChange:()=>this.toggleLayout(f.SIDE_BY_SIDE),value:this.layoutType===f.SIDE_BY_SIDE}),r("snk-view-representation",{mode:f.SIDE_BY_SIDE}),r("label",{class:"ez-label ez-margin--small ez-flex ez-text--medium"},"Todos os campos serão dispostos lado a lado, ajustando-se automaticamente à largura da tela.")))}};re.style=oe;const le="ez-combo-box{width:100px;--ez-text-input__margin-bottom:0px}.grid-config-combo{--ez-text-input--height:28px;--ez-text-input__input--background-color:#fff;--ez-text-input__input--border-color:#dce0e8}",ce=class{constructor(e){p(this,e),this.ezChange=m(this,"ezChange",7),this.selectedOption=h.none,this.preventAutoFocus=!1}render(){return r("ez-combo-box",{class:"grid-config-combo ez-input--inverted",label:"",suppressSearch:!0,value:this.selectedOption,enabled:!0,canShowError:!1,suppressEmptyOption:!0,preventAutoFocus:this.preventAutoFocus},Object.keys(h).map(e=>r("option",{value:h[e].value},h[e].label)))}static get assetsDirs(){return["../assets"]}};ce.style=le;const de=":host{display:block}.config-container{display:flex;flex-direction:column;align-items:center;justify-content:space-between}.config-lists{width:100%;margin-bottom:12px}.config-actions{display:flex;flex-direction:row;justify-content:flex-end;width:100%;gap:12px}",ue=class{constructor(e){p(this,e),this.snkConfigSaved=m(this,"snkConfigSaved",7),this._formConfigFetcher=new P,this.fieldsToSave=[],this.dataUnit=void 0,this.configName=void 0,this.avaliableFields=[],this.selectedFields=[]}async show(){var e;await((e=this.ezDoubleListRef)===null||e===void 0?void 0:e.resetSelectedLists()),await this.initializeFormConfig(),this.ezPopupRef.opened=!0}async initializeFormConfig(){if(!this.configName)return;const e=this.getAllVisibleFieldsFromDataUnit(),t=await this.getConfig();if(t.length===0){this.avaliableFields=[],this.selectedFields=[...e],this.fieldsToSave=[...this.selectedFields];return}const i=this.sortDisplayedFields(t,e),s=e.filter(n=>!t.includes(n.id));this.avaliableFields=[...s],this.selectedFields=[...i],this.fieldsToSave=[...this.selectedFields]}async getConfig(){const e=await this._formConfigFetcher.fetchSimpleFormConfig(this.configName);return[...this.removeDuplicates(e)]}removeDuplicates(e){return e.filter((t,i)=>e.indexOf(t)===i)}sortDisplayedFields(e,t){const i=[];return e.forEach(s=>{const n=t.find(a=>a.id===s);n&&i.push(n)}),i}getAllVisibleFieldsFromDataUnit(){var e,t,i;return((i=(t=(e=this.dataUnit)===null||e===void 0?void 0:e.metadata)===null||t===void 0?void 0:t.fields)!==null&&i!==void 0?i:[]).filter(n=>n.visible).map(n=>({id:n.name,label:n.label}))}close(){this.ezPopupRef.opened=!1}async handleResetConfigs(){await this._formConfigFetcher.restoreFormConfig(this.configName),await this.initializeFormConfig(),await this.handleSave()}handleCancel(){this.close()}async handleSave(){const e=this.fieldsToSave.map(t=>t.id);await this._formConfigFetcher.saveSimpleFormConfig(this.configName,e),this.close(),this.snkConfigSaved.emit()}render(){return r("ez-popup",{ref:e=>this.ezPopupRef=e,heightMode:"auto",size:"medium",ezTitle:"Configurar formulário"},r("div",{class:"config-container"},r("div",{class:"config-lists"},r("ez-double-list",{ref:e=>this.ezDoubleListRef=e,leftList:this.avaliableFields,leftTitle:"Campos disponíveis",rightList:this.selectedFields,rightTitle:"Campos selecionados",onEzRightListChanged:({detail:e})=>this.fieldsToSave=[...e],entityLabel:"campo",entityLabelPlural:"campos"})),r("div",{class:"config-actions"},r("ez-button",{label:"Restaurar",onClick:this.handleResetConfigs.bind(this),size:"small"}),r("ez-button",{label:"Cancelar",onClick:this.handleCancel.bind(this),size:"small"}),r("ez-button",{label:"Salvar",class:"ez-button--primary",onClick:this.handleSave.bind(this),size:"small"}))))}};ue.style=de;const he=".sc-snk-view-representation-h{display:block}.svg-container.sc-snk-view-representation{display:flex;width:185px;height:125px;border-radius:8px;background-color:#f7f7f7;padding:10px 12px;box-sizing:border-box;position:relative}.svg-container__background.sc-snk-view-representation{display:flex;flex-direction:column;width:100%}.svg-container__header.sc-snk-view-representation{display:flex;gap:2px;margin-bottom:12px}.svg-container__circle.sc-snk-view-representation{width:9px;height:9px;border-radius:50%}.svg-container__circle--red.sc-snk-view-representation{background-color:#ed7678}.svg-container__circle--yellow.sc-snk-view-representation{background-color:#eddb76}.svg-container__circle--green.sc-snk-view-representation{background-color:#7ad08e}.svg-container__section.sc-snk-view-representation{width:100%}.svg-container__collumn.sc-snk-view-representation{width:100%;display:flex;flex-direction:column}.svg-container__inline.sc-snk-view-representation{display:flex;flex-direction:row;gap:6px}.svg-container__line.sc-snk-view-representation{height:13px;border-radius:4px;background-color:#d9d9d9;margin-bottom:4px}.svg-container__line--short.sc-snk-view-representation{width:39.68px;height:7px;border-radius:3.5px}.svg-container__line--long.sc-snk-view-representation{width:100%}",ge=class{constructor(e){p(this,e),this.mode=f.SIDE_BY_SIDE}renderCascadeLayout(){return r("div",{class:"svg-container__collumn"},[...Array(3)].map(()=>r("div",{class:"svg-container__section"},r("div",{class:"svg-container__line svg-container__line--short"}),r("div",{class:"svg-container__line svg-container__line--long"}))))}renderSideBySideLayout(){return r("div",{class:"svg-container__inline"},[...Array(2)].map(()=>this.renderCascadeLayout()))}render(){return r("div",{class:"svg-container ez-margin-left--small"},r("div",{class:"svg-container__background"},r("div",{class:"svg-container__header"},r("div",{class:"svg-container__circle svg-container__circle--red"}),r("div",{class:"svg-container__circle svg-container__circle--yellow"}),r("div",{class:"svg-container__circle svg-container__circle--green"})),this.mode===f.CASCADE?this.renderCascadeLayout():this.renderSideBySideLayout()))}};ge.style=he;const fe=".sc-taskbar-actions-button-h{--ez-dropdown--min-width:150px;display:flex;width:fit-content;height:fit-content}.ez-dropdown-container.sc-taskbar-actions-button{position:relative;display:inline-block}.ez-dropdown--sticky.sc-taskbar-actions-button{position:absolute;display:block;min-width:var(--ez-dropdown--min-width)}",pe=class{constructor(e){p(this,e),this.taskbarActionSelected=m(this,"taskbarActionSelected",7),this.taskbarActionsOpened=m(this,"taskbarActionsOpened",7),this.taskbarActionsButtonDisconnected=m(this,"taskbarActionsButtonDisconnected",7),this._showDropdown=!1,this.title=void 0,this.enabled=void 0,this.actions=void 0}async handleKeyDown(e){(e.key==="Escape"||e.key==="Esc")&&await this.hideActions()}async handleClose(){await this.hideActions()}async showActions(){this._showDropdown=!0,requestAnimationFrame(()=>{this._element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})})}async hideActions(){this._showDropdown=!1}async isOpened(){return this._showDropdown}controlDropdown(){this._showDropdown=!this._showDropdown}loadItems(){return this.actions.filter(e=>e!==void 0).map(e=>{var t;return{id:e.value,label:e.label,value:e.value,type:(t=e.type)!==null&&t!==void 0?t:"item",children:e.children,iconName:e.iconName,subAction:e.subAction,group:e.group,disableCloseOnSelect:e.disableCloseOnSelect}})}canShowDropdown(){var e;return this._showDropdown&&((e=this.actions)===null||e===void 0?void 0:e.length)>0}onSelectAction(e){const t=this.actions.map(s=>Object.assign(Object.assign({},s),{id:s.value})),i=this.getSelectedAction(e.id,t);this.taskbarActionSelected.emit(i),i.disableCloseOnSelect||(this._showDropdown=!1)}getSelectedAction(e,t){let i=null;for(const s of t){if(s.id===e){i=s;break}if(s!=null&&s.children&&(i=this.getSelectedAction(e,s.children),i))break}return i}dropdownItemBuilder(e,t){const i=this.actions.find(n=>n.value===e.id);if(!i||!i.itemBuilder)return;const s=i.itemBuilder(this._element,i);return typeof s=="string"?r("div",{innerHTML:s}):s}initializeEagerItems(){var e;(e=this.actions)===null||e===void 0||e.forEach(t=>{var i;t&&t.eagerInitialize&&t.itemBuilder&&((i=t.itemBuilder)===null||i===void 0||i.call(t,this._element,t))})}componentDidLoad(){this.initializeEagerItems()}componentDidRender(){this._showDropdown&&this.taskbarActionsOpened.emit(this._element)}disconnectedCallback(){this.taskbarActionsButtonDisconnected.emit()}render(){return r(E,null,r("div",{class:`${this.canShowDropdown()?" ez-elevation--16":""} ez-dropdown-container`},r("ez-button",{title:this.title,mode:"icon",iconName:"dots-vertical",size:"small",enabled:this.enabled,onClick:()=>this.controlDropdown()}),this.canShowDropdown()&&r("ez-dropdown",{class:"ez-dropdown--sticky",items:this.loadItems(),onEzClick:e=>this.onSelectAction(e.detail),onEzOutsideClick:()=>this._showDropdown=!1,itemBuilder:(e,t)=>this.dropdownItemBuilder(e,t)})))}get _element(){return A(this)}};pe.style=fe;const me="",_e=class{constructor(e){p(this,e),this._showDropdown=!1,this.iconName=void 0,this.action=void 0,this.name=void 0,this.className=void 0,this.dataElementId=void 0,this.title=void 0,this.enabled=void 0,this.actions=void 0}initializeEagerItems(){var e;(e=this.actions)===null||e===void 0||e.forEach(t=>{var i;t&&t.eagerInitialize&&t.itemBuilder&&((i=t.itemBuilder)===null||i===void 0||i.call(t,this._splitButtonRef,t))})}componentDidLoad(){this.initializeEagerItems()}dropdownItemBuilder(e,t){const i=this.actions.find(n=>n.value===e.id);if(!i||!i.itemBuilder)return;const s=i.itemBuilder(this._splitButtonRef,i);return typeof s=="string"?r("div",{innerHTML:s}):s}loadItems(){return this.actions.filter(e=>e!==void 0).map(e=>{var t;return{id:e.value,label:e.label,value:e.value,type:(t=e.type)!==null&&t!==void 0?t:"item",children:e.children,iconName:e.iconName,subAction:e.subAction,group:e.group,disableCloseOnSelect:e.disableCloseOnSelect}})}render(){return r(E,null,r("ez-split-button",{ref:e=>this._splitButtonRef=e,key:this.dataElementId,class:`${this.className} "ez-split-button--tertiary ez-padding--medium"`,items:this.loadItems(),mode:"icon-only",iconName:this.iconName,enabled:this.enabled,show:this._showDropdown,onButtonClick:()=>this.action(this.name),itemBuilder:(e,t)=>this.dropdownItemBuilder(e,t)}))}};_e.style=me;export{y as snk_actions_button,x as snk_grid_config,re as snk_layout_form_config,ce as snk_select_box,ue as snk_simple_form_config,ge as snk_view_representation,pe as taskbar_actions_button,_e as taskbar_split_button};

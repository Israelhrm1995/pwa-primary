{"version":3,"file":"snk-actions-form.entry-1ohkyo6o.js","sources":["../../node_modules/@sankhyalabs/sankhyablocks/dist/esm/snk-actions-form.entry.js"],"sourcesContent":["import { r as registerInstance, h } from './index-479e1293.js';\nimport { DataUnit, UserInterface, DataType, ApplicationContext } from '@sankhyalabs/core';\nimport { P as ParamType } from './ParamType-d5152b06.js';\n\nconst SnkActionsForm = class {\n  constructor(hostRef) {\n    registerInstance(this, hostRef);\n    this.APPLY = 'OK';\n    this.CANCEL = 'CANCEL';\n    this.CLOSE = 'CLOSE';\n    this.action = undefined;\n    this.applyParameters = undefined;\n    this.dataUnit = new DataUnit();\n  }\n  /**\n   * Responsável por abrir a popup.\n   */\n  async openPopup() {\n    this._ezPopup.opened = true;\n  }\n  ;\n  exitPopup() {\n    this._ezPopup.opened = false;\n  }\n  async handleApply() {\n    try {\n      await this._ezForm.validate();\n      let row = this.dataUnit.getSelectedRecord();\n      if (row) {\n        this._params.forEach((param, index) => {\n          if (row.hasOwnProperty(param.name)) {\n            if (param.paramType == ParamType.ENTITY) {\n              let searchValue = row[param.name];\n              if (!searchValue) {\n                param.value = null;\n                return;\n              }\n              param.value = typeof searchValue === 'object' ? searchValue.value : searchValue;\n              return;\n            }\n            this._params[index].value = row[param.name];\n          }\n          else {\n            this._params[index].value = undefined;\n          }\n        });\n        this.action.actionConfig.params.promptParam = this._params;\n      }\n      this.exitPopup();\n      this.applyParameters(this.action);\n    }\n    catch (e) {\n      // exceção ignorada, quando o validate() falha.\n    }\n  }\n  searchLoader(evt, param) {\n    const options = {\n      entity: param.entityName,\n      entityDescription: param.label\n    };\n    return this._application.executePreparedSearch(evt.mode, evt.argument, options);\n  }\n  ;\n  getUserInterface(paramType) {\n    switch (paramType) {\n      case ParamType.TEXT:\n        return UserInterface.SHORTTEXT;\n      case ParamType.INTEGER:\n        return UserInterface.INTEGERNUMBER;\n      case ParamType.DECIMAL:\n        return UserInterface.DECIMALNUMBER;\n      case ParamType.DATE:\n        return UserInterface.DATE;\n      case ParamType.DATETIME:\n        return UserInterface.DATETIME;\n      case ParamType.BOOLEAN:\n        return UserInterface.CHECKBOX;\n      case ParamType.ENTITY:\n        return UserInterface.SEARCH;\n      case ParamType.OPTIONS:\n        return UserInterface.OPTIONSELECTOR;\n    }\n  }\n  getDataType(paramType) {\n    switch (paramType) {\n      case ParamType.TEXT:\n      case ParamType.OPTIONS:\n        return DataType.TEXT;\n      case ParamType.INTEGER:\n      case ParamType.DECIMAL:\n        return DataType.NUMBER;\n      case ParamType.DATE:\n      case ParamType.DATETIME:\n        return DataType.DATE;\n      case ParamType.BOOLEAN:\n        return DataType.BOOLEAN;\n      case ParamType.ENTITY:\n        return DataType.OBJECT;\n    }\n  }\n  getProps(param) {\n    switch (param.paramType) {\n      case ParamType.DECIMAL:\n        return param.precision ? { precision: Number(param.precision) } : undefined;\n      case ParamType.ENTITY:\n        return { ENTITYNAME: param.entityName };\n      case ParamType.OPTIONS:\n        return { options: this.prepareOptions(param.options) };\n      default:\n        return undefined;\n    }\n  }\n  buildFields() {\n    let fields = [];\n    this._params.forEach((param, index) => {\n      const hasName = !!param.name;\n      let paramName = hasName ? param.name : `param_${index}`;\n      fields.push({\n        name: paramName,\n        label: param.label,\n        dataType: this.getDataType(param.paramType),\n        userInterface: this.getUserInterface(param.paramType),\n        readOnly: false,\n        required: param.paramType == 'B' ? false : param.required === \"true\",\n        properties: this.getProps(param)\n      });\n      this._params[index].name = paramName;\n      this._params[index].isGeneratedName = !hasName;\n    });\n    const metadata = {\n      name: 'params',\n      label: 'params',\n      fields: fields\n    };\n    this._metadata = metadata;\n  }\n  fillFields() {\n    this._params.forEach((param) => {\n      if (param.saveLast == 'true') {\n        this.dataUnit.setFieldValue(param.name, param.value);\n      }\n    });\n  }\n  prepareOptions(options) {\n    const optionsArray = options.split(\";\");\n    let optionsList = optionsArray.map(function (opc, index) {\n      let value;\n      let label;\n      if (opc.indexOf('=') > -1) {\n        let opcArr = opc.split('=');\n        value = opcArr[0];\n        label = opcArr[1];\n      }\n      else {\n        value = (index + 1).toString();\n        label = opc;\n      }\n      return {\n        value: value,\n        label: label\n      };\n    });\n    return optionsList;\n  }\n  componentWillLoad() {\n    this._application = ApplicationContext.getContextValue(\"__SNK__APPLICATION__\");\n    this._params = [...this.action.actionConfig.params.promptParam];\n    this.dataUnit.metadataLoader = this.metadataLoader.bind(this);\n    this.dataUnit.loadMetadata().then(() => {\n      this.fillFields();\n    });\n    this.dataUnit.addRecord();\n  }\n  async metadataLoader() {\n    return new Promise((resolve) => {\n      this.buildFields();\n      resolve(this._metadata);\n    });\n  }\n  handleModalAction(evt) {\n    switch (evt) {\n      case this.APPLY:\n        this.handleApply();\n        break;\n      case this.CANCEL:\n      case this.CLOSE:\n        this.exitPopup();\n        break;\n    }\n  }\n  render() {\n    return (h(\"ez-popup\", { size: \"medium\", heightMode: \"auto\", useHeader: false, ref: (ref) => this._ezPopup = ref }, h(\"ez-modal-container\", { modalTitle: this._application.messagesBuilder.getMessage(\"snkActionsButton.form.fillParams\", undefined), okButtonLabel: this._application.messagesBuilder.getMessage(\"snkActionsButton.buttons.apply\", undefined), cancelButtonLabel: this._application.messagesBuilder.getMessage(\"snkActionsButton.buttons.cancel\", undefined), onEzModalAction: (evt) => this.handleModalAction(evt.detail) }, h(\"div\", { class: \"ez-margin-vertical--medium\" }, h(\"ez-form\", { ref: (ref) => this._ezForm = ref, dataUnit: this.dataUnit })))));\n  }\n};\n\nexport { SnkActionsForm as snk_actions_form };\n"],"names":["SnkActionsForm","hostRef","registerInstance","DataUnit","row","param","index","ParamType","searchValue","evt","options","paramType","UserInterface","DataType","fields","hasName","paramName","metadata","opc","value","label","opcArr","ApplicationContext","resolve","h","ref"],"mappings":"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","x_google_ignoreList":[0]}
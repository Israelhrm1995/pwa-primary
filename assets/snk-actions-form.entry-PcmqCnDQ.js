import{r as d,n as h,U as n,D as o,A as m,h as p}from"./index-C7RI_ets.js";import{P as t}from"./ParamType-d5152b06-Clw0uipm.js";const f=class{constructor(e){d(this,e),this.APPLY="OK",this.CANCEL="CANCEL",this.CLOSE="CLOSE",this.action=void 0,this.applyParameters=void 0,this.dataUnit=new h}async openPopup(){this._ezPopup.opened=!0}exitPopup(){this._ezPopup.opened=!1}async handleApply(){try{await this._ezForm.validate();let e=this.dataUnit.getSelectedRecord();e&&(this._params.forEach((s,a)=>{if(e.hasOwnProperty(s.name)){if(s.paramType==t.ENTITY){let i=e[s.name];if(!i){s.value=null;return}s.value=typeof i=="object"?i.value:i;return}this._params[a].value=e[s.name]}else this._params[a].value=void 0}),this.action.actionConfig.params.promptParam=this._params),this.exitPopup(),this.applyParameters(this.action)}catch{}}searchLoader(e,s){const a={entity:s.entityName,entityDescription:s.label};return this._application.executePreparedSearch(e.mode,e.argument,a)}getUserInterface(e){switch(e){case t.TEXT:return n.SHORTTEXT;case t.INTEGER:return n.INTEGERNUMBER;case t.DECIMAL:return n.DECIMALNUMBER;case t.DATE:return n.DATE;case t.DATETIME:return n.DATETIME;case t.BOOLEAN:return n.CHECKBOX;case t.ENTITY:return n.SEARCH;case t.OPTIONS:return n.OPTIONSELECTOR}}getDataType(e){switch(e){case t.TEXT:case t.OPTIONS:return o.TEXT;case t.INTEGER:case t.DECIMAL:return o.NUMBER;case t.DATE:case t.DATETIME:return o.DATE;case t.BOOLEAN:return o.BOOLEAN;case t.ENTITY:return o.OBJECT}}getProps(e){switch(e.paramType){case t.DECIMAL:return e.precision?{precision:Number(e.precision)}:void 0;case t.ENTITY:return{ENTITYNAME:e.entityName};case t.OPTIONS:return{options:this.prepareOptions(e.options)};default:return}}buildFields(){let e=[];this._params.forEach((a,i)=>{const l=!!a.name;let r=l?a.name:`param_${i}`;e.push({name:r,label:a.label,dataType:this.getDataType(a.paramType),userInterface:this.getUserInterface(a.paramType),readOnly:!1,required:a.paramType=="B"?!1:a.required==="true",properties:this.getProps(a)}),this._params[i].name=r,this._params[i].isGeneratedName=!l});const s={name:"params",label:"params",fields:e};this._metadata=s}fillFields(){this._params.forEach(e=>{e.saveLast=="true"&&this.dataUnit.setFieldValue(e.name,e.value)})}prepareOptions(e){return e.split(";").map(function(i,l){let r,c;if(i.indexOf("=")>-1){let u=i.split("=");r=u[0],c=u[1]}else r=(l+1).toString(),c=i;return{value:r,label:c}})}componentWillLoad(){this._application=m.getContextValue("__SNK__APPLICATION__"),this._params=[...this.action.actionConfig.params.promptParam],this.dataUnit.metadataLoader=this.metadataLoader.bind(this),this.dataUnit.loadMetadata().then(()=>{this.fillFields()}),this.dataUnit.addRecord()}async metadataLoader(){return new Promise(e=>{this.buildFields(),e(this._metadata)})}handleModalAction(e){switch(e){case this.APPLY:this.handleApply();break;case this.CANCEL:case this.CLOSE:this.exitPopup();break}}render(){return p("ez-popup",{size:"medium",heightMode:"auto",useHeader:!1,ref:e=>this._ezPopup=e},p("ez-modal-container",{modalTitle:this._application.messagesBuilder.getMessage("snkActionsButton.form.fillParams",void 0),okButtonLabel:this._application.messagesBuilder.getMessage("snkActionsButton.buttons.apply",void 0),cancelButtonLabel:this._application.messagesBuilder.getMessage("snkActionsButton.buttons.cancel",void 0),onEzModalAction:e=>this.handleModalAction(e.detail)},p("div",{class:"ez-margin-vertical--medium"},p("ez-form",{ref:e=>this._ezForm=e,dataUnit:this.dataUnit}))))}};export{f as snk_actions_form};
//# sourceMappingURL=snk-actions-form.entry-PcmqCnDQ.js.map

{"version":3,"file":"snk-attach.entry-BTdzj0LP.js","sources":["../../node_modules/@sankhyalabs/sankhyablocks/dist/esm/snk-attach.entry.js"],"sourcesContent":["import { r as registerInstance, c as createEvent, h } from './index-479e1293.js';\nimport { ApplicationContext, DataType, Action, UserInterface, StringUtils, DataUnitLoaderUtils, DataUnit } from '@sankhyalabs/core';\nimport { D as DataFetcher } from './DataFetcher-db08cad0.js';\nimport { S as SaveErrorsEnum } from './ISave-da565824.js';\nimport './index-b40568ff.js';\nimport { P as PreloadManager, D as DataUnitFetcher, I as InMemoryLoader } from './dataunit-fetcher-1b78797a.js';\nimport './filter-item-type.enum-d45e026f.js';\nimport './form-config-fetcher-e623539b.js';\nimport { V as VIEW_MODE } from './constants-7b422de0.js';\nimport { A as AutorizationType } from './auth-fetcher-43c8d76b.js';\nimport { T as TaskbarElement } from './taskbar-elements-171476d4.js';\nimport './PrintUtils-3e4ff0f5.js';\nimport '@sankhyalabs/core/dist/dataunit/metadata/UnitMetadata';\nimport '@sankhyalabs/ezui/dist/collection/utils/constants';\nimport '@sankhyalabs/ezui/dist/collection/components/ez-grid/utils';\nimport '@sankhyalabs/core/dist/utils/SortingUtils';\nimport './ResourceIDUtils-a114189a.js';\nimport './index-b72af127.js';\n\nconst SERVICE$1 = {\n  save: \"Attach.save\",\n  delete: \"Attach.remove\",\n  view: \"Attach.view\",\n  repository: \"RepositorioArquivoSP.abreArquivo\"\n};\nclass AttachFetcher {\n  constructor(dataUnitName) {\n    this.dataUnitName = dataUnitName;\n  }\n  async save({ dataUnit: dataUnitName, record, updatingFields: fields, operation }) {\n    var _a, _b;\n    const isInsert = operation == \"INSERT\";\n    const dataBody = isInsert ? fields : record;\n    if (!isInsert && (fields === null || fields === void 0 ? void 0 : fields.DESCRICAO) && (fields === null || fields === void 0 ? void 0 : fields.DESCRICAO) !== (record === null || record === void 0 ? void 0 : record.DESCRICAO)) {\n      throw new Error(SaveErrorsEnum.DESCRIPTION_CANNOT_BE_CHANGED);\n    }\n    const reqBody = {\n      \"anexo\": {\n        \"codata\": isInsert ? fields === null || fields === void 0 ? void 0 : fields.REGISTER_KEY : record === null || record === void 0 ? void 0 : record.CODATA,\n        \"sequencia\": (dataBody === null || dataBody === void 0 ? void 0 : dataBody.SEQUENCIA) || \"0\",\n        \"tipo\": (dataBody === null || dataBody === void 0 ? void 0 : dataBody.TIPO) || \"N\",\n        \"descricao\": dataBody === null || dataBody === void 0 ? void 0 : dataBody.DESCRICAO,\n        \"arquivo\": (_b = (_a = fields.CAMINHO_ARQUIVO) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.name,\n        \"ehInclusao\": isInsert ? \"S\" : \"N\",\n        \"ehArquivoRepositorio\": \"N\"\n      }\n    };\n    return new Promise((resolve, reject) => {\n      DataFetcher.get().callServiceBroker(SERVICE$1.save, JSON.stringify(reqBody))\n        .then(result => {\n        var _a;\n        return resolve([Object.assign(Object.assign(Object.assign({}, result), fields), { __owner__dataunit__name__: (_a = this.dataUnitName) !== null && _a !== void 0 ? _a : dataUnitName })]);\n      })\n        .catch(error => reject(error));\n    });\n  }\n  async edit(change) {\n    throw new Error(\"Method not implemented.\");\n  }\n  async delete(record) {\n    var request = {\n      anexo: {\n        codata: record.CODATA,\n        tipo: record.TIPO,\n        descricao: record.DESCRICAO,\n      }\n    };\n    const result = await DataFetcher.get().callServiceBroker(SERVICE$1.delete, JSON.stringify(request));\n    return Promise.resolve(result);\n  }\n  async getDownloadKey(record) {\n    var _a, _b, _c;\n    if (record.EHARQUIVOREPOSITORIO == 'S') {\n      const request = {\n        config: {\n          path: record.ARQUIVO,\n          tipoconteudo: record.TIPOCONTEUDO\n        }\n      };\n      const result = await DataFetcher.get().callServiceBroker(SERVICE$1.repository, JSON.stringify(request));\n      return Promise.resolve({\n        chave: {\n          valor: (_b = (_a = result === null || result === void 0 ? void 0 : result.responseBody) === null || _a === void 0 ? void 0 : _a.chave) === null || _b === void 0 ? void 0 : _b.valor\n        }\n      });\n    }\n    const criteria = {\n      anexo: {\n        codata: record.CODATA,\n        codemp: record.CODEMP,\n        sequencia: record.SEQUENCIA,\n        tipo: record.TIPO,\n        descricao: record.DESCRICAO,\n        tipoConteudo: record.TIPOCONTEUDO\n      }\n    };\n    const result = await DataFetcher.get().callServiceBroker(SERVICE$1.view, JSON.stringify(criteria));\n    if (result === null || result === void 0 ? void 0 : result.chaveAnexo) {\n      return Promise.resolve({\n        chave: {\n          valor: (_c = result === null || result === void 0 ? void 0 : result.chaveAnexo) === null || _c === void 0 ? void 0 : _c.idChaveAnexo\n        }\n      });\n    }\n    return Promise.reject(new Error(\"File not found.\"));\n  }\n}\n\nconst SERVICE = {\n  save: \"AnexoSistemaSP.salvar\",\n  delete: \"AnexoSistemaSP.excluir\",\n  download: \"AnexoSistemaSP.baixar\",\n};\nclass AnexoSistemaFetcher {\n  constructor(entityName, dataUnitName) {\n    var _a;\n    this.entityName = entityName;\n    this.dataUnitName = dataUnitName;\n    this.validateFields = (fields) => {\n      if (!!fields.LINK && !!fields.NOMEARQUIVO)\n        throw new Error(SaveErrorsEnum.LINK_AND_FILE_AT_THE_SAME_TIME);\n      if (!fields.LINK && !fields.NOMEARQUIVO)\n        throw new Error(SaveErrorsEnum.ANY_LINK_OR_FILE_FILLED);\n      if (!this._registerKey)\n        throw new Error('Register key can not be null');\n    };\n    this.resourceID = (window[\"resourceID\"] || ((_a = window[\"workspace\"]) === null || _a === void 0 ? void 0 : _a.resourceID));\n  }\n  set registerKey(registerKey) {\n    this._registerKey = registerKey;\n  }\n  async save(change) {\n    var _a, _b;\n    let { updatingFields: fields } = change;\n    fields = Object.assign(Object.assign({}, fields), { NOMEARQUIVO: (_a = fields.NOMEARQUIVO) === null || _a === void 0 ? void 0 : _a[0] });\n    try {\n      this.validateFields(fields);\n      const fileInfo = !fields.LINK ? fields.NOMEARQUIVO : null;\n      const reqBody = {\n        serviceName: SERVICE.save,\n        requestBody: {\n          params: {\n            resourceID: this.resourceID,\n            description: fields.DESCRICAO,\n            fileSelect: fileInfo ? 1 : 0,\n            keySession: (_b = fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.properties) === null || _b === void 0 ? void 0 : _b.fileNameTmp,\n            nameAttach: fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.name,\n            link: fields.LINK,\n            nameEntity: this.entityName,\n            pkEntity: this._registerKey,\n            typeAcess: fields.TIPOACESSO,\n            typeApres: fields.TIPOAPRES,\n          }\n        }\n      };\n      const result = await DataFetcher.get().callServiceBroker(SERVICE.save, JSON.stringify(reqBody));\n      return Promise.resolve([Object.assign(Object.assign(Object.assign({}, result), fields), { ARQUIVOOULINK: !!fields.LINK ? fields.LINK : fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.name, __owner__dataunit__name__: this.dataUnitName })]);\n    }\n    catch (error) {\n      return Promise.reject(error);\n    }\n  }\n  async edit(change) {\n    var _a, _b, _c;\n    let { updatingFields: fields, record } = change;\n    const getFieldValue = (fieldValue) => {\n      if (fields[fieldValue] !== undefined)\n        return fields[fieldValue];\n      return record[fieldValue];\n    };\n    const attachField = getFieldValue('NOMEARQUIVO');\n    const hasNewAttachment = (_b = (_a = fields.NOMEARQUIVO) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.downloadURL;\n    fields = Object.assign(Object.assign({}, fields), { DESCRICAO: getFieldValue('DESCRICAO'), LINK: getFieldValue('LINK'), TIPOACESSO: getFieldValue('TIPOACESSO'), TIPOAPRES: getFieldValue('TIPOAPRES'), CHAVEARQUIVO: record.CHAVEARQUIVO, NOMEARQUIVO: attachField === null || attachField === void 0 ? void 0 : attachField[0] });\n    const fileInfo = !fields.LINK ? fields.NOMEARQUIVO : null;\n    try {\n      this.validateFields(fields);\n      const reqBody = {\n        serviceName: SERVICE.save,\n        requestBody: {\n          params: {\n            resourceID: this.resourceID,\n            nuAttach: record === null || record === void 0 ? void 0 : record.NUATTACH,\n            description: fields.DESCRICAO,\n            fileSelect: hasNewAttachment ? 1 : 0,\n            keySession: (_c = fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.properties) === null || _c === void 0 ? void 0 : _c.fileNameTmp,\n            keyAttach: fields.CHAVEARQUIVO,\n            nameAttach: fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.name,\n            link: fields.LINK,\n            nameEntity: this.entityName,\n            pkEntity: this._registerKey,\n            typeAcess: fields.TIPOACESSO,\n            typeApres: fields.TIPOAPRES,\n          }\n        }\n      };\n      const result = await DataFetcher.get().callServiceBroker(SERVICE.save, JSON.stringify(reqBody));\n      return Promise.resolve([Object.assign(Object.assign(Object.assign({}, result), fields), { ARQUIVOOULINK: !!fields.LINK ? fields.LINK : fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.name, __owner__dataunit__name__: this.dataUnitName })]);\n    }\n    catch (error) {\n      return Promise.reject(error);\n    }\n  }\n  delete(record) {\n    var _a;\n    const attachField = ((_a = record.NOMEARQUIVO) === null || _a === void 0 ? void 0 : _a[0]) || {};\n    const reqBody = {\n      serviceName: SERVICE.delete,\n      requestBody: {\n        paramsDelete: {\n          keyAttach: record.CHAVEARQUIVO,\n          nameAttach: attachField === null || attachField === void 0 ? void 0 : attachField.name,\n          nameEntity: record.NOMEINSTANCIA,\n          nuAttach: record.NUATTACH,\n          pkEntity: record.PKREGISTRO\n        }\n      }\n    };\n    return new Promise((resolve, reject) => {\n      DataFetcher.get().callServiceBroker(SERVICE.delete, JSON.stringify(reqBody))\n        .then(result => resolve(result))\n        .catch(error => reject(error));\n    });\n  }\n  getDownloadKey(record) {\n    var _a;\n    const attachField = ((_a = record.NOMEARQUIVO) === null || _a === void 0 ? void 0 : _a[0]) || {};\n    const reqBody = {\n      serviceName: SERVICE.download,\n      requestBody: {\n        paramsDown: {\n          nameAttach: attachField === null || attachField === void 0 ? void 0 : attachField.name,\n          nameEntity: record.NOMEINSTANCIA,\n          nuAttach: record.NUATTACH,\n          pkEntity: record.PKREGISTRO,\n          keyAttach: record.CHAVEARQUIVO,\n        }\n      }\n    };\n    return new Promise((resolve, reject) => {\n      DataFetcher.get().callServiceBroker(SERVICE.download, JSON.stringify(reqBody))\n        .then(result => resolve(result))\n        .catch(error => reject(error));\n    });\n  }\n}\n\nclass AnexoSistemaDataUnitFactory {\n  constructor(entityName, getMessage) {\n    this.entityName = entityName;\n    this.getMessage = getMessage;\n    this._application = ApplicationContext.getContextValue(\"__SNK__APPLICATION__\");\n  }\n  initLoaders(dataUnit, fetcher, onSuccess) {\n    if (!this.loader)\n      this.loader = dataUnit.dataLoader;\n    dataUnit.dataLoader = (dataUnit, request) => this.dataLoader(dataUnit, request);\n    dataUnit.saveLoader = (_, changes) => this.saveLoader(changes, fetcher).then((recordIds) => {\n      if (recordIds.length)\n        onSuccess();\n      return recordIds;\n    });\n    dataUnit.removeLoader = (dataUnit, ids) => this.removeLoader(dataUnit, ids, fetcher).then((recordIds) => {\n      if (recordIds.length)\n        onSuccess();\n      return recordIds;\n    });\n  }\n  metadataLoader(dataUnit) {\n    throw new Error(\"Method not implemented.\");\n  }\n  dataLoader(dataUnit, request) {\n    return new Promise(resolve => {\n      this.loader(dataUnit, request).then(response => {\n        const records = ((response === null || response === void 0 ? void 0 : response.records) || []).map(record => {\n          let fileInfo;\n          if (!record.LINK)\n            fileInfo = [{\n                name: record.NOMEARQUIVO,\n              }];\n          return Object.assign(Object.assign({}, record), { ARQUIVOOULINK: !!record.LINK ? record.LINK : record.NOMEARQUIVO, NOMEARQUIVO: fileInfo });\n        });\n        resolve(Object.assign(Object.assign({}, response), { records }));\n      });\n    });\n  }\n  saveLoader(changes, fetcher) {\n    return new Promise((resolve) => {\n      var _a;\n      const change = Array.isArray(changes) ? changes[0] : {};\n      const savePromise = ((_a = change === null || change === void 0 ? void 0 : change.record) === null || _a === void 0 ? void 0 : _a.NUATTACH) >= 0 ? fetcher.edit.bind(fetcher) : fetcher.save.bind(fetcher);\n      savePromise(change).then((records) => {\n        resolve(records);\n      }).catch((error) => {\n        if (error.message === SaveErrorsEnum.LINK_AND_FILE_AT_THE_SAME_TIME) {\n          this._application.alert(this.getMessage('snkAttach.alertValidation.fileAndLinkAtTheSameTime.title'), this.getMessage('snkAttach.alertValidation.fileAndLinkAtTheSameTime.message'));\n          return resolve([]);\n        }\n        if (error.message === SaveErrorsEnum.ANY_LINK_OR_FILE_FILLED) {\n          this._application.alert(this.getMessage('snkAttach.alertValidation.anyLinkOrFileFilled.title'), this.getMessage('snkAttach.alertValidation.anyLinkOrFileFilled.message'));\n          return resolve([]);\n        }\n        if (error.message) {\n          this._application.error((error.title || error.name), error.message);\n          return resolve([]);\n        }\n        resolve([]);\n      });\n    });\n  }\n  removeLoader(dataUnit, ids, fetcher) {\n    return new Promise((resolve) => {\n      const { records } = dataUnit.getSelectionInfo();\n      const recordToDelete = records[0];\n      fetcher.delete(recordToDelete).then(() => {\n        PreloadManager.removeRecords(dataUnit, [recordToDelete]);\n        return resolve(ids);\n      });\n    });\n  }\n  getFilters(registerKey) {\n    return [\n      {\n        name: 'AttachmentsByPK',\n        expression: 'this.PKREGISTRO = :PKREGISTRO',\n        params: [{\n            name: \"PKREGISTRO\",\n            dataType: DataType.TEXT,\n            value: `${registerKey}_${this.entityName}`\n          }]\n      }\n    ];\n  }\n  getInterceptions(dataUnit, action, crudRef) {\n    return new Promise((resolve) => {\n      if (action.type === Action.EDITION_CANCELED) {\n        if (!dataUnit.isDirty())\n          return resolve(action);\n        return this._application.confirm(this.getMessage('snkAttach.cancelConfirmation.title'), this.getMessage('snkAttach.cancelConfirmation.message')).then((cancellationConfirmed) => {\n          if (cancellationConfirmed) {\n            crudRef.goToView(VIEW_MODE.GRID);\n            return resolve(action);\n          }\n          return resolve(undefined);\n        });\n      }\n      if (action.type === Action.DATA_SAVED) {\n        dataUnit.loadData();\n        return resolve(action);\n      }\n      resolve(action);\n    });\n  }\n}\n\nconst application$1 = ApplicationContext.getContextValue(\"__SNK__APPLICATION__\");\nconst getMessage$1 = (key) => {\n  var _a, _b;\n  return (_b = (_a = application$1 === null || application$1 === void 0 ? void 0 : application$1.messagesBuilder) === null || _a === void 0 ? void 0 : _a.getMessage) === null || _b === void 0 ? void 0 : _b.call(_a, key, null);\n};\nconst attachCrudConfig = {\n  grid: {\n    columns: [\n      { name: \"CODATA\", orderIndex: 0, width: 0 },\n      { name: \"DESCRICAO\", orderIndex: 1, width: 0 },\n      { name: \"ARQUIVO\", orderIndex: 2, width: 0 },\n      { name: \"DTALTER\", orderIndex: 3, width: 0 },\n      { name: \"USUARIO\", orderIndex: 4, width: 0 },\n    ],\n  },\n  form: {\n    emptyConfig: false,\n    fields: [\n      {\n        name: \"DESCRICAO\",\n        label: getMessage$1(\"snkAttach.attachMetadata.lblDescription\"),\n        visible: true,\n        readOnly: false,\n        required: true,\n      },\n      {\n        name: \"CAMINHO_ARQUIVO\",\n        label: getMessage$1(\"snkAttach.attachMetadata.lblFile\"),\n        visible: true,\n        readOnly: false,\n        required: true,\n      },\n    ],\n  },\n};\nconst attachFetcherMetadataBuilder = {\n  name: \"Attach\",\n  label: \"Attach List\",\n  fields: [\n    { name: \"CODATA\", label: getMessage$1(\"snkAttach.attachMetadata.lblCode\"), dataType: DataType.TEXT },\n    { name: \"DESCRICAO\", label: getMessage$1(\"snkAttach.attachMetadata.lblDescription\"), dataType: DataType.TEXT, readOnly: false },\n    { name: \"ARQUIVO\", label: getMessage$1(\"snkAttach.attachMetadata.lblFileOrLink\"), dataType: DataType.TEXT },\n    { name: \"USUARIO\", label: getMessage$1(\"snkAttach.attachMetadata.lblUser\"), dataType: DataType.TEXT },\n    { name: \"DTALTER\", label: getMessage$1(\"snkAttach.attachMetadata.lblDate\"), dataType: DataType.TEXT },\n    {\n      name: \"CAMINHO_ARQUIVO\",\n      label: getMessage$1(\"snkAttach.attachMetadata.lblFileUpload\"),\n      dataType: DataType.OBJECT,\n      userInterface: UserInterface.FILE,\n      readOnly: false,\n      required: true,\n      visible: true,\n      properties: {\n        subTitle: getMessage$1(\"snkAttach.attachMetadata.lblSubTitle\"),\n        MAX_FILES: 1,\n        STORAGESTRATEGY: \"SESSION\",\n        INTERNAL_FILENAME: \"Attach.upload\",\n      }\n    },\n  ],\n};\n\nconst SERVICE_LOAD = \"Attach.load\";\nclass AttachFetcherDataUnitFactory {\n  constructor(getMessage) {\n    this.getMessage = getMessage;\n    this._records = [];\n    this._application = ApplicationContext.getContextValue(\"__SNK__APPLICATION__\");\n  }\n  initLoaders(dataUnit, fetcher, onSuccess) {\n    dataUnit.metadataLoader = (dataUnit) => this.metadataLoader(dataUnit);\n    dataUnit.dataLoader = (dataUnit, request) => this.dataLoader(dataUnit, request);\n    dataUnit.saveLoader = (_, changes) => this.saveLoader(changes, fetcher).then((recordIds) => {\n      if (recordIds.length)\n        onSuccess();\n      return recordIds;\n    });\n    dataUnit.removeLoader = (dataUnit, ids) => this.removeLoader(dataUnit, ids, fetcher).then((recordIds) => {\n      if (recordIds.length)\n        onSuccess();\n      return recordIds;\n    });\n  }\n  metadataLoader(_) {\n    return Promise.resolve(attachFetcherMetadataBuilder);\n  }\n  async dataLoader(dataUnit, request) {\n    if (!request.source) {\n      return Promise.resolve({ records: this._records });\n    }\n    if (!Number.isNaN(Number(request.source))) {\n      const criteria = {\n        criteria: {\n          codata: request.source,\n          tipoAnexo: \"N\"\n        }\n      };\n      const applicationDataFetcher = await this._application.getDataFetcher();\n      const { anexos: { anexo = [] } } = await applicationDataFetcher.callServiceBroker(SERVICE_LOAD, JSON.stringify(criteria));\n      const records = [];\n      anexo.forEach((param) => {\n        records.push(Object.assign({ __record__id__: StringUtils.generateUUID(), CAMINHO_ARQUIVO: [{\n              name: param === null || param === void 0 ? void 0 : param.ARQUIVO,\n            }] }, param));\n      });\n      this._records = records;\n    }\n    return DataUnitLoaderUtils.buildLoadDataResponse(this._records, dataUnit, request);\n  }\n  saveLoader(changes, fetcher) {\n    return new Promise((resolve) => {\n      const change = Array.isArray(changes) ? changes[0] : {};\n      fetcher.save(change)\n        .then(resolve)\n        .catch((error) => {\n        if (error.message === SaveErrorsEnum.DESCRIPTION_CANNOT_BE_CHANGED) {\n          this._application.alert(this.getMessage('snkAttach.alertValidation.descriptionCannotBeChanged.title'), this.getMessage('snkAttach.alertValidation.descriptionCannotBeChanged.message'));\n          return resolve([]);\n        }\n        if (error.message === SaveErrorsEnum.LINK_AND_FILE_AT_THE_SAME_TIME) {\n          this._application.alert(this.getMessage('snkAttach.alertValidation.fileAndLinkAtTheSameTime.title'), this.getMessage('snkAttach.alertValidation.fileAndLinkAtTheSameTime.message'));\n          return resolve([]);\n        }\n        if (error.message === SaveErrorsEnum.ANY_LINK_OR_FILE_FILLED) {\n          this._application.alert(this.getMessage('snkAttach.alertValidation.anyLinkOrFileFilled.title'), this.getMessage('snkAttach.alertValidation.anyLinkOrFileFilled.message'));\n          return resolve([]);\n        }\n        if (error.message) {\n          this._application.error((error.title || error.name), error.message);\n          return resolve([]);\n        }\n        resolve([]);\n      });\n    });\n  }\n  removeLoader(dataUnit, ids, fetcher) {\n    return new Promise((resolve) => {\n      dataUnit.getSelectionInfo().records.forEach(async (record) => {\n        this._application.hasAccess(AutorizationType.REMOVE)\n          .then(async (hasAccess) => {\n          if (hasAccess) {\n            await fetcher.delete(record);\n            resolve(ids);\n          }\n        });\n      });\n    });\n  }\n  getFilters() {\n    throw new Error('Method not implemented.');\n  }\n  getInterceptions(dataUnit, action, crudRef) {\n    return new Promise((resolve) => {\n      var _a, _b, _c, _d, _e, _f;\n      switch (action.type) {\n        case Action.EDITION_CANCELED:\n          if (!dataUnit.isDirty())\n            return resolve(action);\n          return this._application.confirm(this.getMessage('snkAttach.cancelConfirmation.title'), this.getMessage('snkAttach.cancelConfirmation.message')).then((cancellationConfirmed) => {\n            if (cancellationConfirmed) {\n              crudRef.goToView(VIEW_MODE.GRID);\n              return resolve(action);\n            }\n            return resolve(undefined);\n          });\n        case Action.DATA_SAVED:\n          dataUnit.loadData(undefined, undefined, false, (_c = (_b = (_a = action === null || action === void 0 ? void 0 : action.payload) === null || _a === void 0 ? void 0 : _a.records) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.REGISTER_KEY);\n          return resolve(action);\n        case Action.RECORDS_REMOVED:\n          dataUnit.loadData(undefined, undefined, false, (_f = (_e = (_d = action === null || action === void 0 ? void 0 : action.payload) === null || _d === void 0 ? void 0 : _d.cachedRecords) === null || _e === void 0 ? void 0 : _e[0]) === null || _f === void 0 ? void 0 : _f.CODATA);\n          return resolve(action);\n      }\n      resolve(action);\n    });\n  }\n}\n\nconst application = ApplicationContext.getContextValue(\"__SNK__APPLICATION__\");\nconst getMessage = (key) => {\n  var _a, _b;\n  return (_b = (_a = application === null || application === void 0 ? void 0 : application.messagesBuilder) === null || _a === void 0 ? void 0 : _a.getMessage) === null || _b === void 0 ? void 0 : _b.call(_a, key, null);\n};\nconst TaskbarAttachButtons = {\n  DOWNLOAD: {\n    hint: getMessage(\"snkAttach.taskbar.titleDownload\"),\n    name: \"DOWNLOAD\",\n    iconName: 'file-download'\n  },\n  LINK: {\n    hint: getMessage(\"snkAttach.taskbar.titleLink\"),\n    name: \"LINK\",\n    iconName: \"launch\"\n  }\n};\nconst buildTaskBarManager = () => {\n  const disabledButtonsWithoutSelection = [\n    TaskbarElement.REMOVE,\n    \"DOWNLOAD\",\n    \"LINK\"\n  ];\n  return {\n    getButtons: (_, dataState, currentButtons) => {\n      const refreshBtnIndex = currentButtons.indexOf(TaskbarElement.REFRESH);\n      if ((dataState === null || dataState === void 0 ? void 0 : dataState.insertionMode) || (dataState === null || dataState === void 0 ? void 0 : dataState.isDirty)) {\n        return currentButtons.reverse();\n      }\n      else if (refreshBtnIndex !== -1) {\n        currentButtons.splice(refreshBtnIndex, 1);\n      }\n      const { selectedRecord } = dataState || {};\n      const taskbarTobeAdded = !!(selectedRecord === null || selectedRecord === void 0 ? void 0 : selectedRecord.LINK) ? TaskbarAttachButtons.LINK : TaskbarAttachButtons.DOWNLOAD;\n      currentButtons.splice(currentButtons.indexOf(TaskbarElement.DIVIDER) + 1, 0, TaskbarElement.REMOVE, taskbarTobeAdded, TaskbarElement.DIVIDER);\n      const buttonsToRemove = [TaskbarElement.CLONE, TaskbarElement.DATA_EXPORTER];\n      const updatedButtons = Array.from(new Set(currentButtons.filter((button) => !buttonsToRemove.includes(button))));\n      updatedButtons.splice(updatedButtons.indexOf(taskbarTobeAdded) + 1, 0, TaskbarElement.DIVIDER);\n      return updatedButtons;\n    },\n    isEnabled: (_, dataState, currentButton) => {\n      const hasSelectedRecord = (dataState === null || dataState === void 0 ? void 0 : dataState.selectedRecord) !== undefined;\n      const disabledButton = disabledButtonsWithoutSelection.includes(currentButton);\n      if (disabledButton && !hasSelectedRecord)\n        return false;\n      return true;\n    }\n  };\n};\n\nconst anexoSistemaCrudConfig = {\n  grid: {\n    columns: [\n      { name: \"ARQUIVOOULINK\", orderIndex: 0, width: 0 },\n      { name: \"DESCRICAO\", orderIndex: 1, width: 0 },\n      { name: \"DHCAD\", orderIndex: 2, width: 0 },\n      { name: \"DHALTER\", orderIndex: 3, width: 0 },\n      { name: \"TIPOAPRES\", orderIndex: 4, width: 0 },\n      { name: \"TIPOACESSO\", orderIndex: 5, width: 0 },\n      { name: \"CODUSU\", orderIndex: 6, width: 0 },\n      { name: \"CODUSUALT\", orderIndex: 7, width: 0 }\n    ]\n  },\n  form: {\n    emptyConfig: false,\n    fields: [\n      {\n        name: \"DESCRICAO\",\n        required: true\n      },\n      {\n        name: \"TIPOAPRES\",\n        required: true,\n      },\n      {\n        name: \"TIPOACESSO\",\n        required: true,\n      },\n      {\n        name: \"LINK\"\n      },\n      {\n        name: \"NOMEARQUIVO\"\n      }\n    ]\n  },\n};\n\nconst snkAttachCss = \".snk-attach__header.sc-snk-attach,.snk-attach__crud-section.sc-snk-attach{padding:0 var(--space--lg)}.snk-attach__file-info.sc-snk-attach{padding:var(--space--small);max-width:50%}.snk-attach__main.sc-snk-attach{height:85%}.ez-box__container.sc-snk-attach{height:100%}\";\n\nconst RESOURCE_ID = 'AnexoSistema';\nconst DATA_UNIT_NAME = 'br.com.sankhya.core.v3.anexoSistema';\nconst GRID_LEGACY_CONFIG_NAME = 'GrdCfgHtml5:grdcfg.dynaform.anexo';\nconst LINKORFILE_COLUMN_NAME = \"ARQUIVOOULINK\";\nconst SnkAttach = class {\n  constructor(hostRef) {\n    registerInstance(this, hostRef);\n    this.back = createEvent(this, \"back\", 7);\n    this.handleTaskbarClick = async ({ detail: taskbar }) => {\n      if ([\"DOWNLOAD\", \"LINK\"].includes(taskbar))\n        return this.downloadAttachment(this._currentDataUnit.getSelectedRecord());\n      if (this.fetcherType === \"Attach\" && [\"SAVE\"].includes(taskbar) && this._currentDataUnit.isDirty()) {\n        await this._currentDataUnit.setFieldValue(\"REGISTER_KEY\", this.registerKey);\n      }\n    };\n    this.handleBack = () => {\n      this._currentDataUnit.cancelEdition().then((cancelationConfirmed) => {\n        if (cancelationConfirmed)\n          this.back.emit();\n      });\n    };\n    this.handleFinish = () => {\n      if (!this._currentDataUnit.isDirty())\n        return this.back.emit();\n      if (!this.validateAnexoSistema()) {\n        return;\n      }\n      this._currentDataUnit.saveData().then(() => {\n        this.showFinishedToast();\n        this.back.emit();\n      });\n    };\n    this.gridLegacyConfigName = undefined;\n    this.fetcherType = undefined;\n    this.fetcher = undefined;\n    this.dataUnit = undefined;\n    this.dataUnitBuilder = undefined;\n    this.registerKey = undefined;\n    this.entityName = undefined;\n    this.messagesBuilder = undefined;\n    this._currentFetcher = undefined;\n    this._currentDataUnit = undefined;\n    this.crudConfig = undefined;\n  }\n  async registerKeyWatcher(newRegisterKey, oldRegisterKey) {\n    var _a;\n    if (this._currentDataUnit == null) {\n      this.loadAttachmentDataUnit();\n    }\n    if (oldRegisterKey !== newRegisterKey) {\n      if (this._currentFetcher instanceof AnexoSistemaFetcher) {\n        this._currentFetcher.registerKey = newRegisterKey;\n      }\n      await ((_a = this._currentDataUnit) === null || _a === void 0 ? void 0 : _a.loadData());\n    }\n  }\n  getAnexoSistemaFetcherInstance() {\n    var _a;\n    const anexoSistemaFetcher = new AnexoSistemaFetcher(this.entityName, (_a = this._currentDataUnit) === null || _a === void 0 ? void 0 : _a.name);\n    anexoSistemaFetcher.registerKey = this.registerKey;\n    return anexoSistemaFetcher;\n  }\n  async initAttach() {\n    var _a, _b, _c, _d, _e;\n    if (!this.fetcherType && !this.registerKey)\n      return;\n    if (!this.fetcherType) {\n      this.fetcherType = \"AnexoSistema\";\n    }\n    this.returnToGridMode();\n    if (this.fetcherType === \"AnexoSistema\") {\n      this._currentFetcher = this.getAnexoSistemaFetcherInstance();\n      (_a = this._currentDataUnitBuilder) === null || _a === void 0 ? void 0 : _a.initLoaders(this._currentDataUnit, this._currentFetcher, this.returnToGridMode.bind(this));\n      await ((_b = this._currentDataUnit) === null || _b === void 0 ? void 0 : _b.loadData());\n      return;\n    }\n    if (this.fetcherType === \"Attach\") {\n      const hasMoreOneItem = ((_c = this.registerKey) === null || _c === void 0 ? void 0 : _c.split(\"_\").length) > 1;\n      if (hasMoreOneItem)\n        return;\n    }\n    await ((_d = this._currentDataUnit) === null || _d === void 0 ? void 0 : _d.loadMetadata());\n    await ((_e = this._currentDataUnit) === null || _e === void 0 ? void 0 : _e.loadData(undefined, undefined, true, this.registerKey));\n  }\n  /**\n   * Conforme mecanismo de mensagens, é possível customizar as mensagens dos blocos de construção\n   * através de um pequeno modulo na estrutura da aplicação:\n   * - Criar um arquivo no seguinte caminho: /messages/appmessages.msg.js.\n   * Para conhecer os detalhes do módulo, vide o arquivo neste projeto \"/src/lib/message/resources/snk-attach.msg.ts\"\n  */\n  getMessage(key, params) {\n    if (this.messagesBuilder)\n      return this.messagesBuilder.getMessage(key, params);\n  }\n  showFinishedToast() {\n    this._application.info(this.getMessage('snkAttach.finishedMessage'), { iconName: \"check\" });\n  }\n  downloadAttachment(selectedRecord) {\n    if (!selectedRecord)\n      throw new Error('Nenhum registro selecionado');\n    if (selectedRecord.LINK) {\n      window.open(`${selectedRecord.LINK}`);\n      return;\n    }\n    this._currentFetcher\n      .getDownloadKey(selectedRecord)\n      .then(({ chave }) => {\n      var _a;\n      let forceDownload = false;\n      if (!((_a = selectedRecord === null || selectedRecord === void 0 ? void 0 : selectedRecord.ARQUIVO) === null || _a === void 0 ? void 0 : _a.endsWith(\".pdf\"))) {\n        forceDownload = true;\n      }\n      window.open(`/mge/visualizadorArquivos.mge?chaveArquivo=${chave.valor}${forceDownload ? \"&forcarDownload=S\" : \"\"}`);\n    });\n  }\n  returnToGridMode() {\n    var _a;\n    (_a = this._currentDataUnit) === null || _a === void 0 ? void 0 : _a.clearSelection();\n    if (this._crudElement)\n      this._crudElement.goToView(VIEW_MODE.GRID);\n  }\n  async loadAttachmentDataUnit() {\n    try {\n      switch (this.fetcherType) {\n        case \"AnexoSistema\":\n          await this.loadAnexoSistema();\n          break;\n        case \"Attach\":\n          await this.loadAttach();\n          break;\n        default:\n          this._currentFetcher = this.fetcher;\n          this._currentDataUnit = this.dataUnit;\n          this._currentDataUnitBuilder = this.dataUnitBuilder;\n      }\n    }\n    catch (error) {\n      throw new Error('There was an error while creating the data unit');\n    }\n  }\n  async loadAnexoSistema() {\n    var _a, _b;\n    this._currentDataUnit = new DataUnitFetcher().getDataUnit(RESOURCE_ID, DATA_UNIT_NAME);\n    this._currentFetcher = this.getAnexoSistemaFetcherInstance();\n    let gridValidateForm;\n    if (!this._currentDataUnit.metadata) {\n      await ((_a = this._currentDataUnit) === null || _a === void 0 ? void 0 : _a.loadMetadata());\n      this.crudConfig = this.entityName ? { form: anexoSistemaCrudConfig === null || anexoSistemaCrudConfig === void 0 ? void 0 : anexoSistemaCrudConfig.form } : Object.assign({}, anexoSistemaCrudConfig);\n      gridValidateForm = { grid: anexoSistemaCrudConfig === null || anexoSistemaCrudConfig === void 0 ? void 0 : anexoSistemaCrudConfig.grid };\n    }\n    this.initDataUnitLoaders();\n    this._currentDataUnit.addFilterProvider({\n      getFilter: () => this._currentDataUnitBuilder.getFilters(this.registerKey)\n    });\n    this._currentDataUnit.addInterceptor({\n      interceptAction: (action) => this._currentDataUnitBuilder.getInterceptions(this._currentDataUnit, action, this._crudElement)\n    });\n    await ((_b = this._currentDataUnit) === null || _b === void 0 ? void 0 : _b.loadData());\n    this.disableEditFieldsNotInForm(gridValidateForm);\n  }\n  async loadAttach() {\n    var _a, _b;\n    this._currentFetcher = new AttachFetcher();\n    this._currentDataUnit = new DataUnit(InMemoryLoader.IN_MEMORY_DATA_UNIT_NAME);\n    this._currentDataUnit.pageSize = 150;\n    let gridValidateForm;\n    this.initDataUnitLoaders();\n    this._currentDataUnit.addInterceptor({\n      interceptAction: (action) => {\n        var _a;\n        if (action.type === Action.METADATA_LOADED) {\n          this.crudConfig = this.entityName ? { form: attachCrudConfig === null || attachCrudConfig === void 0 ? void 0 : attachCrudConfig.form } : Object.assign({}, attachCrudConfig);\n          gridValidateForm = { grid: attachCrudConfig === null || attachCrudConfig === void 0 ? void 0 : attachCrudConfig.grid };\n          (_a = this._crudElement) === null || _a === void 0 ? void 0 : _a.updateConfig();\n        }\n        return this._currentDataUnitBuilder.getInterceptions(this._currentDataUnit, action, this._crudElement);\n      }\n    });\n    if (!this._currentDataUnit.metadata) {\n      await ((_a = this._currentDataUnit) === null || _a === void 0 ? void 0 : _a.loadMetadata());\n      this.crudConfig = this.entityName ? { form: attachCrudConfig === null || attachCrudConfig === void 0 ? void 0 : attachCrudConfig.form } : Object.assign({}, attachCrudConfig);\n      gridValidateForm = { grid: attachCrudConfig === null || attachCrudConfig === void 0 ? void 0 : attachCrudConfig.grid };\n      await ((_b = this._currentDataUnit) === null || _b === void 0 ? void 0 : _b.loadData(undefined, undefined, true, this.registerKey));\n      this.disableEditFieldsNotInForm(gridValidateForm);\n    }\n  }\n  initDataUnitLoaders() {\n    var _a, _b;\n    if (this.fetcherType === \"AnexoSistema\") {\n      this._currentFetcher = this.getAnexoSistemaFetcherInstance();\n      this._currentDataUnitBuilder = new AnexoSistemaDataUnitFactory(this.entityName, this.getMessage.bind(this));\n      (_a = this._currentDataUnitBuilder) === null || _a === void 0 ? void 0 : _a.initLoaders(this._currentDataUnit, this._currentFetcher, this.returnToGridMode.bind(this));\n    }\n    if (this.fetcherType === \"Attach\") {\n      this._currentFetcher = new AttachFetcher();\n      this._currentDataUnitBuilder = new AttachFetcherDataUnitFactory(this.getMessage.bind(this));\n      (_b = this._currentDataUnitBuilder) === null || _b === void 0 ? void 0 : _b.initLoaders(this._currentDataUnit, this._currentFetcher, async () => {\n        this.returnToGridMode();\n        await this._currentDataUnit.loadData(undefined, undefined, true, this.registerKey);\n      });\n    }\n  }\n  disableEditFieldsNotInForm(gridValidateForm) {\n    var _a, _b, _c, _d, _e;\n    const gridColumns = ((_b = (_a = this._crudElement) === null || _a === void 0 ? void 0 : _a.gridConfig) === null || _b === void 0 ? void 0 : _b.columns) || ((_c = gridValidateForm === null || gridValidateForm === void 0 ? void 0 : gridValidateForm.grid) === null || _c === void 0 ? void 0 : _c.columns) || ((_e = (_d = this.crudConfig) === null || _d === void 0 ? void 0 : _d.grid) === null || _e === void 0 ? void 0 : _e.columns);\n    if (!!this.getGridLegacyConfigName()) {\n      this._currentDataUnit.disableField(LINKORFILE_COLUMN_NAME);\n    }\n    gridColumns === null || gridColumns === void 0 ? void 0 : gridColumns.forEach(column => {\n      var _a, _b;\n      const fieldName = column.name;\n      if (!((_b = (_a = this.crudConfig) === null || _a === void 0 ? void 0 : _a.form) === null || _b === void 0 ? void 0 : _b.fields.some(field => (field === null || field === void 0 ? void 0 : field.name) === fieldName))) {\n        this._currentDataUnit.disableField(fieldName);\n      }\n    });\n  }\n  validateAnexoSistema() {\n    var _a;\n    if (this._currentFetcher instanceof AnexoSistemaFetcher) {\n      try {\n        let fields = this._currentDataUnit.getSelectedRecord();\n        fields = Object.assign(Object.assign({}, fields), { NOMEARQUIVO: (_a = fields.NOMEARQUIVO) === null || _a === void 0 ? void 0 : _a[0] });\n        this._currentFetcher.validateFields(fields);\n      }\n      catch (error) {\n        if (error.message === SaveErrorsEnum.LINK_AND_FILE_AT_THE_SAME_TIME) {\n          this._application.alert(this.getMessage('snkAttach.alertValidation.fileAndLinkAtTheSameTime.title'), this.getMessage('snkAttach.alertValidation.fileAndLinkAtTheSameTime.message'));\n          return false;\n        }\n        if (error.message === SaveErrorsEnum.ANY_LINK_OR_FILE_FILLED) {\n          this._application.alert(this.getMessage('snkAttach.alertValidation.anyLinkOrFileFilled.title'), this.getMessage('snkAttach.alertValidation.anyLinkOrFileFilled.message'));\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n  async componentWillLoad() {\n    this._application = ApplicationContext.getContextValue(\"__SNK__APPLICATION__\");\n    await this.initAttach();\n  }\n  componentWillRender() {\n    if (!this.fetcherType) {\n      this.fetcherType = \"AnexoSistema\";\n    }\n    if (this._currentDataUnit == null) {\n      this.loadAttachmentDataUnit();\n    }\n  }\n  async handleOnDataStateChange({ detail }) {\n    if (this.fetcherType !== 'Attach')\n      return;\n    if (!detail.insertionMode) {\n      this._currentDataUnit.disableField('DESCRICAO');\n    }\n    else {\n      this._currentDataUnit.enableField('DESCRICAO');\n    }\n    await this._currentDataUnit.loadMetadata();\n  }\n  ;\n  getGridLegacyConfigName() {\n    if (this.gridLegacyConfigName)\n      return this.gridLegacyConfigName;\n    return this.entityName ? GRID_LEGACY_CONFIG_NAME + \".\" + this.entityName : this.entityName;\n  }\n  render() {\n    var _a, _b;\n    if (!this._currentDataUnit)\n      return null;\n    return (h(\"main\", { class: \"snk-attach__main\" }, h(\"header\", { class: \"snk-attach__header\" }, h(\"snk-simple-bar\", { onExit: this.handleBack, messagesBuilder: this.messagesBuilder }, h(\"div\", { slot: \"rightSlot\" }, h(\"ez-button\", { class: \"ez-button--primary\", label: this.getMessage(\"snkAttach.finish\"), onClick: this.handleFinish })))), h(\"div\", { class: \"snk-attach__crud-section ez-size-height--full ez-size-width--full ez-flex ez-flex--column\" }, h(\"div\", { class: \"ez-box__container\" }, h(\"snk-simple-crud\", { ref: (el) => this._crudElement = el, dataUnit: this._currentDataUnit, taskbarManager: buildTaskBarManager(), gridConfig: (_a = this.crudConfig) === null || _a === void 0 ? void 0 : _a.grid, formConfig: (_b = this.crudConfig) === null || _b === void 0 ? void 0 : _b.form, useCancelConfirm: false, onActionClick: this.handleTaskbarClick, messagesBuilder: this.messagesBuilder, onDataStateChange: this.handleOnDataStateChange.bind(this), multipleSelection: true, configName: this.entityName, ignoreReadOnlyFormFields: this.entityName ? true : false, gridLegacyConfigName: this.getGridLegacyConfigName() }, h(\"div\", { slot: \"snkSimpleCrudHeader\" }, h(\"div\", { class: \"ez-flex ez-flex--column\" }, h(\"span\", { class: \"ez-title--primary ez-text ez-text--large ez-text--bold ez-padding-bottom--medium\" }, this.getMessage(\"snkAttach.title\")), h(\"span\", { class: \"ez-text ez-text--medium ez-text--secondary ez-padding-bottom--medium\" }, this.getMessage(\"snkAttach.description\")))))))));\n  }\n  static get watchers() { return {\n    \"registerKey\": [\"registerKeyWatcher\"]\n  }; }\n};\nSnkAttach.style = snkAttachCss;\n\nexport { SnkAttach as snk_attach };\n"],"names":["SERVICE$1","AttachFetcher","dataUnitName","record","fields","operation","_a","_b","isInsert","dataBody","SaveErrorsEnum","reqBody","resolve","reject","DataFetcher","result","error","change","request","_c","criteria","SERVICE","AnexoSistemaFetcher","entityName","registerKey","fileInfo","getFieldValue","fieldValue","attachField","hasNewAttachment","AnexoSistemaDataUnitFactory","getMessage","ApplicationContext","dataUnit","fetcher","onSuccess","_","changes","recordIds","ids","response","records","recordToDelete","PreloadManager","DataType","action","crudRef","Action","cancellationConfirmed","VIEW_MODE","application$1","getMessage$1","key","attachCrudConfig","attachFetcherMetadataBuilder","UserInterface","SERVICE_LOAD","AttachFetcherDataUnitFactory","applicationDataFetcher","anexo","param","StringUtils","DataUnitLoaderUtils","AutorizationType","hasAccess","_d","_e","_f","application","TaskbarAttachButtons","buildTaskBarManager","disabledButtonsWithoutSelection","TaskbarElement","dataState","currentButtons","refreshBtnIndex","selectedRecord","taskbarTobeAdded","buttonsToRemove","updatedButtons","button","currentButton","hasSelectedRecord","anexoSistemaCrudConfig","snkAttachCss","RESOURCE_ID","DATA_UNIT_NAME","GRID_LEGACY_CONFIG_NAME","LINKORFILE_COLUMN_NAME","SnkAttach","hostRef","registerInstance","createEvent","taskbar","cancelationConfirmed","newRegisterKey","oldRegisterKey","anexoSistemaFetcher","params","chave","forceDownload","DataUnitFetcher","gridValidateForm","DataUnit","InMemoryLoader","gridColumns","column","fieldName","field","detail","h","el"],"mappings":"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","x_google_ignoreList":[0]}
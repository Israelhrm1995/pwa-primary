{"version":3,"file":"snk-exporter-email-sender.entry-CMuld1pn.js","sources":["../../node_modules/@sankhyalabs/sankhyablocks/dist/esm/snk-exporter-email-sender.entry.js"],"sourcesContent":["import { h, r as registerInstance, g as getElement } from './index-479e1293.js';\nimport { ElementIDUtils } from '@sankhyalabs/core';\nimport { ModalAction } from '@sankhyalabs/ezui/dist/collection/components/ez-modal-container';\n\nconst EmailInfoStep = ({ getMessage, changeInfo, data }) => {\n  const { format, email } = data || {};\n  return h(\"div\", null,\n    h(\"ez-text-input\", Object.assign({ label: `${getMessage(\"snkExporter.emailSenderInfoStep_sendTo\")} (obrigatório) *`, value: email === null || email === void 0 ? void 0 : email.to, onEzChange: evt => { var _a; return changeInfo(\"to\", (_a = evt.detail) === null || _a === void 0 ? void 0 : _a.trim()); } }, { [ElementIDUtils.DATA_ELEMENT_ID_ATTRIBUTE_NAME]: `${ElementIDUtils.getInternalIDInfo(\"sendTo\")}` })),\n    h(\"ez-text-input\", Object.assign({ label: `${getMessage(\"snkExporter.emailSenderInfoStep_subject\")} (obrigatório) *`, value: email === null || email === void 0 ? void 0 : email.subject, onEzChange: evt => { var _a; return changeInfo(\"subject\", (_a = evt.detail) === null || _a === void 0 ? void 0 : _a.trim()); } }, { [ElementIDUtils.DATA_ELEMENT_ID_ATTRIBUTE_NAME]: `${ElementIDUtils.getInternalIDInfo(\"subject\")}` })),\n    h(\"ez-text-area\", Object.assign({ label: getMessage(\"snkExporter.emailSenderInfoStep_message\"), value: email === null || email === void 0 ? void 0 : email.message, onEzChange: evt => changeInfo(\"message\", evt.detail) }, { [ElementIDUtils.DATA_ELEMENT_ID_ATTRIBUTE_NAME]: `${ElementIDUtils.getInternalIDInfo(\"message\")}` })),\n    ((email === null || email === void 0 ? void 0 : email.attachments) || [])\n      .map((file, index) => h(\"ez-file-item\", Object.assign({ class: \"ez-padding-bottom--large\", fileName: `${file.name}.${format}`, fileSize: file.size, canRemove: false }, { [ElementIDUtils.DATA_ELEMENT_ID_ATTRIBUTE_NAME]: `${ElementIDUtils.getInternalIDInfo(\"fileItem_\") + (index + 1)}` }))));\n};\n\nconst OptionsStep = ({ getMessage, changeInfo, data }) => {\n  const selectionCount = (data === null || data === void 0 ? void 0 : data.selectedRows) || 0;\n  const formatOptions = [\n    { label: getMessage(\"snkExporter.emailSenderOptStep_formatPDF\"), value: \"pdf\" },\n    { label: getMessage(\"snkExporter.emailSenderOptStep_formatXLS\"), value: \"xls\" }\n  ];\n  const typeOptions = [\n    { label: getMessage(\"snkExporter.emailSenderOptStep_allData\"), value: \"all\" },\n    { label: getMessage(\"snkExporter.emailSenderOptStep_currentPage\"), value: \"page\" },\n  ];\n  if (selectionCount > 0) {\n    const label = getMessage(selectionCount > 1 ? \"snkExporter.emailSenderOptStep_someRecords\" : \"snkExporter.emailSenderOptStep_oneRecord\", { SELECTION_COUNT: selectionCount });\n    typeOptions.push({\n      label,\n      value: \"selection\"\n    });\n  }\n  return h(\"div\", null,\n    h(\"ez-radio-button\", Object.assign({ class: \"ez-margin-bottom--large\" }, { [ElementIDUtils.DATA_ELEMENT_ID_ATTRIBUTE_NAME]: `${ElementIDUtils.getInternalIDInfo(\"formato\")}` }, { label: getMessage(\"snkExporter.emailSenderOptStep_lblFormat\"), direction: \"horizontal\", value: data === null || data === void 0 ? void 0 : data.format, onEzChange: evt => changeInfo(\"format\", evt.detail), options: formatOptions })),\n    h(\"ez-radio-button\", Object.assign({ class: \"ez-margin-bottom--large\" }, { [ElementIDUtils.DATA_ELEMENT_ID_ATTRIBUTE_NAME]: `${ElementIDUtils.getInternalIDInfo(\"type\")}` }, { label: getMessage(\"snkExporter.emailSenderOptStep_export\"), value: (data === null || data === void 0 ? void 0 : data.type) || \"all\", onEzChange: evt => changeInfo(\"type\", evt.detail), options: typeOptions })));\n};\n\nconst SnkExporterEmailSender = class {\n  constructor(hostRef) {\n    registerInstance(this, hostRef);\n    this._stepInfo = [\n      {\n        subTitle: \"snkExporter.emailSenderOptStep_subtitle\",\n        firstButton: \"snkExporter.emailSenderCancelButton\",\n        secondButton: \"snkExporter.emailSenderNextButton\",\n        firstButtonAction: () => this.close(),\n        secondButtonAction: () => this.changeStep(1)\n      },\n      {\n        subTitle: \"snkExporter.emailSenderInfoStep_subtitle\",\n        firstButton: \"snkExporter.emailSenderBackButton\",\n        secondButton: \"snkExporter.emailSenderSendButton\",\n        firstButtonAction: () => this.changeStep(0),\n        secondButtonAction: () => this.send(),\n        secondButtonEnabledTester: () => this.isFilled(),\n        secondButtonClass: \"ez-button--primary\"\n      }\n    ];\n    this._config = undefined;\n    this._opened = false;\n    this._currentStep = 0;\n    this.getMessage = undefined;\n  }\n  open(config) {\n    var _a;\n    this._config = Object.assign(Object.assign({}, config), { format: (_a = config === null || config === void 0 ? void 0 : config.format) !== null && _a !== void 0 ? _a : \"pdf\" });\n    this._opened = true;\n    this.changeStep(0);\n    return new Promise(accept => {\n      this._promiseResolver = accept;\n    });\n  }\n  close() {\n    this._opened = false;\n    return new Promise(accept => {\n      this._promiseResolver = accept;\n    });\n  }\n  getStepMessage(key) {\n    const stepInfo = this._stepInfo[this._currentStep] || {};\n    return this.getMessage(stepInfo[key]);\n  }\n  executeButtonAction(first) {\n    const stepInfo = this._stepInfo[this._currentStep] || {};\n    stepInfo[first ? \"firstButtonAction\" : \"secondButtonAction\"]();\n  }\n  checkButtonEnabled(first) {\n    const stepInfo = this._stepInfo[this._currentStep] || {};\n    const testFunction = stepInfo[first ? \"firstButtonEnabledTester\" : \"secondButtonEnabledTester\"];\n    if (testFunction) {\n      return testFunction();\n    }\n    return true;\n  }\n  changeStep(index) {\n    this._currentStep = index;\n    if (this._viewStack) {\n      this._viewStack.show(this._currentStep);\n    }\n  }\n  send() {\n    const { format, type, email, resolver } = this._config;\n    resolver({ format, type, email, report: undefined });\n  }\n  isFilled() {\n    var _a, _b;\n    return ((_a = this._config.email) === null || _a === void 0 ? void 0 : _a.to) && ((_b = this._config.email) === null || _b === void 0 ? void 0 : _b.subject) ? true : false;\n  }\n  updateEmailInfo(field, value) {\n    this._config = Object.assign(Object.assign({}, this._config), { email: Object.assign(Object.assign({}, this._config.email), { [field]: value }) });\n  }\n  updateConfigInfo(field, value) {\n    this._config = Object.assign(Object.assign({}, this._config), { [field]: value });\n  }\n  getSecondButtonClass() {\n    const stepInfo = this._stepInfo[this._currentStep] || {};\n    return stepInfo[\"secondButtonClass\"] || \"ez-button--secondary\";\n  }\n  render() {\n    ElementIDUtils.addIDInfoIfNotExists(this._element, 'snkExporterEmailSender');\n    return (h(\"ez-popup\", { useHeader: false, size: \"x-small\", heightMode: \"auto\", opened: this._opened }, h(\"ez-modal-container\", { onEzModalAction: (evt) => {\n        if (evt.detail === ModalAction.CLOSE)\n          this.close();\n      }, modalTitle: this.getMessage(\"snkExporter.emailSenderTitle\"), modalSubTitle: this.getStepMessage(\"subTitle\") }, h(\"ez-view-stack\", { ref: ref => this._viewStack = ref }, h(\"stack-item\", null, h(OptionsStep, { getMessage: this.getMessage, data: this._config, changeInfo: (field, value) => this.updateConfigInfo(field, value) })), h(\"stack-item\", null, h(EmailInfoStep, { getMessage: this.getMessage, data: this._config, changeInfo: (field, value) => this.updateEmailInfo(field, value) }))), h(\"div\", { class: \"ez-col ez-col--sd-12 ez-flex--justify-end ez-margin-vertical--small\" }, h(\"ez-button\", Object.assign({ class: \"ez-button--tertiary ez-padding-right--medium\", label: this.getStepMessage(\"firstButton\"), onClick: () => this.executeButtonAction(true), enabled: this.checkButtonEnabled(true) }, { [ElementIDUtils.DATA_ELEMENT_ID_ATTRIBUTE_NAME]: `${ElementIDUtils.getInternalIDInfo(\"firstButton\")}` })), h(\"ez-button\", Object.assign({ class: this.getSecondButtonClass(), label: this.getStepMessage(\"secondButton\"), onClick: () => this.executeButtonAction(false), enabled: this.checkButtonEnabled(false) }, { [ElementIDUtils.DATA_ELEMENT_ID_ATTRIBUTE_NAME]: `${ElementIDUtils.getInternalIDInfo(\"secondButton\")}` }))))));\n  }\n  get _element() { return getElement(this); }\n};\n\nexport { SnkExporterEmailSender as snk_exporter_email_sender };\n"],"names":["EmailInfoStep","getMessage","changeInfo","data","format","email","h","evt","_a","ElementIDUtils","file","index","OptionsStep","selectionCount","formatOptions","typeOptions","label","SnkExporterEmailSender","hostRef","registerInstance","config","accept","key","stepInfo","first","testFunction","type","resolver","_b","field","value","ModalAction","ref","getElement"],"mappings":"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","x_google_ignoreList":[0]}
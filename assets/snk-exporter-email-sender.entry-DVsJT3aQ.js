import{r as c,h as s,g as u}from"./index-ChOtpOHD.js";import{E as o}from"./dataUnitInMemoryLoader-BjgoPaoq.js";import{M as d}from"./modal-action-DYa1rU64.js";import"./modal-button-status-OTEz8c7N.js";const p=({getMessage:e,changeInfo:t,data:n})=>{const{format:a,email:r}=n||{};return s("div",null,s("ez-text-input",Object.assign({label:`${e("snkExporter.emailSenderInfoStep_sendTo")} (obrigatório) *`,value:r==null?void 0:r.to,onEzChange:l=>{var i;return t("to",(i=l.detail)===null||i===void 0?void 0:i.trim())}},{[o.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${o.getInternalIDInfo("sendTo")}`})),s("ez-text-input",Object.assign({label:`${e("snkExporter.emailSenderInfoStep_subject")} (obrigatório) *`,value:r==null?void 0:r.subject,onEzChange:l=>{var i;return t("subject",(i=l.detail)===null||i===void 0?void 0:i.trim())}},{[o.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${o.getInternalIDInfo("subject")}`})),s("ez-text-area",Object.assign({label:e("snkExporter.emailSenderInfoStep_message"),value:r==null?void 0:r.message,onEzChange:l=>t("message",l.detail)},{[o.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${o.getInternalIDInfo("message")}`})),((r==null?void 0:r.attachments)||[]).map((l,i)=>s("ez-file-item",Object.assign({class:"ez-padding-bottom--large",fileName:`${l.name}.${a}`,fileSize:l.size,canRemove:!1},{[o.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${o.getInternalIDInfo("fileItem_")+(i+1)}`}))))},_=({getMessage:e,changeInfo:t,data:n})=>{const a=(n==null?void 0:n.selectedRows)||0,r=[{label:e("snkExporter.emailSenderOptStep_formatPDF"),value:"pdf"},{label:e("snkExporter.emailSenderOptStep_formatXLS"),value:"xls"}],l=[{label:e("snkExporter.emailSenderOptStep_allData"),value:"all"},{label:e("snkExporter.emailSenderOptStep_currentPage"),value:"page"}];if(a>0){const i=e(a>1?"snkExporter.emailSenderOptStep_someRecords":"snkExporter.emailSenderOptStep_oneRecord",{SELECTION_COUNT:a});l.push({label:i,value:"selection"})}return s("div",null,s("ez-radio-button",Object.assign({class:"ez-margin-bottom--large"},{[o.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${o.getInternalIDInfo("formato")}`},{label:e("snkExporter.emailSenderOptStep_lblFormat"),direction:"horizontal",value:n==null?void 0:n.format,onEzChange:i=>t("format",i.detail),options:r})),s("ez-radio-button",Object.assign({class:"ez-margin-bottom--large"},{[o.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${o.getInternalIDInfo("type")}`},{label:e("snkExporter.emailSenderOptStep_export"),value:(n==null?void 0:n.type)||"all",onEzChange:i=>t("type",i.detail),options:l})))},g=class{constructor(e){c(this,e),this._stepInfo=[{subTitle:"snkExporter.emailSenderOptStep_subtitle",firstButton:"snkExporter.emailSenderCancelButton",secondButton:"snkExporter.emailSenderNextButton",firstButtonAction:()=>this.close(),secondButtonAction:()=>this.changeStep(1)},{subTitle:"snkExporter.emailSenderInfoStep_subtitle",firstButton:"snkExporter.emailSenderBackButton",secondButton:"snkExporter.emailSenderSendButton",firstButtonAction:()=>this.changeStep(0),secondButtonAction:()=>this.send(),secondButtonEnabledTester:()=>this.isFilled(),secondButtonClass:"ez-button--primary"}],this._config=void 0,this._opened=!1,this._currentStep=0,this.getMessage=void 0}open(e){var t;return this._config=Object.assign(Object.assign({},e),{format:(t=e==null?void 0:e.format)!==null&&t!==void 0?t:"pdf"}),this._opened=!0,this.changeStep(0),new Promise(n=>{this._promiseResolver=n})}close(){return this._opened=!1,new Promise(e=>{this._promiseResolver=e})}getStepMessage(e){const t=this._stepInfo[this._currentStep]||{};return this.getMessage(t[e])}executeButtonAction(e){(this._stepInfo[this._currentStep]||{})[e?"firstButtonAction":"secondButtonAction"]()}checkButtonEnabled(e){const n=(this._stepInfo[this._currentStep]||{})[e?"firstButtonEnabledTester":"secondButtonEnabledTester"];return n?n():!0}changeStep(e){this._currentStep=e,this._viewStack&&this._viewStack.show(this._currentStep)}send(){const{format:e,type:t,email:n,resolver:a}=this._config;a({format:e,type:t,email:n,report:void 0})}isFilled(){var e,t;return!!(!((e=this._config.email)===null||e===void 0)&&e.to&&(!((t=this._config.email)===null||t===void 0)&&t.subject))}updateEmailInfo(e,t){this._config=Object.assign(Object.assign({},this._config),{email:Object.assign(Object.assign({},this._config.email),{[e]:t})})}updateConfigInfo(e,t){this._config=Object.assign(Object.assign({},this._config),{[e]:t})}getSecondButtonClass(){return(this._stepInfo[this._currentStep]||{}).secondButtonClass||"ez-button--secondary"}render(){return o.addIDInfoIfNotExists(this._element,"snkExporterEmailSender"),s("ez-popup",{useHeader:!1,size:"x-small",heightMode:"auto",opened:this._opened},s("ez-modal-container",{onEzModalAction:e=>{e.detail===d.CLOSE&&this.close()},modalTitle:this.getMessage("snkExporter.emailSenderTitle"),modalSubTitle:this.getStepMessage("subTitle")},s("ez-view-stack",{ref:e=>this._viewStack=e},s("stack-item",null,s(_,{getMessage:this.getMessage,data:this._config,changeInfo:(e,t)=>this.updateConfigInfo(e,t)})),s("stack-item",null,s(p,{getMessage:this.getMessage,data:this._config,changeInfo:(e,t)=>this.updateEmailInfo(e,t)}))),s("div",{class:"ez-col ez-col--sd-12 ez-flex--justify-end ez-margin-vertical--small"},s("ez-button",Object.assign({class:"ez-button--tertiary ez-padding-right--medium",label:this.getStepMessage("firstButton"),onClick:()=>this.executeButtonAction(!0),enabled:this.checkButtonEnabled(!0)},{[o.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${o.getInternalIDInfo("firstButton")}`})),s("ez-button",Object.assign({class:this.getSecondButtonClass(),label:this.getStepMessage("secondButton"),onClick:()=>this.executeButtonAction(!1),enabled:this.checkButtonEnabled(!1)},{[o.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${o.getInternalIDInfo("secondButton")}`})))))}get _element(){return u(this)}};export{g as snk_exporter_email_sender};

import{r as T,c as y,O as u,E as I,h as d,j as B,A as U,L as A,d as R,H as E,g as M,k as N,M as $,l as z,m as V,D as c,t as g,S as j}from"./index-CxFxc26b.js";import{E as H}from"./EzScrollDirection-BLSFLxtp.js";import{C as k}from"./ConfigStorage-cf578768-CIb4C9-y.js";import{F as h}from"./filter-item-type.enum-d45e026f-B41QHsvD.js";import{D as q,F as X}from"./index-8acbae97-DxLtPl40.js";import{F as P}from"./filterNumberVariation-8cee02ea-CN_9h3IK.js";import{A as D}from"./FormLayout-DWDL0qnG.js";import{P as O}from"./PersonalizedFilterUtils-2db38ff2-C2kMqHFO.js";import{M as L}from"./modal-action-DYa1rU64.js";import"./modal-button-status-OTEz8c7N.js";import{F as _}from"./filter-type.enum-f6a8fe23-UC9SJhBV.js";import{A as x}from"./default-filters-50105e43-B_LQr6Mx.js";import"./form-config-fetcher-e623539b-VBVHUPpx.js";import"./DataFetcher-db08cad0-DvO7h7yr.js";import"./PrintUtils-3e4ff0f5-BzI1KebB.js";const K=e=>{switch(e.type){case h.DEFAULT_FILTER:return Z(e);case h.BINARY_SELECT:return W(e);case h.MULTI_SELECT:return G(e);case h.MULTI_LIST:return Y(e);case h.PERIOD:return te(e);case h.SEARCH:return ie(e);case h.TEXT:return se(e);case h.NUMBER:return re(e);case h.PERSONALIZED:return ne(e);case h.CHECK_BOX_LIST:return Q(e);default:return}};function Z(e){return{name:e.id,expression:e.props.expression,params:[]}}function W(e){const{id:t,value:i,props:s}=e,l=s.options.find(f=>f.name===i);return{name:t,expression:l.expression,params:[]}}function G(e){const{id:t,value:i,props:s}=e;return{name:t,expression:s.expression,params:[{name:t,dataType:c.TEXT,value:i}]}}function Y(e){const{id:t,value:i,props:s}=e,r=ee(i);if(r.length>0)return{name:t,expression:s.expression,params:[{name:t,dataType:c.TEXT,value:JSON.stringify(r)}]}}function Q(e){var t;const{id:i,value:s,props:r}=e,l=Object.entries(s??{}).filter(([a,n])=>n===!0).map(([a,n])=>a),f=(t=r.options)===null||t===void 0?void 0:t.filter(a=>l.includes(a.name));return{name:i,expression:J(f),params:[]}}function J(e){let t="";return e.forEach((i,s)=>{var r;t+=` ${s>0?(r=i.operand)!==null&&r!==void 0?r:"OR":""} ${i.expression}`}),t.trim()}function ee(e){var t,i;return((i=(t=e==null?void 0:e.elements)!==null&&t!==void 0?t:e==null?void 0:e.members)!==null&&i!==void 0?i:e).filter(r=>r==null?void 0:r.check).map(({id:r})=>Number.isNaN(+r)?String(r):Number(r))}function te(e){const{id:t,value:i,props:s}=e;let{end:r,start:l}=i;typeof r=="string"&&(r=new Date(r)),typeof l=="string"&&(l=new Date(l));const f=[];let a;return r&&l?(a=s.expression.fullfill,f.push({name:`${t}.START`,dataType:c.DATE,value:g(c.DATE,l)},{name:`${t}.END`,dataType:c.DATE,value:g(c.DATE,r)})):l?(a=s.expression.onlystart,f.push({name:t,dataType:c.DATE,value:g(c.DATE,l)})):(a=s.expression.onlyend,f.push({name:t,dataType:c.DATE,value:g(c.DATE,r)})),{name:t,expression:a,params:f}}function ie(e){const{id:t,value:i,props:s}=e,r=s.expression;return{name:t,expression:r,params:[{name:t,dataType:c.TEXT,value:g(c.TEXT,i==null?void 0:i.value)}]}}function se(e){let{id:t,value:i,props:s}=e;const r=s.expression;return j.isEmpty(s.likeAs)||(i=le(i,s.likeAs)),{name:t,expression:r,params:[{name:t,dataType:c.TEXT,value:g(c.TEXT,i)}]}}function re(e){const{id:t,value:i,props:s}=e;if(s.variation===P.INTERVAL){const{start:f,end:a}=i??{start:0,end:0};if(!isNaN(f)&&!isNaN(a))return{name:t,expression:s.intervalExpression.fullfill,params:[{name:`${t}.START`,dataType:c.NUMBER,value:g(c.NUMBER,f)},{name:`${t}.END`,dataType:c.NUMBER,value:g(c.NUMBER,a)}]};if(!isNaN(f))return{name:t,expression:s.intervalExpression.onlystart,params:[{name:t,dataType:c.NUMBER,value:g(c.NUMBER,f)}]};if(!isNaN(a))return{name:t,expression:s.intervalExpression.onlyend,params:[{name:t,dataType:c.NUMBER,value:g(c.NUMBER,a)}]}}const l=s.expression;return{name:t,expression:l,params:[{name:t,dataType:c.NUMBER,value:g(c.NUMBER,i)}]}}function le(e,t){return t==="CONTANIS"?`%${e}%`:t==="STARTS_WITH"?`${e}%`:t==="ENDS_WITH"?`%${e}`:e}function ne(e){const{id:t,groupedItems:i=[]}=e,r=i.filter(a=>!!a.visible).map(a=>{var n;const o=a.props.expression,p=(((n=a.props.personalizedFilter)===null||n===void 0?void 0:n.parameters)||[]).map((b,F)=>{const C=Array.from(a.value||0),v=b.dataType;let m=F>=0&&F<C.length?C[F]:null;return m!=null&&typeof m=="object"&&"value"in m&&(m=m.value),m==null&&v===c.BOOLEAN&&(m=!1),{name:b.name,dataType:v,value:typeof m=="string"?m:g(v,m)}});return{expression:o,name:a.id,params:p}}),l=r.map(a=>`(${a.expression})`).join(` ${X.AND} `),f=r.flatMap(a=>a.params);return{name:t,expression:l,params:f}}class ae{constructor({filterConfig:t,configName:i,onComplete:s,getMessage:r,disablePersonalizedFilter:l,onAddPersonalizedFilter:f,onEditPersonalizedFilter:a,onDeletePersonalizedFilter:n}){this._filterConfig=t,this._configName=i,this._onComplete=s,this._getMessage=r,this._disablePersonalizedFilter=l,this._addPersonalizedFilterFn=f,this._editPersonalizedFilterFn=a,this._onDeletePersonalizedFilter=n}applyFilters(t){this._onComplete(t),this._closeModal()}buildFilterModal(){const t=document.createElement("snk-filter-modal");return t.className="ez-size-height--full",t.filters=this._filterConfig,t.configName=this._configName,t.disablePersonalizedFilter=this._disablePersonalizedFilter,t.getMessage=this._getMessage.bind(this),t.applyFilters=this.applyFilters.bind(this),t.closeModal=()=>this._closeModal(),t.addPersonalizedFilter=i=>this._addPersonalizedFilterFn(i),t.editPersonalizedFilter=(i,s)=>this._editPersonalizedFilterFn(i,s),t.deletePersonalizedFilter=(i,s,r)=>this._onDeletePersonalizedFilter(i,s,r),t}async showModal(){const i={content:this.buildFilterModal(),position:"right",heightMode:"full",closeOutsideClick:!1,useScrimLight:!0};this._closeModal=await D.showModal(i)}async closeModal(){this._closeModal()}}const oe='.sc-snk-filter-bar-h{display:grid;grid-template-columns:1fr minmax(100px, 100%) 1fr 1fr;--snk-personalized-filter--z-index:var(--elevation--20, 20);--snk-personalized-filter--background-color:var(--background--xlight, #fff)}.snk-filter-bar__title.sc-snk-filter-bar{max-width:260px;display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-size:16px;font-family:var(--font-pattern, Arial);font-weight:var(--text-weight--large, 600);color:var(--color--title-primary, #2B3A54);margin-top:12px}[data-mode="hidden"].sc-snk-filter-bar-h{width:0px;height:0px}[data-mode="button"].sc-snk-filter-bar-h{grid-template-columns:1fr;width:fit-content}.snk-filter__popover-container.sc-snk-filter-bar{display:flex;cursor:auto}.filter-bar__personalized-filter.sc-snk-filter-bar{display:flex;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;overflow:auto;z-index:var(--snk-personalized-filter--z-index);background-color:var(--snk-personalized-filter--background-color)}.snk-filter__popover.sc-snk-filter-bar{display:flex;flex-direction:column;position:absolute;width:fit-content;height:fit-content;min-width:265px;background-color:var(--background--xlight, #fff);border-radius:var(--border--radius-medium, 12px);box-shadow:var(--shadow, 0px 0px 16px 0px #000)}.snk-filter-item__editor-header.sc-snk-filter-bar{flex-grow:1;font-weight:var(--text-weight--medium, 400);color:var(--color--title-primary, #2B3A54)}.snk-filter__popover-rule.sc-snk-filter-bar{border-style:solid;border-color:var(--color--disable-secondary, #F2F5F8);border-radius:1px;border-width:1px;width:100%}.editor__ez-check.sc-snk-filter-bar{--ez-check__label--padding-left:0}.snk-filter-item__editor-header-button.sc-snk-filter-bar{cursor:pointer;background-color:transparent;border:none;padding:3px;outline-color:var(--color--primary)}.snk-filter-bar__divider.sc-snk-filter-bar{margin-bottom:var(--space--small);height:80%}.snk-filter-bar__filter-item-container.sc-snk-filter-bar{display:flex;align-items:start}.snk-filter-bar__scroller.sc-snk-filter-bar .sc-snk-filter-bar:first-child{margin-left:var(--space-extra-small, 3px)}.snk-filter-bar__filter-list-items-container.sc-snk-filter-bar{overflow-y:auto;max-height:360px;margin-top:var(--space--small, 6px)}.snk-filter-bar__filter-list-item.sc-snk-filter-bar{cursor:pointer;border-radius:var(--border--radius-small, 6px);border:none;background-color:transparent}.snk-filter-bar__filter-list-item__label.sc-snk-filter-bar{color:var(--title--primary)}.snk-filter-bar__filter-list-item__label--secondary.sc-snk-filter-bar{color:var(--text--primary)}.snk-filter-bar__filter-list-item__icon.sc-snk-filter-bar{--ez-icon--color:var(--title--primary)}.snk-filter-bar__filter-list-item__icon--secondary.sc-snk-filter-bar{--ez-icon--color:var(--text--secondary)}.snk-filter-bar__filter-list-item.sc-snk-filter-bar:focus-visible{outline:none;background-color:var(--background--medium)}.snk-filter-bar__filter-list-item.sc-snk-filter-bar:hover{background-color:var(--background--medium)}.snk-filter-bar__filter-list-items-container--empty.sc-snk-filter-bar{width:100%;height:100px;display:flex;justify-content:center;align-self:center;align-items:center}.snk-filter-bar__filter-list-items-button--active.sc-snk-filter-bar{position:relative}.snk-filter-bar__filter-list-items-button--active.sc-snk-filter-bar::after{display:flex;position:absolute;content:"";width:8px;height:8px;top:7px;left:17px;background-color:var(--icon--alert--color, #008561);border-radius:50%}.snk-filter-bar__filter-modal-item.sc-snk-filter-bar{--modal-item-border-width:2px;display:flex;flex-direction:row;margin-left:var(--modal-item-border-width);border-radius:var(--border--radius-medium, 12px);background-color:var(--background--medium, #f0f3f7);border:none;width:100%}.snk-filter-bar__filter-modal-item.sc-snk-filter-bar:focus-visible{outline:var(--color--primary) solid var(--modal-item-border-width)}.snk-filter-bar__filter-modal-item__check.sc-snk-filter-bar{width:auto}.snk-filter-bar__filter-modal-item__label.sc-snk-filter-bar{font-weight:var(--text-weight--medium)}.snk-filter-bar__filter-modal-content.sc-snk-filter-bar{display:grid;grid-template-rows:auto auto 1fr auto;width:99%;height:100%}',de=class{constructor(e){T(this,e),this.configUpdated=y(this,"configUpdated",7),this._updateSequence=[],this._loadingPending=!1,this._configUpdated=!1,this._firstLoad=!0,this._pendingVariables=!1,this._isDefaultFilter=!1,this._customfiltersToBeUpdated=[],this._resolveLoading=void 0,this._calculateSortIndex=t=>{if(!t.visible)return 0;if(t.hardFixed)return 1e6;let i=t.fixed?1e5:0;return i+=this.hasValidValue(t)?1e4:0,i+=this._updateSequence.lastIndexOf(t.id)+1,i},this._filtersComparator=(t,i)=>this._calculateSortIndex(i)-this._calculateSortIndex(t),this.enableLockManagerLoadingComp=!1,this.customFilterBarConfig=void 0,this.dataUnit=void 0,this.title=void 0,this.configName=void 0,this.resourceID=void 0,this.mode="regular",this.filterConfig=void 0,this.messagesBuilder=void 0,this.disablePersonalizedFilter=void 0,this.filterBarLegacyConfigName=void 0,this.autoLoad=void 0,this.afterApplyConfig=void 0,this.allowDefault=void 0,this.scrollerLocked=!1,this.showPersonalizedFilter=!1,this.personalizedFilterId=void 0}hasValidValue(e){return e.value===void 0||e.value===null?!1:Array.isArray(e.value)?e.value.some(t=>t.check===!0):!0}observeFilterConfig(e,t){u.equals(e,t)||this.handleFilterConfigsChanged(t,e)}handleFilterConfigsChanged(e,t){if(e!=null&&t==null)this._loadingPending=!0,this._configUpdated=!0;else{const i=new Map(e?e.map(s=>[s.id,s]):void 0);i.size===0&&t.length>0?(this._loadingPending=!0,this._configUpdated=!1):t.forEach(s=>{const r=i.get(s.id);if(r!=null){if(this._configUpdated=this._configUpdated||u.objectToString(r)!=u.objectToString(s),this._loadingPending=this._loadingPending||u.objectToString(r.value)!==u.objectToString(s.value),!this._loadingPending){const l=u.objectToString(r.groupedItems)!=u.objectToString(s.groupedItems);this._configUpdated=this._configUpdated||l,this._loadingPending=this._loadingPending||l}}else this._configUpdated=!0,this._loadingPending=this._loadingPending||s.value!=null})}(this._loadingPending||this._configUpdated)&&this.configUpdated.emit(t),this.processAfterUpdateConfig()}async reload(){this.loadConfigFromStorage(!0)}async getFilterItem(e){const t=this.filterConfig.find(i=>i.id===e);return Promise.resolve(u.copy(t))}async updateFilterItem(e){return this.filterConfig.findIndex(i=>i.id===e.id)==-1?(console.warn("[SnkFilterBar.updateFilterItem] FilterItem não encontrado, o mesmo não será atualizado."),Promise.resolve()):(this._loadingPending=!0,this.updateFilter(e),Promise.resolve())}async addFilterItem(e){return this.filterConfig.findIndex(i=>i.id===e.id)>-1?(console.warn("[SnkFilterBar.addFilterItem] FilterItem já existe , o mesmo não será adicionado novamente."),Promise.resolve()):(this.filterConfig.push(e),this._loadingPending=!0,this.updateFilter(e),Promise.resolve())}async removeFilterItem(e){const t=this.filterConfig.findIndex(s=>s.id===e);if(t==-1)return console.warn("[SnkFilterBar.removeFilterItem] FilterItem não encontrado"),Promise.resolve(void 0);const i=this.filterConfig[t];return this.filterConfig=this.filterConfig.filter(s=>s.id!==e),Promise.resolve(i)}componentDidLoad(){if(this._element){const e={dataUnit:this.dataUnit};I.addIDInfo(this._element,null,e)}}processPendingFilter(){if(this._pendingVariables){const e=this._element.querySelector("#filter-PERSONALIZED_FILTER_GROUP");e&&e.showUp(!0).then(()=>{this.processAfterUpdateConfig()})}else this.processAfterUpdateConfig()}getPersonalizedFilterItem(){return this.filterConfig.find(e=>e.type===h.PERSONALIZED)}async processAfterUpdateConfig(){var e;if(this._loadingPending){if(await this._application.isLoadedByPk()&&!this._configUpdated)return;const t=this.getPersonalizedFilterItem();if(this._pendingVariables=!O.validateVariableValues(t),this._pendingVariables)return;this._loadingPending=!1,this.doLoadData(this.dataUnit.getLastLoadRequest()!=null)}this._configUpdated&&(this._configUpdated=!1,k.saveFilterBarConfig(this.filterConfig,this.configName,this.resourceID),(e=this.afterApplyConfig)===null||e===void 0||e.call(this))}async doLoadData(e=!1){try{if(this._firstLoad&&this.autoLoad===!1||this._firstLoad&&!e&&this.autoLoad===void 0&&!await this._application.getBooleanParam("global.carregar.registros.iniciar.tela"))return;this.dataUnit.loadData(void 0,void 0,!0)}finally{this._firstLoad=!1}}getMessage(e,t,i){var s;return this.messagesBuilder==null&&this._application&&(this.messagesBuilder=this._application.messagesBuilder),((s=this.messagesBuilder)===null||s===void 0?void 0:s.getMessage(e,t))||i}getFilter(e){var t;const i=[];return(t=this.filterConfig)===null||t===void 0||t.filter(s=>this.isActiveFilter(s)).forEach(s=>{const r=K(s);r&&i.push(r)}),i}isActiveFilter(e){return e.type===h.DEFAULT_FILTER?!0:this.filterActiveFilter(e)&&(e.groupedItems||e.value!=null)}async registryFilterProvider(){this.dataUnit.addFilterProvider(this),this.filterConfig&&await this.doLoadData()}itemFocused(e){this._element.querySelectorAll("snk-filter-item,snk-filter-list").forEach(t=>{t.id===e?t.tagName.toLowerCase()==="snk-filter-item"&&t.getClientRects()[0].x<0&&t.scrollIntoView({behavior:"auto",inline:"nearest"}):t.hideDetail()})}filterActiveFilter(e){return e.visible||e.removalBlocked}filterPersonalizedItems(e){return e.type===h.PERSONALIZED}getPersonalizedFilterVariableItems(){return this.filterConfig.filter(this.filterPersonalizedItems).map(e=>{const t=`filter-${e.id}`;return d("snk-filter-item",{key:e.id,id:t,config:Object.assign({},e),onFocusin:()=>this.itemFocused(t),onVisibleChanged:i=>this.scrollerLocked=i.detail,onFilterChange:i=>this.updateFilter(i.detail),getMessage:(i,s)=>this.getMessage(i,s),showChips:!1})})}getFilterItems(){const e=[],t=[];this.filterConfig.sort((s,r)=>this._filtersComparator(s,r)).filter(this.filterActiveFilter).forEach((s,r)=>{s=u.copy(s);const l=`filter-${s.id}`,f=d("snk-filter-item",{onVisibleChanged:a=>this.scrollerLocked=a.detail,onFilterChange:a=>this.updateFilter(a.detail),onFocusin:()=>this.itemFocused(l),id:l,config:s,class:r>0?"ez-padding-left--medium":"",getMessage:(a,n)=>this.getMessage(a,n),key:s.id});return s.fixed||s.hardFixed?e.push(f):t.push(f),f});const i=[];return i.push(...e),e.length>0&&t.length>0&&i.push(d("hr",{class:"ez-divider-vertical ez-divider--dark ez-margin-left--medium snk-filter-bar__divider"})),i.push(...t),i}calculateUpdateSequence(e){e&&(this._updateSequence=this._updateSequence.filter(t=>e.id!==t),this._updateSequence.push(e.id))}normalizeItem(e){const t=Object.assign({},e);return["props","value","hardFixed","fixed"].forEach(s=>{t[s]==null&&delete t[s]}),e.value===""&&delete e.value,t}updateFilter(e){this.filterConfig=this.filterConfig.map(t=>(e=this.normalizeItem(e),t.id===e.id?(u.objectToString(t)!=u.objectToString(e)&&this.calculateUpdateSequence(e),e):t)).sort((t,i)=>this._filtersComparator(t,i))}loadPermitions(){this._application.isUserSup().then(e=>this.allowDefault=e)}addFilterBarLegacyConfigName(){this.filterBarLegacyConfigName&&k.addFilterBarLegacyConfig(this.configName,this.filterBarLegacyConfigName)}async loadConfigFromStorage(e){try{e&&await k.deleteFilterBarConfigCache(this.configName,this.resourceID);let t;this.customFilterBarConfig?t=await this.customFilterBarConfig(this.configName,this.resourceID,{contextURI:this.dataUnit.name}):t=await k.loadFilterBarConfig(this.configName,this.resourceID,{contextURI:this.dataUnit.name}),this.filterConfig=t.map(i=>this.normalizeItem(i)),this.filterConfig.sort((i,s)=>this._filtersComparator(i,s))}catch(t){throw new B(this.getMessage("snkFilterBar.failToLoadConfig"),t)}}async attachDataUnit(){if(this.dataUnit==null){let e=this._element.parentElement;for(;e;)if(e.tagName.toUpperCase()==="SNK-DATA-UNIT"){const t=e;this.dataUnit=t.dataUnit,this.dataUnit?await this.registryFilterProvider():t.addEventListener("dataUnitReady",async i=>{this.dataUnit=i.detail,await this.registryFilterProvider()});break}e=e.parentElement}else await this.registryFilterProvider()}filterChangeListener(e){this.updateFilter(e.detail)}async showFilterModal(){const e=s=>{var r;this.filterConfig=s.map(this.normalizeItem).sort((l,f)=>this._filtersComparator(l,f)),(r=this.afterApplyConfig)===null||r===void 0||r.call(this)};let t=u.copy(this.filterConfig);t=t.sort((s,r)=>s.originOrder-r.originOrder);const i={filterConfig:t,configName:this.configName,onComplete:e,disablePersonalizedFilter:this.disablePersonalizedFilter,getMessage:(s,r)=>this.getMessage(s,r),onAddPersonalizedFilter:s=>this.addPersonalizedFilter(s),onEditPersonalizedFilter:(s,r)=>this.editPersonalizedFilter(s,r),onDeletePersonalizedFilter:(s,r,l)=>this.deletePersonalizedFilter(s,h.PERSONALIZED,r,l)};this._filterModalFactory=new ae(i),await this._filterModalFactory.showModal()}addPersonalizedFilter(e=!1){this._filterModalFactory.closeModal(),this._isDefaultFilter=e,this.personalizedFilterId=void 0,this.showPersonalizedFilter=!0,window.requestAnimationFrame(()=>{this._elPersonalizedFilter.createPersonalizedFilter()})}editPersonalizedFilter(e,t=!1){this._filterModalFactory.closeModal(),this._isDefaultFilter=t,this.showPersonalizedFilter=!0,this.personalizedFilterId=e}deletePersonalizedFilter(e,t,i,s=!1){if(s){k.removeDefaultFilter(e,this.resourceID,i),this._isDefaultFilter=!1;return}t===h.PERSONALIZED&&k.removePersonalizedFilter(e,this.resourceID,i)}handleHidePersonalizedFilter(e){e?this.loadConfigFromStorage().then(()=>{this.hidePersonalizedFilter()}):this.hidePersonalizedFilter()}hidePersonalizedFilter(){this.personalizedFilterId=void 0,this.showPersonalizedFilter=!1,this._isDefaultFilter=!1}async componentWillLoad(){var e;try{if(this._application=U.getContextValue("__SNK__APPLICATION__"),await this.attachDataUnit(),this._application){if(this._application.enableLockManagerLoadingApp&&this.enableLockManagerLoadingComp){const t=A.addLockManagerCtxId(this._element);this._resolveLoading=A.lock(t,R.APP_LOADING)}await Promise.all([this.loadPermitions(),this.addFilterBarLegacyConfigName(),this.loadConfigFromStorage()])}}finally{(e=this._resolveLoading)===null||e===void 0||e.call(this)}}componentDidRender(){this.processPendingFilter()}render(){if(!(!this.dataUnit||!this.filterConfig||this.filterConfig.length===0))return this.showPersonalizedFilter?d("snk-personalized-filter",{class:"filter-bar__personalized-filter",filterId:this.personalizedFilterId,ref:e=>this._elPersonalizedFilter=e,isDefaultFilter:this._isDefaultFilter,onEzCancel:()=>this.handleHidePersonalizedFilter(!1),onEzAfterSave:()=>this.handleHidePersonalizedFilter(!0),entityUri:this.dataUnit.name,configName:this.configName,resourceID:this.resourceID}):this.mode!=="regular"?d(E,{"data-mode":this.mode},this.getPersonalizedFilterVariableItems(),this.mode==="button"&&d("ez-button",{class:"ez-margin-left--medium",size:"small",label:this.getMessage("snkFilterBar.filters",void 0,"Filtros"),onClick:this.showFilterModal.bind(this)})):d(E,null,d("div",null,d("span",{class:"snk-filter-bar__title",title:this.title,"data-tooltip":this.title,"data-flow":"bottom"},this.title)),d("ez-scroller",{class:"snk-filter-bar__scroller",direction:H.HORIZONTAL,activeShadow:!0,locked:this.scrollerLocked},d("section",{class:"snk-filter-bar__filter-item-container"},this.getFilterItems())),d("ez-button",{class:"ez-padding-left--medium ez-margin-top--extra-small",size:"small",label:this.getMessage("snkFilterBar.filters",void 0,"Filtros"),onClick:this.showFilterModal.bind(this)},d("ez-icon",{slot:"leftIcon",iconName:"plus",class:"ez-padding-right--small"})))}get _element(){return M(this)}static get watchers(){return{filterConfig:["observeFilterConfig"]}}};de.style=oe;const fe="ez-popover-core.sc-snk-filter-item{--ez-popover__box--z-index:var(--elevation--20, 20);--ez-popover__box--overlay-z-index:var(--elevation--16, 16)}",he=class{constructor(e){T(this,e),this.visibleChanged=y(this,"visibleChanged",7),this.filterChange=y(this,"filterChange",3),this.detailIsVisible=void 0,this.config=void 0,this.getMessage=void 0,this.showChips=!0}observeDetailIsVisible(e){this.visibleChanged.emit(e)}filterChangeListener(){this.hideDetail()}async showUp(e=!1){var t;this._filterItemElement.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"}),e&&(await((t=this._chipElement)===null||t===void 0?void 0:t.setBlur()),await this._popover.showUnder(this._chipElement))}async hideDetail(){await this._popover.hide()}getConfigChanges(){var e;const t=this.config;!((e=t.groupedItems)===null||e===void 0)&&e.length&&(t.visible=!1,t.groupedItems=t.groupedItems.map(r=>Object.assign(Object.assign({},r),{visible:!1})));const s=t.type===h.MULTI_LIST&&Array.isArray(t.value)?t.value.map(r=>Object.assign(Object.assign({},r),{check:!1})):void 0;return Object.assign(Object.assign({},t),{value:s})}clearFilter(e){if(e==null||e.stopPropagation(),this.canClearFilter()){const t=this.getConfigChanges();this.filterChange.emit(t)}else this.togglePopover()}async togglePopover(e){e==null||e.preventDefault(),e==null||e.stopPropagation(),this.detailIsVisible?await this.hideDetail():await this.showUp(!0)}getLabel(e=!1){var t,i;const{type:s,value:r,label:l,props:f,groupedItems:a=[]}=this.config;if(r||a.length){if(s===h.BINARY_SELECT){const[n,o]=f.options,p=this.getMessage("snkFilterBar.binarySelectTooltip");if(n.name===r)return e?`${p} ${String(n.label).toLowerCase()}`:n.label;if(o.name===r)return e?`${p} ${String(o.label).toLowerCase()}`:o.label}if(s===h.MULTI_SELECT){const n=f.options.find(o=>o.value===r);return`${l}: ${n.label}`}if(s===h.PERIOD){let{end:n,start:o}=r;typeof n=="string"&&(n=new Date(n),n.setMinutes(n.getMinutes()+n.getTimezoneOffset())),typeof o=="string"&&(o=new Date(o),o.setMinutes(o.getMinutes()+o.getTimezoneOffset()));const p=new Intl.DateTimeFormat("pt-BR");if(n&&o){const b=o.getFullYear()===n.getFullYear(),F=Object.assign({day:"2-digit",month:"2-digit"},(!b||e)&&{year:"2-digit"}),C=N.formatDate(o,F),v=N.formatDate(n,F);return e?this.getMessage("snkFilterBar.fullPeriodTooltip",{LABEL:l,START_LABEL:C,END_LABEL:v}):`${l}: ${C} → ${v}`}else return o?`${l}: ${this.getMessage("snkFilterBar.onlyStartToltip")} ${p.format(o)}`:n?`${l}: ${this.getMessage("snkFilterBar.onlyEndToltip")} ${p.format(n)}`:l}if(s===h.SEARCH)return`${l}: ${r.value} - ${r.label}`;if(s===h.PERSONALIZED){const n=this.calculateActiveCount(a);return n<=0?l:`${l}: ${this.getMessage("snkFilterBar.personalizedCount",{activeCount:n})}`}if(s===h.MULTI_LIST){const n=((t=r.elements)!==null&&t!==void 0?t:r).filter(o=>o==null?void 0:o.check);return this.getLabelFromCheckedOptions(n,l,e)}if(s===h.CHECK_BOX_LIST){const n=Object.entries(r??{}).filter(([b,F])=>F===!0).map(([b,F])=>b),p=((i=f.options)!==null&&i!==void 0?i:[]).filter(b=>n.includes(b.name));return this.getLabelFromCheckedOptions(p,l,e)}if(s===h.NUMBER&&f.variation===P.INTERVAL){const{start:n,end:o}=r;if(!isNaN(n)&&!isNaN(o))return this.getMessage("snkFilterBar.fullIntervalTooltip",{LABEL:l,START_LABEL:n,END_LABEL:o});if(!isNaN(n))return`${l}: ${this.getMessage("snkFilterBar.onlyStartToltip")} ${Number(n)}`;if(!isNaN(o))return`${l}: ${this.getMessage("snkFilterBar.onlyEndToltip")} ${Number(o)}`}if(this.config.mask){const n=new $(this.config.mask);return`${l}: ${n.format(r)}`}return`${l}: ${r}`}return l}getLabelFromCheckedOptions(e,t,i){const s=e.length;if(s===0)return`${t}`;if(s>1){if(i){const r=e.map(l=>l.label);return`${t}: ${r.join(",")}`}return`${t}: ${s} ${this.getMessage("snkFilterBar.multiListToltip")}`}return`${t}: ${e[0].label}`}calculateActiveCount(e){return e.reduce((t,i)=>i.visible?t+1:t,0)}componentDidLoad(){this._filterItemElement&&(I.addIDInfo(this._filterItemElement),this._idSnkFilterDetail=`filterDetail_${this.config.id}`)}canClearFilter(){const{value:e,groupedItems:t=[]}=this.config;return e!=null&&this.config.type===h.MULTI_LIST?e.some(i=>i.check):e!==void 0||t.some(i=>i.visible)}getRightIconName(){return this.canClearFilter()?"close":this.detailIsVisible?"chevron-up":"chevron-down"}getLeftIconName(){switch(this.config.type){case h.PERIOD:return"calendar";case h.PERSONALIZED:return"tune"}}hasActiveElements(e){var t,i,s;return((s=(i=(t=e==null?void 0:e.elements)!==null&&t!==void 0?t:e)===null||i===void 0?void 0:i.filter(r=>r==null?void 0:r.check))===null||s===void 0?void 0:s.length)>0}hasActiveValue(e){return e.type!==h.MULTI_LIST&&e.value!==void 0||this.hasActiveElements(e.value)}getEnabledChip(){if(this.detailIsVisible)return!0;if(this.config.type===h.PERSONALIZED){const{groupedItems:e=[]}=this.config;return e.some(t=>t.visible)}return this.hasActiveValue(this.config)}handleVisibilityPopover(e){this.detailIsVisible=e.detail}render(){const e=this.getLeftIconName();return d(E,null,this.showChips&&d("ez-chip",{id:this.config.id,ref:t=>this._chipElement=t,label:this.getLabel(),value:this.getEnabledChip(),onClick:t=>this.togglePopover(t),disableAutoUpdateValue:!0},e&&d("ez-icon",{ref:t=>this._leftIconElement=t,iconName:e,class:"ez-padding-right--small",slot:"leftIcon"}),d("ez-icon",{ref:t=>this._rightIconElement=t,iconName:this.getRightIconName(),class:"ez-padding-left--small",slot:"rightIcon",id:"removeFilter",onClick:t=>this.clearFilter(t)})),d("ez-popover-core",{ref:t=>this._popover=t,onEzVisibilityChange:t=>this.handleVisibilityPopover(t)},d("snk-filter-detail",{key:this.config.id,config:this.config,getMessage:this.getMessage,class:"sc-snk-filter-bar snk-filter__popover ez-padding--small ez-elevation--16","data-element-id":this._idSnkFilterDetail,showHardFixed:this.showChips})))}get _filterItemElement(){return M(this)}static get watchers(){return{detailIsVisible:["observeDetailIsVisible"]}}};he.style=fe;const S="__SHOWMORE__",w=5,xe=class{constructor(e){T(this,e),this.snkItemSelected=y(this,"snkItemSelected",7),this._preselection=-1,this.innerClickCheck=(t,i)=>i.id!=z.MODAL_ELEMENT_ID?!0:(this._detailIsVisible=!1,!1),this._filterArgument=void 0,this._showAll=void 0,this.label=void 0,this.iconName=void 0,this.items=void 0,this.getMessage=void 0,this.emptyText=void 0,this.findFilterText=void 0,this.buttonClass=void 0}showDetail(){this._preselection=-1,this._floatingID=z.float(this._popover,this._popoverContainer,{autoClose:!0,innerClickTest:this.innerClickCheck,backClickListener:()=>this.onListCloseCallback(),useOverlay:!0}),this._detailIsVisible=!0,this._showAll=!1,this._filterArgument="",this._filterInput.setFocus()}async hideDetail(){this._floatingID!=null&&z.close(this._floatingID)}onListCloseCallback(){this._floatingID=void 0,this._detailIsVisible=!1}buttonClick(){this._detailIsVisible?this.hideDetail():this.showDetail()}componentDidLoad(){this._element&&I.addIDInfo(this._element)}componentDidRender(){this._floatingID==null&&this._popover&&this._popover.remove()}buildIdElement(e,t){if(!e)return;const i={id:t};e.removeAttribute(I.DATA_ELEMENT_ID_ATTRIBUTE_NAME),I.addIDInfoIfNotExists(e,"filterItemList",i)}buildItemElement(e){const t=++this._selectableItemsCount;return d("button",{ref:i=>i&&this.buildIdElement(i,e.label),id:`filter-item${t}`,onFocusin:()=>this._preselection=t,class:"ez-col ez-col--sd-12 ez-align--middle ez-padding--small sc-snk-filter-bar snk-filter-bar__filter-list-item",onClick:()=>this.itemSelected(e.name),name:e.label,key:t},e.iconName?d("ez-icon",{iconName:e.iconName,size:"small",class:`ez-padding-right--extra-small sc-snk-filter-bar snk-filter-bar__filter-list-item__icon ${e.iconClass||""}`}):void 0,d("div",{class:`ez-text ez-text--medium ez-text--primary ez-padding--extra-small sc-snk-filter-bar snk-filter-bar__filter-list-item__label ${e.labelClass||""}`},e.label))}itemSelected(e){e===S?this._showAll=!0:(this.hideDetail(),this.snkItemSelected.emit(e))}getFilterItems(){const e=this.items?V.applyStringFilter(this._filterArgument,this.items.filter(i=>i.kind==="FILTER")):[];return e.length===0?d("div",{class:"ez-text ez-text--medium ez-text--primary ez-padding--extra-small sc-snk-filter-bar snk-filter-bar__filter-list-items-container--empty"},this.emptyText):(!this._filterArgument&&!this._showAll&&e.length>w+1&&(e.splice(w),e.push({kind:"INTERNAL",label:"Mostrar mais",iconName:"dots-horizontal",name:S,iconClass:"snk-filter-bar__filter-list-item__icon--secondary",labelClass:"snk-filter-bar__filter-list-item__label--secondary"})),this._selectableItemsCount=0,d("div",{class:"sc-snk-filter-bar snk-filter-bar__filter-list-items-container"},e.map(i=>this.buildItemElement(i))))}getFooterItems(){return this.items.filter(e=>e.kind==="FOOTER")}keyDownHandler(e){switch(e.key){case"ArrowDown":this.changePreselection(this._preselection+1),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();break;case"ArrowUp":this.changePreselection(this._preselection-1),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();break}}changePreselection(e){if(e<0&&(e=this._selectableItemsCount),this._preselection=e>this._selectableItemsCount?0:e,this._preselection===0)this._filterInput.setFocus();else{const t=this._element.querySelector(`#filter-item${this._preselection}`);t&&t.focus()}}render(){return d(E,{class:"ez-flex ez-flex--column"},d("ez-button",{class:this.buttonClass,label:this.label,onClick:()=>this.buttonClick(),mode:this.iconName?"icon":void 0,iconName:this.iconName,size:"small"},d("slot",{name:"leftIcon"})),d("section",{class:"ez-margin-top--small sc-snk-filter-bar snk-filter__popover-container",ref:e=>this._popoverContainer=e},d("div",{class:"sc-snk-filter-bar snk-filter__popover ez-padding--small ez-elevation--4",ref:e=>this._popover=e},d("ez-filter-input",{ref:e=>this._filterInput=e,"data-element-id":"serachFilters",mode:"slim",label:this.findFilterText,value:this._filterArgument,onEzChange:e=>this._filterArgument=e.detail,onFocus:()=>this._preselection=0}),this.getFilterItems(),d("hr",{class:"sc-snk-filter-bar snk-filter__popover-rule"}),this.items?this.getFooterItems().map(e=>this.buildItemElement(e)):void 0)))}get _element(){return M(this)}},ce="ez-modal{--ez-modal-content-padding:24px 12px}.snk-filter-modal__container{width:344px;max-width:344px;min-width:344px;overflow:hidden}.snk-filter-modal__content{display:flex;flex-direction:column;gap:var(--space--medium, 12px);padding-right:var(--space--3xs, 4px)}.snk-filter-modal__collapsible-box{border:var(--border--small, 1px solid) var(--color--strokes, #DCE0E8);border-radius:var(--border--radius-medium);padding:var(--space--medium, 12px) var(--space--small, 6px)}.snk-filter-modal__rendered-items{max-height:760px;overflow-x:hidden;overflow-y:auto}.snk-filter-modal__rendered-items::-webkit-scrollbar{width:var(--space--small);min-width:var(--space--small);max-width:var(--space--small)}",ue=class{constructor(e){T(this,e),this.getMessage=void 0,this.configName=void 0,this.filters=void 0,this.applyFilters=void 0,this.closeModal=void 0,this.addPersonalizedFilter=void 0,this.editPersonalizedFilter=void 0,this.deletePersonalizedFilter=void 0,this.filtersToDelete=[],this.filterDefaultToDelete=void 0,this.disablePersonalizedFilter=void 0}deletePersonalizedFilterListener(e){this.filtersToDelete.push(e.detail)}getCustomMessage(e,t){var i;return(i=this.getMessage)===null||i===void 0?void 0:i.call(this,`snkFilterBar.filterModal.${e}`,t)}handleClearAll(){const{customFilters:e,quickFilters:t,otherFilters:i,multiListFilters:s}=this.filters.reduce((r,l)=>l.type===h.MULTI_LIST?(r.multiListFilters.push(l),r):l.filterType===_.QUICK_FILTER?(r.quickFilters.push(l),r):l.filterType===_.CUSTOM_FILTER?(r.customFilters.push(l),r):(l.filterType===_.OTHER_FILTERS&&r.otherFilters.push(l),r),{quickFilters:[],customFilters:[],otherFilters:[],multiListFilters:[]});this.handleClearFilterList(t),this.handleClearCustomFilters(e),this.handleClearOthersFilters(i),s.forEach(r=>this.handleClearSigleFilter(r))}handleClearOthersFilters(e){this.filters=this.filters.map(t=>e.includes(t)?Object.assign(Object.assign({},t),{value:void 0}):t)}handleClearCustomFilters(e){this.filters.forEach((t,i)=>{t.filterType===_.CUSTOM_FILTER&&(this.filters[i]=this.clearAllCustomFilter(e).shift())})}clearAllCustomFilter(e){return e.map(t=>{const i=Object.assign({},t);return delete i.value,i.visible=!1,i.groupedItems&&(i.groupedItems=this.clearAllCustomFilter(i.groupedItems)),i})}hasChangeToSave(){return u.objectToString(this.filters)!==u.objectToString(this._originalFilterConfig)}handleClose(){if(!this.hasChangeToSave()){this.closeModal();return}return D.confirm(this.getCustomMessage("validations.notSaved.title"),this.getCustomMessage("validations.notSaved.message")).then(t=>{t&&this.closeModal()})}handleApplyFilters(){const e=this.filters.find(t=>t.filterType===_.CUSTOM_FILTER||t.filterType===_.DEFAULT_FILTER);this.isValidCustomFilter(e)&&this.applyFilters(this.filters),this.filtersToDelete.length>0&&(this.filtersToDelete.forEach(t=>{this.deletePersonalizedFilter(t,this.configName)}),this.filtersToDelete=[]),this.filterDefaultToDelete&&(this.deletePersonalizedFilter(this.filterDefaultToDelete,this.configName,!0),this._defaultFilter=void 0,this.filterDefaultToDelete=void 0)}isValidCustomFilter(e){return O.validateVariableValues(e)?!0:(D.alert(this.getCustomMessage("validations.notFullFilled.title"),this.getCustomMessage("validations.notFullFilled.message")),!1)}modalActionListener(e){switch(e.detail){case L.CANCEL:this.handleClearAll();break;case L.OK:this.handleApplyFilters();break;case L.CLOSE:this.handleClose();break}}handleFilterChange(e){this.filters=this.filters.map(t=>t.id===e.id?e:t)}handleClearFilterList(e){this.filters=this.filters.map(t=>e.includes(t)?Object.assign(Object.assign({},t),{value:void 0}):t)}handleClearSigleFilter(e){if(h.MULTI_LIST===e.type){let i=u.copy(e);this.uncheckFilterValues(i.value);const s=u.copy(this.filters),r=s.findIndex(l=>l.id===e.id);s.splice(r,1,i),this.filters=u.copy(s);return}if(h.CHECK_BOX_LIST===e.type){const i=u.copy(this.filters);i.find(s=>s.id===e.id).value=void 0,this.filters=u.copy(i);return}const t=this.filters.find(i=>i.id===e.id);t.value=void 0,this.filters=u.copy(this.filters)}uncheckFilterValues(e){return e.forEach(t=>{t&&(t.check=!1)}),e}renderFilterItem(e,t){return d("snk-filter-modal-item",{class:t?"ez-col ez-col--sd-12":"ez-col ez-col--sd-6 ez-padding--small",filterItem:e,configName:this.configName,onFilterChange:i=>this.handleFilterChange(i.detail),onEditPersonalizedFilter:i=>this.editPersonalizedFilter(i.detail),onAddPersonalizedFilter:()=>this.addPersonalizedFilter()})}isDefaultFilterNumberVariation(e){var t;return e.type===h.NUMBER&&(!e.props.variation||((t=e.props)===null||t===void 0?void 0:t.variation)===P.DEFAULT)}mountFiltersLines(e){let i=0,s=!1;const r={};for(let l=0;l<e.length;l++){r[i]=r[i]||[];const f=e[l],a=l===e.length-1,n=f.type===h.TEXT||this.isDefaultFilterNumberVariation(f),o=a?!1:e[l+1].type===h.TEXT||this.isDefaultFilterNumberVariation(e[l+1]);if(n&&o||s){r[i].push(f),s=r[i].length<2,r[i].length===2&&++i;continue}r[i]=r[i]||[],r[i].push(f),++i}return Object.values(r)}renderFilterLine(e){const t=e.length===1;return e.map(i=>this.renderFilterItem(i,t))}getIformedFiltersCount(e){let t=0;return e.forEach(i=>{var s,r,l,f,a,n;if(h.MULTI_LIST===i.type){t+=(a=(f=(l=(r=(s=i.value)===null||s===void 0?void 0:s.elements)!==null&&r!==void 0?r:i.value)===null||l===void 0?void 0:l.filter(o=>o==null?void 0:o.check))===null||f===void 0?void 0:f.length)!==null&&a!==void 0?a:0;return}if(h.CHECK_BOX_LIST===i.type){t+=Object.entries((n=i.value)!==null&&n!==void 0?n:{}).filter(([o,p])=>p===!0).map(([o,p])=>o).length;return}if(i.groupedItems!=null){t=i.groupedItems.filter(o=>o.visible).length;return}i.value&&t++}),t}renderCollapsibleFilterBox(e,t,i,s=!0){if(!t.length)return null;const r=this.getIformedFiltersCount(t),l=this.mountFiltersLines(t);return d("ez-collapsible-box",{class:"snk-filter-modal__collapsible-box",headerSize:"medium",value:!0,label:e},!!r&&d("ez-badge",{class:"ez-badge--primary-subtle",slot:"rightSlot",label:r==null?void 0:r.toString()}),d("div",{class:"ez-row snk-filter-modal__rendered-items"},l.map(this.renderFilterLine.bind(this))),s&&d("div",{class:"ez-flex ez-flex--justify-end grow"},d("ez-button",{class:"ez-button--tertiary",size:"medium",label:"Limpar",onClick:()=>i?this.handleClearSigleFilter(t[0]):this.handleClearFilterList(t)})))}handleDeleteFilter(){this._application.confirm(this.getMessage("snkPersonalizedFilter.deleteConfirm.title"),this.getMessage("snkPersonalizedFilter.info.deleteDefaultFilterConfirm"),"alert-circle-inverted","critical").then(e=>{e&&(this.filterDefaultToDelete=this._defaultFilter,this.filters=this.filters.filter(t=>t.id!==_.DEFAULT_FILTER))})}handleActionSelectedDefaultFilter({detail:e}){switch(e){case x.CREATE:this.addPersonalizedFilter(!0);break;case x.EDIT:this.editPersonalizedFilter(this._defaultFilter.id,!0);break;case x.REMOVE:this.handleDeleteFilter();break}}getCustomFilter(e){return e.filter(i=>i.filterType===_.CUSTOM_FILTER)}getDefaultFilter(e){return e.find(i=>i.id===q.id)}componentWillLoad(){this._application=U.getContextValue("__SNK__APPLICATION__")}componentWillRender(){this._modalTitle=this.getCustomMessage("title"),this._okButtonLabel=this.getCustomMessage("okButtonLabel"),this._cancelButtonLabel=this.getCustomMessage("cancelButtonLabel")}componentDidLoad(){this._originalFilterConfig||(this._originalFilterConfig=this.filters)}render(){this._defaultFilter=this.getDefaultFilter(this.filters);const e=this.getCustomFilter(this.filters),t=this.filters.filter(s=>s.filterType===_.QUICK_FILTER),i=this.filters.filter(s=>s.filterType===_.OTHER_FILTERS);return d("ez-modal-container",{class:"snk-filter-modal__container",modalTitle:this._modalTitle,cancelButtonLabel:this._cancelButtonLabel,okButtonLabel:this._okButtonLabel,onEzModalAction:this.modalActionListener.bind(this)},d("div",{class:"snk-filter-modal__content ez-col--sd-12"},d("snk-default-filter",{getMessage:this.getCustomMessage.bind(this),hasDefaultFilter:!!this._defaultFilter,onActionSelected:this.handleActionSelectedDefaultFilter.bind(this)}),!this.disablePersonalizedFilter&&this.renderCollapsibleFilterBox(this.getCustomMessage("customFilters"),e,!1,!1),this.renderCollapsibleFilterBox(this.getCustomMessage("quickFilters"),t,!1),i.map(s=>this.renderCollapsibleFilterBox(s.label,[s],!0))))}};ue.style=ce;export{de as snk_filter_bar,he as snk_filter_item,xe as snk_filter_list,ue as snk_filter_modal};
//# sourceMappingURL=snk-filter-bar_4.entry-BwU_rDAO.js.map

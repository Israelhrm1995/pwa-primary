import{r as g,c as d,h as s,F as h,H as f,g as u}from"./index-CcALeDO2.js";import{A as p}from"./FormLayout-CTCTPPNq.js";import{E as l,O as a}from"./dataUnitInMemoryLoader-CwDmnNwL.js";import{F as n}from"./filter-item-type.enum-d45e026f-B41QHsvD.js";import{E as m}from"./presentationMode-783bbf9d-DynInUa-.js";import{P as v}from"./PersonalizedFilterUtils-2db38ff2-BredGiFa.js";import"./index-8acbae97-DxLtPl40.js";const O=class{constructor(e){g(this,e),this.filterChange=d(this,"filterChange",7),this.config=void 0,this.getMessage=void 0,this.showHardFixed=!0}async show(){var e,i;(i=(e=this._editor)===null||e===void 0?void 0:e.show)===null||i===void 0||i.call(e)}observeConfig(e){var i,t;this._editor&&(this._editor.config=e),(t=(i=this._editor)===null||i===void 0?void 0:i.reloadList)===null||t===void 0||t.call(i),this._customElementObject=this.getContentEditor()}componentDidLoad(){if(this._element){l.addIDInfo(this._element);const e=this._element.getAttribute(l.DATA_ELEMENT_ID_ATTRIBUTE_NAME);this._idContentEditor=`${e}_${this.config.id}`}}changeConfig(e){this.filterChange.emit(e)}getContentEditor(){switch(this.config.type){case n.BINARY_SELECT:return{tag:"snk-filter-binary-select"};case n.MULTI_SELECT:return{tag:"snk-filter-multi-select"};case n.PERIOD:return{tag:"snk-filter-period"};case n.SEARCH:return{tag:"snk-filter-search"};case n.NUMBER:return{tag:"snk-filter-number"};case n.PERSONALIZED:return{tag:"snk-personalized-filter-editor",props:{presentationMode:m.CHIP,onValueChanged:i=>this.handleValueChanged(i)}};case n.CHECK_BOX_LIST:return{tag:"snk-filter-checkbox-list",props:{onValueChanged:i=>this.config=Object.assign(Object.assign({},this.config),{value:i.detail})}};case n.MULTI_LIST:return{tag:"snk-entity-list",props:{onValueChanged:i=>this.config=Object.assign(Object.assign({},this.config),{value:i.detail})}}}return{tag:"snk-filter-text"}}handleValueChanged({detail:e}){const i=(e==null?void 0:e.items)||this.config.groupedItems;this.config=Object.assign(Object.assign({},this.config),{groupedItems:i,visible:(i||[]).filter(t=>t.visible).length>0})}removeItem(){const i=this.config.type===n.MULTI_LIST&&Array.isArray(this.config.value)?this.config.value.map(o=>Object.assign(Object.assign({},o),{check:!1})):void 0,t=Object.assign(Object.assign({},this.config),{visible:!1,fixed:!1,value:i});t.groupedItems!=null&&(t.groupedItems=t.groupedItems.map(o=>Object.assign(Object.assign({},o),{visible:!1,fixed:!1,value:void 0}))),this.changeConfig(t)}removeItemFromGroup(e){return Object.assign(Object.assign({},e),{visible:!1,fixed:!1,value:void 0})}getPopUpHeaderButtons(){return s(h,null,!this.config.removalBlocked&&this.buildIcon(this.getMessage("snkFilterBar.removeFilter"),"delete",()=>this.removeItem()),this.showHardFixed&&!this.config.hardFixed&&this.buildIcon(this.getMessage(this.config.fixed?"snkFilterBar.unpinFilter":"snkFilterBar.pinFilter"),this.config.fixed?"un-pin":"push-pin",()=>this.changeConfig(Object.assign(Object.assign({},this.config),{fixed:!this.config.fixed}))))}buildIcon(e,i,t){return s("button",{onClick:()=>t(),class:"sc-snk-filter-bar snk-filter-item__editor-header-button",ref:o=>o&&this.buildIdButton(o,e)},s("ez-icon",Object.assign({title:e,iconName:i},{[l.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${l.getInternalIDInfo(`_${e}`)}`})))}buildIdButton(e,i){if(!e)return;const t={id:i};e.removeAttribute(l.DATA_ELEMENT_ID_ATTRIBUTE_NAME),l.addIDInfoIfNotExists(e,"button",t)}clearBinarySelectValues(){var e;const i=this._editor||{};(e=i.resetValues)===null||e===void 0||e.call(i),this.config=a.copy(this.originalConfig),this.changeConfig(Object.assign(Object.assign({},this.config),{value:void 0}))}apply(){if(!v.validateVariableValues(this.config,this._editor.value))return p.alert(this.getMessage("snkFilterBar.filterModal.validations.notFullFilled.title"),this.getMessage("snkFilterBar.filterModal.validations.notFullFilled.message"));const i=this._editor.value!==void 0?this._editor.value:this.config.value;this.changeConfig(Object.assign(Object.assign({},this.config),{visible:this.isVisible(),value:i}))}isVisible(){return this.config.groupedItems&&this.config.groupedItems.length>0?this.config.groupedItems.filter(e=>e.visible).length>0:!0}clear(){var e;if(this.config.type===n.BINARY_SELECT){this.clearBinarySelectValues();return}if(n.MULTI_LIST===this.config.type){const i=a.copy(this.config);(e=i.value)===null||e===void 0||e.forEach(t=>!!t&&(t.check=!1)),this.config=a.copy(i);return}this.changeConfig(Object.assign(Object.assign({},this.config),{value:void 0}))}filterCanBeCleared(){return this.config.type!==n.PERSONALIZED}onKeyDonwListener(e){e.key==="Enter"&&this._applyButton.setFocus().then(()=>this.apply())}buildRightSlot(e){return s("ez-icon",{iconName:"delete",onClick:()=>this.removeValueFromConfig(e)})}removeValueFromConfig(e){var i,t;if(this.config){const o=a.copy(this.config),c=(i=o.value)===null||i===void 0?void 0:i.findIndex(r=>(r==null?void 0:r.id)===e.id);(t=o.value)===null||t===void 0||t.splice(c,1),this.config=a.copy(o)}}componentWillLoad(){this.originalConfig=a.copy(this.config),this._customElementObject=this.getContentEditor()}render(){const{tag:e,props:i}=this._customElementObject;return s(f,null,s("div",{class:"col ez-col--sd-12 ez-align--right ez-padding-medium ez-flex--align-items-center"},s("div",{class:"ez-text ez-title ez-title--small ez-padding--small sc-snk-filter-bar snk-filter-item__editor-header"},this.config.detailTitle),this.getPopUpHeaderButtons()),s(e,Object.assign({maxHeightList:"240px",ref:t=>this._editor=t,value:this.config.value,config:this.config,onKeyDown:t=>this.onKeyDonwListener(t),"data-element-id":this._idContentEditor,getMessage:this.getMessage,rightListSlotBuilder:t=>this.buildRightSlot(t)},i)),s("hr",{class:"sc-snk-filter-bar snk-filter__popover-rule"}),s("div",{class:"ez-col ez-col--sd-12 ez-align--right"},this.filterCanBeCleared()&&s("ez-button",{label:this.getMessage("snkFilterBar.cleanFilter"),onClick:()=>this.clear(),size:"small"}),s("ez-button",{ref:t=>this._applyButton=t,label:this.getMessage("snkFilterBar.applyFilter"),onClick:()=>this.apply(),size:"small",class:"ez-button--primary ez-padding-left--medium"})))}get _element(){return u(this)}static get watchers(){return{config:["observeConfig"]}}};export{O as snk_filter_detail};
//# sourceMappingURL=snk-filter-detail.entry-tVLV-TVk.js.map

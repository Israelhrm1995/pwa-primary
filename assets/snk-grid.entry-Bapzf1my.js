import{r as f,c as h,a as p,E as u,A as C,b as k,S as b,h as r,F as T,g as E}from"./index-CxFxc26b.js";import{K as I}from"./index-dPP-F_x9.js";import{T as s}from"./taskbar-elements-171476d4-AkTdhoOC.js";import{C as o}from"./ConfigStorage-cf578768-CIb4C9-y.js";import{P as d,E as c}from"./index-b40568ff-7Mtm7E1e.js";import{T as g}from"./taskbar-processor-3436124c-7XYCPk7j.js";import{s as m}from"./index-b72af127-BthcoYGc.js";import{S,C as _,a as R,R as v,b as O,c as D}from"./ClientSideExporterProvider-09dee1a3-BYqlpfXV.js";import"./DataFetcher-db08cad0-DvO7h7yr.js";import"./ISave-da565824-Eut4pXqL.js";import"./dataunit-fetcher-1b78797a-DBNOZpxi.js";import"./filter-item-type.enum-d45e026f-B41QHsvD.js";import"./form-config-fetcher-e623539b-VBVHUPpx.js";import"./constants-7b422de0-BRz2gykn.js";import{g as U}from"./GetSelectedRecordsIDsInfo-9fa41508-CVMRaNSv.js";import"./FormLayout-DWDL0qnG.js";import{b as G}from"./search-column-Da0RZOkA.js";import"./IFetchDataExporterParams-d73bed3d-DNdoYuuf.js";import"./PrintUtils-3e4ff0f5-BzI1KebB.js";import"./ResourceIDUtils-a114189a-DvfZuq5X.js";import"./index-BdigElPL.js";class M extends D{getFilters(){var e;return(e=this.dataUnit)===null||e===void 0?void 0:e.getAppliedFilters()}getOrders(){var e;return(e=this.dataUnit)===null||e===void 0?void 0:e.getSort()}getResourceURI(){var e;return(e=this.dataUnit)===null||e===void 0?void 0:e.name}getSelectedNumber(){return this.dataUnit.getSelectionInfo().length}getTotalRecords(){var e,i,a;const{total:n}=((e=this.dataUnit)===null||e===void 0?void 0:e.getPaginationInfo())||{};return n??((a=(i=this.dataUnit)===null||i===void 0?void 0:i.records)===null||a===void 0?void 0:a.length)}getSelectedIDs(){return U(this.dataUnit)}getOffset(){return this.getExporterOffset(this.getPaginationInfo())}getPageSize(){var e;return(e=this.dataUnit)===null||e===void 0?void 0:e.pageSize}getExportLimit(){return 5e3}getRecordID(){var e,i,a;return(a=(i=(e=this.dataUnit)===null||e===void 0?void 0:e.records)===null||i===void 0?void 0:i[0])===null||a===void 0?void 0:a.__record__id__}getPaginationInfo(){var e;return(e=this.dataUnit)===null||e===void 0?void 0:e.getPaginationInfo()}getExporterOffset(e){if(e==null)return;const i=e.firstRecord;return i>0?i-1:i}}const N=".sc-snk-grid-h{--snk-grid-min-height:300px;--snk-grid-padding:var(--space--small)}.snk-grid__container.sc-snk-grid{display:flex;height:100%;width:100%;padding:var(--snk-grid-padding);outline:none}.snk-grid__header.sc-snk-grid{width:100%;display:flex;flex-wrap:nowrap;justify-content:flex-end}.snk-grid__filter-bar.sc-snk-grid{width:100%}.snk-grid__header-divider.sc-snk-grid{margin-bottom:var(--space--medium)}.snk-grid__table.sc-snk-grid{min-height:var(--snk-grid-min-height)}.snk-grid-container__without-shadow.sc-snk-grid{--ezgrid__container--shadow:unset}.snk-grid-container__footer.sc-snk-grid{background-color:var(--background--xlight, #FFF);border-radius:0 0 var(--border--radius-medium) var(--border--radius-medium);box-shadow:var(--shadow--small)}",A=class{constructor(t){f(this,t),this.actionClick=h(this,"actionClick",7),this.gridDoubleClick=h(this,"gridDoubleClick",7),this._customEditors=new Map,this._customRenders=new Map,this._keyboardManager=new I,this._topTaskbarProcessor=new g({"snkGridTopTaskbar.regular":["FORM_MODE","CONFIGURATOR","INSERT"],"snkGridTopTaskbar.regular.secondary":["FORM_MODE","CONFIGURATOR","INSERT"],"snkGridTopTaskbar.regular.singleTaskbar":[],"snkGridTopTaskbar.finish_edition":["CANCEL","SAVE",this.handleAddFormMode()],"snkGridTopTaskbar.finish_edition.secondary":[],"snkGridTopTaskbar.finish_edition.singleTaskbar":[]}),this._headerTaskbarProcessor=new g({"snkGridHeaderTaskbar.unselected":["REFRESH","DATA_EXPORTER","ACTIONS_BUTTON","MORE_OPTIONS"],"snkGridHeaderTaskbar.selected":this.getGridHeaderSelectedBtns(),"snkGridHeaderTaskbar.detail.unselected":["REFRESH","MORE_OPTIONS"],"snkGridHeaderTaskbar.detail.selected":["UPDATE","ATTACH","CLONE","REMOVE","MORE_OPTIONS","DIVIDER","REFRESH"],"snkGridHeaderTaskbar.singleTaskbar.unselected":["INSERT","FORM_MODE","CONFIGURATOR","REFRESH","DATA_EXPORTER","ACTIONS_BUTTON","MORE_OPTIONS"],"snkGridHeaderTaskbar.singleTaskbar.selected":["UPDATE","CLONE","REMOVE","MORE_OPTIONS","DIVIDER","ATTACH","FORM_MODE","CONFIGURATOR","REFRESH","DATA_EXPORTER","ACTIONS_BUTTON"],"snkGridHeaderTaskbar.singleTaskbar.detail.unselected":["INSERT","FORM_MODE","CONFIGURATOR","REFRESH","MORE_OPTIONS"],"snkGridHeaderTaskbar.singleTaskbar.detail.selected":["UPDATE","ATTACH","CLONE","REMOVE","MORE_OPTIONS","DIVIDER","FORM_MODE","CONFIGURATOR","REFRESH"],"snkGridHeaderTaskbar.singleTaskbar.finish_edition":["CANCEL","SAVE",this.handleAddFormMode()]}),this.dataUnitInterceptor={interceptAction:async e=>e.type===p.METADATA_LOADED?await this.interceptMetadataLoaded(e):e},this._dataUnit=void 0,this._dataState=void 0,this._gridConfig=void 0,this._popUpGridConfig=!1,this._showSnkFilterBar=!0,this._enableContinuousInsert=!1,this.columnFilterDataSource=new S,this.enableLockManagerLoadingComp=!1,this.enableLockManagerTaskbarClick=!1,this.configName=void 0,this.filterBarTitle=void 0,this.resourceID=void 0,this.selectionToastConfig=void 0,this.actionsList=void 0,this.isDetail=void 0,this.taskbarManager=void 0,this.statusResolver=void 0,this.multipleSelection=void 0,this.presentationMode=d.PRIMARY,this.messagesBuilder=void 0,this.useEnterLikeTab=!1,this.recordsValidator=void 0,this.canEdit=!0,this.taskbarCustomContainerId=void 0,this.gridHeaderCustomSlotId="GRID_HEADER_CUSTOM_ELEMENTS",this.topTaskbarCustomSlotId="GRID_TASKBAR_CUSTOM_ELEMENTS",this.disablePersonalizedFilter=void 0,this.gridLegacyConfigName=void 0,this.filterBarLegacyConfigName=void 0,this.autoLoad=void 0,this.autoFocus=!0,this.enableGridInsert=!1,this.outlineMode=!1,this.suppressHorizontalScroll=!1,this.strategyExporter=c.SERVER_SIDE,this.useSearchColumn=!0,this.multipleEditionEnabled=!0,this.paginationCounterMode="auto",this.suppressCheckboxColumn=void 0,this.compact=void 0}getGridHeaderSelectedBtns(){const t=[s.UPDATE,s.CLONE,s.REMOVE,s.MORE_OPTIONS,s.DIVIDER,s.ATTACH,s.FORM_MODE,s.CONFIGURATOR,s.REFRESH,s.DATA_EXPORTER,s.ACTIONS_BUTTON];return this.multipleEditionEnabled&&t.unshift(s.UPDATE_MULTIPLE),t}reloadConfig(){this.loadConfig()}async showConfig(){this._grid!=null&&this.openGridConfig()}async hideConfig(){this._grid!=null&&this.closeGridConfig()}async setConfig(t){this.setGridConfig(t)}async reloadFilterBar(){var t;(t=this._snkFilterBar)===null||t===void 0||t.reload()}async getFilterBar(){return this._snkFilterBar}async addCustomEditor(t,e,i){if(this._grid){this._grid.addCustomEditor(t,e,i);return}const a=new Map(this._customEditors);a.set(t,{customEditor:e,detailContext:i}),this._customEditors=a}async addGridCustomRender(t,e,i){if(this._grid){this._grid.addGridCustomRender(t,e,i);return}const a=new Map(this._customRenders);a.set(t,{customRender:e,detailContext:i}),this._customRenders=a}async addCustomValueFormatter(t,e){this._grid.addCustomValueFormatter(t,e)}async removeCustomValueFormatter(t){this._grid.removeCustomValueFormatter(t)}async setFocus(){this._grid.setFocus()}async handleClick(t){var e;if(this.hasToBlockEvent(t)){if(t.preventDefault(),t.stopPropagation(),!await this._dataUnit.cancelEdition())return;const i=new t.constructor(t.type,t);(e=t.target)===null||e===void 0||e.dispatchEvent(i)}this._grid&&!this._grid.contains(t.target)&&this._grid.stopEdit()}hasToBlockEvent(t){var e;return((e=this._snkFilterBar)===null||e===void 0?void 0:e.contains(t.target))&&this.enableGridInsert&&this._dataUnit.hasNewRecord()}async handleGridLegacyConfigName(t,e){t&&t!==e&&(this.addGridLegacyConfigName(),this.loadConfig())}handleAddFormMode(){return this.enableGridInsert?s.FORM_MODE:""}openGridConfig(){this._grid.getColumnsState().then(t=>{this._snkGridConfig.columns=t.filter(e=>e.name),this._popUpGridConfig=!0})}closeGridConfig(){this._popUpGridConfig=!1}setGridConfig(t){this._gridConfig=t,_.assertDefaultSorting(this._gridConfig,this._dataUnit)}fixColumNameCharset(t){try{return decodeURIComponent(escape(t))}catch{return t}}normalizeGridConfig(t){if(!t)return t;const e=t.columns.map(i=>Object.assign(Object.assign({},i),{name:this.fixColumNameCharset(i.name)}));return Object.assign(Object.assign({},t),{columns:e})}loadConfig(){o.loadGridConfig(this.configName,this.resourceID).then(t=>{this.setGridConfig(this.normalizeGridConfig(t))}).catch(t=>{console.warn(t)})}addGridLegacyConfigName(){this.gridLegacyConfigName&&this.configName&&o.addGridLegacyConfig(this.configName,this.gridLegacyConfigName)}gridConfigChangeHandler(t){const e=this.normalizeGridConfig(t.detail);o.saveGridConfig(e,this.configName,this.resourceID),t.stopPropagation()}modalConfigChangeHandler(t){const e=this.normalizeGridConfig(t.detail);this._grid.setColumnsState(e.columns).then(()=>{this.setGridConfig(e),this.closeGridConfig(),this.dataExporterProviderStore()}),t.stopPropagation()}async dataExporterProviderStore(){const t=this.strategyExporter===c.SERVER_SIDE?new M(this._dataUnit,this._grid):new R(this._dataUnit,this._grid);m.set("exporterProviders",Object.assign(Object.assign({},m.get("exporterProviders")),{[this.configName]:t}))}addElementID(){const t={dataUnit:this._dataUnit};u.addIDInfo(this._element,null,t)}loadGridCustomFormatters(t){!t||!this._grid||t.forEach(e=>{var i;!((i=e.properties)===null||i===void 0)&&i.rm_precision&&this.addCustomValueFormatter(e.name,this._rmPrecisionCustomValueFormatter)})}async interceptMetadataLoaded(t){return this.loadGridCustomFormatters(t.payload.fields),t}finishLoading(){this._dataUnit.addInterceptor(this.dataUnitInterceptor),_.assertDefaultSorting(this._gridConfig,this._dataUnit),this.addElementID(),this.columnFilterDataSource!=null&&(this.columnFilterDataSource.setApplication(this._application),this.columnFilterDataSource.setDataUnit(this._dataUnit))}setCustomRenders(){if(this._grid)for(const[t,e]of this._customRenders)this._grid.addGridCustomRender(t,e.customRender,e.detailContext),this._customRenders.delete(t)}setCustomEditors(){if(this._grid)for(const[t,e]of this._customEditors)this._grid.addCustomEditor(t,e.customEditor,e.detailContext),this._customEditors.delete(t)}componentWillLoad(){this._application=C.getContextValue("__SNK__APPLICATION__");let t=this._element.parentElement;for(;t;){if(t.tagName.toUpperCase()==="SNK-DATA-UNIT"){this._snkDataUnit=t,this._dataUnit=this._snkDataUnit.dataUnit,this._dataUnit?this.finishLoading():this._snkDataUnit.addEventListener("dataUnitReady",e=>{this._dataUnit=e.detail,this.finishLoading()}),this.messagesBuilder||(this.messagesBuilder=this._snkDataUnit.messagesBuilder),this._snkDataUnit.addEventListener("dataStateChange",this.handleDataStateChange.bind(this)),this._snkDataUnit.addEventListener("cancelEdition",()=>{var e;!((e=this._dataState)===null||e===void 0)&&e.recordsIsEmpty&&this._dataUnit.clearSelection()});break}t=t.parentElement}this._rmPrecisionCustomValueFormatter=new v,this.addGridLegacyConfigName(),this.loadConfig(),this._continuousInsertUtils=new O(this._application,this.resourceID,this.configName),this.enableGridInsert&&this._continuousInsertUtils.getConfig().then(e=>this._enableContinuousInsert=e)}componentDidRender(){var t,e;this._rmPrecisionCustomValueFormatter.setGrid(this._grid),this.loadGridCustomFormatters((e=(t=this._dataUnit)===null||t===void 0?void 0:t.metadata)===null||e===void 0?void 0:e.fields),this.setCustomRenders(),this.setCustomEditors()}async handleDataStateChange(t){this._dataState=t.detail,this._rmPrecisionCustomValueFormatter.setDataState(this._dataState)}getHeaderDisabledButtons(){var t;const e=[];return!((t=this._dataState)===null||t===void 0)&&t.selectionInfo&&(this._dataState.selectionInfo.length>1&&e.push(s.CLONE,s.ATTACH,s.UPDATE),this._dataState.selectionInfo.isAllRecords()&&e.push(s.REMOVE)),e}getInvisibleButtons(){var t,e;let i=[];return(!this._dataUnit||this._dataUnit.records.length===0)&&i.push(s.DATA_EXPORTER),((t=this._dataState)===null||t===void 0?void 0:t.selectionInfo.mode)===k.ALL_RECORDS&&i.push(s.ACTIONS_BUTTON),((e=this._dataState)===null||e===void 0?void 0:e.selectionInfo.length)===1&&i.push(s.UPDATE_MULTIPLE),i}componentWillRender(){const t=this.getInvisibleButtons();this._headerTaskbarProcessor.process(this.getHeaderTaskbarId(),this.taskbarManager,this._dataState,this.getHeaderDisabledButtons(),t),this._topTaskbarProcessor.process(this.getTopTaskBarId(),this.taskbarManager,this._dataState,void 0,t),this.dataExporterProviderStore()}getHeaderTaskbarId(){var t,e;const i=this._dataState&&!!(!((t=this._dataState.selectionInfo)===null||t===void 0)&&t.length),n={primary:this.isDetail?"snkGridHeaderTaskbar.detail":"snkGridHeaderTaskbar",secondary:this.isDetail?"snkGridHeaderTaskbar.detail":"snkGridHeaderTaskbar",singleTaskbar:this.isDetail?"snkGridHeaderTaskbar.singleTaskbar.detail":"snkGridHeaderTaskbar.singleTaskbar"}[this.presentationMode];let l=i?`${n}.selected`:`${n}.unselected`;return!((e=this._dataState)===null||e===void 0)&&e.isDirty&&this.presentationMode===d.SINGLE_TASKBAR&&(l="snkGridHeaderTaskbar.singleTaskbar.finish_edition"),l}getTopTaskBarId(){var t;const i={primary:"",secondary:".secondary",singleTaskbar:".singleTaskbar"}[this.presentationMode];return!((t=this._dataState)===null||t===void 0)&&t.isDirty?`snkGridTopTaskbar.finish_edition${i}`:`snkGridTopTaskbar.regular${i}`}getPrimaryButton(){return{primary:"INSERT",secondary:"",singleTaskbar:"INSERT"}[this.presentationMode]}getColumnSearch(t){return this._columnSearch!=null?this._columnSearch:(this._columnSearch=G(t,({argument:e})=>new Promise(i=>{this._grid.filterColumns(e).then(a=>{i(a.filter(n=>!n.hidden).map(n=>({label:n.label,value:n.name})))})}),e=>{e!=null&&this._grid.locateColumn(e.value)}),this._columnSearch)}getActionsList(){const t=[];if(this.enableGridInsert&&t.push(this._continuousInsertUtils.actionContinuousInsert(this._enableContinuousInsert,()=>{this._enableContinuousInsert=!this._enableContinuousInsert,this._continuousInsertUtils.handleSaveConfig(this._enableContinuousInsert)})),this.isGridInsertActive())return t;if(this.taskbarManager!=null&&this.taskbarManager.getMoreOptions!=null){const e=this.getTopTaskBarId();return t.concat(this.taskbarManager.getMoreOptions(e,this.configName,this._dataState,this.actionsList))}return t.concat(this.actionsList)}getActionsSettingsList(){return[{value:b.generateUUID(),label:this.messagesBuilder.getMessage("snkGrid.findColumn",{}),disableCloseOnSelect:!0,eagerInitialize:!0,itemBuilder:(e,i)=>this.getColumnSearch(i)}]}handleFilterConfigUpdated(t){if(!t.length){this._showSnkFilterBar=!1;return}if(t.length===1&&t[0].id==="PERSONALIZED_FILTER_GROUP"){this._showSnkFilterBar=t[0].groupedItems.length>0;return}this._showSnkFilterBar=!0}getGridHeaderButtons(){return this.isGridInsertActive()?s.MORE_OPTIONS:this._headerTaskbarProcessor.buttons}isGridInsertActive(){return this.enableGridInsert&&this._dataUnit.hasNewRecord()}render(){if(this._dataUnit)return r("div",{class:"snk-grid__container ez-flex ez-flex--column ez-flex-item--auto ez-padding--large ez-box--no-outline",tabindex:"0"},r("div",{class:"snk-grid__header ez-margin-bottom--extra-small"},this._showSnkFilterBar&&r(T,null,r("snk-filter-bar",{ref:t=>this._snkFilterBar=t,title:this.filterBarTitle,dataUnit:this._dataUnit,"data-element-id":"gridFilter",class:"snk-grid__filter-bar ez-align--top",configName:this.configName,messagesBuilder:this.messagesBuilder,resourceID:this.resourceID,onConfigUpdated:t=>this.handleFilterConfigUpdated(t.detail),disablePersonalizedFilter:this.disablePersonalizedFilter,filterBarLegacyConfigName:this.filterBarLegacyConfigName,autoLoad:this.autoLoad,enableLockManagerLoadingComp:this.enableLockManagerLoadingComp}),r("hr",{class:"ez-divider-vertical ez-divider--dark ez-margin-left--medium snk-grid__header-divider"})),r("snk-taskbar",{class:"ez-padding-left--medium ez-padding-top--extra-small","data-element-id":"grid_top",key:"topTaskbar",configName:this.configName,dataUnit:this._dataUnit,messagesBuilder:this.messagesBuilder,buttons:this._topTaskbarProcessor.buttons,disabledButtons:this._topTaskbarProcessor.disabledButtons,customButtons:this._topTaskbarProcessor.customButtons,primaryButton:this.getPrimaryButton(),resourceID:this.resourceID,customContainerId:this.taskbarCustomContainerId,customSlotId:this.topTaskbarCustomSlotId,overflowStrategy:"none",actionsSettingsList:this.getActionsSettingsList()},r("slot",{name:this.topTaskbarCustomSlotId}))),r("ez-grid",{ref:t=>this._grid=t,class:(this.presentationMode===d.SECONDARY?"snk-grid-container__without-shadow ":"")+"snk-grid__table","data-element-id":"embedded",dataUnit:this._dataUnit,key:"grid-"+this._snkDataUnit.entityName,config:this._gridConfig,onConfigChange:t=>{this.gridConfigChangeHandler(t)},onEzDoubleClick:t=>this.gridDoubleClick.emit(t.detail),statusResolver:this.statusResolver,multipleSelection:this.multipleSelection,columnfilterDataSource:this.columnFilterDataSource,selectionToastConfig:this.selectionToastConfig,useEnterLikeTab:this.useEnterLikeTab,recordsValidator:this.recordsValidator,canEdit:this.canEdit,autoFocus:this.autoFocus,enableGridInsert:this.enableGridInsert,enableContinuousInsert:this._enableContinuousInsert,enableLockManagerTaskbarClick:this.enableLockManagerTaskbarClick,enableLockManagerLoadingComp:this.enableLockManagerLoadingComp,outlineMode:this.outlineMode,useSearchColumn:this.useSearchColumn,suppressHorizontalScroll:this.suppressHorizontalScroll,paginationCounterMode:this.paginationCounterMode,suppressCheckboxColumn:this.suppressCheckboxColumn,compact:this.compact},r("snk-taskbar",{id:"teste",dataUnit:this._dataUnit,configName:this.configName,messagesBuilder:this.messagesBuilder,"data-element-id":"grid_left",buttons:this.getGridHeaderButtons(),presentationMode:this.presentationMode,disabledButtons:this._headerTaskbarProcessor.disabledButtons,customButtons:this._headerTaskbarProcessor.customButtons,slot:"leftButtons",actionsList:this.getActionsList(),primaryButton:this.getPrimaryButton(),resourceID:this.resourceID,customContainerId:this.taskbarCustomContainerId,customSlotId:this.gridHeaderCustomSlotId,actionsSettingsList:this.getActionsSettingsList()},r("slot",{name:this.gridHeaderCustomSlotId}))),r("div",{class:"ez-col ez-col--sd-12 snk-grid-container__footer"},r("slot",{name:"SnkGridFooter"})),r("ez-popup",{size:"medium",heightMode:"auto",useHeader:!1,opened:this._popUpGridConfig,onEzClosePopup:()=>this.closeGridConfig()},r("snk-grid-config",{ref:t=>this._snkGridConfig=t,config:this._gridConfig,"data-element-id":this._element.getAttribute(u.DATA_ELEMENT_ID_ATTRIBUTE_NAME),selectedIndex:0,configName:this.configName,onConfigChange:t=>this.modalConfigChangeHandler(t),onConfigCancel:()=>this.closeGridConfig(),resourceID:this.resourceID})))}get _element(){return E(this)}static get watchers(){return{gridLegacyConfigName:["handleGridLegacyConfigName"]}}};A.style=N;export{A as snk_grid};
//# sourceMappingURL=snk-grid.entry-Bapzf1my.js.map

import{r as C,c as p,h as t,F as I,H as E,g as M}from"./index-DA6RLjux.js";import{E as m,U as d}from"./dataUnitInMemoryLoader-BjgoPaoq.js";import{A as P}from"./ApplicationContext-B_qAnYBt.js";import{F as S}from"./filter-item-type.enum-d45e026f-B41QHsvD.js";import{E as z}from"./presentationMode-783bbf9d-DynInUa-.js";import{E as x}from"./EzScrollDirection-BLSFLxtp.js";import{C as v}from"./FormLayout-pPi2ZB-q.js";const A=".sc-snk-personalized-filter-editor-h{--snk-filter-personalized__max-height:21;--snk-filter-personalized__max-width:21.5}.SnkFilterPersonalized_list-container.sc-snk-personalized-filter-editor{margin:0;padding:0;list-style:none;display:flex;flex-direction:column}.SnkFilterPersonalized_list-container-chip.sc-snk-personalized-filter-editor{width:400px}.SnkFilterPersonalized_list-scroller.sc-snk-personalized-filter-editor{display:block;max-height:calc(var(--space--2xl) * var(--snk-filter-personalized__max-height));cursor:auto;--ez-scroller__max-height:300px}.SnkFilterPersonalized_checkbox.sc-snk-personalized-filter-editor{display:grid;grid-template-columns:auto auto;justify-content:start}.SnkFilterPersonalized_list-container.sc-snk-personalized-filter-editor:has(.SnkFilterPersonalized_list-item--chip){gap:var(--space--small, 6px);max-width:calc(var(--space--md) * var(--snk-filter-personalized__max-width))}.SnkFilterPersonalized_list-item--modal.sc-snk-personalized-filter-editor{display:flex;border-radius:var(--border--radius-regular)}.SnkFilterPersonalized_list-item--modal.sc-snk-personalized-filter-editor:hover{background-color:var(--background--medium, #f0f3f7)}.SnkFilterPersonalized_list-actions.sc-snk-personalized-filter-editor{display:none;align-items:center;gap:var(--space--3xs)}.SnkFilterPersonalized_list-item--modal.sc-snk-personalized-filter-editor:hover .SnkFilterPersonalized_list-actions.sc-snk-personalized-filter-editor{display:flex}.SnkFilterPersonalized_list-item--chip.sc-snk-personalized-filter-editor{display:flex;flex-direction:column;border:var(--border--small, 1px solid) var(--color-strokes, #DCE0E8);border-radius:var(--border--radius-regular)}.SnkFilterPersonalized_list-item--chip.sc-snk-personalized-filter-editor .sc-snk-personalized-filter-editor:first-of-type{gap:var(--space--3xs)}.SnkFilterPersonalized_list-icon.sc-snk-personalized-filter-editor{--ez-icon--color:var(--title--primary, #2B3A54);cursor:pointer}.SnkFilterPersonalized_list-icon.sc-snk-personalized-filter-editor:hover{outline:none;color:var(--color--primary-600, #007a5a);fill:var(--color--primary-600, #007a5a);--ez-icon--color:var(--color--primary-600, #007a5a)}",T=class{constructor(e){C(this,e),this.deleteFilter=p(this,"deleteFilter",7),this.editFilter=p(this,"editFilter",7),this.addFilter=p(this,"addFilter",7),this.valueChanged=p(this,"valueChanged",7),this.originalItems=[],this.messagesBuilder=void 0,this.presentationMode=z.MODAL,this.config=void 0,this.value=void 0,this.items=[]}async show(){const e=document.querySelector("#param_0");e&&e.setFocus()}configWatcher(e){this.items=this.originalItems=e.groupedItems||[]}getMessage(e,i){var s;if(this.messagesBuilder)return this.messagesBuilder.getMessage(e,i);if(!((s=this._application)===null||s===void 0)&&s.messagesBuilder)return this._application.messagesBuilder.getMessage(e,i)}getItemContent(e){var i,s;const r=()=>t("ez-check",Object.assign({class:"SnkFilterPersonalized_checkbox",id:`param_${e.id}`,key:e.id,value:e.visible,label:e.label,onEzChange:({detail:a})=>this.handleItemChange.bind(this)(a,e.id)},{[m.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${m.getInternalIDInfo(`checkboxFilter_${e.id}`)}`})),l=!!(!((s=(i=e.props)===null||i===void 0?void 0:i.personalizedFilter)===null||s===void 0)&&s.parameters.length);return t("div",{class:`${this.isModalMode()?"":"SnkFilterPersonalized_list-item--chip"}`},t("li",{class:`${this.isModalMode()?"SnkFilterPersonalized_list-item--modal":""}`},t("div",{class:"ez-flex ez-flex--align-items-center ez-flex--justify-between ez-size-width--full"},t(r,null),this.buildModalListActions(e,l))),e.visible&&l&&t("div",{class:"ez-row ez-padding--small"},this.getFormField(e)))}buildModalListActions(e,i){if(this.isModalMode())return this.isModalMode()?t("div",{class:"SnkFilterPersonalized_list-actions"},t("ez-icon",{class:"SnkFilterPersonalized_list-icon",iconName:"edit",title:this.getMessage("snkPersonalizedFilter.listActions.edit"),onClick:()=>this.editFilter.emit(e.id)}),t("ez-icon",{class:"SnkFilterPersonalized_list-icon",iconName:"delete",title:this.getMessage("snkPersonalizedFilter.listActions.delete"),onClick:this.handleDeleteFilter.bind(this,e)})):i&&t("ez-badge",Object.assign({class:"ez-badge--warning-subtle ez-margin-right--small",label:this.getMessage("snkPersonalizedFilter.info.badgeVariable"),size:"medium"},{[m.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${m.getInternalIDInfo(`variableBadge_${e.id}`)}`}))}isModalMode(){return this.presentationMode===z.MODAL}doSearch(e,i,s){const r=Object.assign({},s.searchContext);return r.searchOptions=Object.assign(Object.assign({},r.searchOptions),{showInactives:"true"}),new Promise((l,a)=>{this._application.executePreparedSearch(e,i,r).then(o=>{l(o)}).catch(o=>{a(o)})})}getFormField(e){var i,s;return((s=(i=e==null?void 0:e.props)===null||i===void 0?void 0:i.personalizedFilter)===null||s===void 0?void 0:s.parameters).map((l,a)=>{var o,g,f,b;const c=Object.assign(Object.assign({},l),{id:e.id}),h=(o=e.value)===null||o===void 0?void 0:o[a],u="param_"+a;switch(l.userInterface){case d.SEARCH:const _=((g=this.config.props)===null||g===void 0?void 0:g.useSearchPlus)==!0?"ez-search-plus":"ez-search";return t(_,{id:u,suppressEmptyOption:!0,value:h,onEzChange:n=>this.handleFilterItemChange(n.detail,c),label:l.label,optionLoader:({mode:n,argument:k})=>this.doSearch(n,k,l)});case d.SWITCH:case d.CHECKBOX:const F=d.SWITCH===l.userInterface?v.SWITCH:v.REGULAR;return t("ez-check",{id:u,class:"ez-padding-bottom--medium",mode:F,value:h,label:l.label,onEzChange:n=>this.handleFilterItemChange(n.detail,c)});case d.DECIMALNUMBER:return t("ez-number-input",{id:u,label:l.label,value:h,precision:((f=l.props)===null||f===void 0?void 0:f.precision)||2,onEzChange:n=>this.handleFilterItemChange(n.detail,c)});case d.INTEGERNUMBER:return t("ez-number-input",{id:u,label:l.label,value:h,precision:(b=l.props)===null||b===void 0?void 0:b.precision,onEzChange:n=>this.handleFilterItemChange(n.detail,c)});case d.OPTIONSELECTOR:return t("ez-combo-box",{id:u,label:l.label,value:h,options:l.options,onEzChange:n=>this.handleFilterItemChange(n.detail,c)});case d.DATE:return t("ez-date-input",{id:u,label:l.label,value:this.parseDate(h),onEzChange:n=>this.handleFilterItemChange(n.detail,c)});case d.DATETIME:return t("ez-date-time-input",{id:u,label:l.label,value:this.parseDate(h),onEzChange:n=>this.handleFilterItemChange(n.detail,c)});default:return t("ez-text-input",{id:u,label:l.label,value:h,onEzChange:n=>this.handleFilterItemChange(n.detail,c)})}})}parseDate(e){if(typeof e=="string"){let i=new Date(e);return i.setMinutes(i.getMinutes()+i.getTimezoneOffset()),i}return e}getVisibleCount(e){return e.reduce((i,s)=>s.visible?i+1:i,0)}handleItemChange(e,i){this.items=this.originalItems=this.originalItems.map(s=>{const r=s.id===i?e:s.visible;return Object.assign(Object.assign({},s),{visible:r,active:r})}),this.emitChange()}handleSearchFilterList({detail:e=""}){this.items=e?this.originalItems.filter(i=>i.label.toLowerCase().includes(e.toLowerCase())):this.originalItems}handleFilterItemChange(e,i){var s;const r=this.items.find(({id:g})=>g===i.id),{parameters:l=[]}=((s=r.props)===null||s===void 0?void 0:s.personalizedFilter)||{},a=l.findIndex(g=>g.name===i.name);l[a]=i,r.props.personalizedFilter.parameters=l,r.value||(r.value=[]),r.value[a]=e;const o=[...this.items,r];this.items=Array.from(new Set(o)),this.emitChange()}handleClearFilters(){this.emitChange(!0)}emitChange(e=!1){e&&(this.items=this.originalItems);const i=this.items.map(r=>Object.assign(Object.assign({},r),{visible:!e&&r.visible})),s=this.getVisibleCount(i);this.valueChanged.emit({value:s,items:i})}handleDeleteFilter(e){this._application.confirm(this.getMessage("snkPersonalizedFilter.deleteConfirm.title"),this.getMessage("snkPersonalizedFilter.deleteConfirm.message",{filterName:e.label})).then(i=>{i&&(this.deleteFilter.emit(e),this.items=this.originalItems=this.originalItems.filter(s=>s.id!==e.id),this.emitChange())})}componentDidLoad(){this._element&&m.addIDInfoIfNotExists(this._element,"filterContentEditor")}componentWillLoad(){var e;this._application=P.getContextValue("__SNK__APPLICATION__"),this.items=this.originalItems=((e=this.config)===null||e===void 0?void 0:e.groupedItems)||[]}buildModeModalHeader(){if(this.presentationMode===z.MODAL)return t("div",{class:"ez-margin-bottom--medium"},t(I,null,t("ez-filter-input",Object.assign({label:this.config.label,onEzChange:this.handleSearchFilterList.bind(this)},{[m.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:`${m.getInternalIDInfo("filterSearch")}`})),t("span",{class:"ez-text ez-title--small ez-title--primary"}," ",this.config.detailTitle," ")))}buildModeModalFooter(){if(this.presentationMode===z.MODAL)return t("div",{class:"ez-flex ez-flex--justify-end grow ez-margin-top--medium ez-margin-bottom--small"},t("ez-button",{class:"ez-button--tertiary ez-margin-right--small",size:"medium",label:this.getMessage("snkPersonalizedFilter.footerActions.clear"),onClick:this.handleClearFilters.bind(this)}),t("ez-button",{class:"ez-button--secondary ez-margin-right--small",size:"medium",label:this.getMessage("snkPersonalizedFilter.footerActions.create"),onClick:()=>this.addFilter.emit()}))}buildContainerFiltersCreated(){return this.items.length?t("ez-scroller",{class:"SnkFilterPersonalized_list-scroller",direction:x.VERTICAL},t("ul",{class:`SnkFilterPersonalized_list-container ${this.isModalMode()?"":"SnkFilterPersonalized_list-container-chip"}`},this.items.map(e=>this.getItemContent(e)))):t("div",{class:"ez-margin--auto"},t("span",{class:"ez-text ez-text--secondary ez-text--small"},this.getMessage("snkPersonalizedFilter.info.noDataFound")))}render(){if(!(!this.config||this.config.type!==S.PERSONALIZED))return t(E,null,this.buildModeModalHeader(),this.buildContainerFiltersCreated(),this.buildModeModalFooter())}get _element(){return M(this)}static get watchers(){return{config:["configWatcher"]}}};T.style=A;export{T as snk_personalized_filter_editor};

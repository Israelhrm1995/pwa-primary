import{r as w,h as r,H as x,g as y}from"./index-CHe-Tgi3.js";import{O as p,S as f,E as S}from"./dataUnitInMemoryLoader-CwDmnNwL.js";import{P as C,b as A,a as u}from"./ISave-da565824-BpwjVTmC.js";import"./DataFetcher-db08cad0-YRT7v6X1.js";import"./index-b40568ff-7Mtm7E1e.js";import"./dataunit-fetcher-1b78797a-B5AebLgP.js";import"./filter-item-type.enum-d45e026f-B41QHsvD.js";import"./form-config-fetcher-e623539b-ClsRvgut.js";import"./constants-7b422de0-BRz2gykn.js";import"./PrintUtils-3e4ff0f5-Dyc0ptsy.js";import"./ApplicationContext-B_qAnYBt.js";import"./constants-CKEKe-xZ.js";import"./ResourceIDUtils-a114189a-DSWFS9XU.js";const N=".sc-snk-pesquisa-h{--snk-pesquisa--font-size:var(--text--medium, 14px);--snk-pesquisa--font-family:var(--font-pattern, Arial);--snk-pesquisa--font-weight:var(--text-weight--medium, 400);--snk-pesquisa__records--color:var(--text--primary, #626e82);--snk-pesquisa__records--color-secondary:var(--text--secondary, #626e82);--snk-pesquisa__records--padding-vertical:var(--space--medium, 12px);--snk-pesquisa__content--padding-right:var(--space--small, 6px);--snk-pesquisa__btn--color:var(--title--primary, #2B3A54);--snk-pesquisa__btn-disabled--color:var(--text--disable, #AFB6C0);--snk-pesquisa__btn-hover--color:var(--color--primary, #4e4e4e);--snk-pesquisa__scrollbar--color-default:var(--scrollbar--default, #626e82);--snk-pesquisa__scrollbar--color-background:var(--scrollbar--background, #E5EAF0);--snk-pesquisa__scrollbar--color-hover:var(--scrollbar--hover, #2B3A54);--snk-pesquisa__scrollbar--color-clicked:var(--scrollbar--clicked, #a2abb9);--snk-pesquisa__scrollbar--border-radius:var(--border--radius-small, 6px);--snk-pesquisa__scrollbar--width:var(--space--small, 6px);height:100%;display:flex;flex-direction:column;overflow-y:auto}.snk-pesquisa.sc-snk-pesquisa{display:flex;flex-direction:column;height:100%}.snk-pesquisa__input.sc-snk-pesquisa{display:flex;width:100%;box-sizing:border-box;padding-top:4px;padding-right:4px}.snk-pesquisa__input.sc-snk-pesquisa ez-icon.sc-snk-pesquisa{--ez-icon--color:inherit;font-weight:var(--text-weight--large, 600)}.snk-pesquisa__content.sc-snk-pesquisa{display:flex;flex-direction:column;overflow-y:hidden;scrollbar-width:thin;scrollbar-color:var(--snk-pesquisa__scrollbar--color-clicked) var(--snk-pesquisa__scrollbar--color-background);padding-right:var(--snk-pesquisa__content--padding-right);height:100vh}.snk-pesquisa__content.sc-snk-pesquisa::-webkit-scrollbar{background-color:var(--snk-pesquisa__scrollbar--color-background);width:var(--snk-pesquisa__scrollbar--width);max-width:var(--snk-pesquisa__scrollbar--width);min-width:var(--snk-pesquisa__scrollbar--width)}.snk-pesquisa__content.sc-snk-pesquisa::-webkit-scrollbar-track{background-color:var(--snk-pesquisa__scrollbar--color-background);border-radius:var(--snk-pesquisa__scrollbar--border-radius)}.snk-pesquisa__content.sc-snk-pesquisa::-webkit-scrollbar-thumb{background-color:var(--snk-pesquisa__scrollbar--color-default);border-radius:var(--snk-pesquisa__scrollbar--border-radius)}.snk-pesquisa__content.sc-snk-pesquisa::-webkit-scrollbar-thumb:vertical:hover,.snk-pesquisa__content.sc-snk-pesquisa::-webkit-scrollbar-thumb:horizontal:hover{background-color:var(--snk-pesquisa__scrollbar--color-hover)}.snk-pesquisa__content.sc-snk-pesquisa::-webkit-scrollbar-thumb:vertical:active,.snk-pesquisa__content.sc-snk-pesquisa::-webkit-scrollbar-thumb:horizontal:active{background-color:var(--snk-pesquisa__scrollbar--color-clicked)}.snk-pesquisa__records-label.sc-snk-pesquisa{display:flex;flex-direction:row;justify-content:space-between;font-family:var(--snk-pesquisa--font-family);font-weight:var(--snk-pesquisa--font-weight);font-size:var(--snk-pesquisa--font-size);padding-bottom:var(--snk-pesquisa__records--padding-vertical);padding-top:var(--snk-pesquisa__records--padding-vertical)}.snk-pesquisa__records-label.hidden.sc-snk-pesquisa{display:none}.snk-pesquisa__records.sc-snk-pesquisa{color:var(--snk-pesquisa__records--color)}.snk-pesquisa__records-limit.sc-snk-pesquisa{color:var(--snk-pesquisa__records--color-secondary)}.snk-pesquisa__records-limit.hidden.sc-snk-pesquisa,.snk-pesquisa__records.hidden.sc-snk-pesquisa{visibility:hidden}.snk-pesquisa__btn.sc-snk-pesquisa{outline:none;border:none;background:none;cursor:pointer;color:var(--snk-pesquisa__btn--color)}.snk-pesquisa__btn.sc-snk-pesquisa:disabled{cursor:unset;color:var(--snk-pesquisa__btn-disabled--color)}.snk-pesquisa__btn.sc-snk-pesquisa:disabled:hover{cursor:unset;color:var(--snk-pesquisa__btn-disabled--color)}.snk-pesquisa__btn.sc-snk-pesquisa:hover{color:var(--snk-pesquisa__btn-hover--color)}.snk-pesquisa__cards-container.sc-snk-pesquisa{height:100%;overflow-y:auto}",T=class{constructor(e){w(this,e),this._mdByName={},this._startHighlightTag="<span class='card-item__highlight'>",this._endHighlightTag="</span>",this._specialCharsRegex=/[[.\-\$\+\*,_\&\(\)%\/\\#@!:\|\=\'\"]/gmi,this._charsWithAccentuation="ÁÉÍÓÚ_ÃÕ_ÂÊÎÔÛ_ÀÈÌÒÙ_Ü_Ç_áéíóú_ãõ_âêîôû_àèìòù_ü_ç",this._charsWithoutAccentuation="AEIOU_AO_AEIOU_AEIOU_U_C_aeiou_ao_aeiou_aeiou_u_c",this._changeDeboucingTimeout=null,this._limitCharsToSearch=3,this._deboucingTime=450,this._gridDataSource=[],this.pesquisaFetcher=new C,this._itemList=void 0,this._startLoading=!1,this._presentationMode="list",this._currentView=void 0,this._valideDataSource=!1,this.searchLoader=void 0,this.treeLoader=void 0,this.selectItem=void 0,this.entityName=void 0,this.argument=void 0,this.isHierarchyEntity=!1,this.allowsNonAnalytic=!1}observeArgument(){this._textInput&&(this._textInput.value=this.argument)}clearSearch(){this.argument="",this._itemList=void 0}buildDetails(e,i){let t={};for(let s=0;s<e.length;s++){const a=e[s],n=i[a.fieldName],c=a.options&&a.options[n]||n;t[a.description]=this.highlightValue(i.__matchFields,c,e,!0)}return t}buildFirstFields(e,i,t=6){return e&&Array.isArray(e)&&e.forEach(s=>{let a=this.removeReference(i,this._mdByName[s]);a&&i.unshift(a)}),i=i.slice(0,t),i}doSearch(e){this.searchLoader&&typeof this.searchLoader=="function"&&(this._startLoading=!0,this.searchLoader(e).then(i=>{i&&this.processSearchResponse(i)}).finally(()=>{this._startLoading=!1}))}processSearchResponse(e){e=p.stringToObject(e.json.$);let i=e.descriptionField,t=e.pkField;t&&(this._gridMetadata=A(e),this._gridDataSource=[...e.data],this._pkField=t,this._descriptionField=i,this._itemList=this.buildCardItemList(e,t,i))}buildCardItemList(e,i,t){var s;return(s=e.data)===null||s===void 0?void 0:s.map(n=>{var c;let o=this.filterFieldsMetadata(e,n),h=this.buildFirstFields(n.__matchFields,o);return{key:this.highlightValue(n.__matchFields,(c=n[i])===null||c===void 0?void 0:c.toString(),h,!0),title:t?this.highlightValue(n.__matchFields,n[t],h,!0):"",details:this.buildDetails(h,n)}})}filterFieldsMetadata(e,i){return e.fieldsMetadata.filter(t=>{let s=!f.isEmpty(i[t.fieldName])&&t.visible!==!1&&t.type!=="B"&&e.pkField!==t.fieldName&&e.descriptionField!==t.fieldName&&(t.isPrimaryKey||!t.isLinkField)&&!(t.type==="S"&&t.presentationType==="H");return s&&(this._mdByName[t.fieldName]=t),typeof i[t.fieldName]=="string"&&(i[t.fieldName].indexOf("<img")>-1||i[t.fieldName].indexOf("<svg")>-1)?!1:s})}removeAtIndex(e,i){if(i>=0&&i<e.length)return e.splice(i,1)[0]}removeReference(e,i){let t=this.indexOf(e,i);return this.removeAtIndex(e,t)}indexOf(e,i){let t=-1;return Array.isArray(e)&&this.find(e,(s,a)=>(t=a,this.equals(i,s))),t}equals(e,i){return p.objectToString(e)===p.objectToString(i)}find(e,i){if(e){for(let t=0,s=e.length;t<s;t++)if(i(e[t],t,e))return e[t]}else return}highlightValue(e,i,t,s){let a=this.replaceHtmlEntities(i);if(this.argument&&(s||this.isIn(e,t.fieldName))){const n=this.getArgumentNumber();let c=(isNaN(n)?this.argument:n.toString()).split(/%|,|\s+/),o=0,h=this.replaceAccentuatedChars(a);c.forEach(l=>{if(l){l=this.replaceAccentuatedChars(l);let g=this.getSpecialCharacters(l);g!=null&&g.length>0&&(l=this.removeSpecialCharacters(l)),(t.mask||t.uiType==="CGC_CPF"||t.uiType==="Phone")&&(l=l.split("").join("\\.?\\-?\\/?\\(?\\)?"));let m=new RegExp(l,"ig");m.lastIndex=o;let d=m.exec(h);if(d&&d.length>0){o=d.index;let k=d[0].length,_=a.substring(o,o+k),b=_!=null&&_.trim()?this._startHighlightTag+_+this._endHighlightTag:"",v=a.substring(0,o),q=a.substring(o+k);a=v+b+q,o=o+b.length,h=this.replaceAccentuatedChars(a)}}})}return a}replaceHtmlEntities(e){return e==null?e:String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}replaceAccentuatedChars(e){if(e==null)return e;const i=["&amp;","&lt;","&gt;","&quot;"];return this.replaceToSpace(e,i).replace(/[^\w ]/g,s=>{let a=this._charsWithAccentuation.indexOf(s);return a>-1&&(s=this._charsWithoutAccentuation.charAt(a)),s||""})}replaceToSpace(e,i=[]){return e==null||i.forEach(t=>{const s=new RegExp(t,"g");let a="";for(let n=0;n<t.length;n++)a+=" ";e=String(e).replace(s,a)}),e}isIn(e,i){return this.indexOf(e,i)>-1}getSpecialCharacters(e){let i,t=[];for(;i=this._specialCharsRegex.exec(e);)t.push(e[i.index]);return t}removeSpecialCharacters(e){return this.getSpecialCharacters(e).forEach(t=>{e=this.replaceAll(e,t,"")}),e}replaceAll(e,i,t){let s=(e??"").indexOf(i);for(;s>-1;)e=e.replace(i,t),s=e.indexOf(i);return e}getArgumentNumber(){return Number(this.argument||void 0)}createOption(e){let{key:i,title:t}=e;const s=new RegExp(this._startHighlightTag,"g"),a=new RegExp(this._endHighlightTag,"g");t=f.decodeHtmlEntities(t);const n={value:i==null?void 0:i.replace(s,"").replace(a,""),label:t==null?void 0:t.replace(s,"").replace(a,"")};this.selectItem(n)}onChangeValue(e){var i;if(this.clearDeboucingTimeout(),this._startLoading){this._changeDeboucingTimeout=setTimeout(()=>{this.onChangeValue(e)},this._deboucingTime);return}if(this.argument=(e.detail||"").trim(),this.isHierarchyEntity&&this._presentationMode==="list"){(i=this._pesquisaTree)===null||i===void 0||i.applyFilter();return}const t=this.getArgumentNumber();this.argument&&(!isNaN(t)||this.argument.length>=this._limitCharsToSearch)?this._changeDeboucingTimeout=setTimeout(()=>{this.doSearch(isNaN(t)?this.argument:t.toString()),this._valideDataSource=!0},this._deboucingTime):(this._itemList=void 0,this._gridDataSource=[],this._valideDataSource=!1)}clearDeboucingTimeout(){this._changeDeboucingTimeout&&(clearTimeout(this._changeDeboucingTimeout),this._changeDeboucingTimeout=void 0)}onClickSearch(){this.doSearch((this.argument||"").trim()),this._valideDataSource=!0}getMessageView(){return this._startLoading?"Aguarde, buscando registros...":this._itemList?this._itemList.length>=1?`${this._itemList.length} ${this._itemList.length>1?"registros encontrados":"registro encontrado"}`:"Nenhum registro encontrado":"Os resultados de sua pesquisa aparecerão aqui..."}async componentWillLoad(){const e=await this.pesquisaFetcher.loadPresentationConfig(this.entityName);this._presentationMode=e==="list"?"list":"table"}async componentDidLoad(){S.addIDInfo(this._element),await this.chooseViewMode()}async handleChangeViewMode(){this._presentationMode=this._presentationMode==="list"?"table":"list",await this.chooseViewMode(),await this.pesquisaFetcher.savePresentationConfig(this.entityName,this._presentationMode)}async chooseViewMode(){var e,i;if(this._presentationMode!=="list"){await((e=this._viewStack)===null||e===void 0?void 0:e.show(u.GRID)),this._currentView=u.GRID;return}const t=this.isHierarchyEntity?u.TREE:u.CARDS;await((i=this._viewStack)===null||i===void 0?void 0:i.show(t)),this._currentView=t}hideLimitMessage(){return this._itemList?this._itemList.length<100:!0}hideRecordsMessage(){return this._presentationMode==="list"&&this.isHierarchyEntity}getButtonModeInfo(){return this._presentationMode==="list"?{iconName:"table",title:"Modo grade"}:this.isHierarchyEntity?{iconName:"hierarchical-tree",title:"Modo árvore hierárquica"}:{iconName:"list",title:"Modo lista"}}render(){var e,i;return r(x,null,r("div",{class:"snk-pesquisa"},r("div",{class:"snk-pesquisa__input"},r("ez-text-input",{label:"Buscar",class:"ez-margin-right--medium",canShowError:!1,ref:t=>this._textInput=t,onEzChange:t=>this.onChangeValue(t),value:this.argument,"data-element-id":"searchInput"},r("ez-icon",{slot:"leftIcon",iconName:"search"}),this.argument&&(!((e=this._textInput)===null||e===void 0)&&e.value)?r("button",{slot:"rightIcon",class:"snk-pesquisa__btn",onClick:()=>this.clearSearch()},r("ez-icon",{iconName:"close"})):void 0),r("ez-button",{class:"ez-button--primary",label:"Pesquisar",onClick:()=>this.onClickSearch()}),r("ez-button",{class:"ez-margin-left--medium",mode:"icon",iconName:this.getButtonModeInfo().iconName,title:this.getButtonModeInfo().title,onClick:async()=>await this.handleChangeViewMode()})),r("div",{class:`snk-pesquisa__records-label ${this._currentView===u.TREE?"hidden":""}`},r("label",{class:`snk-pesquisa__records ${this.hideRecordsMessage()?"hidden":""}`},this.getMessageView()),r("label",{class:`snk-pesquisa__records-limit ${this.hideLimitMessage()?"hidden":""}`},"Essa pesquisa foi limitada, existem mais resultados.")),r("div",{class:"snk-pesquisa__content"},r("ez-view-stack",{ref:t=>this._viewStack=t,"data-element-id":"simple-crud"},r("stack-item",null,this._valideDataSource&&r("pesquisa-grid",{metadata:this._gridMetadata,dataSource:this._gridDataSource,pkField:this._pkField,descriptionField:this._descriptionField,entityName:this.entityName,shouldLoadConfig:this._currentView===u.GRID,onPesquisaGridSelectItem:({detail:t})=>this.selectItem(t)})),r("stack-item",null,r("div",{class:"snk-pesquisa__cards-container"},(i=this._itemList)===null||i===void 0?void 0:i.map(t=>r("ez-card-item",{onEzClick:s=>this.createOption(s.detail),item:t})))),r("stack-item",null,r("pesquisa-tree",{ref:t=>this._pesquisaTree=t,argument:this.argument,treeLoader:this.treeLoader,allowsNonAnalytic:this.allowsNonAnalytic,shouldLoadTree:this._currentView===u.TREE,onPesquisaTreeSelectItem:({detail:t})=>this.selectItem(t)}))))))}get _element(){return y(this)}static get watchers(){return{argument:["observeArgument"]}}};T.style=N;export{T as snk_pesquisa};
//# sourceMappingURL=snk-pesquisa.entry-BA3IXn9i.js.map

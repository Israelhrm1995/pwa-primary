import{r as l,h as t,H as o,g as h}from"./index-CHe-Tgi3.js";import{P as c}from"./PrintUtils-3e4ff0f5-Dyc0ptsy.js";import{A as d}from"./FormLayout-CTCTPPNq.js";import{E as n}from"./dataUnitInMemoryLoader-CwDmnNwL.js";import{A as u}from"./ApplicationContext-B_qAnYBt.js";import{M as a}from"./modal-button-status-OTEz8c7N.js";const p=".sc-snk-print-selector-h{max-height:100%}ez-modal-container.sc-snk-print-selector{--ez-modal-container-overflow-y:hidden}ez-list.sc-snk-print-selector{height:100%}.list-scroll.sc-snk-print-selector{height:100%;overflow-y:auto;padding-right:var(--snk-grid-config__main--padding-right)}.with-header.sc-snk-print-selector{max-height:calc(100% - 125px)}.without-header.sc-snk-print-selector{max-height:calc(100% - 85px)}.list-scroll.sc-snk-print-selector::-webkit-scrollbar{width:var(--space--small);min-width:var(--space--small);max-width:var(--space--small)}.hidden.sc-snk-print-selector{display:none}",m=class{constructor(e){l(this,e),this.APPLY="OK",this.CANCEL="CANCEL",this.CLOSE="CLOSE",this.REMOTE_PRINTERS_TAB="0",this.LOCAL_PRINTERS_TAB="1",this._hasRemotePrinters=!1,this._hasLocalPrinters=!1,this._localPrinters=[],this._isSingleJob=!1,this._saveSubstitute=!1,this.buildIdTabSelector=()=>{const i=[{label:this.getMessage("snkPrintSelector.title.localPrintersTab"),tabKey:this.LOCAL_PRINTERS_TAB,index:Number(this.LOCAL_PRINTERS_TAB)}];return this._printServerActive&&i.unshift({label:this.getMessage("snkPrintSelector.title.remotePrintersTab"),tabKey:this.REMOTE_PRINTERS_TAB,index:Number(this.REMOTE_PRINTERS_TAB)}),[...i]},this._printServerActive=!1,this._selectedPrinter=void 0,this._remotePrintersDataSource=[],this._localPrintersDataSource=[],this._printJobData=void 0}async openPrintSelector(e){return new Promise(i=>{this._printJobData=e,this._isSingleJob=this._printJobData.pendingPrinters.length===1,this._printServerActive=this._printJobData.printServerActive,this._printServerActive?this.buildRemotePrinters():(this.buildLocalPrinters(),this._viewStack.show(+this.LOCAL_PRINTERS_TAB)),this._ezPopup.opened=!0,this._printerResolver=i})}closePrintSelector(){this._ezPopup.opened=!1,this.element.remove()}handleModalAction(e){switch(e){case this.APPLY:this.handleApply();break;case this.CANCEL:case this.CLOSE:this.handleCancel();break}}async handleCancel(){await d.confirm(this.getMessage("snkPrintSelector.title.warning"),this.getMessage("snkPrintSelector.message.canceledPrint"))&&(this.closePrintSelector(),this._printerResolver({selectedPrinter:void 0,saveSubstitute:!1}))}handleApply(){this._printerResolver({selectedPrinter:this._selectedPrinter,saveSubstitute:this._saveSubstitute}),this.closePrintSelector()}onChangeTab(e){e.detail.tabKey===this.LOCAL_PRINTERS_TAB&&this.buildLocalPrinters(),this._viewStack.show(+e.detail.tabKey)}buildRemotePrinters(){const e=[];this._printJobData.printServers.forEach(i=>{e.push({group:i.printServerUri,items:i.printerList.map(s=>({label:s.printerName,group:i.printServerUri}))})}),this._remotePrintersDataSource=e,this._hasRemotePrinters=this._remotePrintersDataSource.length>0}buildLocalPrinters(){this._localPrintersDataSource.length>0||(this._localPrinters=c.getInstance().getLocalPrinters(),this._localPrintersDataSource=this._localPrinters.map(e=>({label:e.nome})),this._hasLocalPrinters=this._localPrintersDataSource.length>0)}onSelectPrinter(e,i){if(i){this._hasRemotePrinters&&this._remotePrintersList.removeSelection(),this._selectedPrinter=this._localPrinters.find(r=>r.nome===e.label);return}this._hasLocalPrinters&&this._localPrintersList.removeSelection();const s=this._printJobData.printServers.find(r=>r.printServerUri===e.group);this._selectedPrinter=s==null?void 0:s.printerList.find(r=>r.printerName===e.label)}renderNoPrinters(){return t("div",{class:"ez-flex ez-flex--justify-center ez-flex--align-items-center ez-size-height--full ez-size-width--full"},t("span",{class:"ez-text ez-text--primary ez-text--medium"},this.getMessage("snkPrintSelector.message.noPrinters")))}buildPrinterIcon(){return t("ez-icon",{iconName:"print",style:{marginRight:"var(--space--small)"}})}getElementID(e){return{[n.DATA_ELEMENT_ID_ATTRIBUTE_NAME]:n.getInternalIDInfo(e)}}getMessage(e){return this._application.messagesBuilder.getMessage(e,void 0)}componentWillLoad(){this._application=u.getContextValue("__SNK__APPLICATION__")}componentDidLoad(){this.element&&n.addIDInfo(this.element)}render(){return t(o,null,t("ez-popup",Object.assign({size:"small",heightMode:"full",useHeader:!1,ref:e=>this._ezPopup=e},this.getElementID("snk-print-selector")),t("ez-modal-container",{modalTitle:this.getMessage("snkPrintSelector.title.printerSelection"),okButtonLabel:this.getMessage("snkPrintSelector.button.print"),okButtonStatus:this._selectedPrinter?a.ENABLED:a.DISABLED,cancelButtonLabel:this.getMessage("snkPrintSelector.button.cancel"),onEzModalAction:e=>this.handleModalAction(e.detail)},this._isSingleJob&&t("div",{class:"ez-flex ez-margin-bottom--large"},t("div",{class:"ez-flex ez-margin-right--large"},t("span",{class:"ez-text ez-text--bold ez-text--medium ez-padding-right--small"},this.getMessage("snkPrintSelector.subtitle.document")),t("span",{class:"ez-text ez-text--primary ez-text--medium"},this._printJobData.pendingPrinters[0].docTypeDescription)),t("div",{class:"ez-flex ez-margin-right--large"},t("span",{class:"ez-text ez-text--bold ez-text--medium ez-padding-right--small"},this.getMessage("snkPrintSelector.subtitle.jobs")),t("span",{class:"ez-text ez-text--primary ez-text--medium"},this._printJobData.pendingPrinters[0].printJobCount))),t("ez-tabselector",{tabs:this.buildIdTabSelector(),onEzChange:e=>this.onChangeTab(e),selectedTab:this._printServerActive?this.REMOTE_PRINTERS_TAB:this.LOCAL_PRINTERS_TAB}),t("ez-view-stack",{ref:e=>this._viewStack=e},t("stack-item",{hidePolicy:"hide"},this._printServerActive&&t("div",{class:`list-scroll ez-size-height--full ${this._isSingleJob?"with-header":"without-header"}`},t("ez-list",{ref:e=>this._remotePrintersList=e,class:`ez-padding-top--medium ${this._hasRemotePrinters?"":"hidden"}`,dataSource:this._remotePrintersDataSource,onEzSelectItem:e=>this.onSelectPrinter(e.detail,!1),itemLeftSlotBuilder:this.buildPrinterIcon,useGroups:!0,ezSelectable:!0,hoverFeedback:!0,"data-element-id":"remotePrintersList"}),!this._hasRemotePrinters&&this.renderNoPrinters())),t("stack-item",{hidePolicy:"hide"},t("div",{class:`list-scroll ez-size-height--full ${this._isSingleJob?"with-header":"without-header"}`},t("ez-list",{ref:e=>this._localPrintersList=e,class:`ez-padding-top--medium ${this._hasLocalPrinters?"":"hidden"}`,dataSource:this._localPrintersDataSource,onEzSelectItem:e=>this.onSelectPrinter(e.detail,!0),itemLeftSlotBuilder:this.buildPrinterIcon,ezSelectable:!0,hoverFeedback:!0}),!this._hasLocalPrinters&&this.renderNoPrinters()))),t("ez-check",{label:this.getMessage("snkPrintSelector.message.savePrinter"),onEzChange:e=>this._saveSubstitute=e.detail}))))}get element(){return h(this)}};m.style=p;export{m as snk_print_selector};
//# sourceMappingURL=snk-print-selector.entry-9LumeWTm.js.map

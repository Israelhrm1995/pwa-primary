{"version":3,"file":"snk-print-selector.entry-BcM4d3hJ.js","sources":["../../node_modules/@sankhyalabs/sankhyablocks/dist/esm/snk-print-selector.entry.js"],"sourcesContent":["import { r as registerInstance, h, H as Host, g as getElement } from './index-479e1293.js';\nimport { P as PrintUtils } from './PrintUtils-3e4ff0f5.js';\nimport { ApplicationUtils } from '@sankhyalabs/ezui/dist/collection/utils';\nimport { ElementIDUtils, ApplicationContext } from '@sankhyalabs/core';\nimport ModalButtonStatus from '@sankhyalabs/ezui/dist/collection/components/ez-modal-container/modal-button-status';\n\nconst snkPrintSelectorCss = \".sc-snk-print-selector-h{max-height:100%}ez-modal-container.sc-snk-print-selector{--ez-modal-container-overflow-y:hidden}ez-list.sc-snk-print-selector{height:100%}.list-scroll.sc-snk-print-selector{height:100%;overflow-y:auto;padding-right:var(--snk-grid-config__main--padding-right)}.with-header.sc-snk-print-selector{max-height:calc(100% - 125px)}.without-header.sc-snk-print-selector{max-height:calc(100% - 85px)}.list-scroll.sc-snk-print-selector::-webkit-scrollbar{width:var(--space--small);min-width:var(--space--small);max-width:var(--space--small)}.hidden.sc-snk-print-selector{display:none}\";\n\nconst SnkPrintSelector = class {\n  constructor(hostRef) {\n    registerInstance(this, hostRef);\n    this.APPLY = \"OK\";\n    this.CANCEL = \"CANCEL\";\n    this.CLOSE = \"CLOSE\";\n    this.REMOTE_PRINTERS_TAB = '0';\n    this.LOCAL_PRINTERS_TAB = '1';\n    this._hasRemotePrinters = false;\n    this._hasLocalPrinters = false;\n    this._localPrinters = [];\n    this._isSingleJob = false;\n    this._saveSubstitute = false;\n    this.buildIdTabSelector = () => {\n      const defaultTabs = [\n        {\n          label: this.getMessage(\"snkPrintSelector.title.localPrintersTab\"),\n          tabKey: this.LOCAL_PRINTERS_TAB,\n          index: Number(this.LOCAL_PRINTERS_TAB)\n        }\n      ];\n      if (this._printServerActive) {\n        defaultTabs.unshift({\n          label: this.getMessage(\"snkPrintSelector.title.remotePrintersTab\"),\n          tabKey: this.REMOTE_PRINTERS_TAB,\n          index: Number(this.REMOTE_PRINTERS_TAB)\n        });\n      }\n      return [...defaultTabs];\n    };\n    this._printServerActive = false;\n    this._selectedPrinter = undefined;\n    this._remotePrintersDataSource = [];\n    this._localPrintersDataSource = [];\n    this._printJobData = undefined;\n  }\n  async openPrintSelector(printJobData) {\n    return new Promise((resolve) => {\n      this._printJobData = printJobData;\n      this._isSingleJob = this._printJobData.pendingPrinters.length === 1;\n      this._printServerActive = this._printJobData.printServerActive;\n      if (this._printServerActive) {\n        this.buildRemotePrinters();\n      }\n      else {\n        this.buildLocalPrinters();\n        this._viewStack.show(+this.LOCAL_PRINTERS_TAB);\n      }\n      this._ezPopup.opened = true;\n      this._printerResolver = resolve;\n    });\n  }\n  closePrintSelector() {\n    this._ezPopup.opened = false;\n    this.element.remove();\n  }\n  handleModalAction(evt) {\n    switch (evt) {\n      case this.APPLY:\n        this.handleApply();\n        break;\n      case this.CANCEL:\n      case this.CLOSE:\n        this.handleCancel();\n        break;\n    }\n  }\n  async handleCancel() {\n    const result = await ApplicationUtils.confirm(this.getMessage(\"snkPrintSelector.title.warning\"), this.getMessage(\"snkPrintSelector.message.canceledPrint\"));\n    if (result) {\n      this.closePrintSelector();\n      this._printerResolver({ selectedPrinter: undefined, saveSubstitute: false });\n    }\n  }\n  handleApply() {\n    this._printerResolver({ selectedPrinter: this._selectedPrinter, saveSubstitute: this._saveSubstitute });\n    this.closePrintSelector();\n  }\n  onChangeTab(evt) {\n    if (evt.detail.tabKey === this.LOCAL_PRINTERS_TAB) {\n      this.buildLocalPrinters();\n    }\n    this._viewStack.show(+evt.detail.tabKey);\n  }\n  buildRemotePrinters() {\n    const dataSource = [];\n    this._printJobData.printServers.forEach((printServer) => {\n      dataSource.push({\n        group: printServer.printServerUri,\n        items: printServer.printerList.map((printer) => ({\n          label: printer.printerName,\n          group: printServer.printServerUri\n        }))\n      });\n    });\n    this._remotePrintersDataSource = dataSource;\n    this._hasRemotePrinters = this._remotePrintersDataSource.length > 0;\n  }\n  buildLocalPrinters() {\n    if (this._localPrintersDataSource.length > 0)\n      return;\n    this._localPrinters = PrintUtils.getInstance().getLocalPrinters();\n    this._localPrintersDataSource = this._localPrinters.map((printer) => ({\n      label: printer.nome\n    }));\n    this._hasLocalPrinters = this._localPrintersDataSource.length > 0;\n  }\n  onSelectPrinter(printer, isLocal) {\n    if (isLocal) {\n      if (this._hasRemotePrinters)\n        this._remotePrintersList.removeSelection();\n      this._selectedPrinter = this._localPrinters.find((item) => item.nome === printer.label);\n      return;\n    }\n    if (this._hasLocalPrinters)\n      this._localPrintersList.removeSelection();\n    const serverGroup = this._printJobData.printServers.find((item) => item.printServerUri === printer.group);\n    this._selectedPrinter = serverGroup === null || serverGroup === void 0 ? void 0 : serverGroup.printerList.find((item) => item.printerName === printer.label);\n  }\n  renderNoPrinters() {\n    return (h(\"div\", { class: 'ez-flex ez-flex--justify-center ez-flex--align-items-center ez-size-height--full ez-size-width--full' }, h(\"span\", { class: 'ez-text ez-text--primary ez-text--medium' }, this.getMessage(\"snkPrintSelector.message.noPrinters\"))));\n  }\n  buildPrinterIcon() {\n    return (h(\"ez-icon\", { iconName: \"print\", style: { marginRight: 'var(--space--small)' } }));\n  }\n  getElementID(sufix) {\n    return {\n      [ElementIDUtils.DATA_ELEMENT_ID_ATTRIBUTE_NAME]: ElementIDUtils.getInternalIDInfo(sufix)\n    };\n  }\n  getMessage(path) {\n    return this._application.messagesBuilder.getMessage(path, undefined);\n  }\n  componentWillLoad() {\n    this._application = ApplicationContext.getContextValue(\"__SNK__APPLICATION__\");\n  }\n  componentDidLoad() {\n    if (!this.element)\n      return;\n    ElementIDUtils.addIDInfo(this.element);\n  }\n  render() {\n    return (h(Host, null, h(\"ez-popup\", Object.assign({ size: 'small', heightMode: 'full', useHeader: false, ref: (ref) => this._ezPopup = ref }, this.getElementID(\"snk-print-selector\")), h(\"ez-modal-container\", { modalTitle: this.getMessage(\"snkPrintSelector.title.printerSelection\"), okButtonLabel: this.getMessage(\"snkPrintSelector.button.print\"), okButtonStatus: this._selectedPrinter ? ModalButtonStatus.ENABLED : ModalButtonStatus.DISABLED, cancelButtonLabel: this.getMessage(\"snkPrintSelector.button.cancel\"), onEzModalAction: (evt) => this.handleModalAction(evt.detail) }, this._isSingleJob &&\n      h(\"div\", { class: 'ez-flex ez-margin-bottom--large' }, h(\"div\", { class: 'ez-flex ez-margin-right--large' }, h(\"span\", { class: 'ez-text ez-text--bold ez-text--medium ez-padding-right--small' }, this.getMessage(\"snkPrintSelector.subtitle.document\")), h(\"span\", { class: 'ez-text ez-text--primary ez-text--medium' }, this._printJobData.pendingPrinters[0].docTypeDescription)), h(\"div\", { class: 'ez-flex ez-margin-right--large' }, h(\"span\", { class: 'ez-text ez-text--bold ez-text--medium ez-padding-right--small' }, this.getMessage(\"snkPrintSelector.subtitle.jobs\")), h(\"span\", { class: 'ez-text ez-text--primary ez-text--medium' }, this._printJobData.pendingPrinters[0].printJobCount))), h(\"ez-tabselector\", { tabs: this.buildIdTabSelector(), onEzChange: (evt) => this.onChangeTab(evt), selectedTab: this._printServerActive ? this.REMOTE_PRINTERS_TAB : this.LOCAL_PRINTERS_TAB }), h(\"ez-view-stack\", { ref: (ref) => this._viewStack = ref }, h(\"stack-item\", { hidePolicy: 'hide' }, this._printServerActive &&\n      h(\"div\", { class: `list-scroll ez-size-height--full ${this._isSingleJob ? 'with-header' : 'without-header'}` }, h(\"ez-list\", { ref: (ref) => this._remotePrintersList = ref, class: `ez-padding-top--medium ${this._hasRemotePrinters ? '' : 'hidden'}`, dataSource: this._remotePrintersDataSource, onEzSelectItem: (evt) => this.onSelectPrinter(evt.detail, false), itemLeftSlotBuilder: this.buildPrinterIcon, useGroups: true, ezSelectable: true, hoverFeedback: true, \"data-element-id\": 'remotePrintersList' }), !this._hasRemotePrinters && this.renderNoPrinters())), h(\"stack-item\", { hidePolicy: 'hide' }, h(\"div\", { class: `list-scroll ez-size-height--full ${this._isSingleJob ? 'with-header' : 'without-header'}` }, h(\"ez-list\", { ref: (ref) => this._localPrintersList = ref, class: `ez-padding-top--medium ${this._hasLocalPrinters ? '' : 'hidden'}`, dataSource: this._localPrintersDataSource, onEzSelectItem: (evt) => this.onSelectPrinter(evt.detail, true), itemLeftSlotBuilder: this.buildPrinterIcon, ezSelectable: true, hoverFeedback: true }), !this._hasLocalPrinters && this.renderNoPrinters()))), h(\"ez-check\", { label: this.getMessage(\"snkPrintSelector.message.savePrinter\"), onEzChange: evt => this._saveSubstitute = evt.detail })))));\n  }\n  get element() { return getElement(this); }\n};\nSnkPrintSelector.style = snkPrintSelectorCss;\n\nexport { SnkPrintSelector as snk_print_selector };\n"],"names":["snkPrintSelectorCss","SnkPrintSelector","hostRef","registerInstance","defaultTabs","printJobData","resolve","evt","ApplicationUtils","dataSource","printServer","printer","PrintUtils","isLocal","item","serverGroup","h","sufix","ElementIDUtils","path","ApplicationContext","Host","ref","ModalButtonStatus","getElement"],"mappings":"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","x_google_ignoreList":[0]}
import{r as F,c,h as l,g as D}from"./index-BCuik2gT.js";import{S as g,O as C,A as E,U as I,D as S,E as k}from"./dataUnitInMemoryLoader-CwDmnNwL.js";import{A as v}from"./ApplicationContext-B_qAnYBt.js";import{K as L}from"./index-CXQTu0Xy.js";import"./FormLayout-CTCTPPNq.js";import{b as M,a as T,L as U}from"./search-column-Da0RZOkA.js";import{V as d,S as m}from"./constants-7b422de0-BRz2gykn.js";import{T as a}from"./taskbar-elements-171476d4-DU5Q282J.js";import"./DataFetcher-db08cad0-YRT7v6X1.js";import"./ISave-da565824-BpwjVTmC.js";import{S as O,R as G,b as P,a as N,C as w}from"./ClientSideExporterProvider-09dee1a3-C5roZqBq.js";import{P as p}from"./index-b40568ff-7Mtm7E1e.js";import{I as R}from"./dataunit-fetcher-1b78797a-B5AebLgP.js";import"./filter-item-type.enum-d45e026f-B41QHsvD.js";import{F as A}from"./form-config-fetcher-e623539b-ClsRvgut.js";import{T as z}from"./taskbar-processor-3436124c-7XYCPk7j.js";import{C as _}from"./ConfigStorage-cf578768-BCbBaPvX.js";import{S as b}from"./SnkFormConfigManager-c1cd9dcd-D0ra-Sa2.js";import{s as y}from"./index-b72af127-DBw8cbiA.js";import"./PrintUtils-3e4ff0f5-Dyc0ptsy.js";import"./IFetchDataExporterParams-d73bed3d-DNdoYuuf.js";import"./index-BdigElPL.js";import"./GetSelectedRecordsIDsInfo-9fa41508-Dkcln7_7.js";import"./constants-CKEKe-xZ.js";import"./ResourceIDUtils-a114189a-DSWFS9XU.js";class u{static applyCSSVars(e,i,n){const s=o=>o.href?o.href.indexOf(window.location.origin)===0:!0;Array.from(e.styleSheets).filter(s).forEach(o=>{Array.from(o.cssRules).filter(r=>r instanceof CSSStyleRule).forEach(r=>{Array.from(r.style).forEach(f=>{f.startsWith("--")&&u.applyIfExists(i,n,f)})})})}static applyVarsTextInput(e,i){i&&(u.applyIfExists(e,i,"--ez-text-input__input--background-color"),u.applyIfExists(e,i,"--ez-text-input__input--border-color"),u.applyIfExists(e,i,"--ez-text-input--height"),u.applyIfExists(e,i,"--ez-text-input__input--disabled--background-color"),u.applyIfExists(e,i,"--ez-text-input__input--disabled--color"),u.applyIfExists(e,i,"--ez-text-input--height--slim"),u.applyIfExists(e,i,"--ez-text-input--border-radius"),u.applyIfExists(e,i,"--ez-text-input__input--focus--border-color"),u.applyIfExists(e,i,"--ez-text-input__icon--width"),u.applyIfExists(e,i,"--ez-text-input__input--focus--icon-color"),u.applyIfExists(e,i,"--ez-text-input__margin-bottom"))}static applyVarsButton(e,i){i&&["--ez-button--min-width","--ez-button--height","--ez-button__icon--width","--ez-button__inline__icon--padding","--ez-button--padding-top","--ez-button--padding-bottom","--ez-button--padding-right","--ez-button--padding-left","--ez-button--color","--ez-button--font-size","--ez-button--font-family","--ez-button--font-weight","--ez-button--background-color","--ez-button--border-radius","--ez-button--border","--ez-button--hover-color","--ez-button--hover--background-color","--ez-button--disabled-color","--ez-button--disabled--background-color","--ez-button--focus--border","--ez-button--focus--box-shadow","--ez-button--active-color","--ez-button--active--background-color","--ez-button--link-color","--ez-button--link--hover-color","--ez-button--link--small--font-size","--ez-button--link--medium--font-size","--ez-button--link--large--font-size"].forEach(n=>{u.applyIfExists(e,i,n)})}static applyVarsGrid(e,i){i&&["--ez-grid--min-height","--snk-grid-min-height"].forEach(n=>{const s=getComputedStyle(e).getPropertyValue(n);s!=null&&i.style.setProperty(n,s)})}static applyIfExists(e,i,n){const s=getComputedStyle(e).getPropertyValue(n);s&&i.style.setProperty(n,s)}}const x=["INSERT","REFRESH","PREVIOUS","NEXT","DIVIDER","MORE_OPTIONS"],B=["INSERT","REFRESH","PREVIOUS","NEXT","DIVIDER","CLONE","REMOVE","DIVIDER","MORE_OPTIONS"],V=".sc-snk-simple-crud-h{display:flex;height:100%;width:100%;--snk-simple-crud-grid--min-height:300px}.simple-crud__container.sc-snk-simple-crud{display:grid;grid-template-rows:auto 1fr;height:100%;width:100%}.simple-crud__container-section.sc-snk-simple-crud{flex-wrap:unset;flex-direction:column}.simple-crud__form--hidden.sc-snk-simple-crud{display:none}ez-grid.sc-snk-simple-crud{--ez-grid__container--shadow:none;--ez-grid__container--shadow--outline:none;--ez-grid--min-height:var(--snk-simple-crud-grid--min-height)}ez-form.sc-snk-simple-crud{min-height:300px}",H=class{constructor(t){F(this,t),this.dataStateChange=c(this,"dataStateChange",3),this.dataUnitReady=c(this,"dataUnitReady",3),this.actionClick=c(this,"actionClick",7),this.formItemsReady=c(this,"formItemsReady",7),this.configuratorSave=c(this,"configuratorSave",7),this.configuratorCancel=c(this,"configuratorCancel",7),this._multiSelectionListDataSource=new O,this._formConfigFetcher=new A,this._customEditors=new Map,this._customRenders=new Map,this._container=void 0,this._showPopUpGridConfig=!1,this._currentViewMode=d.GRID,this._config=void 0,this._fieldToGetFocus=void 0,this._customContainerId=`SNK-SIMPLE-CRUD-CUSTOM-CONTAINER-${g.generateUUID()}`,this.enableLockManagerLoadingComp=!1,this.enableLockManagerTaskbarClick=!1,this.dataState=void 0,this.dataUnit=void 0,this.entityName=void 0,this.mode=m.SERVER,this.gridConfig=void 0,this.formConfig=void 0,this._formFields=[],this._fieldsProps=new Map,this.enableContinuousInsert=!1,this.multipleSelection=void 0,this.useCancelConfirm=!0,this.pageSize=150,this.resourceID=void 0,this.enableGridInsert=!1,this.paginationCounterMode="auto",this.taskbarManager=void 0,this.messagesBuilder=void 0,this.useEnterLikeTab=!1,this.actionsList=void 0,this.configName=void 0,this.showConfiguratorButtons=!1,this.gridLegacyConfigName=void 0,this.formLegacyConfigName=void 0,this.ignoreReadOnlyFormFields=!1,this.autoFocus=!0,this.domainMessagesBuilder=void 0,this.multipleEditionEnabled=!0,this.layoutFormConfig=!1,this.autoLoad=void 0,this.outlineMode=!1}async addCustomEditor(t,e){if(this._grid&&this._form){this._grid.addCustomEditor(t,e),this._form.addCustomEditor(t,e);return}const i=new Map(this._customEditors);i.set(t,e),this._customEditors=i}async addGridCustomRender(t,e){if(this._grid){this._grid.addGridCustomRender(t,e);return}const i=new Map(this._customRenders);i.set(t,e),this._customRenders=i}async handleResourceIDChanged(t,e){g.isEmpty(t)||t!==e&&(await this.loadFormConfig(!0),await this.loadGridConfig(!0))}async addCustomValueFormatter(t,e){this._grid.addCustomValueFormatter(t,e)}async removeCustomValueFormatter(t){this._grid.removeCustomValueFormatter(t)}async setFieldProp(t,e,i){const n=new Map(this._fieldsProps),s=this._fieldsProps.get(t);n.set(t,Object.assign(Object.assign({},s),{[e]:i})),this._fieldsProps=n}loadTaskbarProcessor(){const t={};t[h.FORM_REGULAR]=this.getButtons(!1,[a.GRID_MODE],!0),t[h.GRID_REGULAR]=this.getButtons(!1,[a.DATA_EXPORTER,a.FORM_MODE]),t[h.FORM_SELECTED]=this.getButtons(!0,[a.GRID_MODE],!0),t[h.GRID_SELECTED]=this.getGridSelectedButtonsCallBack.bind(this),t[h.FINISH_EDITION]=this.getFinishEditionButtonsCallback.bind(this),t[h.MULTIPLE_EDITION]=[a.CANCEL],this._taskbarProcessor=new z(t)}getGridSelectedButtonsCallBack(){var t,e,i;return!this.multipleEditionEnabled||((i=(e=(t=this.dataState)===null||t===void 0?void 0:t.selectionInfo)===null||e===void 0?void 0:e.records)===null||i===void 0?void 0:i.length)===1?this.getButtons(!0,[a.DATA_EXPORTER,a.FORM_MODE]):this.getButtons(!0,[a.UPDATE_MULTIPLE,a.DATA_EXPORTER,a.FORM_MODE])}getFinishEditionButtonsCallback(){const t=[a.CANCEL,a.SAVE];return this.enableGridInsert&&this._currentViewMode!==d.ATTACHMENT&&t.push(this._currentViewMode===d.GRID?a.FORM_MODE:a.GRID_MODE),t}getButtons(t,e,i){let n=t?B:x;return i&&(n=n.filter(s=>s!==a.REFRESH)),this.addConfigButton(this.resolveInMemoryBtns(n).concat(e))}addConfigButton(t){return this.configName===void 0||this.configName&&this.gridLegacyConfigName?t:t.concat(a.CONFIGURATOR)}get application(){return v.getContextValue("__SNK__APPLICATION__")}resolveInMemoryBtns(t){const e=[...t];return this.mode===m.IN_MEMORY&&e.splice(1,1),e}async goToView(t){this._currentViewMode=t,this._viewStack&&(t===d.GRID&&(this.dataUnit.isMultipleEdition=!1),this._viewStack.show(t)),t===d.GRID&&requestAnimationFrame(()=>this.focusToGrid()),t===d.FORM&&requestAnimationFrame(()=>this.focusToForm())}actionClickListener(t){this.handleTaskbarAction(t.detail),t.stopPropagation()}handleTaskbarAction(t){switch(t){case a.CONFIGURATOR:this._snkConfigurator.open();break;case a.GRID_MODE:this.goToView(d.GRID);break;case a.FORM_MODE:this.goToView(d.FORM);break;case a.UPDATE_MULTIPLE:this.dataUnit.isMultipleEdition=!0,this.goToView(d.FORM);break}}async onChangeEntityName(t){if(this.dataUnit)return;const e=v.getContextValue("__SNK__APPLICATION__");this.dataUnit=await e.getDataUnit(t,null,null,this.configName)}onModeChange(){this.mode==m.IN_MEMORY&&this.initInMemoryDataUnit()}observeDataState(t,e){this.handleDataStateChange(t,e)}async observeFormLegacy(t,e){await this.handleUpdateFormLegacyConfig(t,e)}async observeGridLegacy(t,e){await this.handleUpdateGridLegacyConfig(t,e)}async handleDataStateChange(t,e){C.objectToString(e)!=C.objectToString(t)&&this.dataStateChange.emit(t),await this.processRmPrecision()}async processRmPrecision(){var t,e;const i=await this._snkDataUnit.getFieldsWithRmPrecision();for(const n of i||[]){if(!n)continue;const s=(e=(t=this.dataState)===null||t===void 0?void 0:t.rowMetadata)===null||e===void 0?void 0:e.getProp("rm_precision",n);!s&&s!==0||(await this.setFieldProp(n,"precision",s),await this.setFieldProp(n,"prettyPrecision",s))}this._rmPrecisionCustomValueFormatter.setDataState(this.dataState)}async handleUpdateGridLegacyConfig(t,e){t==null||t==e||this._gridConfigAlreadyLoaded&&await this.loadGridConfig(!0)}async handleUpdateFormLegacyConfig(t,e){t==null||t==e||this._formConfigAlreadyLoaded&&await this.loadFormConfig(!0)}openConfig(t){this._snkConfigurator.close(),t===d.GRID?this.openGridConfig():t===d.FORM&&this.openFormConfig()}openGridConfig(){this._grid.getColumnsState().then(t=>{this._snkGridConfig.columns=t.filter(e=>e.name),this._snkGridConfig.selectedIndex=0,this._showPopUpGridConfig=!0})}async openFormConfig(){(this.formLegacyConfigName||this.configName)&&await this._snkSimpleFormConfig.show()}addGridLegacyConfigName(){this.gridLegacyConfigName&&this.configName&&_.addGridLegacyConfig(this.configName,this.gridLegacyConfigName)}loadGridConfig(t){if(this.configName!==void 0&&!((this.gridConfig!=null||this._gridConfigAlreadyLoaded)&&!t))return this.addGridLegacyConfigName(),this._gridConfigAlreadyLoaded=!0,new Promise((e,i)=>{_.loadGridConfig(this.configName,this.resolveResourceID()).then(n=>{this.setGridConfig(n),e()}).catch(n=>{i(n)})})}formConfigIsLoaded(){return this.formConfig!=null||this._formConfigAlreadyLoaded}async loadFormConfig(t=!1,e=!1){if(this.configName===void 0||(this._formConfigManager==null&&(this._formConfigManager=new b(this.configName,this.resolveResourceID(),void 0,this.dataUnit),this._formConfigManager.setConfig(this.formConfig)),this.formConfigIsLoaded()&&!t))return;this._formConfigAlreadyLoaded=!0;let i=await this._formConfigFetcher.fetchLegacyConfigurableForm(this.formLegacyConfigName);if(i!=null){this._formConfigManager.setConfig(i),this.setFormConfig(i,e);return}this.setFormConfig(await this._formConfigManager.loadConfig())}async componentWillRender(){this.loadTaskbarProcessor(),this._resourceID=await this.application.getResourceID(),this.dataExporterProviderStore(),this.dataExporterProviderStore(),this._taskbarProcessor.process(this.getTaskBarId(),this.taskbarManager,this.dataState,this.getTaskBarDisabledButtons()),this.configName!==void 0&&(this.gridConfig!=null||this._gridConfigAlreadyLoaded||(await this.addGridLegacyConfigName(),await this.loadGridConfig(),await this.loadFormConfig()))}componentDidRender(){this._rmPrecisionCustomValueFormatter.setGrid(this._grid),this.addGridCustomValueFormattters(),this.setFieldsProps(),this.setCustomRenders(),this.setCustomEditors()}componentWillLoad(){this.processMetadata(),this.onModeChange(),this.configDatasource(),this._rmPrecisionCustomValueFormatter=new G,this._continuousInsertUtils=new P(this.application,this.resolveResourceID(),this.configName),this.enableGridInsert&&this._continuousInsertUtils.getConfig().then(t=>this.enableContinuousInsert=t)}componentDidLoad(){u.applyVarsGrid(this._element,this._grid),this.initKeyboardManager(),this.dataUnit.subscribe(this.dataUnitActionHandler.bind(this))}async dataUnitActionHandler(t){(t.type===E.EDITION_CANCELED||t.type===E.DATA_SAVED)&&this.dataUnit.isMultipleEdition&&this.goToView(d.GRID)}disconnectedCallback(){var t;(t=this._keyboardManager)===null||t===void 0||t.unbindAllShortcutKeys()}setCustomRenders(){if(this._grid)for(const[t,e]of this._customRenders)this._grid.addGridCustomRender(t,e),this._customRenders.delete(t)}setCustomEditors(){if(!(!this._grid||!this._form))for(const[t,e]of this._customEditors)this._grid.addCustomEditor(t,e),this._form.addCustomEditor(t,e),this._customEditors.delete(t)}configDatasource(){this._multiSelectionListDataSource.setApplication(this.application),this._multiSelectionListDataSource.setDataUnit(this.dataUnit)}setFieldsProps(){if(this._form)for(const[t,e]of this._fieldsProps){for(const i in e)this._form.setFieldProp(t,i,e[i]);this._fieldsProps.delete(t)}}getTaskBarId(){var t,e;return!((t=this.dataState)===null||t===void 0)&&t.isDirty?h.FINISH_EDITION:this.dataUnit.isMultipleEdition?h.MULTIPLE_EDITION:!((e=this.dataState)===null||e===void 0)&&e.selectionInfo&&!this.dataState.selectionInfo.isAllRecords()&&this.dataState.selectionInfo.length>0?this._currentViewMode===d.GRID?h.GRID_SELECTED:h.FORM_SELECTED:this._currentViewMode===d.GRID?h.GRID_REGULAR:h.FORM_REGULAR}initInMemoryDataUnit(){this._inMemoryLoader=new R(this._metadata,void 0,{autoLoad:this.autoLoad}),this.dataUnit=this._inMemoryLoader.dataUnit,this.dataUnitReady.emit(this.dataUnit)}setMetadata(t){return this._inMemoryLoader?this._inMemoryLoader.metadata=t:this.dataUnit&&(this.dataUnit.metadata=t),Promise.resolve()}setRecords(t){return this._inMemoryLoader?this._inMemoryLoader.records=t:this.dataUnit&&(this.dataUnit.records=t),Promise.resolve()}getRecords(){return Promise.resolve(this.dataUnit.records)}async openConfigurator(){var t;(t=this._snkConfigurator)===null||t===void 0||t.open()}async closeConfigurator(){var t;(t=this._snkConfigurator)===null||t===void 0||t.close()}async updateConfig(){this._formConfigManager==null&&(this._formConfigManager=new b(this.configName,this.resolveResourceID())),this._formConfigManager.setConfig(this.formConfig)}processMetadata(){const t=this._element.querySelectorAll("snk-field-metadata"),e=[],i={fields:[],emptyConfig:!1};t.forEach(n=>{const s={name:n.getAttribute("name")||n.getAttribute("label"),label:n.getAttribute("label"),dataType:S[n.getAttribute("dataType")]||S.TEXT,userInterface:I[n.getAttribute("userInterface")]||I.SHORTTEXT,readOnly:n.getAttribute("readOnly")=="true",required:n.getAttribute("required")=="true",tab:n.getAttribute("tab")||void 0,visible:n.getAttribute("visible")!="false"},o={name:s.name,tab:s.tab,visible:s.visible};i.fields.push(o),e.push(s)}),e.length>0&&(this.formConfig||(this.formConfig=i),this._metadata={name:"SimpleCrud",label:"SimpleCrud",fields:e})}addGridCustomValueFormattters(){var t,e,i;const n=((t=this._metadata)===null||t===void 0?void 0:t.fields)||((i=(e=this.dataUnit)===null||e===void 0?void 0:e.metadata)===null||i===void 0?void 0:i.fields);if(!n)return;const s=[];n.forEach(o=>{var r;!((r=o.properties)===null||r===void 0)&&r.rm_precision&&!s.includes(o.name)&&s.push(o.name)}),s.forEach(o=>{this.addCustomValueFormatter(o,this._rmPrecisionCustomValueFormatter)})}onDataStateChange(t){this.dataState=Object.assign({},t.detail)}getTaskBarDisabledButtons(){var t,e,i,n,s,o;const r=[];return!((t=this.dataState)===null||t===void 0)&&t.hasNext||r.push(a.NEXT),!((e=this.dataState)===null||e===void 0)&&e.hasPrevious||r.push(a.PREVIOUS),!((n=(i=this.dataState)===null||i===void 0?void 0:i.selectionInfo)===null||n===void 0)&&n.isEmpty()&&r.push(a.FORM_MODE),((o=(s=this.dataState)===null||s===void 0?void 0:s.selectionInfo)===null||o===void 0?void 0:o.length)>1&&r.push(a.CLONE),r}handleCancelEdit(){var t;!((t=this.dataState)===null||t===void 0)&&t.recordsIsEmpty&&(this.goToView(d.GRID),this.dataUnit.clearSelection())}handleConfiguratorEvent(t,e){if(t.stopImmediatePropagation(),e==="SAVE"){this.configuratorSave.emit();return}this.configuratorCancel.emit()}onSelectField(t){t!=null&&(this._fieldToGetFocus=t.value)}getFieldSearch(t,e){return this._fieldSearch!=null?this._fieldSearch:(this._splitButtonForm=t,this._fieldSearch=M(e,({argument:i})=>this.fieldsOptionLoader(i),i=>this.onSelectField(i)),this._fieldSearch)}getFormFields(){var t,e;return(e=(t=this.formConfig)===null||t===void 0?void 0:t.fields)!==null&&e!==void 0?e:this._formFields}handleFormSetFields(t){C.equals(this._formFields,t)||(this._formFields=t??[])}fieldsOptionLoader(t){const e=t==null?void 0:t.toLowerCase(),s=this.getFormFields().map(o=>{var r;return(r=this.dataUnit)===null||r===void 0?void 0:r.getField(o.name)}).filter(o=>{var r,f;return((r=o.name)===null||r===void 0?void 0:r.toLowerCase().includes(e))||((f=o.label)===null||f===void 0?void 0:f.toLowerCase().includes(e))}).map(o=>({value:o.name,label:o.label}));return Promise.resolve(s)}isGridInsertActive(){return this.enableGridInsert&&this.dataUnit.hasNewRecord()}getColumnSearch(t,e){return this._columnSearch!=null?this._columnSearch:(this._splitButton=t,this._columnSearch=M(e,({argument:i})=>new Promise(n=>{this._grid.filterColumns(i).then(s=>{n(s.filter(o=>!o.hidden).map(o=>({label:o.label,value:o.name})))})}),i=>{i!=null&&this._grid.locateColumn(i.value)}),this._columnSearch)}getActionsList(){const t=[];if(this.enableGridInsert&&t.push(this._continuousInsertUtils.actionContinuousInsert(this.enableContinuousInsert,()=>{this.enableContinuousInsert=!this.enableContinuousInsert,this._continuousInsertUtils.handleSaveConfig(this.enableContinuousInsert)})),this.isGridInsertActive())return t;if(this.taskbarManager!=null&&this.taskbarManager.getMoreOptions!=null){const e=this.getTopTaskBarId();return t.concat(this.taskbarManager.getMoreOptions(e,this.configName,this.dataState,this.actionsList))}return t.concat(this.actionsList)}getSettingsListGrid(){var t,e;return[{value:g.generateUUID(),label:(e=(t=this.messagesBuilder)===null||t===void 0?void 0:t.getMessage("snkSimpleCrud.findColumn",{}))!==null&&e!==void 0?e:T,disableCloseOnSelect:!0,eagerInitialize:!0,itemBuilder:(n,s)=>this.getColumnSearch(n,s)}]}getSettingsListForm(){var t,e;return[{value:g.generateUUID(),label:(e=(t=this.messagesBuilder)===null||t===void 0?void 0:t.getMessage("snkSimpleCrud.findFields",{}))!==null&&e!==void 0?e:U,disableCloseOnSelect:!0,eagerInitialize:!0,itemBuilder:(n,s)=>this.getFieldSearch(n,s)}]}getTopTaskBarId(){var t;return!((t=this.dataState)===null||t===void 0)&&t.isDirty?`snkGridTopTaskbar.finish_edition${p.PRIMARY}`:`snkGridTopTaskbar.regular${p.PRIMARY}`}clearFieldToFocusHandler(){this._fieldToGetFocus=void 0}gridConfigChangeHandler(t){if(t.stopPropagation(),!this.configName)return;const e=t.detail;_.saveGridConfig(e,this.configName,this.resolveResourceID())}modalConfigChangeHandler(t){const e=t.detail;this._grid.setColumnsState(e.columns).then(()=>{this.setGridConfig(e),this.closeGridConfig(),this.dataExporterProviderStore()}),t.stopPropagation()}async dataExporterProviderStore(){if(this.dataUnit==null||this._grid==null)return;const t=new N(this.dataUnit,this._grid);y.set("exporterProviders",Object.assign(Object.assign({},y.get("exporterProviders")),{[this.getDataExporterStoreKey()]:t}))}getDataExporterStoreKey(){return`SnkSimpleCrudDataExporter:${this.configName==null?this.dataUnit.name:this.configName}`}setGridConfig(t){this.gridConfig=t,w.assertDefaultSorting(this.gridConfig,this.dataUnit)}setFormConfig(t,e){this.formConfig&&!e||(this.formConfig=t)}closeGridConfig(){this._showPopUpGridConfig=!1}getPageSize(){return this.mode===m.IN_MEMORY?0:this.pageSize==null?150:this.pageSize}resolveResourceID(){return g.isEmpty(this.resourceID)?this._resourceID:this.resourceID}getFormConfig(){var t;const e=(t=this._formConfigManager)===null||t===void 0?void 0:t.getConfig(this.dataUnit,this.ignoreReadOnlyFormFields);return!this.configName&&!e?this.formConfig:e}updateFormConfig(){let t=this.formConfig;this.formLegacyConfigName==null&&(t=Object.assign(Object.assign({},this.formConfig),{fields:this.dataUnit.metadata.fields})),this.setFormConfig(t,!0),this._formConfigManager==null&&(this._formConfigManager=new b(this.configName,this.resolveResourceID())),this._formConfigManager.setConfig(this.formConfig)}handleDataUnitOnInsertionMode(){this.enableGridInsert||this.goToView(d.FORM)}async initKeyboardManager(){var t;this._keyboardManager=new L({propagate:!1,element:this._element});const e=this.dataUnit||await((t=this._snkDataUnit)===null||t===void 0?void 0:t.getDataUnit());e!=null&&this._keyboardManager.bind("F7",()=>e.saveData(),{description:"Salva os dados.",element:this._element}).bind("F8",e.addRecord.bind(e),{description:"Adiciona um novo registro.",element:this._element}).bind("F9",e.removeSelectedRecords.bind(e),{description:"Remove o registro selecionado.",element:this._element}).bind("Escape",()=>{e.isDirty()&&e.cancelEdition()},{debounceTime:1e3,description:"Cancela uma ação.",element:this._element})}async handleFormConfigSaved(){await this.loadFormConfig(!0,!0)}focusToGrid(){this._grid.focus()}focusToForm(){this._form.focus()}renderTaskbarContent(t){var e;return l("snk-taskbar",{class:`ez-box--no-outline ez-box ${this._currentViewMode===d.FORM?(this.outlineMode?"ez-box--outline":"ez-box--shadow-xsmall")+" ez-padding--small":""}`,dataUnit:this.dataUnit,primaryButton:!((e=this.dataState)===null||e===void 0)&&e.isDirty?"SAVE":"INSERT","data-element-id":"grid_left",messagesBuilder:this.messagesBuilder,buttons:this._taskbarProcessor.buttons,actionsList:this.getActionsList(),actionsSettingsList:t===d.GRID?this.getSettingsListGrid():this.getSettingsListForm(),disabledButtons:this._taskbarProcessor.disabledButtons,customButtons:this._taskbarProcessor.customButtons,"data-exporter-store-key":this.getDataExporterStoreKey(),slot:"leftButtons",presentationMode:p.SECONDARY,tabindex:"0"},l("slot",{name:"TASKBAR_CUSTOM_ELEMENTS"}))}render(){var t;if(this.dataUnit!=null)return l("snk-data-unit",{ref:e=>this._snkDataUnit=e,class:"simple-crud__container",dataUnit:this.dataUnit,useCancelConfirm:this.useCancelConfirm,onDataStateChange:e=>this.onDataStateChange(e),onCancelEdition:this.handleCancelEdit.bind(this),pageSize:this.getPageSize(),onInsertionMode:this.handleDataUnitOnInsertionMode.bind(this),onDataUnitReady:e=>this.dataUnitReady.emit(e.detail),onMessagesBuilderUpdated:e=>this.messagesBuilder=e.detail,onDataUnitFieldsHidded:this.updateFormConfig.bind(this),domainMessagesBuilder:this.domainMessagesBuilder},l("header",null,l("slot",{name:"snkSimpleCrudHeader"})),l("section",{class:`ez-box ez-box--no-outline ${this.outlineMode?"ez-box--outline":"ez-box--shadow"} simple-crud__container-section`,ref:e=>this._container=e,tabindex:"0"},l("ez-view-stack",{ref:e=>this._viewStack=e,"data-element-id":"simple-crud"},l("stack-item",null,l("ez-grid",{class:"ez-margin-bottom--large ez-box--no-outline",ref:e=>this._grid=e,dataUnit:this.dataUnit,config:this.gridConfig,"no-header":!0,multipleSelection:this.multipleSelection,onEzDoubleClick:()=>this.goToView(d.FORM),onConfigChange:e=>this.gridConfigChangeHandler(e),columnfilterDataSource:this.dataUnit.name&&this.dataUnit.name.includes(R.IN_MEMORY_DATA_UNIT_NAME)?void 0:this._multiSelectionListDataSource,useEnterLikeTab:this.useEnterLikeTab,autoFocus:this.autoFocus,enableGridInsert:this.enableGridInsert,enableContinuousInsert:this.enableContinuousInsert,enableLockManagerTaskbarClick:this.enableLockManagerTaskbarClick,enableLockManagerLoadingComp:this.enableLockManagerLoadingComp,outlineMode:this.outlineMode,tabindex:"0",paginationCounterMode:this.paginationCounterMode},this.renderTaskbarContent(d.GRID),l("div",{slot:"footer"},l("slot",{name:"snkSimpleCrudFooter"})))),l("stack-item",null,this.renderTaskbarContent(d.FORM),l("ez-form",{ref:e=>this._form=e,class:"ez-margin-top--large  ez-box--no-outline",dataUnit:this.dataUnit,config:this.getFormConfig(),fieldToFocus:this._fieldToGetFocus,onEzFormSetFields:e=>this.handleFormSetFields(e.detail),onEzFormRequestClearFieldToFocus:this.clearFieldToFocusHandler.bind(this),elementFocusSearchField:this._container,tabindex:"0"}),l("snk-simple-form-config",{ref:e=>this._snkSimpleFormConfig=e,dataUnit:this.dataUnit,onSnkConfigSaved:this.handleFormConfigSaved.bind(this),configName:(t=this.formLegacyConfigName)!==null&&t!==void 0?t:this.configName})),this.messagesBuilder&&l("snk-configurator",{ref:e=>this._snkConfigurator=e,viewMode:this._currentViewMode,messagesBuilder:this.messagesBuilder,onConfigSelected:e=>this.goToView(e.detail),onOpenConfig:e=>this.openConfig(e.detail),showActionButtons:this.showConfiguratorButtons,onSave:e=>this.handleConfiguratorEvent(e,"SAVE"),onCancel:e=>this.handleConfiguratorEvent(e,"CANCEL"),resourceID:this.resolveResourceID(),customContainerId:this._customContainerId,layoutFormConfig:this.layoutFormConfig})),l("div",{id:`${this._customContainerId}`},l("slot",{name:"SnkConfigContainerSlot"}))),l("ez-popup",{size:"medium",heightMode:"auto",useHeader:!1,opened:this._showPopUpGridConfig,onEzClosePopup:()=>this.closeGridConfig()},l("snk-grid-config",{ref:e=>this._snkGridConfig=e,config:this.gridConfig,"data-element-id":this._element.getAttribute(k.DATA_ELEMENT_ID_ATTRIBUTE_NAME),selectedIndex:0,configName:this.configName,onConfigChange:e=>this.modalConfigChangeHandler(e),onConfigCancel:()=>this.closeGridConfig(),resourceID:this.resolveResourceID()})))}get _element(){return D(this)}static get watchers(){return{resourceID:["handleResourceIDChanged"],entityName:["onChangeEntityName"],mode:["onModeChange"],dataState:["observeDataState"],formLegacyConfigName:["observeFormLegacy"],gridLegacyConfigName:["observeGridLegacy"]}}};var h;(function(t){t.FORM_REGULAR="snkSimpleCrudTaskbar.form_regular",t.GRID_REGULAR="snkSimpleCrudTaskbar.grid_regular",t.FORM_SELECTED="snkSimpleCrudTaskbar.form_selected",t.GRID_SELECTED="snkSimpleCrudTaskbar.grid_selected",t.FINISH_EDITION="snkSimpleCrudTaskbar.finish_edition",t.MULTIPLE_EDITION="snkSimpleCrudTaskbar.multiple_edition"})(h||(h={}));H.style=V;export{H as snk_simple_crud};
//# sourceMappingURL=snk-simple-crud.entry-DFeEFxhV.js.map

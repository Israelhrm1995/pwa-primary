import{r as _,c as d,h as l,H as v,g as f}from"./index-a3IjaFud.js";import{A as r,L as S,b as k,c as b,S as u,d as T,E as A}from"./dataUnitInMemoryLoader-BjgoPaoq.js";import{A as p}from"./ApplicationContext-B_qAnYBt.js";import{O as c,a as I}from"./index-BWOKysts.js";import{A as m}from"./AuthorizationConfig-dcbd207a-CB05oqv_.js";import{T as i,V as C,A as E,b as g,a as O}from"./taskbar-elements-171476d4-BPt8a2si.js";import{P as h}from"./index-b40568ff-7Mtm7E1e.js";import"./index-b72af127-DA7C94b9.js";const F=".sc-snk-taskbar-h{display:flex;flex-wrap:wrap}.no-wrap.sc-snk-taskbar-h{flex-wrap:nowrap}.full-width.sc-snk-taskbar-h{width:100%}.align-right.sc-snk-taskbar-h{justify-content:flex-end}.overflowed.sc-snk-taskbar{display:none}",L=class{constructor(t){_(this,t),this.actionClick=d(this,"actionClick",7),this.taskbarSaveLocker=d(this,"taskbarSaveLocker",7),this.taskbarSaveUnlocker=d(this,"taskbarSaveUnlocker",7),this.TASKBAR_ITEM_ID_PREFIX="TASKBAR_ITEM_",this.TASKBAR_CUSTOM_ELEMENTS_CONTAINER_CLASS_NAME="taskbar-custom-elements-container",this.ACTIONS_BUTTON_TAG="TASKBAR-ACTIONS-BUTTON",this.NOT_OVERFLOW_ELEMENTS=["moreOptions","dataExporter_snkDataExporter","actionsButton_snkActionsButton"],this.TASKBAR_CUSTOM_ELEMENTS="taskbar-custom-elements-container",this._titleKeyByElement={[i.UPDATE_MULTIPLE]:"snkTaskbar.titleUpdateMultiple",[i.UPDATE]:"snkTaskbar.titleUpdate",[i.PREVIOUS]:"snkTaskbar.titlePrevious",[i.NEXT]:"snkTaskbar.titleNext",[i.REFRESH]:"snkTaskbar.titleRefresh",[i.CLONE]:"snkTaskbar.titleClone",[i.REMOVE]:"snkTaskbar.titleRemove",[i.MORE_OPTIONS]:"snkTaskbar.titleMoreOptions",[i.INSERT]:"snkTaskbar.titleInsert",[i.CANCEL]:"snkTaskbar.titleCancel",[i.SAVE]:"snkTaskbar.titleSave",[i.GRID_MODE]:"snkTaskbar.titleGridMode",[i.FORM_MODE]:"snkTaskbar.titleFormMode",[i.CONFIGURATOR]:"snkTaskbar.titleConfigurator",[i.ATTACH]:"snkTaskbar.titleAttach"},this.onSaveEvent=e=>{switch(e.type){case r.FIELD_INVALIDATED:case r.INVALIDATE_CLEAN:case r.DATA_SAVED:case r.SAVING_ERROR:case r.SAVING_CANCELED:this._isWaitingForSave=!1;break;case r.SAVING_DATA:this._isWaitingForSave=!0;break}},this._permissions=void 0,this._overFlowedElements=[],this._customElements=void 0,this._customElementsId=void 0,this._slotContainer=void 0,this._hiddenActionsList=[],this._lastWidth=void 0,this._hasToUpdateOverFlow=!1,this._isWaitingForSave=!1,this.alignRigth=!1,this.customSlotId="TASKBAR_CUSTOM_ELEMENTS",this.customContainerId=void 0,this.overflowStrategy="hiddenItems",this.configName=void 0,this.resourceID=void 0,this.buttons=void 0,this.customButtons=void 0,this.actionsList=void 0,this.actionsSettingsList=void 0,this.primaryButton=void 0,this.disabledButtons=void 0,this.dataUnit=void 0,this.presentationMode=h.PRIMARY,this.messagesBuilder=void 0}handleCustomSlotElementsLoaded(t){this.hasToSearchCustomElements(t)&&this.getCustomElements(!0)}handleTaskbarSaveLocker(){this._isWaitingForSave!==!0&&(this._isWaitingForSave=!0)}handleTaskbarSaveUnlocker(){this._isWaitingForSave===!0&&(this._isWaitingForSave=!1)}hasToSearchCustomElements(t){return this.customSlotId===t.detail&&!this._slotContainer}observeButtons(){this._definitions=void 0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{var t;return(t=this._overFlowWatcher)===null||t===void 0?void 0:t.forceUpdate()})})}observeDisabledButtons(){var t;(t=this._overFlowWatcher)===null||t===void 0||t.forceUpdate()}observeLastWidth(t,e){e===0&&t!==0&&(this._hasToUpdateOverFlow=!0)}observeIsWaitingForSave(t,e){t==!0&&e==!1&&this.taskbarSaveLocker.emit(),t==!1&&e==!0&&this.taskbarSaveUnlocker.emit()}elementsFromString(t){const e=[];return t==null||t.split(",").forEach(s=>{s=s.trim(),(C[s]||this.isAllowed(s))&&e.push(s.trim())}),e}isAllowed(t){return t===E.CONFIGURATOR?this._permissions?this._permissions.isSup||this._permissions[m.CONFIG_GRID]||this._permissions[m.CONFIG]:!1:E[t]?this._permissions?this._permissions.isSup||this._permissions[t]:!1:!0}getTitle(t){var e;let s;return this.isAllowed(t)?s=this._titleKeyByElement[t]:s="snkTaskbar.forbidden",s?(e=this.messagesBuilder)===null||e===void 0?void 0:e.getMessage(s,{}):""}elementClick(t){S.whenResolve(this._element,k.TASKBAR_CLICK).then(()=>{if(this.dataUnit)switch(t){case i.PREVIOUS:this.dataUnit.previousRecord();break;case i.NEXT:this.dataUnit.nextRecord();break;case i.REFRESH:this.dataUnit.loadData();break;case i.CLONE:this.dataUnit.copySelected();break;case i.REMOVE:this.dataUnit.removeSelectedRecords();break;case i.INSERT:this.dataUnit.addRecord();break;case i.CANCEL:this.dataUnit.cancelEdition();break;case i.SAVE:this._isWaitingForSave||(this._isWaitingForSave=!0,this.dataUnit.saveData().catch(e=>{if(!(e instanceof b))throw e}).finally(()=>{this._isWaitingForSave=!1}));break}this.isEnabled(t)&&this.actionClick.emit(t)})}isEnabled(t){return this.isAllowed(t)?!(this.disabledButtons&&this.disabledButtons.includes(t)):!1}validatePresentationMode(){Object.values(h).includes(this.presentationMode)||(this.presentationMode=h.PRIMARY)}getElement(t,e){let s=e===this.primaryButton?"ez-button--primary ":"";t>1&&(s+="ez-padding-left--medium");const n=i[e.toString()],o=this._element.dataset.exporterStoreKey||this.configName;return n?g(e,s,this.getIdElemBtnNative(e),a=>this.getTitle(a),a=>this.elementClick(a),a=>this.isEnabled(a),e!==i.CONFIGURATOR?this.buildDynamicActionsList():this.buildActionsSettingsList(),o,this.presentationMode):O(e,s,this.getIdElemBtnCustom(e),a=>this.elementClick(a),a=>this.isEnabled(a))}buildDynamicActionsList(){var t;return this._hiddenActionsList.length?[...(t=this.actionsList)!==null&&t!==void 0?t:[],...this._hiddenActionsList]:this.actionsList}buildActionsSettingsList(){return this.actionsSettingsList}getIdElemBtnNative(t){return u.toCamelCase(t)}getIdElemBtnCustom(t){return u.toCamelCase(t.name)}isDivider(t){var e;return t===void 0?!1:(e=t.$attrs$)===null||e===void 0?void 0:e["data-taskbar-divider"]}removeEmpty(t){let e;return t.filter(s=>s==null||this.isDivider(e)&&this.isDivider(s)?!1:(e=s,!0))}appendCustomElementsInTaskbar(){this._customElementsId.forEach(t=>{const e=t.replace(this.TASKBAR_ITEM_ID_PREFIX,""),s=this._customElements.get(e),n=this._element.querySelector(`#${t}`);n?n==null||n.appendChild(s):this.unlinkCustomElementFromTaskbar(s)})}addCustomElementContainer(t){var e;const s=`${this.TASKBAR_ITEM_ID_PREFIX}${t}`;return this._customElementsId.includes(s)||(this._customElementsId.push(s),(e=this._overFlowWatcher)===null||e===void 0||e.addNotOverFlowElement(s)),l("span",{class:"ez-padding-left--medium",key:s,id:s})}getCustomElements(t){var e,s;this._customElementsId=[],this._customElements=new Map,this._slotContainer=this.buildSlotContainer(t),Array.from((s=(e=this._slotContainer)===null||e===void 0?void 0:e.children)!==null&&s!==void 0?s:[]).forEach(o=>this._customElements.set(o.id,o))}buildSlotContainer(t){let e;if(this.customContainerId){const s=document.querySelector(`#${this.customContainerId}`);e=s==null?void 0:s.querySelector(`#${this.customSlotId}`)}else e=this._element.querySelector(`#${this.customSlotId}`);return t&&!e&&(e=document.querySelector(`#${this.customSlotId}`)),e}componentWillLoad(){this._application=p.getContextValue("__SNK__APPLICATION__"),this._application?this._application.getAllAccess(this.resourceID).then(t=>this._permissions=t):this._permissions={},this.getCustomElements()}componentWillRender(){this.handleDefinitions(),this.validatePresentationMode(),this.updateOverFlowIfNeeded()}handleDefinitions(){this._definitions==null&&this._permissions&&(this._definitions=this.elementsFromString(this.buttons))}updateOverFlowIfNeeded(){this._hasToUpdateOverFlow&&(requestAnimationFrame(()=>{var t;return(t=this._overFlowWatcher)===null||t===void 0?void 0:t.forceUpdate()}),this._hasToUpdateOverFlow=!1)}handleOverFlow(t){const e=t.filter(s=>!this.hasToIgnoreOverFlow(s));this.resetOverFlowedElements(),this.doOverFlowElements(e)}resetOverFlowedElements(){this._overFlowedElements.forEach(t=>{t.classList.remove(c)}),this._hiddenActionsList=[],this._overFlowedElements=[]}doOverFlowElements(t){t.forEach(e=>{e.classList.add(c),this._overFlowedElements.push(e),this.addItemToActionList(e)})}addItemToActionList(t){const e=this.getTaskbarElementName(t);if(e&&this.isEnabled(e)&&this.isAllowed(e)){const s={value:e,label:this.getTaskbarElementLabel(t),iconName:this.getTaskbarElementIcon(t)};this._hiddenActionsList.push(s)}}getTaskbarElementName(t){var e;return(e=t.getAttribute("data-taskbar-element"))!==null&&e!==void 0?e:""}getTaskbarElementIcon(t){var e;return(e=t.getAttribute("data-taskbar-icon"))!==null&&e!==void 0?e:""}getTaskbarElementLabel(t){var e;return(e=t.getAttribute("data-taskbar-label"))!==null&&e!==void 0?e:""}hasToIgnoreOverFlow(t){return t.classList.contains(this.TASKBAR_CUSTOM_ELEMENTS_CONTAINER_CLASS_NAME)}handleOverFlowStrategy(){this.overflowStrategy==="hiddenItems"&&(this._overFlowWatcher=new I(this.buildOverFlowWatcherParams()))}buildOverFlowWatcherParams(){return{element:this._element,callback:this.handleOverFlow.bind(this),overFlowDirection:T.HORIZONTAL,notOverFlow:this.NOT_OVERFLOW_ELEMENTS}}componentDidLoad(){const t={dataUnit:this.dataUnit};A.addIDInfo(this._element,null,t),this.handleOverFlowStrategy(),this.dataUnit.subscribe(this.onSaveEvent)}componentDidRender(){this.appendCustomElementsInTaskbar(),this.updateLastWidth()}updateLastWidth(){this._lastWidth=this._element.getBoundingClientRect().width}disconnectedCallback(){var t,e;(t=this.dataUnit)===null||t===void 0||t.unsubscribe(this.onSaveEvent),this.unlinkAllCustomElements(),(e=this._overFlowWatcher)===null||e===void 0||e.destroy()}unlinkAllCustomElements(){var t;(t=this._customElementsId)===null||t===void 0||t.forEach(e=>{const s=e.replace(this.TASKBAR_ITEM_ID_PREFIX,""),n=this._customElements.get(s);this.unlinkCustomElementFromTaskbar(n)})}unlinkCustomElementFromTaskbar(t){this._slotContainer.appendChild(t)}render(){var t;if(this._definitions===void 0)return;let e=0;return l(v,{class:this.getHostClasses()},this.removeEmpty(this._definitions.map(s=>{var n,o;return e++,i[s]?this.getElement(e,i[s]):!((n=this.customButtons)===null||n===void 0)&&n.has(s)?this.getElement(e,this.customButtons.get(s)):this._customElements.has(s)?this.addCustomElementContainer(s):((o=this._overFlowWatcher)===null||o===void 0||o.addNotOverFlowElement(s),l("slot",{name:s}))})),l("div",{id:this.TASKBAR_CUSTOM_ELEMENTS,class:this.TASKBAR_CUSTOM_ELEMENTS_CONTAINER_CLASS_NAME},l("slot",{name:this.customSlotId}),(t=this._overFlowWatcher)===null||t===void 0?void 0:t.addNotOverFlowElement(this.TASKBAR_CUSTOM_ELEMENTS)))}getHostClasses(){return this.overflowStrategy!=="hiddenItems"?"no-wrap":`full-width ${this.alignRigth?"align-right":""}`}get _element(){return f(this)}static get watchers(){return{buttons:["observeButtons"],disabledButtons:["observeDisabledButtons"],_lastWidth:["observeLastWidth"],_isWaitingForSave:["observeIsWaitingForSave"]}}};L.style=F;export{L as snk_taskbar};
